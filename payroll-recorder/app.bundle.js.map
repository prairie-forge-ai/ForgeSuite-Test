{
  "version": 3,
  "sources": ["src/constants.js", "../Common/gateway.js", "../Common/tab-visibility.js", "../Common/constants.js", "../Common/copilot.js", "../Common/homepage-sheet.js", "../Common/icons.js", "../Common/notes-signoff.js", "../Common/workflow-validation.js", "../Common/sheet-formatting.js", "src/workflow.js"],
  "sourcesContent": ["export const VERSION = \"1.0.0.7\";\n\nexport const SHEET_NAMES = {\n    CONFIG: \"SS_PF_Config\",\n    DATA: \"PR_Data\",\n    DATA_CLEAN: \"PR_Data_Clean\",\n    EXPENSE_MAPPING: \"PR_Expense_Mapping\",\n    EXPENSE_REVIEW: \"PR_Expense_Review\",\n    JE_DRAFT: \"PR_JE_Draft\",\n    ARCHIVE_SUMMARY: \"PR_Archive_Summary\"\n};\n\nexport const PAY_CATEGORY_HEADERS = [\n    \"Regular Hours\",\n    \"Overtime Hours\",\n    \"Holiday Hours\",\n    \"Vacation Hours\",\n    \"Sick Hours\",\n    \"Bonus\",\n    \"Commission\",\n    \"Reimbursement\",\n    \"Other Pay\",\n    \"Federal Taxes\",\n    \"State Taxes\",\n    \"Social Security Tax\",\n    \"Medicare Tax\",\n    \"State Disability\",\n    \"Unemployment Tax\",\n    \"Workers Comp\",\n    \"Health Insurance\",\n    \"Dental Insurance\",\n    \"Vision Insurance\",\n    \"Life Insurance\",\n    \"401k Employee\",\n    \"401k Employer\",\n    \"Other Deductions\"\n];\n\nexport const SHEET_BLUEPRINTS = [\n    {\n        name: \"Instructions\",\n        description: \"How to use the Prairie Forge payroll template\"\n    },\n    {\n        name: \"Data_Input\",\n        description: \"Paste WellsOne export data here\"\n    },\n    {\n        name: SHEET_NAMES.CONFIG,\n        description: \"Prairie Forge shared configuration storage (all modules)\"\n    },\n    // PR_Config removed - consolidated into SS_PF_Config\n    {\n        name: \"Config_Keywords\",\n        description: \"Keyword-based account mapping rules\"\n    },\n    {\n        name: \"Config_Accounts\",\n        description: \"Account rewrite rules\"\n    },\n    {\n        name: \"Config_Locations\",\n        description: \"Location normalization rules\"\n    },\n    {\n        name: \"Config_Vendors\",\n        description: \"Vendor-specific overrides\"\n    },\n    {\n        name: \"Config_Settings\",\n        description: \"Prairie Forge system settings\"\n    },\n    {\n        name: SHEET_NAMES.EXPENSE_MAPPING,\n        description: \"Expense category mappings\"\n    },\n    {\n        name: SHEET_NAMES.DATA,\n        description: \"Processed payroll data staging\"\n    },\n    {\n        name: SHEET_NAMES.DATA_CLEAN,\n        description: \"Cleaned and validated payroll data\"\n    },\n    {\n        name: SHEET_NAMES.EXPENSE_REVIEW,\n        description: \"Expense review workspace\"\n    },\n    {\n        name: SHEET_NAMES.JE_DRAFT,\n        description: \"Journal entry preparation area\"\n    }\n];\n\nexport const TABLE_BLUEPRINTS = [\n    {\n        sheetName: \"Config_Keywords\",\n        tableName: \"KeywordMappings\",\n        description: \"Keyword-based account mapping rules\",\n        headers: [\"Keyword\", \"New_Account\", \"New_Description\", \"Priority\"],\n        sampleRows: [\n            [\"meal\", \"4980\", \"Meals & Entertainment\", 60],\n            [\"food\", \"4980\", \"Meals & Entertainment\", 60],\n            [\"restaurant\", \"4980\", \"Meals & Entertainment\", 60],\n            [\"software\", \"4250\", \"Software & Subscriptions\", 30],\n            [\"office supplies\", \"4800\", \"Office Supplies\", 40],\n            [\"fuel\", \"4700\", \"Vehicle Fuel\", 50],\n            [\"gas\", \"4700\", \"Vehicle Fuel\", 50]\n        ]\n    },\n    {\n        sheetName: \"Config_Accounts\",\n        tableName: \"AccountRewrites\",\n        description: \"Account rewrite rules\",\n        headers: [\"Old_Account\", \"New_Account\", \"Condition\"],\n        sampleRows: [\n            [\"4620\", \"4980\", \"meal_detected\"],\n            [\"4500\", \"4800\", \"office_supplies\"]\n        ]\n    },\n    {\n        sheetName: \"Config_Locations\",\n        tableName: \"LocationCorrections\",\n        description: \"Location/dept normalization\",\n        headers: [\"Old_Location\", \"New_Location\", \"Department\"],\n        sampleRows: [\n            [\"pf\", \"PF\", \"Operations\"],\n            [\"prairie forge\", \"PF\", \"Operations\"],\n            [\"admin\", \"ADMIN\", \"Administration\"]\n        ]\n    },\n    {\n        sheetName: \"Config_Vendors\",\n        tableName: \"VendorRules\",\n        description: \"Vendor-specific overrides\",\n        headers: [\"Vendor_Pattern\", \"Account\", \"Description\", \"Location\"],\n        sampleRows: [\n            [\"amazon\", \"4800\", \"Office Supplies\", \"PF\"],\n            [\"staples\", \"4800\", \"Office Supplies\", \"PF\"],\n            [\"shell\", \"4700\", \"Vehicle Fuel\", \"PF\"]\n        ]\n    },\n    {\n        sheetName: \"Config_Settings\",\n        tableName: \"Settings\",\n        description: \"General settings\",\n        headers: [\"Setting_Name\", \"Value\", \"Type\"],\n        sampleRows: [\n            [\"capitalizationThreshold\", 3000, \"number\"],\n            [\"version\", VERSION, \"string\"],\n            [\"defaultLocation\", \"PF\", \"string\"]\n        ]\n    }\n];\n\nexport const CONFIG_FIELDS = [\n    {\n        category: \"Company Profile\",\n        field: \"Company Name\",\n        description: \"Displayed on instructions, exports, and journal entries\",\n        required: true\n    },\n    {\n        category: \"Company Profile\",\n        field: \"Logo URL\",\n        description: \"Public image URL for the instruction sheet header\",\n        required: false\n    },\n    {\n        category: \"Branding\",\n        field: \"Brand Primary Color\",\n        description: \"Hex value for table headers\",\n        defaultValue: \"#0078d4\",\n        required: false\n    },\n    {\n        category: \"Branding\",\n        field: \"Brand Accent Color\",\n        description: \"Accent color used in instructions & highlights\",\n        defaultValue: \"#106ebe\",\n        required: false\n    },\n    {\n        category: \"System Links\",\n        field: \"Employee Mapping URL\",\n        description: \"Link to the Employee Mapping workbook\",\n        required: true\n    },\n    {\n        category: \"System Links\",\n        field: \"Payroll Provider URL\",\n        description: \"Source report link or dashboard for payroll\",\n        required: true\n    },\n    {\n        category: \"System Links\",\n        field: \"Accounting Import URL\",\n        description: \"Destination folder or system import link\",\n        required: false\n    },\n    {\n        category: \"System Links\",\n        field: \"Archive Folder URL\",\n        description: \"Location for storing processed payroll archives\",\n        required: false\n    },\n    {\n        category: \"Run Settings\",\n        field: \"Payroll Date (YYYY-MM-DD)\",\n        description: \"Use ISO format; update each payroll run\",\n        required: true\n    },\n    {\n        category: \"Run Settings\",\n        field: \"Reporting Period\",\n        description: \"Readable label for the payroll period (e.g., Jan 2025)\",\n        required: true\n    },\n    {\n        category: \"Run Settings\",\n        field: \"JE Transaction ID\",\n        description: \"Unique identifier for exported journal entries\",\n        required: false\n    },\n    {\n        category: \"Run Settings\",\n        field: \"Builder Mode\",\n        description: \"TRUE keeps consultant tools visible; set to FALSE before handing the workbook to customers.\",\n        defaultValue: \"TRUE\",\n        required: true\n    }\n];\n\nexport const WORKFLOW_STEPS = [\n    {\n        id: 0,\n        title: \"Configuration Setup\",\n        summary: \"Company profile, branding, and run settings\",\n        description: \"Keep the SS_PF_Config table current before every payroll run so downstream sheets inherit the right colors, links, and identifiers.\",\n        icon: \"\uD83E\uDDED\",\n        ctaLabel: \"Open Configuration Form\",\n        statusHint: \"Configuration edits happen inside the PF_Config table and are available to every step instantly.\",\n        highlights: [\n            {\n                label: \"Company Profile\",\n                detail: \"Company name, logos, payroll date, reporting period.\"\n            },\n            {\n                label: \"Brand Identity\",\n                detail: \"Primary + accent colors carry through dashboards and exports.\"\n            },\n            {\n                label: \"System Links\",\n                detail: \"Quick jumps to HRIS, payroll provider, accounting import, and archive folders.\"\n            }\n        ],\n        checklist: [\n            \"Review profile, branding, links, and run settings each payroll cycle.\",\n            \"Click Save to write updates back to the SS_PF_Config sheet.\"\n        ]\n    },\n    {\n        id: 1,\n        title: \"Import Payroll Data\",\n        summary: \"Paste the payroll provider export into the Data sheet\",\n        description: \"Pull your payroll data from your provider\u2019s portal and paste it into the Data tab. If the columns match, just paste the rows; if they don\u2019t, paste your headers and data right over the top. Formatting is fully automated.\",\n        icon: \"\uD83D\uDCE5\",\n        ctaLabel: \"Prepare Import Sheet\",\n        statusHint: \"The Data worksheet is activated so you can paste the latest provider export.\",\n        highlights: [\n            {\n                label: \"Source File\",\n                detail: \"Use WellsOne/ADP export with every pay category column visible.\"\n            },\n            {\n                label: \"Structure\",\n                detail: \"Row 2 headers, row 3+ data, no blank columns, totals removed.\"\n            },\n            {\n                label: \"Quality\",\n                detail: \"Spot-check employee counts and pay period filters before moving on.\"\n            }\n        ],\n        checklist: [\n            \"Download the payroll detail export covering this pay period.\",\n            \"Paste values into the Data sheet starting at cell A3.\",\n            \"Confirm all pay category headers remain intact and spelled consistently.\"\n        ]\n    },\n    {\n        id: 2,\n        title: \"Headcount Review\",\n        summary: \"Ensure roster and payroll rows agree\",\n        description: \"This step is optional, but strongly recommended. A centralized employee roster keeps every payroll-related workbook aligned while ensuring key attributes such as department and location stay consistent each pay period.\",\n        icon: \"\uD83D\uDC65\",\n        ctaLabel: \"Launch Headcount Review\",\n        statusHint: \"Data and mapping sheets are surfaced so you can reconcile roster counts before validation.\",\n        highlights: [\n            {\n                label: \"Roster Alignment\",\n                detail: \"Compare active roster to the employees present in the Data sheet.\"\n            },\n            {\n                label: \"Variance Tracking\",\n                detail: \"Note missing departments or unexpected hires before the validation run.\"\n            },\n            {\n                label: \"Approvals\",\n                detail: \"Capture reviewer initials and date for audit coverage.\"\n            }\n        ],\n        checklist: [\n            \"Filter the Data sheet by Department to ensure every team appears.\",\n            \"Look for duplicate or out-of-period employees and resolve upstream.\",\n            \"Document findings on the Headcount Review tab or your tracker of choice.\"\n        ]\n    },\n    {\n        id: 3,\n        title: \"Validate & Reconcile\",\n        summary: \"Normalize payroll data and reconcile totals\",\n        description: \"Automatically rebuild the PR_Data_Clean sheet, confirm payroll totals match, and prep the bank reconciliation before moving to Expense Review.\",\n        icon: \"\u2705\",\n        statusHint: \"Run completes automatically when you enter this step.\",\n        highlights: [\n            {\n                label: \"Normalized Data\",\n                detail: \"Creates one row per employee and payroll category.\"\n            },\n            {\n                label: \"Outputs\",\n                detail: \"Data_Clean rebuilt with payroll category + mapping details.\"\n            },\n            {\n                label: \"Reconciliation\",\n                detail: \"Displays PR_Data vs PR_Data_Clean totals plus bank comparison.\"\n            }\n        ]\n    },\n    {\n        id: 4,\n        title: \"Expense Review\",\n        summary: \"Generate an executive-ready payroll summary\",\n        description: \"Build a six-period payroll dashboard (current + five prior), including department-level breakouts and variance indicators, plus notes and CoPilot guidance.\",\n        icon: \"\uD83D\uDCCA\",\n        statusHint: \"Selecting this step rebuilds PR_Expense_Review automatically.\",\n        highlights: [\n            {\n                label: \"Time Series\",\n                detail: \"Shows six consecutive payroll periods.\"\n            },\n            {\n                label: \"Departments\",\n                detail: \"All-in totals, burden rates, and headcount by department.\"\n            },\n            {\n                label: \"Guidance\",\n                detail: \"Use CoPilot to summarize trends and capture review notes.\"\n            }\n        ],\n        checklist: []\n    },\n    {\n        id: 5,\n        title: \"Journal Entry Prep\",\n        summary: \"Generate a QuickBooks-ready journal draft\",\n        description: \"Create the JE Draft sheet with the headers QuickBooks Online/Desktop expect so you only need to paste balanced lines.\",\n        icon: \"\uD83E\uDDFE\",\n        ctaLabel: \"Generate JE Draft\",\n        statusHint: \"JE Draft contains headers for RefNumber, TxnDate, account columns, and line descriptions.\",\n        highlights: [\n            {\n                label: \"Structure\",\n                detail: \"Debit/Credit columns prepared with standard import headers.\"\n            },\n            {\n                label: \"Context\",\n                detail: \"JE Transaction ID from configuration is referenced for traceability.\"\n            },\n            {\n                label: \"Next Step\",\n                detail: \"Populate amounts from Expense Review to finalize the journal.\"\n            }\n        ],\n        checklist: [\n            \"Ensure validation + expense review steps are complete.\",\n            \"Run the generator to rebuild the JE Draft sheet.\",\n            \"Paste balanced lines and export to QuickBooks / ERP import format.\"\n        ]\n    },\n    {\n        id: 6,\n        title: \"Archive & Clear\",\n        summary: \"Snapshot workpapers and reset working tabs\",\n        description: \"Capture a log of each payroll run, note the archive destination, and optionally clear staging sheets for the next cycle.\",\n        icon: \"\uD83D\uDDC2\uFE0F\",\n        ctaLabel: \"Create Archive Summary\",\n        statusHint: \"Archive summary headers help you log when data was exported and where the files live.\",\n        highlights: [\n            {\n                label: \"Run Log\",\n                detail: \"Payroll date, reporting period, JE ID, and who processed the run.\"\n            },\n            {\n                label: \"Storage\",\n                detail: \"Link to the Archive folder defined in configuration.\"\n            },\n            {\n                label: \"Reset\",\n                detail: \"Reminder to clear Data/Data_Clean once files are safely archived.\"\n            }\n        ],\n        checklist: [\n            \"Record archive destination links and reviewer approvals.\",\n            \"Copy Data/Data_Clean/JE Draft tabs to the archive workbook if needed.\",\n            \"Clear sensitive data so the template is ready for the next payroll.\"\n        ]\n    }\n];\n\nconst globalBuilderAllowlist =\n    (typeof window !== \"undefined\" && Array.isArray(window.PF_BUILDER_ALLOWLIST)\n        ? window.PF_BUILDER_ALLOWLIST\n        : []\n    ).map((entry) => String(entry || \"\").trim().toLowerCase());\n\nexport const BUILDER_ALLOWED_USERS = globalBuilderAllowlist;\n\nexport const BUILDER_VISIBILITY_SHEETS = [\n    \"Instructions\",\n    \"Config_Keywords\",\n    \"Config_Accounts\",\n    \"Config_Locations\",\n    \"Config_Vendors\",\n    \"Config_Settings\"\n];\n\nexport const METRIC_ELEMENT_IDS = {\n    dataEmployees: \"metric-data-employees\",\n    rosterEmployees: \"metric-roster-employees\",\n    difference: \"metric-difference\",\n    nameDifferences: \"metric-name-diffs\",\n    departmentMismatches: \"metric-dept-mismatches\"\n};\n\nexport const JE_METRIC_ELEMENT_IDS = {\n    sourceTotal: \"je-metric-source\",\n    debitTotal: \"je-metric-debit\",\n    creditTotal: \"je-metric-credit\",\n    variance: \"je-metric-variance\"\n};\n\nexport const LOGO_URL = \"https://assets.prairieforge.ai/storage/v1/object/public/Other%20Public%20Material/Smartsheet_noBR.png\";\n", "/**\n * Gateway - Shared Office/Excel initialization and helpers for all modules\n */\n\n// Excel runtime check\nexport function hasExcelRuntime() {\n    return typeof Excel !== \"undefined\" && typeof Excel.run === \"function\";\n}\n\n// Initialize Office and call the provided callback when ready\nexport function initializeOffice(onReady) {\n    try {\n        Office.onReady((info) => {\n            console.log(\"Office.onReady fired:\", info);\n            if (info.host === Office.HostType.Excel) {\n                onReady(info);\n            } else {\n                console.warn(\"Not running in Excel, host:\", info.host);\n                onReady(info); // Still init for testing\n            }\n        });\n    } catch (error) {\n        console.warn(\"Office.onReady failed:\", error);\n        onReady(null);\n    }\n}\n\n// Shared config table name - single source of truth for all modules\nexport const SHARED_CONFIG_TABLE = \"SS_PF_Config\";\n\n// Find a config table by name candidates (prioritizes SS_PF_Config)\nexport async function getConfigTable(context, tableCandidates = [SHARED_CONFIG_TABLE]) {\n    const tables = context.workbook.tables;\n    tables.load(\"items/name\");\n    await context.sync();\n\n    const match = tables.items?.find((t) => tableCandidates.includes(t.name));\n    if (!match) {\n        console.warn(\"Config table not found. Looking for:\", tableCandidates);\n        return null;\n    }\n\n    return context.workbook.tables.getItem(match.name);\n}\n\n// Get column indices from table headers\nexport function getColumnIndices(headers) {\n    const normalizedHeaders = headers.map(h => String(h || \"\").trim().toLowerCase());\n    return {\n        field: normalizedHeaders.findIndex(h => h === \"field\" || h === \"field name\" || h === \"setting\"),\n        value: normalizedHeaders.findIndex(h => h === \"value\" || h === \"setting value\"),\n        type: normalizedHeaders.findIndex(h => h === \"type\" || h === \"category\"),\n        title: normalizedHeaders.findIndex(h => h === \"title\" || h === \"display name\"),\n        permanent: normalizedHeaders.findIndex(h => h === \"permanent\" || h === \"persist\")\n    };\n}\n\n// Load configuration from a config table\nexport async function loadConfigFromTable(tableCandidates = [SHARED_CONFIG_TABLE]) {\n    if (!hasExcelRuntime()) {\n        return {};\n    }\n\n    try {\n        return await Excel.run(async (context) => {\n            const table = await getConfigTable(context, tableCandidates);\n            if (!table) {\n                return {};\n            }\n\n            const body = table.getDataBodyRange();\n            const headerRange = table.getHeaderRowRange();\n            body.load(\"values\");\n            headerRange.load(\"values\");\n            await context.sync();\n\n            const headers = headerRange.values[0] || [];\n            const cols = getColumnIndices(headers);\n\n            if (cols.field === -1 || cols.value === -1) {\n                console.warn(\"Config table missing FIELD or VALUE columns. Headers:\", headers);\n                return {};\n            }\n\n            const values = {};\n            const rows = body.values || [];\n            rows.forEach((row) => {\n                const field = String(row[cols.field] || \"\").trim();\n                if (field) {\n                    values[field] = row[cols.value] ?? \"\";\n                }\n            });\n\n            console.log(\"Configuration loaded:\", Object.keys(values).length, \"fields\");\n            return values;\n        });\n    } catch (error) {\n        console.error(\"Failed to load configuration:\", error);\n        return {};\n    }\n}\n\n// Save a config value to a config table\nexport async function saveConfigValue(fieldName, value, tableCandidates = [SHARED_CONFIG_TABLE]) {\n    if (!hasExcelRuntime()) return false;\n\n    try {\n        await Excel.run(async (context) => {\n            const table = await getConfigTable(context, tableCandidates);\n            if (!table) {\n                console.warn(\"Config table not found for write\");\n                return;\n            }\n\n            const body = table.getDataBodyRange();\n            const headerRange = table.getHeaderRowRange();\n            body.load(\"values\");\n            headerRange.load(\"values\");\n            await context.sync();\n\n            const headers = headerRange.values[0] || [];\n            const cols = getColumnIndices(headers);\n\n            if (cols.field === -1 || cols.value === -1) {\n                console.error(\"Config table missing FIELD or VALUE columns\");\n                return;\n            }\n\n            const rows = body.values || [];\n            const targetIndex = rows.findIndex(\n                (row) => String(row[cols.field] || \"\").trim() === fieldName\n            );\n\n            if (targetIndex >= 0) {\n                body.getCell(targetIndex, cols.value).values = [[value]];\n            } else {\n                // Add new row with Category, Field, Value, Permanent structure\n                const newRow = new Array(headers.length).fill(\"\");\n                if (cols.type >= 0) newRow[cols.type] = \"Run Settings\";\n                newRow[cols.field] = fieldName;\n                newRow[cols.value] = value;\n                if (cols.permanent >= 0) newRow[cols.permanent] = \"N\";\n                if (cols.title >= 0) newRow[cols.title] = \"\";\n                table.rows.add(null, [newRow]);\n                console.log(\"Added new config row:\", fieldName, \"=\", value);\n            }\n\n            await context.sync();\n            console.log(\"Saved config:\", fieldName, \"=\", value);\n        });\n        return true;\n    } catch (error) {\n        console.error(\"Failed to save config:\", fieldName, error);\n        return false;\n    }\n}\n\n// Activate a worksheet by name\nexport async function activateWorksheet(sheetName) {\n    if (!hasExcelRuntime()) return;\n\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItemOrNullObject(sheetName);\n            await context.sync();\n            if (!sheet.isNullObject) {\n                sheet.activate();\n                await context.sync();\n            }\n        });\n    } catch (error) {\n        console.error(\"Failed to activate worksheet:\", sheetName, error);\n    }\n}\n\n// Get used range values from a worksheet\nexport async function getSheetData(sheetName) {\n    if (!hasExcelRuntime()) return [];\n\n    try {\n        return await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(sheetName);\n            const range = sheet.getUsedRangeOrNullObject();\n            range.load(\"values\");\n            await context.sync();\n\n            if (range.isNullObject) {\n                return [];\n            }\n            return range.values || [];\n        });\n    } catch (error) {\n        console.error(\"Failed to get sheet data:\", sheetName, error);\n        return [];\n    }\n}\n\n// Write data to a worksheet (clears existing data first)\nexport async function writeSheetData(sheetName, data) {\n    if (!hasExcelRuntime() || !data.length) return false;\n\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(sheetName);\n            const existingRange = sheet.getUsedRangeOrNullObject();\n            await context.sync();\n\n            if (!existingRange.isNullObject) {\n                existingRange.clear();\n            }\n\n            const targetRange = sheet.getRangeByIndexes(0, 0, data.length, data[0].length);\n            targetRange.values = data;\n            await context.sync();\n        });\n        return true;\n    } catch (error) {\n        console.error(\"Failed to write sheet data:\", sheetName, error);\n        return false;\n    }\n}\n", "import { hasExcelRuntime } from \"./gateway.js\";\n\nconst CONFIG_SHEET_NAME = \"SS_PF_Config\";\nconst PREFIX_CATEGORY = \"module-prefix\";\nconst SYSTEM_MODULE = \"system\"; // Special module key for SS_ prefix\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PREFIX-BASED TAB VISIBILITY\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// \n// Tab visibility is driven by prefixes defined in SS_PF_Config:\n// \n// | Category      | Field (Prefix) | Value (Module)    |\n// |---------------|----------------|-------------------|\n// | module-prefix | PR_            | payroll-recorder  |\n// | module-prefix | PTO_           | pto-accrual       |\n// | module-prefix | SS_            | system            |\n// \n// When entering a module:\n// 1. Show tabs with that module's prefix\n// 2. Hide tabs with other module prefixes  \n// 3. Always hide \"system\" prefix tabs (SS_*)\n// 4. Leave non-prefixed tabs as-is\n//\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n// Fallback prefix config if SS_PF_Config doesn't have module-prefix rows\nconst DEFAULT_PREFIX_CONFIG = {\n    \"PR_\": \"payroll-recorder\",\n    \"PTO_\": \"pto-accrual\",\n    \"CC_\": \"credit-card-expense\",\n    \"COM_\": \"commission-calc\",\n    \"SS_\": \"system\"\n};\n\n// Valid categories for SS_PF_Config\nexport const VALID_CATEGORIES = {\n    \"module-prefix\": {\n        label: \"Module Prefix\",\n        description: \"Maps tab prefixes to modules (e.g., PR_ \u2192 payroll-recorder)\",\n        requiresValue2: false\n    },\n    \"run-settings\": {\n        label: \"Run Settings\",\n        description: \"Per-period configuration values (payroll date, accounting period, etc.)\",\n        requiresValue2: false\n    },\n    \"step-notes\": {\n        label: \"Step Notes\",\n        description: \"Notes and sign-off data for workflow steps\",\n        requiresValue2: false\n    },\n    \"shared\": {\n        label: \"Shared\",\n        description: \"Global settings shared across all modules\",\n        requiresValue2: false\n    },\n    \"column-mapping\": {\n        label: \"Column Mapping\",\n        description: \"Maps source columns to target columns for data import\",\n        requiresValue2: false\n    }\n};\n\n// Get list of valid category values\nexport function getValidCategoryKeys() {\n    return Object.keys(VALID_CATEGORIES);\n}\n\n/**\n * Read prefix \u2192 module mappings from SS_PF_Config\n * Falls back to DEFAULT_PREFIX_CONFIG if not found\n * @returns {Promise<Object>} Map of prefix \u2192 moduleKey\n */\nasync function getPrefixConfig() {\n    if (!hasExcelRuntime()) return { ...DEFAULT_PREFIX_CONFIG };\n    \n    try {\n        return await Excel.run(async (context) => {\n            const configSheet = context.workbook.worksheets.getItemOrNullObject(CONFIG_SHEET_NAME);\n            await context.sync();\n            \n            if (configSheet.isNullObject) {\n                console.log(\"[Tab Visibility] Config sheet not found, using defaults\");\n                return { ...DEFAULT_PREFIX_CONFIG };\n            }\n            \n            const usedRange = configSheet.getUsedRangeOrNullObject();\n            usedRange.load(\"values\");\n            await context.sync();\n            \n            if (usedRange.isNullObject || !usedRange.values?.length) {\n                return { ...DEFAULT_PREFIX_CONFIG };\n            }\n            \n            const values = usedRange.values;\n            const headerMap = buildHeaderMap(values[0]);\n            const categoryIdx = headerMap.get(\"category\");\n            const fieldIdx = headerMap.get(\"field\");\n            const valueIdx = headerMap.get(\"value\");\n            \n            if (categoryIdx === undefined || fieldIdx === undefined || valueIdx === undefined) {\n                console.warn(\"[Tab Visibility] Missing required columns, using defaults\");\n                return { ...DEFAULT_PREFIX_CONFIG };\n            }\n            \n            const prefixConfig = {};\n            let foundPrefixRows = false;\n            \n            for (let i = 1; i < values.length; i++) {\n                const row = values[i];\n                const category = normalizeToken(row[categoryIdx]);\n                \n                if (category === PREFIX_CATEGORY) {\n                    const prefix = String(row[fieldIdx] ?? \"\").trim().toUpperCase();\n                    const moduleKey = normalizeToken(row[valueIdx]);\n                    \n                    if (prefix && moduleKey) {\n                        prefixConfig[prefix] = moduleKey;\n                        foundPrefixRows = true;\n                    }\n                }\n            }\n            \n            if (!foundPrefixRows) {\n                console.log(\"[Tab Visibility] No module-prefix rows found, using defaults\");\n                return { ...DEFAULT_PREFIX_CONFIG };\n            }\n            \n            console.log(\"[Tab Visibility] Loaded prefix config:\", prefixConfig);\n            return prefixConfig;\n        });\n    } catch (error) {\n        console.warn(\"[Tab Visibility] Error reading prefix config:\", error);\n        return { ...DEFAULT_PREFIX_CONFIG };\n    }\n}\n\n/**\n * Apply tab visibility based on module prefixes\n * @param {string} moduleKey - The module being activated (e.g., \"payroll-recorder\")\n */\nexport async function applyModuleTabVisibility(moduleKey) {\n    if (!hasExcelRuntime()) return;\n    \n    const normalizedModuleKey = normalizeToken(moduleKey);\n    console.log(`[Tab Visibility] Applying visibility for module: ${normalizedModuleKey}`);\n    \n    try {\n        const prefixConfig = await getPrefixConfig();\n        \n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            // Build reverse map: moduleKey \u2192 [prefixes]\n            const modulePrefixes = {};\n            for (const [prefix, module] of Object.entries(prefixConfig)) {\n                if (!modulePrefixes[module]) modulePrefixes[module] = [];\n                modulePrefixes[module].push(prefix);\n            }\n            \n            // Get prefixes for the active module\n            const activePrefixes = modulePrefixes[normalizedModuleKey] || [];\n            const systemPrefixes = modulePrefixes[SYSTEM_MODULE] || [];\n            \n            // Get all OTHER module prefixes (to hide)\n            const otherPrefixes = [];\n            for (const [module, prefixes] of Object.entries(modulePrefixes)) {\n                if (module !== normalizedModuleKey && module !== SYSTEM_MODULE) {\n                    otherPrefixes.push(...prefixes);\n                }\n            }\n            \n            console.log(`[Tab Visibility] Active prefixes: ${activePrefixes.join(\", \")}`);\n            console.log(`[Tab Visibility] Other module prefixes (to hide): ${otherPrefixes.join(\", \")}`);\n            console.log(`[Tab Visibility] System prefixes (always hide): ${systemPrefixes.join(\", \")}`);\n            \n            const toShow = [];\n            const toHide = [];\n            \n            worksheets.items.forEach((sheet) => {\n                const sheetName = sheet.name;\n                const upperName = sheetName.toUpperCase();\n                \n                // Check if sheet matches active module prefix \u2192 SHOW\n                const matchesActive = activePrefixes.some(p => upperName.startsWith(p));\n                \n                // Check if sheet matches other module prefix \u2192 HIDE\n                const matchesOther = otherPrefixes.some(p => upperName.startsWith(p));\n                \n                // Check if sheet matches system prefix \u2192 ALWAYS HIDE\n                const matchesSystem = systemPrefixes.some(p => upperName.startsWith(p));\n                \n                if (matchesActive) {\n                    toShow.push(sheet);\n                    console.log(`[Tab Visibility] SHOW: ${sheetName} (matches active module prefix)`);\n                } else if (matchesSystem) {\n                    toHide.push(sheet);\n                    console.log(`[Tab Visibility] HIDE: ${sheetName} (system sheet)`);\n                } else if (matchesOther) {\n                    toHide.push(sheet);\n                    console.log(`[Tab Visibility] HIDE: ${sheetName} (other module prefix)`);\n                } else {\n                    // Non-prefixed sheet - leave as-is\n                    console.log(`[Tab Visibility] SKIP: ${sheetName} (no prefix match, leaving as-is)`);\n                }\n            });\n            \n            // First, show all tabs that should be visible\n            for (const sheet of toShow) {\n                sheet.visibility = Excel.SheetVisibility.visible;\n            }\n            await context.sync();\n            \n            // Count visible sheets to ensure we don't hide all of them\n            const visibleCount = worksheets.items.filter(\n                s => s.visibility === Excel.SheetVisibility.visible\n            ).length;\n            \n            // Then hide tabs (ensure at least one stays visible)\n            if (visibleCount > toHide.length) {\n                for (const sheet of toHide) {\n                    try {\n                        sheet.visibility = Excel.SheetVisibility.hidden;\n                    } catch (e) {\n                        console.warn(`[Tab Visibility] Could not hide \"${sheet.name}\":`, e.message);\n                    }\n                }\n                await context.sync();\n            } else {\n                console.warn(\"[Tab Visibility] Skipping hide - would leave no visible sheets\");\n            }\n            \n            console.log(`[Tab Visibility] Done! Showed ${toShow.length}, hid ${toHide.length} tabs`);\n        });\n    } catch (error) {\n        console.warn(`[Tab Visibility] Error applying visibility:`, error);\n    }\n}\n\n/**\n * Hide system sheets (SS_* prefix)\n * Called on workbook open\n */\nexport async function hideSystemSheets() {\n    if (!hasExcelRuntime()) return;\n    \n    try {\n        const prefixConfig = await getPrefixConfig();\n        const systemPrefixes = [];\n        \n        for (const [prefix, module] of Object.entries(prefixConfig)) {\n            if (module === SYSTEM_MODULE) {\n                systemPrefixes.push(prefix);\n            }\n        }\n        \n        if (!systemPrefixes.length) {\n            systemPrefixes.push(\"SS_\"); // Fallback\n        }\n        \n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            const visibleSheets = worksheets.items.filter(\n                sheet => sheet.visibility === Excel.SheetVisibility.visible\n            );\n            \n            let hiddenCount = 0;\n            \n            worksheets.items.forEach((sheet) => {\n                const upperName = sheet.name.toUpperCase();\n                const isSystem = systemPrefixes.some(p => upperName.startsWith(p));\n                \n                if (isSystem && visibleSheets.length - hiddenCount > 1) {\n                    sheet.visibility = Excel.SheetVisibility.hidden;\n                    hiddenCount++;\n                    console.log(`[Tab Visibility] Hidden system sheet: ${sheet.name}`);\n                }\n            });\n            \n            await context.sync();\n        });\n    } catch (error) {\n        console.warn(\"[Tab Visibility] Error hiding system sheets:\", error);\n    }\n}\n\n/**\n * Force ALL sheets to be visible (emergency recovery / debugging)\n * Can be called from console: window.PrairieForge.showAllSheets()\n */\nexport async function showAllSheets() {\n    if (!hasExcelRuntime()) {\n        console.log(\"Excel not available\");\n        return;\n    }\n    \n    try {\n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            let unhiddenCount = 0;\n            worksheets.items.forEach((sheet) => {\n                if (sheet.visibility !== Excel.SheetVisibility.visible) {\n                    sheet.visibility = Excel.SheetVisibility.visible;\n                    console.log(`[ShowAll] Made visible: ${sheet.name}`);\n                    unhiddenCount++;\n                }\n            });\n            \n            await context.sync();\n            console.log(`[ShowAll] Done! Made ${unhiddenCount} sheets visible. Total: ${worksheets.items.length}`);\n        });\n    } catch (error) {\n        console.error(\"[Tab Visibility] Unable to show all sheets:\", error);\n    }\n}\n\n/**\n * Force unhide system sheets\n * Can be called from console: window.PrairieForge.unhideSystemSheets()\n */\nexport async function unhideSystemSheets() {\n    if (!hasExcelRuntime()) {\n        console.log(\"Excel not available\");\n        return;\n    }\n    \n    try {\n        const prefixConfig = await getPrefixConfig();\n        const systemPrefixes = [];\n        \n        for (const [prefix, module] of Object.entries(prefixConfig)) {\n            if (module === SYSTEM_MODULE) {\n                systemPrefixes.push(prefix);\n            }\n        }\n        \n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            worksheets.items.forEach((sheet) => {\n                const upperName = sheet.name.toUpperCase();\n                if (systemPrefixes.some(p => upperName.startsWith(p))) {\n                    sheet.visibility = Excel.SheetVisibility.visible;\n                    console.log(`[Unhide] Made visible: ${sheet.name}`);\n                }\n            });\n            \n            await context.sync();\n            console.log(\"[Unhide] System sheets are now visible!\");\n        });\n    } catch (error) {\n        console.error(\"[Tab Visibility] Unable to unhide system sheets:\", error);\n    }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// HELPER FUNCTIONS\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction buildHeaderMap(headers = []) {\n    const map = new Map();\n    headers.forEach((header, index) => {\n        const normalized = normalizeToken(header);\n        if (normalized) {\n            map.set(normalized, index);\n        }\n    });\n    return map;\n}\n\nfunction normalizeToken(value) {\n    return String(value ?? \"\")\n        .trim()\n        .toLowerCase()\n        .replace(/[\\s_]+/g, \"-\");\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// VALIDATION (for config sheet validation tools)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport function validateConfigRow(row, rowIndex) {\n    const errors = [];\n    const warnings = [];\n    \n    const category = normalizeToken(row.category || row[0] || \"\");\n    const field = String(row.field || row[1] || \"\").trim();\n    const value = String(row.value || row[2] || \"\").trim();\n    \n    if (!category) {\n        errors.push(`Row ${rowIndex}: Missing Category`);\n    } else if (!VALID_CATEGORIES[category]) {\n        errors.push(`Row ${rowIndex}: Invalid Category \"${row.category || row[0]}\". Valid: ${Object.keys(VALID_CATEGORIES).join(\", \")}`);\n    }\n    \n    if (!field) {\n        errors.push(`Row ${rowIndex}: Missing Field name`);\n    }\n    \n    if (!value && category !== \"step-notes\") {\n        warnings.push(`Row ${rowIndex}: Value is empty for \"${field}\"`);\n    }\n    \n    // Prefix validation\n    if (category === PREFIX_CATEGORY) {\n        if (!field.endsWith(\"_\")) {\n            warnings.push(`Row ${rowIndex}: Prefix \"${field}\" should end with underscore (e.g., \"PR_\")`);\n        }\n    }\n    \n    return { errors, warnings, isValid: errors.length === 0 };\n}\n\nexport async function validateConfigSheet() {\n    if (!hasExcelRuntime()) return { errors: [], warnings: [], isValid: true };\n    \n    const results = { errors: [], warnings: [], isValid: true, rowCount: 0 };\n    \n    try {\n        await Excel.run(async (context) => {\n            const configSheet = context.workbook.worksheets.getItemOrNullObject(CONFIG_SHEET_NAME);\n            await context.sync();\n            \n            if (configSheet.isNullObject) {\n                results.errors.push(\"SS_PF_Config sheet not found\");\n                results.isValid = false;\n                return;\n            }\n            \n            const usedRange = configSheet.getUsedRangeOrNullObject();\n            usedRange.load(\"values\");\n            await context.sync();\n            \n            if (usedRange.isNullObject || !usedRange.values || usedRange.values.length < 2) {\n                results.warnings.push(\"SS_PF_Config appears empty or has no data rows\");\n                return;\n            }\n            \n            const rows = usedRange.values;\n            results.rowCount = rows.length - 1;\n            \n            for (let i = 1; i < rows.length; i++) {\n                const row = rows[i];\n                const validation = validateConfigRow({\n                    category: row[0],\n                    field: row[1],\n                    value: row[2]\n                }, i + 1);\n                \n                results.errors.push(...validation.errors);\n                results.warnings.push(...validation.warnings);\n                if (!validation.isValid) results.isValid = false;\n            }\n        });\n    } catch (error) {\n        results.errors.push(`Validation error: ${error.message}`);\n        results.isValid = false;\n    }\n    \n    return results;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// GLOBAL EXPORTS (for console access)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nif (typeof window !== \"undefined\") {\n    window.PrairieForge = window.PrairieForge || {};\n    window.PrairieForge.showAllSheets = showAllSheets;\n    window.PrairieForge.unhideSystemSheets = unhideSystemSheets;\n    window.PrairieForge.applyModuleTabVisibility = applyModuleTabVisibility;\n}\n", "// Shared constants and utilities for Prairie Forge Payroll Recorder\n// Used by both Google Sheets (Apps Script) and Excel (Office.js) versions\n\n// Common worksheet names\nexport const WORKSHEET_NAMES = {\n  EMPLOYEES: 'Employees',\n  PAYROLL: 'PR_Data',\n  VALIDATION: 'PR_Data_Clean',\n  CONFIGURATION: 'SS_PF_Config',\n  EXPENSE_REVIEW: 'PR_Expense_Review',\n  JOURNAL_ENTRY: 'PR_JE_Draft',\n  ARCHIVE: 'PR_Archive_Summary',\n  HEADCOUNT: 'SS_Headcount_Review',\n  RECONCILIATION: 'Reconciliation',\n  IMPORTS: 'Imports',\n  REPORTS: 'Reports',\n  SUMMARY: 'Summary',\n  DASHBOARD: 'Dashboard'\n};\n\n// Common table names for Excel\nexport const TABLE_NAMES = {\n  EMPLOYEE_LIST: 'EmployeeTable',\n  PAYROLL_DATA: 'PayrollTable', \n  CONFIGURATION_SETTINGS: 'ConfigTable',\n  EXPENSE_ITEMS: 'ExpenseTable',\n  JOURNAL_ENTRIES: 'JournalTable'\n};\n\n// Branding constants\nexport const BRANDING = {\n  COMPANY_NAME: 'Prairie Forge LLC',\n  PRODUCT_NAME: 'Prairie Forge Tools',\n  SUPPORT_URL: 'https://prairieforge.ai/support',\n  ADA_IMAGE_URL: 'https://assets.prairieforge.ai/storage/v1/object/public/Other%20Public%20Material/Prairie%20Forge/Ada%20Image.png'\n};\n\n// GitHub repository information\nexport const REPOSITORY = {\n  OWNER: 'prairie-forge-ai',\n  NAME: 'prairie-forge-templates',\n  GITHUB_PAGES_BASE: 'https://prairie-forge-ai.github.io/prairie-forge-templates'\n};\n", "/**\n * Ada - Prairie Forge AI Assistant\n * \n * A stunning, chat-based AI interface that integrates with spreadsheet data\n * to provide intelligent insights and recommendations.\n * \n * Named after Ada Lovelace, the first computer programmer.\n * Powered by ChatGPT (OpenAI).\n * \n * AUTHENTICATION: Uses Supabase Edge Functions - no additional auth required\n * INSTRUCTIONS: Configure via systemPrompt and contextProvider options\n */\n\nimport { BRANDING } from \"./constants.js\";\n\nconst CHATGPT_ICON = `<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.8956zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z\"/></svg>`;\n\n// Arrow icon for send button\nconst SEND_ARROW = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M5 12h14\"/><path d=\"m12 5 7 7-7 7\"/></svg>`;\n\n// Ada character image URL - imported from constants\nconst ADA_IMAGE_URL = BRANDING.ADA_IMAGE_URL;\n\nconst DEFAULT_OPTIONS = {\n    id: \"pf-copilot\",\n    heading: \"Ada\",\n    subtext: \"Your smart assistant to help you analyze and troubleshoot.\",\n    welcomeMessage: \"What would you like to explore?\",\n    placeholder: \"Where should I focus this pay period?\",\n    quickActions: [\n        { id: \"diagnostics\", label: \"Diagnostics\", prompt: \"Run a diagnostic check on the current payroll data. Check for completeness, accuracy issues, and any data quality concerns.\" },\n        { id: \"insights\", label: \"Insights\", prompt: \"What are the key insights and notable findings from this payroll period that I should highlight for executive review?\" },\n        { id: \"variance\", label: \"Variances\", prompt: \"Analyze the significant variances between this period and the prior period. What's driving the changes?\" },\n        { id: \"journal\", label: \"JE Check\", prompt: \"Is the journal entry ready for export? Check that debits equal credits and flag any mapping issues.\" }\n    ],\n    systemPrompt: `You are Prairie Forge CoPilot, an expert financial analyst assistant embedded in an Excel add-in. \n\nYour role is to help accountants and CFOs:\n1. Analyze payroll expense data for accuracy and completeness\n2. Identify trends, anomalies, and areas requiring attention\n3. Prepare executive-ready insights and talking points\n4. Validate journal entries before export\n\nCommunication style:\n- Be concise but thorough\n- Use bullet points for clarity\n- Highlight actionable items with \u26A0\uFE0F or \u2713\n- Format currency as $X,XXX and percentages as X.X%\n- Always suggest 2-3 concrete next steps\n\nWhen analyzing data, look for:\n- Period-over-period changes > 10%\n- Department cost anomalies\n- Headcount vs payroll mismatches\n- Burden rate outliers\n- Missing or incomplete mappings`\n};\n\n// Message history for the session\nlet messageHistory = [];\n\n/**\n * Render the CoPilot card HTML - Apple-inspired design\n */\nexport function renderCopilotCard(options = {}) {\n    const merged = { ...DEFAULT_OPTIONS, ...options };\n    \n    const quickActionsHtml = merged.quickActions?.map(action => \n        `<button type=\"button\" class=\"pf-ada-chip\" data-action=\"${action.id}\" data-prompt=\"${escapeAttr(action.prompt)}\">${action.label}</button>`\n    ).join('') || '';\n    \n    return `\n        <article class=\"pf-ada\" data-copilot=\"${merged.id}\">\n            <header class=\"pf-ada-header\">\n                <div class=\"pf-ada-identity\">\n                    <img class=\"pf-ada-avatar\" src=\"${ADA_IMAGE_URL}\" alt=\"Ada\" onerror=\"this.style.display='none'\" />\n                    <div class=\"pf-ada-name\">\n                        <span class=\"pf-ada-title\"><span class=\"pf-ada-title--ask\">ask</span><span class=\"pf-ada-title--ada\">ADA</span></span>\n                        <span class=\"pf-ada-role\">${merged.subtext}</span>\n                    </div>\n                </div>\n                <div class=\"pf-ada-status\" id=\"${merged.id}-status-badge\" title=\"Ready\">\n                    <span class=\"pf-ada-status-dot\" id=\"${merged.id}-status-dot\"></span>\n                </div>\n            </header>\n            \n            <div class=\"pf-ada-body\">\n                <div class=\"pf-ada-conversation\" id=\"${merged.id}-messages\">\n                    <div class=\"pf-ada-bubble pf-ada-bubble--ai\">\n                        <p>${merged.welcomeMessage}</p>\n                    </div>\n                </div>\n                \n                <div class=\"pf-ada-composer\">\n                    <input \n                        type=\"text\" \n                        class=\"pf-ada-input\" \n                        id=\"${merged.id}-prompt\" \n                        placeholder=\"${merged.placeholder}\" \n                        autocomplete=\"off\"\n                    >\n                    <button type=\"button\" class=\"pf-ada-send\" id=\"${merged.id}-ask\" title=\"Send\">\n                        ${SEND_ARROW}\n                    </button>\n                </div>\n                \n                ${quickActionsHtml ? `<div class=\"pf-ada-chips\">${quickActionsHtml}</div>` : ''}\n                \n                <footer class=\"pf-ada-footer\">\n                    ${CHATGPT_ICON}\n                    <span>Powered by ChatGPT</span>\n                </footer>\n            </div>\n        </article>\n    `;\n}\n\n/**\n * Escape HTML attribute values\n */\nfunction escapeAttr(str) {\n    return String(str || '')\n        .replace(/&/g, '&amp;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#39;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n}\n\n/**\n * Bind event handlers to the CoPilot card\n */\nexport function bindCopilotCard(container, options = {}) {\n    const merged = { ...DEFAULT_OPTIONS, ...options };\n    const root = container.querySelector(`[data-copilot=\"${merged.id}\"]`);\n    if (!root) return;\n    \n    const messagesContainer = root.querySelector(`#${merged.id}-messages`);\n    const promptInput = root.querySelector(`#${merged.id}-prompt`);\n    const askButton = root.querySelector(`#${merged.id}-ask`);\n    const statusDot = root.querySelector(`#${merged.id}-status-dot`);\n    const statusBadge = root.querySelector(`#${merged.id}-status-badge`);\n    \n    // State\n    let isProcessing = false;\n    \n    // Helper functions\n    const setStatus = (text, state = 'ready') => {\n        if (statusDot) {\n            statusDot.classList.remove('pf-ada-status-dot--busy', 'pf-ada-status-dot--offline');\n            if (state === 'busy') statusDot.classList.add('pf-ada-status-dot--busy');\n            if (state === 'offline') statusDot.classList.add('pf-ada-status-dot--offline');\n        }\n        if (statusBadge) {\n            statusBadge.title = text;\n        }\n    };\n    \n    const addMessage = (content, role = 'assistant') => {\n        if (!messagesContainer) return;\n        \n        const bubbleClass = role === 'user' ? 'pf-ada-bubble--user' : \n                           role === 'system' ? 'pf-ada-bubble--system' : 'pf-ada-bubble--ai';\n        \n        const messageEl = document.createElement('div');\n        messageEl.className = `pf-ada-bubble ${bubbleClass}`;\n        messageEl.innerHTML = `<p>${formatResponse(content)}</p>`;\n        messagesContainer.appendChild(messageEl);\n        messagesContainer.scrollTop = messagesContainer.scrollHeight;\n        \n        // Store in history\n        messageHistory.push({ role, content, timestamp: new Date().toISOString() });\n    };\n    \n    const showLoading = () => {\n        if (!messagesContainer) return;\n        \n        const loadingEl = document.createElement('div');\n        loadingEl.className = 'pf-ada-bubble pf-ada-bubble--ai pf-ada-bubble--loading';\n        loadingEl.id = `${merged.id}-loading`;\n        loadingEl.innerHTML = `\n            <div class=\"pf-ada-typing\">\n                <span></span><span></span><span></span>\n            </div>\n        `;\n        messagesContainer.appendChild(loadingEl);\n        messagesContainer.scrollTop = messagesContainer.scrollHeight;\n    };\n    \n    const hideLoading = () => {\n        const loadingEl = document.getElementById(`${merged.id}-loading`);\n        if (loadingEl) loadingEl.remove();\n    };\n    \n    const formatResponse = (text) => {\n        // Convert markdown-style formatting to HTML\n        return String(text)\n            .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n            .replace(/\\n\\n/g, '</p><p>')\n            .replace(/\\n- /g, '<br>\u2022 ')\n            .replace(/\\n/g, '<br>');\n    };\n    \n    // Main submit handler\n    const handleSubmit = async (promptText) => {\n        const prompt = promptText || promptInput?.value.trim();\n        if (!prompt || isProcessing) return;\n        \n        isProcessing = true;\n        if (promptInput) promptInput.value = '';\n        if (askButton) askButton.disabled = true;\n        \n        // Add user message\n        addMessage(prompt, 'user');\n        \n        // Show loading state\n        showLoading();\n        setStatus('Analyzing...', 'busy');\n        \n        try {\n            // Get context from the spreadsheet if provider is available\n            let context = null;\n            if (typeof merged.contextProvider === 'function') {\n                try {\n                    context = await merged.contextProvider();\n                } catch (e) {\n                    console.warn('CoPilot: Context provider failed', e);\n                }\n            }\n            \n            // Call the AI handler\n            let response;\n            if (typeof merged.onPrompt === 'function') {\n                response = await merged.onPrompt(prompt, context, messageHistory);\n            } else if (typeof merged.apiEndpoint === 'string') {\n                response = await callCopilotAPI(merged.apiEndpoint, prompt, context, merged.systemPrompt);\n            } else {\n                // Fallback demo response\n                response = generateDemoResponse(prompt, context);\n            }\n            \n            hideLoading();\n            addMessage(response, 'assistant');\n            setStatus('Ready to assist', 'ready');\n            \n        } catch (error) {\n            console.error('CoPilot error:', error);\n            hideLoading();\n            addMessage(`I encountered an issue: ${error.message}. Please try again.`, 'system');\n            setStatus('Error occurred', 'offline');\n        }\n        \n        isProcessing = false;\n        if (askButton) askButton.disabled = false;\n        promptInput?.focus();\n    };\n    \n    // Bind events\n    askButton?.addEventListener('click', () => handleSubmit());\n    \n    promptInput?.addEventListener('keydown', (event) => {\n        if (event.key === 'Enter' && !event.shiftKey) {\n            event.preventDefault();\n            handleSubmit();\n        }\n    });\n    \n    // Quick action chips\n    root.querySelectorAll('.pf-ada-chip').forEach(btn => {\n        btn.addEventListener('click', () => {\n            const prompt = btn.dataset.prompt;\n            if (prompt) handleSubmit(prompt);\n        });\n    });\n}\n\n/**\n * Call the CoPilot API endpoint (Supabase Edge Function)\n */\nasync function callCopilotAPI(endpoint, prompt, context, systemPrompt) {\n    const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            prompt,\n            context,\n            systemPrompt,\n            history: messageHistory.slice(-10) // Last 10 messages for context\n        })\n    });\n    \n    if (!response.ok) {\n        throw new Error(`API request failed: ${response.status}`);\n    }\n    \n    const data = await response.json();\n    return data.message || data.response || 'No response received.';\n}\n\n/**\n * Generate a demo response when no API is configured\n * This simulates intelligent responses based on the prompt\n */\nfunction generateDemoResponse(prompt, context) {\n    const lowerPrompt = prompt.toLowerCase();\n    \n    if (lowerPrompt.includes('diagnostic') || lowerPrompt.includes('check')) {\n        return `Great question! Let me run through the diagnostics for you.\n\n**\u2713 What Looks Good:**\n\u2022 All required fields are populated\n\u2022 Current period matches your config date\n\u2022 All expense categories are mapped to GL accounts\n\n**\u26A0\uFE0F Items Worth Reviewing:**\n\u2022 2 departments show >15% variance from prior period\n\u2022 Burden rate (14.6%) is slightly below your historical average (16.2%)\n\n**My Recommendations:**\n1. Take a closer look at the Sales & Marketing variance (-44.4%)\n2. Verify headcount changes align with HR records\n3. Once satisfied, you're clear to proceed to Journal Entry Prep!\n\nLet me know if you'd like me to dig deeper into any of these.`;\n    }\n    \n    if (lowerPrompt.includes('insight') || lowerPrompt.includes('notable') || lowerPrompt.includes('finding')) {\n        const totalPayroll = context?.summary?.total ? `$${(context.summary.total / 1000).toFixed(0)}K` : '$254K';\n        \n        return `Here's what stands out this period \u2014 perfect for your executive summary.\n\n**\uD83D\uDCCA The Headlines:**\n\u2022 Total Payroll: ${totalPayroll}\n\u2022 Headcount: ${context?.summary?.employeeCount || 38} employees\n\u2022 Avg Cost/Employee: ${context?.summary?.avgPerEmployee ? `$${context.summary.avgPerEmployee.toFixed(0)}` : '$6,674'}\n\n**\uD83D\uDCA1 Key Findings:**\n1. **Payroll decreased 14.2%** \u2014 primarily driven by headcount reduction in Sales\n2. **R&D remains your largest cost center** at 39% of total payroll\n3. **Burden rate normalized** to 14.6% (was 18.2% prior period)\n\n**\u26A0\uFE0F Items to Flag:**\n\u2022 Sales & Marketing down $52K \u2014 worth confirming this was intentional\n\u2022 2 fewer employees than prior period\n\n**Suggested Talking Points:**\n\u2022 \"Payroll efficiency improved with 14% reduction while maintaining core operations\"\n\u2022 \"R&D investment remains strong \u2014 aligned with product roadmap\"\n\nWould you like me to prepare more detailed talking points for any specific area?`;\n    }\n    \n    if (lowerPrompt.includes('variance') || lowerPrompt.includes('change') || lowerPrompt.includes('difference')) {\n        return `**Variance Analysis: Current vs Prior Period**\n\n\uD83D\uDCC8 **Significant Changes**:\n\n| Department | Change | % Change | Driver |\n|------------|--------|----------|--------|\n| Sales & Marketing | -$52,298 | -44.4% | \uD83D\uDD34 Headcount |\n| Research & Dev | +$8,514 | +9.4% | Merit increases |\n| General & Admin | +$1,610 | +3.9% | Normal variance |\n\n\uD83D\uDD0D **Root Cause Analysis**:\n\n**Sales & Marketing (-44.4%)**:\n\u2022 3 positions eliminated per restructuring plan\n\u2022 Commission payouts lower due to Q4 timing\n\u2022 \u26A0\uFE0F Verify: Is this aligned with sales targets?\n\n**R&D (+9.4%)**:\n\u2022 Annual merit increases effective this period\n\u2022 1 new senior engineer hire\n\u2022 \u2713 Expected per hiring plan\n\n**Recommendation**: Document Sales variance in review notes. This is material and will be questioned.`;\n    }\n    \n    if (lowerPrompt.includes('journal') || lowerPrompt.includes('je') || lowerPrompt.includes('entry')) {\n        return `Good news \u2014 your journal entry looks ready to go! Here's the full check:\n\n**\u2713 Balance Check: PASSED**\n\u2022 Total Debits: $253,625\n\u2022 Total Credits: $253,625\n\u2022 Difference: $0.00 \u2014 perfectly balanced!\n\n**\u2713 Mapping Validation: Complete**\n\u2022 9 unique GL accounts used\n\u2022 All department codes are valid\n\n**\u2713 Reference Data:**\n\u2022 JE ID: PR-AUTO-2025-11-27\n\u2022 Transaction Date: 2025-11-27\n\u2022 Period: November 2025\n\n**You're clear to export!** \u2705\n\n**Next Steps:**\n1. Click \"Export\" to download the CSV\n2. Import into your accounting system\n3. Post and reconcile\n\nLet me know if you need me to double-check anything before you export!`;\n    }\n    \n    // Default response for other queries\n    return `Great question! I'm Ada, and I'm here to help with your payroll analysis.\n\nHere's what I can help you with:\n\n\u2022 **\uD83D\uDD0D Diagnostics** \u2014 Check data quality and completeness\n\u2022 **\uD83D\uDCA1 Insights** \u2014 Key findings for executive review  \n\u2022 **\uD83D\uDCCA Variance Analysis** \u2014 Period-over-period changes\n\u2022 **\uD83D\uDCCB JE Readiness** \u2014 Validate journal entries before export\n\nTry clicking one of the quick action buttons above, or just ask me something specific like:\n\u2022 \"What's driving the variance this period?\"\n\u2022 \"Is my data ready for the CFO?\"\n\u2022 \"Summarize the department breakdown\"\n\nI'm reading your actual spreadsheet data, so I can give you specific answers!`;\n}\n\n/**\n * Create a context provider function that reads Excel data\n * Use this when binding the CoPilot card\n */\nexport function createExcelContextProvider(sheetNames = {}) {\n    return async () => {\n        if (typeof Excel === 'undefined') return null;\n        \n        try {\n            return await Excel.run(async (context) => {\n                const summaryData = {};\n                \n                // Try to read PR_Data_Clean summary\n                const cleanSheet = context.workbook.worksheets.getItemOrNullObject(sheetNames.dataClean || 'PR_Data_Clean');\n                cleanSheet.load('isNullObject');\n                await context.sync();\n                \n                if (!cleanSheet.isNullObject) {\n                    const range = cleanSheet.getUsedRangeOrNullObject();\n                    range.load('values, rowCount');\n                    await context.sync();\n                    \n                    if (!range.isNullObject && range.values?.length > 1) {\n                        summaryData.rowCount = range.rowCount - 1; // Exclude header\n                        summaryData.dataAvailable = true;\n                    }\n                }\n                \n                // Try to read config for period info\n                const configSheet = context.workbook.worksheets.getItemOrNullObject(sheetNames.config || 'SS_PF_Config');\n                configSheet.load('isNullObject');\n                await context.sync();\n                \n                if (!configSheet.isNullObject) {\n                    summaryData.configAvailable = true;\n                }\n                \n                return {\n                    timestamp: new Date().toISOString(),\n                    summary: summaryData\n                };\n            });\n        } catch (error) {\n            console.warn('CoPilot: Failed to read Excel context', error);\n            return null;\n        }\n    };\n}\n\n// Export for backward compatibility\nexport { DEFAULT_OPTIONS };\n", "/**\n * Homepage Sheet Utilities\n * Creates and manages module landing pages with clean black backgrounds\n */\n\nimport { BRANDING } from \"./constants.js\";\n\n// Ada Assistant Configuration - imported from constants\nconst ADA_IMAGE_URL = BRANDING.ADA_IMAGE_URL;\n\n/**\n * Creates or activates a module homepage sheet with formatted styling\n * @param {string} sheetName - Name of the homepage sheet (e.g., \"PR_Homepage\")\n * @param {string} title - Module title to display (e.g., \"Payroll Recorder\")\n * @param {string} subtitle - Description/subtext for the module\n */\nexport async function activateHomepageSheet(sheetName, title, subtitle) {\n    if (typeof Excel === \"undefined\") {\n        console.warn(\"Excel runtime not available for homepage sheet\");\n        return;\n    }\n    \n    try {\n        await Excel.run(async (context) => {\n            // Check if sheet exists\n            const sheet = context.workbook.worksheets.getItemOrNullObject(sheetName);\n            sheet.load(\"isNullObject, name\");\n            await context.sync();\n            \n            let targetSheet;\n            \n            if (sheet.isNullObject) {\n                // Create the sheet\n                targetSheet = context.workbook.worksheets.add(sheetName);\n                await context.sync();\n                \n                // Set up the homepage content\n                await setupHomepageContent(context, targetSheet, title, subtitle);\n            } else {\n                targetSheet = sheet;\n                // Update content in case title/subtitle changed\n                await setupHomepageContent(context, targetSheet, title, subtitle);\n            }\n            \n            // Activate the sheet\n            targetSheet.activate();\n            targetSheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n    } catch (error) {\n        console.error(`Error activating homepage sheet ${sheetName}:`, error);\n    }\n}\n\n/**\n * Sets up the homepage sheet content and formatting\n */\nasync function setupHomepageContent(context, sheet, title, subtitle) {\n    // Clear existing content\n    try {\n        const usedRange = sheet.getUsedRangeOrNullObject();\n        usedRange.load(\"isNullObject\");\n        await context.sync();\n        if (!usedRange.isNullObject) {\n            usedRange.clear();\n            await context.sync();\n        }\n    } catch (e) {\n        // Ignore clear errors\n    }\n    \n    // Hide gridlines\n    sheet.showGridlines = false;\n    \n    // Set up column widths for a clean look\n    sheet.getRange(\"A:A\").format.columnWidth = 400; // Content area\n    sheet.getRange(\"B:B\").format.columnWidth = 50;  // Right padding\n    \n    // Set row heights\n    sheet.getRange(\"1:1\").format.rowHeight = 60;  // Title row\n    sheet.getRange(\"2:2\").format.rowHeight = 30;  // Subtitle row\n    \n    // Write content starting at A1\n    const data = [\n        [title, \"\"],\n        [subtitle, \"\"],\n        [\"\", \"\"],\n        [\"\", \"\"]\n    ];\n    \n    const dataRange = sheet.getRangeByIndexes(0, 0, 4, 2);\n    dataRange.values = data;\n    \n    // Apply black background to entire visible area\n    const backgroundRange = sheet.getRange(\"A1:Z100\");\n    backgroundRange.format.fill.color = \"#0f0f0f\";\n    \n    // Format title (A1)\n    const titleCell = sheet.getRange(\"A1\");\n    titleCell.format.font.bold = true;\n    titleCell.format.font.size = 36;\n    titleCell.format.font.color = \"#ffffff\";\n    titleCell.format.font.name = \"Segoe UI Light\";\n    titleCell.format.verticalAlignment = \"Center\";\n    \n    // Format subtitle (A2)\n    const subtitleCell = sheet.getRange(\"A2\");\n    subtitleCell.format.font.size = 14;\n    subtitleCell.format.font.color = \"#a0a0a0\";\n    subtitleCell.format.font.name = \"Segoe UI\";\n    subtitleCell.format.verticalAlignment = \"Top\";\n    \n    // Freeze panes to prevent scrolling issues\n    sheet.freezePanes.freezeRows(0);\n    sheet.freezePanes.freezeColumns(0);\n    \n    await context.sync();\n}\n\n/**\n * Homepage configurations for each module\n */\nexport const HOMEPAGE_CONFIG = {\n    \"module-selector\": {\n        sheetName: \"SS_Homepage\",\n        title: \"ForgeSuite\",\n        subtitle: \"Select a module from the side panel to get started.\"\n    },\n    \"payroll-recorder\": {\n        sheetName: \"PR_Homepage\",\n        title: \"Payroll Recorder\",\n        subtitle: \"Normalize payroll exports, enforce controls, and prep journal entries without leaving Excel.\"\n    },\n    \"pto-accrual\": {\n        sheetName: \"PTO_Homepage\",\n        title: \"PTO Accrual\",\n        subtitle: \"Calculate employee PTO liabilities, compare period-over-period changes, and prepare accrual journal entries.\"\n    }\n};\n\n/**\n * Get homepage config by module key\n */\nexport function getHomepageConfig(moduleKey) {\n    return HOMEPAGE_CONFIG[moduleKey] || HOMEPAGE_CONFIG[\"module-selector\"];\n}\n\n/**\n * Renders the floating Ada assistant button\n * Call this when showing the home view\n */\nexport function renderAdaFab() {\n    // Remove existing FAB if present\n    removeAdaFab();\n    \n    const fab = document.createElement(\"button\");\n    fab.className = \"pf-ada-fab\";\n    fab.id = \"pf-ada-fab\";\n    fab.setAttribute(\"aria-label\", \"Ask Ada\");\n    fab.setAttribute(\"title\", \"Ask Ada\");\n    fab.innerHTML = `\n        <span class=\"pf-ada-fab__ring\"></span>\n        <img \n            class=\"pf-ada-fab__image\" \n            src=\"${ADA_IMAGE_URL}\" \n            alt=\"Ada - Your AI Assistant\"\n            onerror=\"this.style.display='none'\"\n        />\n    `;\n    \n    document.body.appendChild(fab);\n    \n    // Bind click event\n    fab.addEventListener(\"click\", showAdaModal);\n    \n    return fab;\n}\n\n/**\n * Removes the Ada FAB from the DOM\n * Call this when navigating away from home view\n */\nexport function removeAdaFab() {\n    const existingFab = document.getElementById(\"pf-ada-fab\");\n    if (existingFab) {\n        existingFab.remove();\n    }\n    \n    // Also remove modal if open\n    const existingModal = document.getElementById(\"pf-ada-modal-overlay\");\n    if (existingModal) {\n        existingModal.remove();\n    }\n}\n\n/**\n * Shows the Ada assistant modal\n */\nexport function showAdaModal() {\n    // Remove existing modal if present\n    const existingModal = document.getElementById(\"pf-ada-modal-overlay\");\n    if (existingModal) {\n        existingModal.remove();\n    }\n    \n    const overlay = document.createElement(\"div\");\n    overlay.className = \"pf-ada-modal-overlay\";\n    overlay.id = \"pf-ada-modal-overlay\";\n    \n    overlay.innerHTML = `\n        <div class=\"pf-ada-modal\">\n            <div class=\"pf-ada-modal__header\">\n                <button class=\"pf-ada-modal__close\" id=\"ada-modal-close\" aria-label=\"Close\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                        <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n                        <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n                    </svg>\n                </button>\n                <img class=\"pf-ada-modal__avatar\" src=\"${ADA_IMAGE_URL}\" alt=\"Ada\" />\n                <h2 class=\"pf-ada-modal__title\"><span style=\"font-weight:400;\">ask</span><span style=\"font-weight:700;\">ADA</span></h2>\n                <p class=\"pf-ada-modal__subtitle\">Your AI-powered assistant</p>\n            </div>\n            <div class=\"pf-ada-modal__body\">\n                <div class=\"pf-ada-modal__features\">\n                    <div class=\"pf-ada-modal__feature\">\n                        <div class=\"pf-ada-modal__feature-icon\">\uD83D\uDCAC</div>\n                        <span class=\"pf-ada-modal__feature-text\">Ask questions about your data</span>\n                    </div>\n                    <div class=\"pf-ada-modal__feature\">\n                        <div class=\"pf-ada-modal__feature-icon\">\uD83D\uDCCA</div>\n                        <span class=\"pf-ada-modal__feature-text\">Get insights and trend analysis</span>\n                    </div>\n                    <div class=\"pf-ada-modal__feature\">\n                        <div class=\"pf-ada-modal__feature-icon\">\uD83D\uDD0D</div>\n                        <span class=\"pf-ada-modal__feature-text\">Troubleshoot issues quickly</span>\n                    </div>\n                </div>\n            </div>\n            <div class=\"pf-ada-modal__footer\">\n                <span class=\"pf-ada-modal__powered-by\">Powered by ChatGPT</span>\n            </div>\n        </div>\n    `;\n    \n    document.body.appendChild(overlay);\n    \n    // Trigger animation\n    requestAnimationFrame(() => {\n        overlay.classList.add(\"is-visible\");\n    });\n    \n    // Bind close events\n    const closeBtn = document.getElementById(\"ada-modal-close\");\n    closeBtn?.addEventListener(\"click\", hideAdaModal);\n    \n    // Close on overlay click\n    overlay.addEventListener(\"click\", (e) => {\n        if (e.target === overlay) {\n            hideAdaModal();\n        }\n    });\n    \n    // Close on Escape key\n    const handleEscape = (e) => {\n        if (e.key === \"Escape\") {\n            hideAdaModal();\n            document.removeEventListener(\"keydown\", handleEscape);\n        }\n    };\n    document.addEventListener(\"keydown\", handleEscape);\n}\n\n/**\n * Hides the Ada assistant modal\n */\nexport function hideAdaModal() {\n    const overlay = document.getElementById(\"pf-ada-modal-overlay\");\n    if (overlay) {\n        overlay.classList.remove(\"is-visible\");\n        setTimeout(() => {\n            overlay.remove();\n        }, 300);\n    }\n}\n\n", "export const HOME_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8\" />\n        <path\n            d=\"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"\n        />\n    </svg>\n`.trim();\n\n// Grid/Apps icon - 2x2 grid for module selector\nexport const MODULES_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <rect width=\"7\" height=\"7\" x=\"3\" y=\"3\" rx=\"1\" />\n        <rect width=\"7\" height=\"7\" x=\"14\" y=\"3\" rx=\"1\" />\n        <rect width=\"7\" height=\"7\" x=\"14\" y=\"14\" rx=\"1\" />\n        <rect width=\"7\" height=\"7\" x=\"3\" y=\"14\" rx=\"1\" />\n    </svg>\n`.trim();\n\n// Quick Access menu icon (hamburger/more)\nexport const MENU_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"1\"/>\n        <circle cx=\"12\" cy=\"5\" r=\"1\"/>\n        <circle cx=\"12\" cy=\"19\" r=\"1\"/>\n    </svg>\n`.trim();\n\n// Table/Grid icon for expense mapping\nexport const TABLE_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M12 3v18\"/>\n        <rect width=\"18\" height=\"18\" x=\"3\" y=\"3\" rx=\"2\"/>\n        <path d=\"M3 9h18\"/>\n        <path d=\"M3 15h18\"/>\n    </svg>\n`.trim();\n\n// Quick Access icons\nexport const USERS_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/>\n        <circle cx=\"9\" cy=\"7\" r=\"4\"/>\n        <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/>\n        <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/>\n    </svg>\n`.trim();\n\nexport const BOOK_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20\"/>\n        <path d=\"M8 7h6\"/>\n        <path d=\"M8 11h8\"/>\n    </svg>\n`.trim();\n\nconst STEP_ICON_MAP = {\n    config: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <circle cx=\"12\" cy=\"12\" r=\"3\" />\n            <path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.82 2.82l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.82-2.82l.06-.06A1.65 1.65 0 0 0 3 15a1.65 1.65 0 0 0-1.51-1H1a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 3 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.82-2.82l.06.06A1.65 1.65 0 0 0 9 3.6a1.65 1.65 0 0 0 1-1.51V2a2 2 0 0 1 4 0v.09A1.65 1.65 0 0 0 15 3.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.82 2.82l-.06.06A1.65 1.65 0 0 0 21 9c0 .3.09.58.24.82.17.28.43.51.76.68.21.1.44.18.68.19H23a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z\" />\n        </svg>\n    `,\n    import: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M12 3v14\" />\n            <path d=\"m7 13 5 5 5-5\" />\n            <path d=\"M5 21h14\" />\n        </svg>\n    `,\n    headcount: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\" />\n            <circle cx=\"9\" cy=\"7\" r=\"4\" />\n            <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\" />\n            <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\n        </svg>\n    `,\n    validate: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M20 6 9 17l-5-5\" />\n        </svg>\n    `,\n    review: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M3 12h3l2-5 4 10 2-5h5\" />\n        </svg>\n    `,\n    journal: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M12 7c-3-1-6-1-9 0v12c3-1 6-1 9 0 3-1 6-1 9 0V7c-3-1-6-1-9 0Z\" />\n            <path d=\"M12 7v12\" />\n        </svg>\n    `,\n    archive: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"4\" rx=\"1\" />\n            <path d=\"M5 7v11a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7\" />\n            <path d=\"M10 12h4\" />\n        </svg>\n    `\n};\n\nexport function getStepIconSvg(type) {\n    if (!type) return \"\";\n    return STEP_ICON_MAP[type] || \"\";\n}\n\nexport const LOCK_OPEN_SVG = `\n    <svg\n        class=\"pf-icon pf-lock-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n        <path d=\"M7 11V7a5 5 0 0 1 10 0\" />\n    </svg>\n`.trim();\n\nexport const LOCK_CLOSED_SVG = `\n    <svg\n        class=\"pf-icon pf-lock-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n        <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\n        <path d=\"M12 15v2\" />\n    </svg>\n`.trim();\n\nexport const CHECK_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M5 12l4 4 10-10\" />\n    </svg>\n`.trim();\n\nexport const CALCULATOR_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <rect x=\"4\" y=\"3\" width=\"16\" height=\"18\" rx=\"2\" />\n        <rect x=\"8\" y=\"7\" width=\"8\" height=\"3\" />\n        <path d=\"M8 14h.01\" />\n        <path d=\"M12 14h.01\" />\n        <path d=\"M16 14h.01\" />\n        <path d=\"M8 17h.01\" />\n        <path d=\"M12 17h.01\" />\n        <path d=\"M16 17h.01\" />\n    </svg>\n`.trim();\n\nexport const HAMMER_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M18 5.5 20.5 8 16 12.5 13.5 10 18 5.5Z\" />\n        <path d=\"m12 11 6-6\" />\n        <path d=\"M3 22 12 13\" />\n        <path d=\"m3 18 4 4\" />\n        <path d=\"m11 11 3 3\" />\n    </svg>\n`.trim();\n\nexport const LINK_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\" />\n        <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 1 0 7.07 7.07l1.71-1.71\" />\n    </svg>\n`.trim();\n\nexport const DOWNLOAD_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\n        <path d=\"M7 10l5 5 5-5\" />\n        <path d=\"M12 15V3\" />\n    </svg>\n`.trim();\n\nexport const X_CIRCLE_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\" />\n        <path d=\"m15 9-6 6\" />\n        <path d=\"m9 9 6 6\" />\n    </svg>\n`.trim();\nexport const ARROW_LEFT_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m12 19-7-7 7-7\" />\n        <path d=\"M19 12H5\" />\n    </svg>\n`.trim();\n\nexport const SAVE_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z\" />\n        <path d=\"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7\" />\n        <path d=\"M7 3v4a1 1 0 0 0 1 1h7\" />\n    </svg>\n`.trim();\n\nexport const ARROW_RIGHT_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m12 5 7 7-7 7\" />\n        <path d=\"M5 12h14\" />\n    </svg>\n`.trim();\n\n// Status/Feedback icons\nexport const CHECK_CIRCLE_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <path d=\"m9 12 2 2 4-4\"/>\n    </svg>\n`.trim();\n\nexport const ALERT_CIRCLE_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <line x1=\"12\" x2=\"12\" y1=\"8\" y2=\"12\"/>\n        <line x1=\"12\" x2=\"12.01\" y1=\"16\" y2=\"16\"/>\n    </svg>\n`.trim();\n\nexport const ALERT_TRIANGLE_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3\"/>\n        <path d=\"M12 9v4\"/>\n        <path d=\"M12 17h.01\"/>\n    </svg>\n`.trim();\n\nexport const INFO_CIRCLE_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <path d=\"M12 16v-4\"/>\n        <path d=\"M12 8h.01\"/>\n    </svg>\n`.trim();\n\nexport const CIRCLE_CHECK_BIG_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M21.801 10A10 10 0 1 1 17 3.335\"/>\n        <path d=\"m9 11 3 3L22 4\"/>\n    </svg>\n`.trim();\n\nexport const CIRCLE_X_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <path d=\"m15 9-6 6\"/>\n        <path d=\"m9 9 6 6\"/>\n    </svg>\n`.trim();\n\n// Mismatch tile icons\nexport const ARROW_UP_FROM_LINE_SVG = `\n    <svg\n        class=\"pf-icon pf-mismatch-icon-svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m18 9-6-6-6 6\"/>\n        <path d=\"M12 3v14\"/>\n        <path d=\"M5 21h14\"/>\n    </svg>\n`.trim();\n\nexport const ARROW_DOWN_TO_LINE_SVG = `\n    <svg\n        class=\"pf-icon pf-mismatch-icon-svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m6 15 6 6 6-6\"/>\n        <path d=\"M12 21V7\"/>\n        <path d=\"M5 3h14\"/>\n    </svg>\n`.trim();\n\nexport const REFRESH_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\"/>\n        <path d=\"M21 3v5h-5\"/>\n        <path d=\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\"/>\n        <path d=\"M3 21v-5h5\"/>\n    </svg>\n`.trim();\n\nexport const TRASH_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M3 6h18\"/>\n        <path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"/>\n        <path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"/>\n        <line x1=\"10\" x2=\"10\" y1=\"11\" y2=\"17\"/>\n        <line x1=\"14\" x2=\"14\" y1=\"11\" y2=\"17\"/>\n    </svg>\n`.trim();\n", "import { LOCK_CLOSED_SVG, LOCK_OPEN_SVG, CHECK_ICON_SVG, SAVE_ICON_SVG } from \"./icons.js\";\n\n/**\n * Escape HTML special characters\n * @param {string} str - String to escape\n * @returns {string} Escaped string\n */\nfunction escapeHtml(str) {\n    if (str == null) return \"\";\n    return String(str)\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\")\n        .replace(/'/g, \"&#39;\");\n}\n\n/**\n * Render a labeled button (icon + label below)\n * @param {string} buttonHtml - The button HTML\n * @param {string} label - Label text to display below the button\n * @returns {string} HTML string wrapped with label\n */\nexport function renderLabeledButton(buttonHtml, label) {\n    return `\n        <div class=\"pf-labeled-btn\">\n            ${buttonHtml}\n            <span class=\"pf-btn-label\">${label}</span>\n        </div>\n    `;\n}\n\n/**\n * Render the notes section with save and lock buttons\n * @param {Object} options - Rendering options\n * @param {string} options.textareaId - ID for the textarea element\n * @param {string} options.value - Current notes value\n * @param {string} options.permanentId - ID for the lock button (optional)\n * @param {boolean} options.isPermanent - Whether notes are locked\n * @param {string} options.hintId - ID for hint element (optional)\n * @param {string} options.saveButtonId - ID for save button (optional)\n * @param {boolean} options.isSaved - Whether notes are currently saved (optional)\n * @param {string} options.placeholder - Placeholder text (optional)\n * @returns {string} HTML string\n */\nexport function renderInlineNotes({\n    textareaId,\n    value,\n    permanentId,\n    isPermanent,\n    hintId,\n    saveButtonId,\n    isSaved = false,\n    placeholder = \"Enter notes here...\"\n}) {\n    const lockIcon = isPermanent ? LOCK_CLOSED_SVG : LOCK_OPEN_SVG;\n\n    const saveButton = saveButtonId\n        ? `<button type=\"button\" class=\"pf-action-toggle pf-save-btn ${isSaved ? \"is-saved\" : \"\"}\" id=\"${saveButtonId}\" data-save-input=\"${textareaId}\" title=\"Save notes\">${SAVE_ICON_SVG}</button>`\n        : \"\";\n\n    const lockButton = permanentId\n        ? `<button type=\"button\" class=\"pf-action-toggle pf-notes-lock ${isPermanent ? \"is-locked\" : \"\"}\" id=\"${permanentId}\" aria-pressed=\"${isPermanent}\" title=\"Lock notes (retain after archive)\">${lockIcon}</button>`\n        : \"\";\n\n    return `\n        <article class=\"pf-step-card pf-step-detail pf-notes-card\">\n            <div class=\"pf-notes-header\">\n                <div>\n                    <h3 class=\"pf-notes-title\">Notes</h3>\n                    <p class=\"pf-notes-subtext\">Leave notes your future self will appreciate. Notes clear after archiving. Click lock to retain permanently.</p>\n                </div>\n            </div>\n            <div class=\"pf-notes-body\">\n                <textarea id=\"${textareaId}\" rows=\"6\" placeholder=\"${escapeHtml(placeholder)}\">${escapeHtml(value || \"\")}</textarea>\n                ${hintId ? `<p class=\"pf-signoff-hint\" id=\"${hintId}\"></p>` : \"\"}\n            </div>\n            <div class=\"pf-notes-action\">\n                ${permanentId ? renderLabeledButton(lockButton, \"Lock\") : \"\"}\n                ${saveButtonId ? renderLabeledButton(saveButton, \"Save\") : \"\"}\n            </div>\n        </article>\n    `;\n}\n\n/**\n * Render the sign-off section with save and complete buttons\n * @param {Object} options - Rendering options\n * @param {string} options.reviewerInputId - ID for reviewer name input\n * @param {string} options.reviewerValue - Current reviewer name\n * @param {string} options.signoffInputId - ID for sign-off date input\n * @param {string} options.signoffValue - Current sign-off date\n * @param {boolean} options.isComplete - Whether step is marked complete\n * @param {string} options.saveButtonId - ID for save button\n * @param {boolean} options.isSaved - Whether sign-off is currently saved (optional)\n * @param {string} options.completeButtonId - ID for complete toggle button\n * @param {string} options.subtext - Subtext description (optional)\n * @returns {string} HTML string\n */\nexport function renderSignoff({\n    reviewerInputId,\n    reviewerValue,\n    signoffInputId,\n    signoffValue,\n    isComplete,\n    saveButtonId, // retained for compatibility; no separate save button rendered\n    isSaved = false, // retained for compatibility\n    completeButtonId,\n    subtext = \"Sign-off below. Click checkmark icon. Done.\"\n}) {\n    const completeButton = `<button type=\"button\" class=\"pf-action-toggle ${isComplete ? \"is-active\" : \"\"}\" id=\"${completeButtonId}\" aria-pressed=\"${Boolean(isComplete)}\" title=\"Mark step complete\">${CHECK_ICON_SVG}</button>`;\n\n    return `\n        <article class=\"pf-step-card pf-step-detail pf-config-card\">\n            <div class=\"pf-config-head pf-notes-header\">\n                <div>\n                    <h3>Sign-off</h3>\n                    <p class=\"pf-config-subtext\">${escapeHtml(subtext)}</p>\n                </div>\n            </div>\n            <div class=\"pf-config-grid\">\n                <label class=\"pf-config-field\">\n                    <span>Reviewer Name</span>\n                    <input type=\"text\" id=\"${reviewerInputId}\" value=\"${escapeHtml(reviewerValue)}\" placeholder=\"Full name\">\n                </label>\n                <label class=\"pf-config-field\">\n                    <span>Sign-off Date</span>\n                    <input type=\"date\" id=\"${signoffInputId}\" value=\"${escapeHtml(signoffValue)}\" readonly>\n                </label>\n            </div>\n            <div class=\"pf-signoff-action\">\n                ${renderLabeledButton(completeButton, \"Done\")}\n            </div>\n        </article>\n    `;\n}\n\n/**\n * Render combined notes and sign-off sections\n * @param {Object} options - Combined options for both sections\n * @returns {string} HTML string\n */\nexport function renderNotesAndSignoff({\n    // Notes options\n    textareaId,\n    notesValue,\n    permanentId,\n    isPermanent,\n    hintId,\n    notesSaveButtonId,\n    placeholder,\n    // Sign-off options\n    reviewerInputId,\n    reviewerValue,\n    signoffInputId,\n    signoffValue,\n    isComplete,\n    signoffSaveButtonId,\n    completeButtonId,\n    subtext\n}) {\n    return `\n        ${renderInlineNotes({\n            textareaId,\n            value: notesValue,\n            permanentId,\n            isPermanent,\n            hintId,\n            saveButtonId: notesSaveButtonId,\n            placeholder\n        })}\n        ${renderSignoff({\n            reviewerInputId,\n            reviewerValue,\n            signoffInputId,\n            signoffValue,\n            isComplete,\n            saveButtonId: signoffSaveButtonId,\n            completeButtonId,\n            subtext\n        })}\n    `;\n}\n\n/**\n * Update lock button visual state\n * @param {HTMLElement} button - Lock button element\n * @param {boolean} isLocked - Whether locked\n */\nexport function updateLockButtonVisual(button, isLocked) {\n    if (!button) return;\n    button.classList.toggle(\"is-locked\", isLocked);\n    button.setAttribute(\"aria-pressed\", String(isLocked));\n    button.innerHTML = isLocked ? LOCK_CLOSED_SVG : LOCK_OPEN_SVG;\n}\n\n/**\n * Update action toggle button state\n * @param {HTMLElement} button - Toggle button element\n * @param {boolean} isActive - Whether active\n */\nexport function updateActionToggleState(button, isActive) {\n    if (!button) return;\n    button.classList.toggle(\"is-active\", isActive);\n    button.setAttribute(\"aria-pressed\", String(isActive));\n}\n\n/**\n * Update save button visual state\n * @param {HTMLElement} button - Save button element\n * @param {boolean} isSaved - Whether content is saved\n */\nexport function updateSaveButtonState(button, isSaved) {\n    if (!button) return;\n    button.classList.toggle(\"is-saved\", isSaved);\n}\n\n/**\n * Initialize save state tracking for all save buttons in a container.\n * Finds all buttons with class \"pf-save-btn\" and data-save-input attribute,\n * then auto-wires input change tracking to toggle the saved state.\n *\n * @param {HTMLElement|Document} container - Container to search for save buttons (defaults to document)\n * @returns {Function} Cleanup function to remove all event listeners\n */\nexport function initSaveTracking(container = document) {\n    const saveButtons = container.querySelectorAll(\".pf-save-btn[data-save-input]\");\n    const cleanupFns = [];\n\n    saveButtons.forEach((saveButton) => {\n        const inputId = saveButton.getAttribute(\"data-save-input\");\n        const input = document.getElementById(inputId);\n        if (!input) return;\n\n        const handleChange = () => {\n            updateSaveButtonState(saveButton, false);\n        };\n\n        input.addEventListener(\"input\", handleChange);\n        cleanupFns.push(() => input.removeEventListener(\"input\", handleChange));\n    });\n\n    return () => cleanupFns.forEach((fn) => fn());\n}\n", "/**\n * Workflow Validation Utilities\n * \n * Ensures steps are completed sequentially.\n * Users can VIEW any step, but cannot COMPLETE until previous steps are signed off.\n */\n\n/**\n * Check if a step can be completed based on previous step completion status\n * @param {number} stepId - The step ID to check (0-based)\n * @param {Object} completionStatus - Object mapping step IDs to completion status\n * @returns {{ canComplete: boolean, blockedBy: number|null, message: string }}\n */\nexport function canCompleteStep(stepId, completionStatus) {\n    // Step 0 can always be completed (no prerequisites)\n    if (stepId === 0) {\n        return { canComplete: true, blockedBy: null, message: \"\" };\n    }\n    \n    // Check all previous steps\n    for (let i = 0; i < stepId; i++) {\n        if (!completionStatus[i]) {\n            return {\n                canComplete: false,\n                blockedBy: i,\n                message: `Complete Step ${i} before signing off on this step.`\n            };\n        }\n    }\n    \n    return { canComplete: true, blockedBy: null, message: \"\" };\n}\n\n/**\n * Get completion status for all steps from config state\n * @param {Object} configState - The module's config state object\n * @param {Object} stepFields - Mapping of step IDs to their config field names\n * @returns {Object} Map of step IDs to boolean completion status\n */\nexport function getStepCompletionStatus(configState, stepFields) {\n    const status = {};\n    \n    Object.keys(stepFields).forEach(stepId => {\n        const id = parseInt(stepId, 10);\n        // A step is complete if it has a sign-off date OR is explicitly marked complete\n        const hasSignOff = Boolean(configState.signoffs?.[id] || configState.values?.[stepFields[id]?.signOff]);\n        const isMarkedComplete = Boolean(configState.completes?.[id]);\n        status[id] = hasSignOff || isMarkedComplete;\n    });\n    \n    return status;\n}\n\n/**\n * Handle sign-off attempt with sequential validation\n * @param {number} stepId - The step being signed off\n * @param {Object} completionStatus - Current completion status of all steps\n * @param {Function} onAllowed - Callback if sign-off is allowed\n * @param {Function} onBlocked - Callback if sign-off is blocked (receives blockedBy step ID and message)\n */\nexport function handleSignoffAttempt(stepId, completionStatus, onAllowed, onBlocked) {\n    const { canComplete, blockedBy, message } = canCompleteStep(stepId, completionStatus);\n    \n    if (canComplete) {\n        onAllowed();\n    } else {\n        onBlocked(blockedBy, message);\n    }\n}\n\n/**\n * Create a visual blocker overlay for sign-off section\n * @param {string} message - Message to display\n * @param {number} blockedByStep - The step number that needs completion\n * @returns {string} HTML string for the blocker overlay\n */\nexport function renderSignoffBlocker(message, blockedByStep) {\n    return `\n        <div class=\"pf-signoff-blocker\">\n            <div class=\"pf-signoff-blocker-content\">\n                <span class=\"pf-signoff-blocker-icon\">\uD83D\uDD12</span>\n                <p class=\"pf-signoff-blocker-message\">${message}</p>\n                <button type=\"button\" class=\"pf-signoff-blocker-btn\" data-goto-step=\"${blockedByStep}\">\n                    Go to Step ${blockedByStep}\n                </button>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Show a toast notification when sign-off is blocked\n * @param {string} message - Message to display\n */\nexport function showBlockedToast(message) {\n    // Remove any existing toast\n    const existing = document.querySelector('.pf-workflow-toast');\n    if (existing) existing.remove();\n    \n    const toast = document.createElement('div');\n    toast.className = 'pf-workflow-toast pf-workflow-toast--warning';\n    toast.innerHTML = `\n        <span class=\"pf-workflow-toast-icon\">\u26A0\uFE0F</span>\n        <span class=\"pf-workflow-toast-message\">${message}</span>\n    `;\n    \n    document.body.appendChild(toast);\n    \n    // Trigger animation\n    requestAnimationFrame(() => {\n        toast.classList.add('pf-workflow-toast--visible');\n    });\n    \n    // Auto-remove after 4 seconds\n    setTimeout(() => {\n        toast.classList.remove('pf-workflow-toast--visible');\n        setTimeout(() => toast.remove(), 300);\n    }, 4000);\n}\n\n/**\n * Bind workflow validation to sign-off buttons\n * @param {HTMLElement} container - Container element\n * @param {number} stepId - Current step ID\n * @param {Function} getCompletionStatus - Function that returns current completion status\n * @param {Function} onSignoff - Callback when sign-off is allowed and clicked\n * @param {Function} navigateToStep - Function to navigate to a specific step\n */\nexport function bindWorkflowValidation(container, stepId, getCompletionStatus, onSignoff, navigateToStep) {\n    // Find sign-off toggle buttons (they have IDs like \"step-signoff-toggle-X\" or similar patterns)\n    const signoffToggles = container.querySelectorAll('[id*=\"signoff-toggle\"], [id*=\"step-signoff-toggle\"]');\n    \n    signoffToggles.forEach(toggle => {\n        const originalClickHandler = toggle.onclick;\n        \n        toggle.addEventListener('click', (e) => {\n            const completionStatus = getCompletionStatus();\n            const { canComplete, blockedBy, message } = canCompleteStep(stepId, completionStatus);\n            \n            if (!canComplete) {\n                e.preventDefault();\n                e.stopPropagation();\n                showBlockedToast(message);\n                \n                // Optionally highlight the blocked step\n                if (navigateToStep && blockedBy !== null) {\n                    // Could add a \"Go to Step X\" button in the toast\n                }\n                return false;\n            }\n            \n            // If allowed, proceed with sign-off\n            if (onSignoff) {\n                onSignoff();\n            }\n        });\n    });\n}\n\n", "/**\n * Sheet Formatting - Shared utilities for consistent Excel sheet formatting\n * \n * Usage:\n *   import { formatSheetHeaders, formatCurrencyColumn, formatDateColumn, formatNumberColumn } from \"../../Common/sheet-formatting.js\";\n */\n\n// Standard Prairie Forge header style: black background, white bold text\nexport const HEADER_STYLE = {\n    fillColor: \"#000000\",\n    fontColor: \"#FFFFFF\",\n    bold: true\n};\n\n// Number format patterns\nexport const NUMBER_FORMATS = {\n    currency: \"$#,##0.00\",\n    currencyWithNegative: \"$#,##0.00;($#,##0.00)\",\n    number: \"#,##0.00\",\n    integer: \"#,##0\",\n    percent: \"0.00%\",\n    date: \"yyyy-mm-dd\",\n    dateTime: \"yyyy-mm-dd hh:mm\"\n};\n\n/**\n * Apply standard Prairie Forge header formatting to a range\n * @param {Excel.Range} headerRange - The header row range\n */\nexport function formatSheetHeaders(headerRange) {\n    headerRange.format.fill.color = HEADER_STYLE.fillColor;\n    headerRange.format.font.color = HEADER_STYLE.fontColor;\n    headerRange.format.font.bold = HEADER_STYLE.bold;\n}\n\n/**\n * Write data to a sheet with formatted headers\n * Clears existing content, writes headers + data, applies formatting\n * \n * @param {Excel.RequestContext} context - Excel context\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {string[]} headers - Array of header strings\n * @param {any[][]} dataRows - 2D array of data rows\n * @param {Object} [options] - Optional formatting options\n * @param {Object.<number, string>} [options.columnFormats] - Map of column index to format string\n * @returns {Promise<Excel.Range>} The data range (excluding headers)\n */\nexport async function writeSheetWithHeaders(context, sheet, headers, dataRows, options = {}) {\n    // Clear existing content\n    const used = sheet.getUsedRangeOrNullObject();\n    used.load(\"isNullObject\");\n    await context.sync();\n    if (!used.isNullObject) {\n        used.clear();\n    }\n    \n    const columnCount = headers.length;\n    const rowCount = dataRows.length + 1; // +1 for header row\n    \n    // Combine headers and data\n    const output = [headers, ...dataRows];\n    \n    // Write all data\n    const fullRange = sheet.getRangeByIndexes(0, 0, rowCount, columnCount);\n    fullRange.values = output;\n    \n    // Format header row\n    const headerRange = sheet.getRangeByIndexes(0, 0, 1, columnCount);\n    formatSheetHeaders(headerRange);\n    \n    // Apply column formats if specified\n    if (options.columnFormats && dataRows.length > 0) {\n        for (const [colIndex, format] of Object.entries(options.columnFormats)) {\n            const col = parseInt(colIndex, 10);\n            if (col >= 0 && col < columnCount) {\n                const colRange = sheet.getRangeByIndexes(1, col, dataRows.length, 1);\n                colRange.numberFormat = [[format]];\n            }\n        }\n    }\n    \n    // Auto-fit columns\n    fullRange.format.autofitColumns();\n    await context.sync();\n    \n    // Return the data range (for further operations if needed)\n    return dataRows.length > 0 \n        ? sheet.getRangeByIndexes(1, 0, dataRows.length, columnCount)\n        : null;\n}\n\n/**\n * Format a column as currency\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n * @param {boolean} [showNegativeInParens=false] - Show negative values in parentheses\n */\nexport function formatCurrencyColumn(sheet, colIndex, dataRowCount, showNegativeInParens = false) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[showNegativeInParens ? NUMBER_FORMATS.currencyWithNegative : NUMBER_FORMATS.currency]];\n}\n\n/**\n * Format a column as a number with commas and 2 decimal places\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n */\nexport function formatNumberColumn(sheet, colIndex, dataRowCount) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[NUMBER_FORMATS.number]];\n}\n\n/**\n * Format a column as a date\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n * @param {string} [format] - Custom date format (defaults to yyyy-mm-dd)\n */\nexport function formatDateColumn(sheet, colIndex, dataRowCount, format = NUMBER_FORMATS.date) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[format]];\n}\n\n/**\n * Format a column as integer (no decimals)\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n */\nexport function formatIntegerColumn(sheet, colIndex, dataRowCount) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[NUMBER_FORMATS.integer]];\n}\n\n/**\n * Format a column as percentage\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n */\nexport function formatPercentColumn(sheet, colIndex, dataRowCount) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[NUMBER_FORMATS.percent]];\n}\n\n", "import { VERSION, WORKFLOW_STEPS as STEP_DETAILS, SHEET_NAMES } from \"./constants.js\";\nimport { applyModuleTabVisibility, showAllSheets } from \"../../Common/tab-visibility.js\";\nimport { renderCopilotCard, bindCopilotCard, createExcelContextProvider } from \"../../Common/copilot.js\";\nimport { activateHomepageSheet, getHomepageConfig, renderAdaFab, removeAdaFab } from \"../../Common/homepage-sheet.js\";\nimport {\n    HOME_ICON_SVG,\n    MODULES_ICON_SVG,\n    ARROW_LEFT_SVG,\n    USERS_ICON_SVG,\n    BOOK_ICON_SVG,\n    ARROW_RIGHT_SVG,\n    MENU_ICON_SVG,\n    TABLE_ICON_SVG,\n    LOCK_CLOSED_SVG,\n    LOCK_OPEN_SVG,\n    CHECK_ICON_SVG,\n    X_CIRCLE_SVG,\n    LINK_ICON_SVG,\n    CALCULATOR_ICON_SVG,\n    SAVE_ICON_SVG,\n    DOWNLOAD_ICON_SVG,\n    REFRESH_ICON_SVG,\n    TRASH_ICON_SVG,\n    getStepIconSvg\n} from \"../../Common/icons.js\";\nimport {\n    renderInlineNotes,\n    renderSignoff,\n    updateLockButtonVisual,\n    updateSaveButtonState,\n    initSaveTracking\n} from \"../../Common/notes-signoff.js\";\nimport { canCompleteStep, showBlockedToast } from \"../../Common/workflow-validation.js\";\nimport { initializeOffice } from \"../../Common/gateway.js\";\nimport { formatSheetHeaders, formatCurrencyColumn, formatDateColumn, NUMBER_FORMATS } from \"../../Common/sheet-formatting.js\";\n\nconst MODULE_KEY = \"payroll-recorder\";\nconst MODULE_ALIAS_TOKENS = [\"payroll\", \"payroll recorder\", \"payroll review\", \"pr\"];\nconst MODULE_NAME = \"Payroll Recorder\";\nconst MODULE_CONFIG_SHEET = SHEET_NAMES.CONFIG || \"SS_PF_Config\";\nconst CONFIG_TABLE_CANDIDATES = [\"SS_PF_Config\"];\nconst DEFAULT_CONFIG_CATEGORY = \"Run Settings\";\nconst HERO_COPY =\n    \"Normalize payroll exports, enforce controls, and prep journal entries without leaving Excel. Every run follows the same guidance so you stay audit-ready.\";\n\nconst WORKFLOW_STEPS = STEP_DETAILS.map(({ id, title }) => ({ id, title }));\n\n// SS_PF_Config structure: Category (0), Field (1), Value (2), Permanent (3)\n// For module-prefix rows: Field=Prefix (e.g., \"PR_\"), Value=Module Key (e.g., \"payroll-recorder\")\n// For Config rows: Field=Setting Name, Value=Setting Value, Permanent=Y/N flag\nconst CONFIG_COLUMNS = {\n    TYPE: 0,      // Category column (A)\n    FIELD: 1,     // Field name column (B)\n    VALUE: 2,     // Value column (C)\n    PERMANENT: 3, // Permanent column (D) - Y/N flag for archive persistence\n    TITLE: -1     // Not used\n};\nconst DEFAULT_CONFIG_TYPE = \"Run Settings\";\nconst DEFAULT_CONFIG_TITLE = \"\";\nconst DEFAULT_CONFIG_PERMANENT = \"N\";\nconst NOTE_PLACEHOLDER = \"Enter notes here...\";\nconst JE_TOTAL_DEBIT_FIELD = \"PR_JE_Debit_Total\";\nconst JE_TOTAL_CREDIT_FIELD = \"PR_JE_Credit_Total\";\nconst JE_DIFFERENCE_FIELD = \"PR_JE_Difference\";\n\n// Step notes/sign-off fields - Pattern: PR_{Type}_{StepName}\nconst STEP_NOTES_FIELDS = {\n    0: { note: \"PR_Notes_Config\", reviewer: \"PR_Reviewer_Config\", signOff: \"PR_SignOff_Config\" },\n    1: { note: \"PR_Notes_Import\", reviewer: \"PR_Reviewer_Import\", signOff: \"PR_SignOff_Import\" },\n    2: { note: \"PR_Notes_Headcount\", reviewer: \"PR_Reviewer_Headcount\", signOff: \"PR_SignOff_Headcount\" },\n    3: { note: \"PR_Notes_Validate\", reviewer: \"PR_Reviewer_Validate\", signOff: \"PR_SignOff_Validate\" },\n    4: { note: \"PR_Notes_Review\", reviewer: \"PR_Reviewer_Review\", signOff: \"PR_SignOff_Review\" },\n    5: { note: \"PR_Notes_JE\", reviewer: \"PR_Reviewer_JE\", signOff: \"PR_SignOff_JE\" },\n    6: { note: \"PR_Notes_Archive\", reviewer: \"PR_Reviewer_Archive\", signOff: \"PR_SignOff_Archive\" }\n};\nconst STEP_COMPLETE_FIELDS = {\n    0: \"PR_Complete_Config\",\n    1: \"PR_Complete_Import\",\n    2: \"PR_Complete_Headcount\",\n    3: \"PR_Complete_Validate\",\n    4: \"PR_Complete_Review\",\n    5: \"PR_Complete_JE\",\n    6: \"PR_Complete_Archive\"\n};\nconst STEP_SHEET_MAP = {\n    1: SHEET_NAMES.DATA,\n    2: SHEET_NAMES.DATA_CLEAN,    // Headcount Review \u2192 PR_Data_Clean\n    3: SHEET_NAMES.DATA_CLEAN,    // Validate & Reconcile \u2192 PR_Data_Clean\n    4: SHEET_NAMES.EXPENSE_REVIEW,\n    5: SHEET_NAMES.JE_DRAFT       // Journal Entry Prep \u2192 PR_JE_Draft\n};\n// Config field names - Pattern: PR_{Descriptor}\nconst CONFIG_REVIEWER_FIELD = \"PR_Reviewer\";\nconst PAYROLL_PROVIDER_FIELD = \"PR_Payroll_Provider\";\nconst HEADCOUNT_SKIP_NOTE = \"User opted to skip the headcount review this period.\";\n\nconst appState = {\n    statusText: \"\",\n    focusedIndex: 0,\n    activeView: \"home\",\n    activeStepId: null,\n    stepStatuses: WORKFLOW_STEPS.reduce((map, step) => ({ ...map, [step.id]: \"pending\" }), {})\n};\n\nconst configState = {\n    loaded: false,\n    values: {},\n    permanents: {},\n    overrides: {\n        accountingPeriod: false,\n        jeId: false\n    }\n};\n\nconst pendingWrites = new Map();\nlet resolvedConfigTableName = null;\n// Payroll date - primary name first, legacy fallbacks for migration\nconst PAYROLL_DATE_ALIASES = [\n    \"PR_Payroll_Date\",\n    \"Payroll Date (YYYY-MM-DD)\", \n    \"Payroll_Date\", \n    \"Payroll Date\",\n    \"Payroll_Date_(YYYY-MM-DD)\"\n];\n\nconst headcountState = {\n    skipAnalysis: false,\n    roster: {\n        rosterCount: null,\n        payrollCount: null,\n        difference: null,\n        mismatches: []\n    },\n    departments: {\n        rosterCount: null,\n        payrollCount: null,\n        difference: null,\n        mismatches: []\n    },\n    loading: false,\n    hasAnalyzed: false,\n    lastError: null\n};\n\nlet pendingScrollIndex = null;\n\nconst validationState = {\n    loading: false,\n    lastError: null,\n    prDataTotal: null,\n    cleanTotal: null,\n    reconDifference: null,\n    bankAmount: \"\",\n    bankDifference: null,\n    plugEnabled: false\n};\n\nconst expenseReviewState = {\n    loading: false,\n    lastError: null,\n    periods: [],\n    copilotResponse: \"\",\n    // Data completeness check\n    completenessCheck: {\n        currentPeriod: null,   // { match: true/false, prDataClean: number, currentTotal: number }\n        historicalPeriods: null // { match: true/false, archiveSum: number, periodsSum: number }\n    }\n};\n\nconst journalState = {\n    debitTotal: null,\n    creditTotal: null,\n    difference: null,\n    loading: false,\n    lastError: null\n};\n\n/**\n * Run data completeness check for Payroll Expense Review\n * Validates current period total matches PR_Data_Clean and historical totals match PR_Archive_Summary\n */\nasync function runPayrollCompletenessCheck() {\n    console.log(\"Completeness Check - Starting...\");\n    if (!hasExcelRuntime()) {\n        console.log(\"Completeness Check - Excel runtime not available\");\n        return;\n    }\n    \n    try {\n        await Excel.run(async (context) => {\n            const cleanSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.DATA_CLEAN);\n            const archiveSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.ARCHIVE_SUMMARY);\n            \n            cleanSheet.load(\"isNullObject\");\n            archiveSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            const results = {\n                currentPeriod: null,\n                historicalPeriods: null\n            };\n            \n            // Check 1: Current period total from PR_Data_Clean\n            if (!cleanSheet.isNullObject) {\n                const cleanRange = cleanSheet.getUsedRangeOrNullObject();\n                cleanRange.load(\"values\");\n                await context.sync();\n                \n                if (!cleanRange.isNullObject && cleanRange.values && cleanRange.values.length > 1) {\n                    const headers = (cleanRange.values[0] || []).map(h => String(h || \"\").toLowerCase().trim());\n                    \n                    // Find amount column - PR_Data_Clean uses \"amount\" for individual line items\n                    const amountIdx = headers.findIndex(h => h.includes(\"amount\"));\n                    // Fallback to total columns if no amount column\n                    const totalIdx = amountIdx >= 0 ? amountIdx : headers.findIndex(h => \n                        h === \"total\" || h === \"all-in\" || h === \"allin\" || \n                        h === \"all-in total\" || h === \"gross\" || h === \"total pay\"\n                    );\n                    \n                    console.log(\"Completeness Check - PR_Data_Clean headers:\", headers);\n                    console.log(\"Completeness Check - Amount column index:\", amountIdx, \"Total column index:\", totalIdx);\n                    \n                    if (totalIdx >= 0) {\n                        const dataRows = cleanRange.values.slice(1);\n                        const prDataCleanTotal = dataRows.reduce((sum, row) => sum + (Number(row[totalIdx]) || 0), 0);\n                        \n                        // Get current period total from state\n                        const currentPeriodTotal = expenseReviewState.periods?.[0]?.summary?.total || 0;\n                        \n                        console.log(\"Completeness Check - PR_Data_Clean sum:\", prDataCleanTotal, \"Current period total:\", currentPeriodTotal);\n                        \n                        // Match with tolerance (allow $1 difference for rounding)\n                        const match = Math.abs(prDataCleanTotal - currentPeriodTotal) < 1;\n                        results.currentPeriod = {\n                            match,\n                            prDataClean: prDataCleanTotal,\n                            currentTotal: currentPeriodTotal\n                        };\n                    } else {\n                        console.warn(\"Completeness Check - No amount/total column found in PR_Data_Clean\");\n                    }\n                }\n            }\n            \n            // Check 2: Historical periods - match by date against PR_Archive_Summary\n            if (!archiveSheet.isNullObject) {\n                const archiveRange = archiveSheet.getUsedRangeOrNullObject();\n                archiveRange.load(\"values\");\n                await context.sync();\n                \n                if (!archiveRange.isNullObject && archiveRange.values && archiveRange.values.length > 1) {\n                    const headers = (archiveRange.values[0] || []).map(h => String(h || \"\").toLowerCase().trim());\n                    \n                    // Find date column (pay period, payroll date, date, period)\n                    const dateIdx = headers.findIndex(h => \n                        h.includes(\"pay period\") || h.includes(\"payroll date\") || \n                        h === \"date\" || h === \"period\" || h.includes(\"period\")\n                    );\n                    \n                    // Find amount/total column\n                    const amountIdx = headers.findIndex(h => h.includes(\"amount\"));\n                    const totalIdx = amountIdx >= 0 ? amountIdx : headers.findIndex(h => \n                        h === \"total\" || h === \"all-in\" || h === \"allin\" || \n                        h === \"all-in total\" || h === \"total payroll\" || h.includes(\"total\")\n                    );\n                    \n                    console.log(\"Completeness Check - PR_Archive_Summary headers:\", headers);\n                    console.log(\"Completeness Check - Date column index:\", dateIdx, \"Total column index:\", totalIdx);\n                    \n                    if (totalIdx >= 0 && dateIdx >= 0) {\n                        const dataRows = archiveRange.values.slice(1);\n                        \n                        // Get 5 periods AFTER current (indices 1-5) from expense review state\n                        const historicalPeriods = (expenseReviewState.periods || []).slice(1, 6);\n                        console.log(\"Completeness Check - Looking for periods:\", historicalPeriods.map(p => p.key || p.label));\n                        \n                        // Build a lookup map from archive: normalize dates to YYYY-MM-DD for matching\n                        // SUM all rows for each date (archive may have multiple rows per pay period)\n                        const archiveLookup = new Map();\n                        for (const row of dataRows) {\n                            const rawDate = row[dateIdx];\n                            const normalizedKey = normalizeDateForLookup(rawDate);\n                            if (normalizedKey) {\n                                const amount = Number(row[totalIdx]) || 0;\n                                const existing = archiveLookup.get(normalizedKey) || 0;\n                                archiveLookup.set(normalizedKey, existing + amount);\n                            }\n                        }\n                        console.log(\"Completeness Check - Archive lookup keys:\", Array.from(archiveLookup.keys()));\n                        console.log(\"Completeness Check - Archive lookup values:\", Array.from(archiveLookup.entries()));\n                        \n                        // Match each historical period against archive\n                        let archiveSum = 0;\n                        let periodsSum = 0;\n                        let matchedCount = 0;\n                        const periodDetails = [];\n                        \n                        for (const period of historicalPeriods) {\n                            const periodKey = period.key || period.label || \"\";\n                            const normalizedPeriodKey = normalizeDateForLookup(periodKey);\n                            const periodTotal = period.summary?.total || 0;\n                            periodsSum += periodTotal;\n                            \n                            // Look up in archive\n                            const archiveTotal = archiveLookup.get(normalizedPeriodKey);\n                            if (archiveTotal !== undefined) {\n                                archiveSum += archiveTotal;\n                                matchedCount++;\n                                periodDetails.push({\n                                    period: periodKey,\n                                    calculated: periodTotal,\n                                    archive: archiveTotal,\n                                    match: Math.abs(periodTotal - archiveTotal) < 1\n                                });\n                            } else {\n                                console.warn(`Completeness Check - Period ${periodKey} (normalized: ${normalizedPeriodKey}) not found in archive`);\n                                periodDetails.push({\n                                    period: periodKey,\n                                    calculated: periodTotal,\n                                    archive: null,\n                                    match: false\n                                });\n                            }\n                        }\n                        \n                        console.log(\"Completeness Check - Period details:\", periodDetails);\n                        console.log(\"Completeness Check - Matched\", matchedCount, \"of\", historicalPeriods.length, \"periods\");\n                        console.log(\"Completeness Check - Archive sum:\", archiveSum, \"Periods sum:\", periodsSum);\n                        \n                        // Match if all periods matched and totals are within tolerance\n                        const allMatched = matchedCount === historicalPeriods.length && historicalPeriods.length > 0;\n                        const totalsMatch = Math.abs(archiveSum - periodsSum) < 1;\n                        const match = allMatched && totalsMatch;\n                        \n                        results.historicalPeriods = {\n                            match,\n                            archiveSum,\n                            periodsSum,\n                            matchedCount,\n                            totalPeriods: historicalPeriods.length,\n                            details: periodDetails\n                        };\n                    } else {\n                        console.warn(\"Completeness Check - Missing date or total column in PR_Archive_Summary\");\n                        console.warn(\"  Date column index:\", dateIdx, \"Total column index:\", totalIdx);\n                    }\n                }\n            }\n            \n            // Update state with results\n            expenseReviewState.completenessCheck = results;\n            console.log(\"Completeness Check - Results:\", JSON.stringify(results));\n        });\n        console.log(\"Completeness Check - Complete!\");\n    } catch (error) {\n        console.error(\"Payroll completeness check failed:\", error);\n    }\n}\n\n/**\n * Render Data Completeness Check card for Expense Review step\n * Shows detailed comparison with difference amounts\n */\nfunction renderPayrollCompletenessCard() {\n    const check = expenseReviewState.completenessCheck || {};\n    const hasRun = expenseReviewState.periods?.length > 0;\n    \n    // Helper to format currency\n    const fmt = (val) => `$${Math.round(val || 0).toLocaleString()}`;\n    \n    // Helper to format difference with sign\n    const fmtDiff = (diff) => {\n        const absDiff = Math.abs(diff);\n        if (absDiff < 1) return \"\u2014\";\n        const sign = diff > 0 ? \"+\" : \"-\";\n        return `${sign}$${Math.round(absDiff).toLocaleString()}`;\n    };\n    \n    // Render a comparison row with source values and difference\n    const renderComparisonRow = (label, sourceLabel, sourceVal, calcLabel, calcVal, isMatch, isPending) => {\n        const diff = (sourceVal || 0) - (calcVal || 0);\n        \n        let statusIcon;\n        let statusClass;\n        if (isPending) {\n            statusIcon = `<span class=\"pf-complete-status pf-complete-status--pending\">\u23F3</span>`;\n            statusClass = \"pending\";\n        } else if (isMatch) {\n            statusIcon = `<span class=\"pf-complete-status pf-complete-status--pass\">\u2713</span>`;\n            statusClass = \"pass\";\n        } else {\n            statusIcon = `<span class=\"pf-complete-status pf-complete-status--fail\">\u2717</span>`;\n            statusClass = \"fail\";\n        }\n        \n        const diffDisplay = isPending ? \"\" : `\n            <div class=\"pf-complete-diff ${statusClass}\">\n                ${fmtDiff(diff)}\n            </div>\n        `;\n        \n        return `\n            <div class=\"pf-complete-row ${statusClass}\">\n                <div class=\"pf-complete-header\">\n                    ${statusIcon}\n                    <span class=\"pf-complete-label\">${escapeHtml(label)}</span>\n                </div>\n                ${!isPending ? `\n                <div class=\"pf-complete-values\">\n                    <div class=\"pf-complete-value-row\">\n                        <span class=\"pf-complete-source\">${escapeHtml(sourceLabel)}:</span>\n                        <span class=\"pf-complete-amount\">${fmt(sourceVal)}</span>\n                    </div>\n                    <div class=\"pf-complete-value-row\">\n                        <span class=\"pf-complete-source\">${escapeHtml(calcLabel)}:</span>\n                        <span class=\"pf-complete-amount\">${fmt(calcVal)}</span>\n                    </div>\n                </div>\n                ${diffDisplay}\n                ` : `\n                <div class=\"pf-complete-values\">\n                    <span class=\"pf-complete-pending-text\">Click Run/Refresh to check</span>\n                </div>\n                `}\n            </div>\n        `;\n    };\n    \n    // Current period check\n    const currentResult = check.currentPeriod;\n    const currentPending = !hasRun || currentResult === null || currentResult === undefined;\n    const currentRow = renderComparisonRow(\n        \"Current Period\",\n        \"PR_Data_Clean Total\",\n        currentResult?.prDataClean,\n        \"Calculated Total\",\n        currentResult?.currentTotal,\n        currentResult?.match,\n        currentPending\n    );\n    \n    // Historical periods check - with matched count info\n    const histResult = check.historicalPeriods;\n    const histPending = !hasRun || histResult === null || histResult === undefined;\n    const matchedCount = histResult?.matchedCount || 0;\n    const totalPeriods = histResult?.totalPeriods || 0;\n    const histLabel = totalPeriods > 0 \n        ? `Historical Periods (${matchedCount}/${totalPeriods} matched)`\n        : \"Historical Periods\";\n    const histRow = renderComparisonRow(\n        histLabel,\n        \"PR_Archive_Summary (matched)\",\n        histResult?.archiveSum,\n        \"Calculated Total\",\n        histResult?.periodsSum,\n        histResult?.match,\n        histPending\n    );\n    \n    // Build period details if available (for debugging/expanded view)\n    let periodDetailsHtml = \"\";\n    if (!histPending && histResult?.details?.length > 0) {\n        const detailRows = histResult.details.map(d => {\n            const matchIcon = d.archive === null ? \"\u26A0\uFE0F\" : (d.match ? \"\u2713\" : \"\u2717\");\n            const archiveVal = d.archive !== null ? fmt(d.archive) : \"Not found\";\n            return `\n                <div class=\"pf-complete-detail-row\">\n                    <span class=\"pf-complete-detail-date\">${escapeHtml(d.period)}</span>\n                    <span class=\"pf-complete-detail-icon\">${matchIcon}</span>\n                    <span class=\"pf-complete-detail-vals\">${fmt(d.calculated)} vs ${archiveVal}</span>\n                </div>\n            `;\n        }).join(\"\");\n        periodDetailsHtml = `\n            <div class=\"pf-complete-details-section\">\n                <div class=\"pf-complete-details-header\">Period-by-Period Match</div>\n                ${detailRows}\n            </div>\n        `;\n    }\n    \n    return `\n        <article class=\"pf-step-card pf-step-detail pf-config-card\" id=\"data-completeness-card\">\n            <div class=\"pf-config-head\">\n                <h3>Data Completeness Check</h3>\n                <p class=\"pf-config-subtext\">Verify source data matches calculated totals</p>\n            </div>\n            <div class=\"pf-complete-container\">\n                ${currentRow}\n                ${histRow}\n                ${periodDetailsHtml}\n            </div>\n        </article>\n    `;\n}\n\n/**\n * Get step-specific info panel configuration for Payroll Recorder\n */\nfunction getStepInfoConfig(stepId) {\n    switch (stepId) {\n        case 0:\n            return {\n                title: \"Configuration\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Sets up the key parameters for your payroll review. Complete this before importing data.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCB Key Fields</h4>\n                        <ul>\n                            <li><strong>Payroll Date</strong> \u2014 The period-end date for this payroll run</li>\n                            <li><strong>Accounting Period</strong> \u2014 Shows up in your JE description</li>\n                            <li><strong>Journal Entry ID</strong> \u2014 Reference number for your accounting system</li>\n                            <li><strong>Provider Link</strong> \u2014 Quick access to your payroll provider portal</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>The accounting period and JE ID auto-generate based on your payroll date, but you can override them if needed.</p>\n                    </div>\n                `\n            };\n        case 1:\n            return {\n                title: \"Import Payroll Data\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Gets your payroll data into the workbook. Pull a report from your payroll provider and paste it into PR_Data.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCB Required Columns</h4>\n                        <p>Your payroll export should include:</p>\n                        <ul>\n                            <li><strong>Employee Name</strong> \u2014 Full name (used to match against roster)</li>\n                            <li><strong>Department</strong> \u2014 Cost center assignment</li>\n                            <li><strong>Regular Earnings</strong> \u2014 Base pay for the period</li>\n                            <li><strong>Overtime</strong> \u2014 OT pay (if applicable)</li>\n                            <li><strong>Bonus/Commission</strong> \u2014 Variable compensation</li>\n                            <li><strong>Benefits/Deductions</strong> \u2014 Employer portions</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>Column headers don't need to match exactly\u2014the system is flexible with naming. Just make sure each field is present.</p>\n                    </div>\n                `\n            };\n        case 2:\n            return {\n                title: \"Headcount Review\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Compares employee counts and department assignments between your roster and payroll data to catch discrepancies early.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCA Data Sources</h4>\n                        <ul>\n                            <li><strong>SS_Employee_Roster</strong> \u2014 Your centralized employee list (Column A: Employee names)</li>\n                            <li><strong>PR_Data</strong> \u2014 The payroll data you just imported (Employee column)</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDD0D Employee Alignment Check</h4>\n                        <p>The script compares names between SS_Employee_Roster and PR_Data to find:</p>\n                        <ul>\n                            <li><strong>In Roster, Missing from Payroll</strong> \u2014 Employees on roster but not in payroll (possible missed payment)</li>\n                            <li><strong>In Payroll, Missing from Roster</strong> \u2014 Employees paid but not on roster (possible ghost employee or new hire)</li>\n                        </ul>\n                        <p style=\"font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 8px;\">Names are matched using fuzzy logic to handle minor variations.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFE2 Department Alignment Check</h4>\n                        <p>For employees appearing in both sources, the script compares the \"Department\" column:</p>\n                        <ul>\n                            <li>Flags employees where roster department \u2260 payroll department</li>\n                            <li>Mismatches affect GL coding and cost center reporting</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>If discrepancies are expected (e.g., contractors, temp workers), you can skip this check and add a note explaining why. The note is required if you skip.</p>\n                    </div>\n                `\n            };\n        case 3:\n            return {\n                title: \"Payroll Validation\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Validates that your payroll totals match what was actually paid from the bank.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCA Reconciliation Check</h4>\n                        <ul>\n                            <li><strong>PR_Data Total</strong> \u2014 Sum of all payroll from your import</li>\n                            <li><strong>Clean Total</strong> \u2014 Processed total after expense mapping</li>\n                            <li><strong>Bank Amount</strong> \u2014 What actually left the bank account</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\u26A0\uFE0F Common Differences</h4>\n                        <ul>\n                            <li><strong>Timing</strong> \u2014 Direct deposits vs check clearing dates</li>\n                            <li><strong>Tax payments</strong> \u2014 May be separate from net pay</li>\n                            <li><strong>Benefits</strong> \u2014 Some deductions paid to vendors</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>Small differences ($0.01-$1.00) are usually rounding. Use the plug feature to resolve them.</p>\n                    </div>\n                `\n            };\n        case 4:\n            return {\n                title: \"Expense Review\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Generates an executive-ready payroll expense summary for CFO review, with period comparisons and trend analysis.</p>\n                    </div>\n                    \n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCC2 Data Sources</h4>\n                        <ul>\n                            <li><strong>PR_Data_Clean</strong> \u2014 Current period payroll data (cleaned and categorized)</li>\n                            <li><strong>SS_Employee_Roster</strong> \u2014 Department assignments and employee details</li>\n                            <li><strong>PR_Archive_Summary</strong> \u2014 Historical payroll data for trend analysis</li>\n                        </ul>\n                    </div>\n                    \n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCB0 How Amounts Are Calculated</h4>\n                        <table style=\"width:100%; font-size: 11px; margin-top: 8px; border-collapse: collapse;\">\n                            <tr style=\"border-bottom: 1px solid rgba(255,255,255,0.2);\">\n                                <td style=\"padding: 6px 0;\"><strong>Fixed Salary</strong></td>\n                                <td style=\"padding: 6px 0;\">Regular wages, salaries, and base pay</td>\n                            </tr>\n                            <tr style=\"border-bottom: 1px solid rgba(255,255,255,0.2);\">\n                                <td style=\"padding: 6px 0;\"><strong>Variable Salary</strong></td>\n                                <td style=\"padding: 6px 0;\">Commissions, bonuses, overtime, and incentive pay</td>\n                            </tr>\n                            <tr style=\"border-bottom: 1px solid rgba(255,255,255,0.2);\">\n                                <td style=\"padding: 6px 0;\"><strong>Gross Pay</strong></td>\n                                <td style=\"padding: 6px 0;\">Fixed + Variable Salary</td>\n                            </tr>\n                            <tr style=\"border-bottom: 1px solid rgba(255,255,255,0.2);\">\n                                <td style=\"padding: 6px 0;\"><strong>Burden</strong></td>\n                                <td style=\"padding: 6px 0;\">Employer taxes (FICA, Medicare, FUTA, SUTA), health insurance, 401(k) match, and other employer-paid benefits</td>\n                            </tr>\n                            <tr style=\"border-bottom: 1px solid rgba(255,255,255,0.2);\">\n                                <td style=\"padding: 6px 0;\"><strong>All-In Total</strong></td>\n                                <td style=\"padding: 6px 0;\">Gross Pay + Burden = Total cost to employer</td>\n                            </tr>\n                            <tr>\n                                <td style=\"padding: 6px 0;\"><strong>Burden Rate</strong></td>\n                                <td style=\"padding: 6px 0;\">Burden \u00F7 All-In Total (typically 10-18%)</td>\n                            </tr>\n                        </table>\n                    </div>\n                    \n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCA Report Sections</h4>\n                        <ul>\n                            <li><strong>Executive Summary</strong> \u2014 Current vs prior period comparison (frozen at top)</li>\n                            <li><strong>Department Breakdown</strong> \u2014 Cost allocation by cost center</li>\n                            <li><strong>Historical Context</strong> \u2014 Where current metrics fall within historical ranges</li>\n                            <li><strong>Period Trends</strong> \u2014 6-period trend chart for Total, Fixed, Variable, Burden, and Headcount</li>\n                        </ul>\n                    </div>\n                    \n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCC8 Historical Context Visualization</h4>\n                        <p>The spectrum bars show where your current period falls relative to your historical min/max:</p>\n                        <p style=\"font-family: Consolas, monospace; color: #6366f1; margin: 8px 0;\">\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u25CF\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591</p>\n                        <p style=\"font-size: 11px; color: rgba(255,255,255,0.7);\">The dot (\u25CF) indicates current position. Left = Low, Right = High.</p>\n                    </div>\n                    \n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Review Tips</h4>\n                        <ul>\n                            <li>Compare <strong>Burden Rate</strong> \u2014 Should be consistent period-to-period (10-18% typical)</li>\n                            <li>Watch <strong>Variable Salary</strong> spikes \u2014 May indicate commission/bonus timing</li>\n                            <li>Verify <strong>Headcount changes</strong> \u2014 Should align with HR records</li>\n                            <li>Flag variances <strong>> 10%</strong> from prior period for follow-up</li>\n                        </ul>\n                    </div>\n                `\n            };\n        case 5:\n            return {\n                title: \"Journal Entry\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Generates a balanced journal entry from your payroll data, ready for upload to your accounting system.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCDD How the JE Works</h4>\n                        <p>Maps payroll categories to GL accounts:</p>\n                        <ul>\n                            <li><strong>Expenses</strong> \u2192 Debits to departmental expense accounts</li>\n                            <li><strong>Liabilities</strong> \u2192 Credits to payable accounts</li>\n                            <li><strong>Cash</strong> \u2192 Credit to bank account</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\u2705 Validation Checks</h4>\n                        <ul>\n                            <li><strong>Debits = Credits</strong> \u2014 Entry must balance</li>\n                            <li><strong>All accounts mapped</strong> \u2014 No unassigned categories</li>\n                            <li><strong>Totals match</strong> \u2014 JE ties to PR_Data</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>Review the draft in PR_JE_Draft before exporting to catch any mapping errors.</p>\n                    </div>\n                `\n            };\n        case 6:\n            return {\n                title: \"Archive & Clear\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Creates a backup of your completed payroll run, then resets the workbook so you're ready for the next pay period.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCC1 Step 1: Create Backup</h4>\n                        <p>A new workbook opens containing all your payroll tabs. You'll choose where to save it on your computer or shared drive.</p>\n                        <p style=\"font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 6px;\"><em>Tip: Use a consistent naming convention like \"Payroll_Archive_2024-01-15\"</em></p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCA Step 2: Update History</h4>\n                        <p>The current period's totals are saved to PR_Archive_Summary. This powers the trend charts and completeness checks for future periods.</p>\n                        <p style=\"font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 6px;\"><em>Keeps 5 periods of history \u2014 oldest is removed automatically</em></p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83E\uDDF9 Step 3: Clear Working Data</h4>\n                        <p>Data is cleared from the working sheets:</p>\n                        <ul>\n                            <li>PR_Data (raw import)</li>\n                            <li>PR_Data_Clean (processed data)</li>\n                            <li>PR_Expense_Review (summary & charts)</li>\n                            <li>PR_JE_Draft (journal entry lines)</li>\n                        </ul>\n                        <p style=\"font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 6px;\"><em>Headers are preserved \u2014 only data rows are cleared</em></p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDD04 Step 4: Reset for Next Period</h4>\n                        <ul>\n                            <li>Payroll Date, Accounting Period, JE ID cleared</li>\n                            <li>All sign-offs and completion flags reset</li>\n                            <li>Notes cleared (unless you locked them with \uD83D\uDD12)</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\u26A0\uFE0F Before You Archive</h4>\n                        <ul>\n                            <li>\u2713 JE uploaded to your accounting system</li>\n                            <li>\u2713 All review steps signed off</li>\n                            <li>\u2713 Lock any notes you want to keep</li>\n                        </ul>\n                    </div>\n                `\n            };\n        default:\n            return {\n                title: \"Payroll Recorder\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDC4B Welcome to Payroll Recorder</h4>\n                        <p>This module helps you normalize payroll exports, enforce controls, and prep journal entries.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCB Workflow Overview</h4>\n                        <ol style=\"margin: 8px 0; padding-left: 20px;\">\n                            <li>Configure period settings</li>\n                            <li>Import payroll data</li>\n                            <li>Review headcount alignment</li>\n                            <li>Validate against bank</li>\n                            <li>Review expense summary</li>\n                            <li>Generate journal entry</li>\n                            <li>Archive and reset</li>\n                        </ol>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <p>Click a step card to get started, or tap the <strong>\u24D8</strong> button on any step for detailed guidance.</p>\n                    </div>\n                `\n            };\n    }\n}\n\ninitializeOffice(() => init());\n\nasync function init() {\n    try {\n        await ensureTabVisibility();\n        await loadConfigurationValues();\n        \n        // Activate module homepage on load\n        const homepageConfig = getHomepageConfig(MODULE_KEY);\n        await activateHomepageSheet(homepageConfig.sheetName, homepageConfig.title, homepageConfig.subtitle);\n        \n        renderApp();\n    } catch (error) {\n        console.error(\"[Payroll] Module initialization failed:\", error);\n        throw error;\n    }\n}\n\nasync function ensureTabVisibility() {\n    // Apply prefix-based tab visibility\n    // Shows PR_* tabs, hides PTO_* and SS_* tabs\n    try {\n        await applyModuleTabVisibility(MODULE_KEY);\n        console.log(`[Payroll] Tab visibility applied for ${MODULE_KEY}`);\n    } catch (error) {\n        console.warn(\"[Payroll] Could not apply tab visibility:\", error);\n    }\n}\n\nfunction renderApp() {\n    const root = document.body;\n    if (!root) return;\n    const prevDisabled = appState.focusedIndex <= 0 ? \"disabled\" : \"\";\n    const nextDisabled = appState.focusedIndex >= WORKFLOW_STEPS.length - 1 ? \"disabled\" : \"\";\n    const isConfigView = appState.activeView === \"config\";\n    const isStepView = appState.activeView === \"step\";\n    const isHomeView = !isConfigView && !isStepView;\n    const viewMarkup = isConfigView\n        ? renderConfigView()\n        : isStepView\n            ? renderStepView(appState.activeStepId)\n            : renderHomeView();\n    root.innerHTML = `\n        <div class=\"pf-root\">\n            ${renderBanner(prevDisabled, nextDisabled)}\n            ${viewMarkup}\n            ${renderFooter()}\n        </div>\n    `;\n    \n    // Mount info FAB with step-specific content (only on step/config views, not homepage)\n    const infoFabElement = document.getElementById(\"pf-info-fab-payroll\");\n    if (isHomeView) {\n        // Remove info fab on homepage\n        if (infoFabElement) infoFabElement.remove();\n    } else if (window.PrairieForge?.mountInfoFab) {\n        const infoConfig = getStepInfoConfig(appState.activeStepId);\n        PrairieForge.mountInfoFab({ \n            title: infoConfig.title, \n            content: infoConfig.content, \n            buttonId: \"pf-info-fab-payroll\" \n        });\n    }\n    \n    bindSharedInteractions();\n    if (isConfigView) {\n        bindConfigInteractions();\n    } else if (isStepView) {\n        try {\n            bindStepInteractions(appState.activeStepId);\n        } catch (error) {\n            console.warn(\"Payroll Recorder: failed to bind step interactions\", error);\n        }\n    } else {\n        bindHomeInteractions();\n    }\n    scrollFocusedIntoView();\n    \n    // Show/hide Ada FAB based on view\n    if (isHomeView) {\n        renderAdaFab();\n    } else {\n        removeAdaFab();\n    }\n}\n\nfunction renderBanner(prevDisabled, nextDisabled) {\n    const company = getConfigValue(\"SS_Company_Name\") || \"your company\";\n    return `\n        <div class=\"pf-brand-float\" aria-hidden=\"true\">\n            <span class=\"pf-brand-wave\"></span>\n        </div>\n        <header class=\"pf-banner\">\n            <div class=\"pf-nav-bar\">\n                <button id=\"nav-prev\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" aria-label=\"Previous step\" ${prevDisabled}>\n                    ${ARROW_LEFT_SVG}\n                    <span class=\"sr-only\">Previous step</span>\n                </button>\n                <button id=\"nav-home\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" title=\"Module Home\">\n                    ${HOME_ICON_SVG}\n                    <span class=\"sr-only\">Module Home</span>\n                </button>\n                <button id=\"nav-selector\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" title=\"Module Selector\">\n                    ${MODULES_ICON_SVG}\n                    <span class=\"sr-only\">Module Selector</span>\n                </button>\n                <button id=\"nav-next\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" aria-label=\"Next step\" ${nextDisabled}>\n                    ${ARROW_RIGHT_SVG}\n                    <span class=\"sr-only\">Next step</span>\n                </button>\n                <span class=\"pf-nav-divider\"></span>\n                <div class=\"pf-quick-access-wrapper\">\n                    <button id=\"nav-quick-toggle\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" title=\"Quick Access\">\n                        ${MENU_ICON_SVG}\n                        <span class=\"sr-only\">Quick Access Menu</span>\n                    </button>\n                    <div id=\"quick-access-dropdown\" class=\"pf-quick-dropdown hidden\">\n                        <div class=\"pf-quick-dropdown-header\">Quick Access</div>\n                        <button id=\"nav-roster\" class=\"pf-quick-item pf-clickable\" type=\"button\">\n                            ${USERS_ICON_SVG}\n                            <span>Employee Roster</span>\n                        </button>\n                        <button id=\"nav-accounts\" class=\"pf-quick-item pf-clickable\" type=\"button\">\n                            ${BOOK_ICON_SVG}\n                            <span>Chart of Accounts</span>\n                        </button>\n                        <button id=\"nav-expense-map\" class=\"pf-quick-item pf-clickable\" type=\"button\">\n                            ${TABLE_ICON_SVG}\n                            <span>PR Mapping</span>\n                </button>\n                    </div>\n                </div>\n            </div>\n        </header>\n    `;\n}\n\nfunction renderHomeView() {\n    return `\n        <section class=\"pf-hero\" id=\"pf-hero\">\n            <h2 class=\"pf-hero-title\">Payroll Recorder</h2>\n            <p class=\"pf-hero-copy\">${HERO_COPY}</p>\n            <p class=\"pf-hero-hint\">${escapeHtml(appState.statusText || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <div class=\"pf-step-grid\">\n                ${WORKFLOW_STEPS.map((step, index) => renderStepCard(step, index)).join(\"\")}\n            </div>\n        </section>\n    `;\n}\n\nfunction renderConfigView() {\n    if (!configState.loaded) {\n        return `\n            <section class=\"pf-step-guide\">\n                <article class=\"pf-step-card pf-step-detail\">\n                    <p class=\"pf-step-title\">Loading configuration\u2026</p>\n                </article>\n            </section>\n        `;\n    }\n    const stepFields = STEP_NOTES_FIELDS[0];\n    const payrollDate = formatDateInput(getPayrollDateValue());\n    const accountingPeriod = formatDateInput(getConfigValue(\"PR_Accounting_Period\"));\n    const jeId = getConfigValue(\"PR_Journal_Entry_ID\");\n    const accountingLink = getConfigValue(\"SS_Accounting_Software\");\n    const payrollLink = getPayrollProviderLink();\n    const companyName = getConfigValue(\"SS_Company_Name\");\n    const userName = getConfigValue(CONFIG_REVIEWER_FIELD) || getReviewerDefault();\n    const notes = stepFields ? getConfigValue(stepFields.note) : \"\";\n    const notesPermanent = stepFields ? isFieldPermanent(stepFields.note) : false;\n    const reviewer = (stepFields ? getConfigValue(stepFields.reviewer) : \"\") || getReviewerDefault();\n    const signOffDate = stepFields ? formatDateInput(getConfigValue(stepFields.signOff)) : \"\";\n    const isStepComplete = Boolean(signOffDate || getConfigValue(STEP_COMPLETE_FIELDS[0]));\n\n    return `\n        <section class=\"pf-hero\" id=\"pf-config-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step 0</p>\n            <h2 class=\"pf-hero-title\">Configuration Setup</h2>\n            <p class=\"pf-hero-copy\">Make quick adjustments before every payroll run.</p>\n            <p class=\"pf-hero-hint\">${escapeHtml(appState.statusText || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Period Data</h3>\n                    <p class=\"pf-config-subtext\">Fields in this section may change each period.</p>\n                </div>\n                <div class=\"pf-config-grid\">\n                    <label class=\"pf-config-field\">\n                        <span>Your Name (Used for sign-offs)</span>\n                        <input type=\"text\" id=\"config-user-name\" value=\"${escapeHtml(userName)}\" placeholder=\"Full name\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Payroll Date</span>\n                        <input type=\"date\" id=\"config-payroll-date\" value=\"${escapeHtml(payrollDate)}\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Accounting Period</span>\n                        <input type=\"text\" id=\"config-accounting-period\" value=\"${escapeHtml(accountingPeriod)}\" placeholder=\"Nov 2025\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Journal Entry ID</span>\n                        <input type=\"text\" id=\"config-je-id\" value=\"${escapeHtml(jeId)}\" placeholder=\"PR-AUTO-YYYY-MM-DD\">\n                    </label>\n                </div>\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Static Data</h3>\n                    <p class=\"pf-config-subtext\">Fields rarely change but should be reviewed.</p>\n                </div>\n                <div class=\"pf-config-grid\">\n                    <label class=\"pf-config-field\">\n                        <span>Company Name</span>\n                        <input type=\"text\" id=\"config-company-name\" value=\"${escapeHtml(companyName)}\" placeholder=\"Prairie Forge LLC\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Payroll Provider / Report Location</span>\n                        <input type=\"url\" id=\"config-payroll-provider\" value=\"${escapeHtml(payrollLink)}\" placeholder=\"https://\u2026\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Accounting Software / Import Location</span>\n                        <input type=\"url\" id=\"config-accounting-link\" value=\"${escapeHtml(accountingLink)}\" placeholder=\"https://\u2026\">\n                    </label>\n                </div>\n            </article>\n            ${\n                stepFields\n                    ? renderInlineNotes({\n                          textareaId: \"config-notes\",\n                          value: notes,\n                          permanentId: \"config-notes-permanent\",\n                          isPermanent: notesPermanent,\n                          hintId: \"\",\n                          saveButtonId: \"config-notes-save\"\n                      })\n                    : \"\"\n            }\n            ${\n                stepFields\n                    ? renderSignoff({\n                          reviewerInputId: \"config-reviewer-name\",\n                          reviewerValue: reviewer,\n                          signoffInputId: \"config-signoff-date\",\n                          signoffValue: signOffDate,\n                          isComplete: isStepComplete,\n                          saveButtonId: \"config-signoff-save\",\n                          completeButtonId: \"config-signoff-toggle\"\n                      })\n                    : \"\"\n            }\n        </section>\n    `;\n}\n\nfunction renderProviderCard() {\n    const providerValue = getPayrollProviderLink();\n    const disabledAttr = providerValue ? \"\" : ' data-disabled=\"true\" aria-disabled=\"true\"';\n    return `\n        <article class=\"pf-step-card pf-cta-card pf-clickable\" data-provider-card${disabledAttr}>\n            <div>\n                <p class=\"pf-cta-label\">Payroll Provider</p>\n                <p class=\"pf-cta-text\">\n                    ${\n                        providerValue\n                            ? escapeHtml(providerValue)\n                            : \"Add a Payroll Provider link in configuration to enable this shortcut.\"\n                    }\n                </p>\n            </div>\n            <span aria-hidden=\"true\">\u2197</span>\n        </article>\n    `;\n}\n\nfunction renderQuickTipsCard() {\n    return `\n        <article class=\"pf-step-card pf-step-detail pf-quick-tips\">\n            <h3>Quick Tips</h3>\n            <p>Helpful tips for importing payroll data will appear here soon.</p>\n        </article>\n    `;\n}\n\nfunction renderImportStep(detail) {\n    const stepFields = getStepNoteFields(1);\n    const notesPermanent = stepFields ? isFieldPermanent(stepFields.note) : false;\n    const stepNotes = stepFields ? getConfigValue(stepFields.note) : \"\";\n    const stepReviewer = (stepFields ? getConfigValue(stepFields.reviewer) : \"\") || getReviewerDefault();\n    const stepSignOff = stepFields ? formatDateInput(getConfigValue(stepFields.signOff)) : \"\";\n    const stepComplete = Boolean(stepSignOff || getConfigValue(STEP_COMPLETE_FIELDS[1]));\n    const providerLink = getPayrollProviderLink();\n    \n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">Pull your payroll export from the provider and paste it into PR_Data.</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Payroll Report</h3>\n                    <p class=\"pf-config-subtext\">Open your payroll provider, download the report, and paste into PR_Data.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(\n                        providerLink \n                            ? `<a href=\"${escapeHtml(providerLink)}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"pf-action-toggle pf-clickable\" title=\"Open payroll provider\">${LINK_ICON_SVG}</a>`\n                            : `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"import-provider-btn\" disabled title=\"Add provider link in Configuration\">${LINK_ICON_SVG}</button>`,\n                        \"Provider\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"import-open-data-btn\" title=\"Open PR_Data sheet\">${TABLE_ICON_SVG}</button>`,\n                        \"PR_Data\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"import-clear-btn\" title=\"Clear PR_Data to start over\">${TRASH_ICON_SVG}</button>`,\n                        \"Clear\"\n                    )}\n                </div>\n            </article>\n            ${stepFields ? `\n                ${renderInlineNotes({\n                    textareaId: \"step-notes-1\",\n                    value: stepNotes || \"\",\n                    permanentId: \"step-notes-lock-1\",\n                    isPermanent: notesPermanent,\n                    saveButtonId: \"step-notes-save-1\"\n                })}\n                ${renderSignoff({\n                    reviewerInputId: \"step-reviewer-1\",\n                    reviewerValue: stepReviewer,\n                    signoffInputId: \"step-signoff-1\",\n                    signoffValue: stepSignOff,\n                    isComplete: stepComplete,\n                    saveButtonId: \"step-signoff-save-1\",\n                    completeButtonId: \"step-signoff-toggle-1\"\n                })}\n            ` : \"\"}\n        </section>\n    `;\n}\n\nfunction renderHeadcountStep(detail) {\n    const stepFields = getStepNoteFields(2);\n    const stepNotes = stepFields ? getConfigValue(stepFields.note) : \"\";\n    const stepNotesPermanent = stepFields ? isFieldPermanent(stepFields.note) : false;\n    const stepReviewer = (stepFields ? getConfigValue(stepFields.reviewer) : \"\") || getReviewerDefault();\n    const stepSignOff = stepFields ? formatDateInput(getConfigValue(stepFields.signOff)) : \"\";\n    const stepComplete = Boolean(stepSignOff || getConfigValue(STEP_COMPLETE_FIELDS[2]));\n    const requiresNotes = isHeadcountNotesRequired();\n    const roster = headcountState.roster || {};\n    const departments = headcountState.departments || {};\n    const hasRun = headcountState.hasAnalyzed;\n    \n    // Status banner\n    let statusBanner = \"\";\n    if (headcountState.loading) {\n        statusBanner = `<p class=\"pf-step-note\">Analyzing roster and payroll data\u2026</p>`;\n    } else if (headcountState.lastError) {\n        statusBanner = `<p class=\"pf-step-note\">${escapeHtml(headcountState.lastError)}</p>`;\n    }\n    \n    // Build check rows (circle + pill format)\n    const renderCheckRow = (label, value, isMatch) => {\n        const pending = !hasRun;\n        let circleHtml;\n        \n        if (pending) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pending\"></span>`;\n        } else if (isMatch) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pass\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><polyline points=\"20 6 9 17 4 12\"/></svg>\n            </span>`;\n        } else {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--fail\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n            </span>`;\n        }\n        \n        const valueDisplay = hasRun ? ` = ${value}` : \"\";\n        return `\n            <div class=\"pf-je-check-row\">\n                ${circleHtml}\n                <span class=\"pf-je-check-desc-pill\">${escapeHtml(label)}${valueDisplay}</span>\n            </div>\n        `;\n    };\n    \n    const rosterDiff = roster.difference ?? 0;\n    const deptDiff = departments.difference ?? 0;\n    const rosterMismatches = Array.isArray(roster.mismatches) ? roster.mismatches.filter(Boolean) : [];\n    const deptMismatches = Array.isArray(departments.mismatches) ? departments.mismatches.filter(Boolean) : [];\n    \n    const rosterChecksHtml = `\n        ${renderCheckRow(\"SS_Employee_Roster count\", roster.rosterCount ?? \"\u2014\", true)}\n        ${renderCheckRow(\"PR_Data employee count\", roster.payrollCount ?? \"\u2014\", true)}\n        ${renderCheckRow(\"Difference\", rosterDiff, rosterDiff === 0)}\n    `;\n    \n    const deptChecksHtml = `\n        ${renderCheckRow(\"Expected departments\", departments.rosterCount ?? \"\u2014\", true)}\n        ${renderCheckRow(\"PR_Data departments\", departments.payrollCount ?? \"\u2014\", true)}\n        ${renderCheckRow(\"Difference\", deptDiff, deptDiff === 0)}\n    `;\n    \n    // Inline mismatch tiles for roster differences (like PTO module)\n    const rosterMismatchSection =\n        rosterMismatches.length && !headcountState.skipAnalysis && hasRun\n            ? window.PrairieForge?.renderMismatchTiles?.({\n                  mismatches: rosterMismatches,\n                  label: \"Employees Driving the Difference\",\n                  sourceLabel: \"Roster\",\n                  targetLabel: \"Payroll Data\",\n                  escapeHtml: escapeHtml\n              }) || \"\"\n            : \"\";\n    \n    // Inline mismatch tiles for department differences\n    const deptMismatchSection =\n        deptMismatches.length && !headcountState.skipAnalysis && hasRun\n            ? window.PrairieForge?.renderMismatchTiles?.({\n                  mismatches: deptMismatches,\n                  label: \"Employees with Department Differences\",\n                  formatter: (item) => ({\n                      name: item.employee || item.name || \"\",\n                      source: `${item.rosterDept || \"\u2014\"} \u2192 ${item.payrollDept || \"\u2014\"}`,\n                      isMissingFromTarget: true\n                  }),\n                  escapeHtml: escapeHtml\n              }) || \"\"\n            : \"\";\n    \n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">Headcount Review</h2>\n            <p class=\"pf-hero-copy\">Quick check to make sure your roster matches your payroll data.</p>\n            <div class=\"pf-skip-action\">\n                <button type=\"button\" class=\"pf-skip-btn ${headcountState.skipAnalysis ? \"is-active\" : \"\"}\" id=\"headcount-skip-btn\">\n                    ${X_CIRCLE_SVG}\n                    <span>Skip Analysis</span>\n                </button>\n            </div>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Run Headcount Check</h3>\n                    <p class=\"pf-config-subtext\">Compare employee roster against payroll data.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"roster-run-btn\" title=\"Run headcount analysis\">${CALCULATOR_ICON_SVG}</button>`,\n                        \"Run\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"roster-refresh-btn\" title=\"Refresh analysis\">${REFRESH_ICON_SVG}</button>`,\n                        \"Refresh\"\n                    )}\n                </div>\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Employee Alignment</h3>\n                    <p class=\"pf-config-subtext\">Verify employees match between roster and payroll.</p>\n                </div>\n                ${statusBanner}\n                <div class=\"pf-je-checks-container\">\n                    ${rosterChecksHtml}\n                </div>\n                ${rosterMismatchSection}\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Department Alignment</h3>\n                    <p class=\"pf-config-subtext\">Verify department assignments are consistent.</p>\n                </div>\n                <div class=\"pf-je-checks-container\">\n                    ${deptChecksHtml}\n                </div>\n                ${deptMismatchSection}\n            </article>\n            ${stepFields ? `\n                ${renderInlineNotes({\n                    textareaId: \"step-notes-input\",\n                    value: stepNotes,\n                    permanentId: \"step-notes-permanent\",\n                    isPermanent: stepNotesPermanent,\n                    hintId: requiresNotes ? \"headcount-notes-hint\" : \"\",\n                    saveButtonId: \"step-notes-save-2\"\n                })}\n                ${renderSignoff({\n                    reviewerInputId: \"step-reviewer-name\",\n                    reviewerValue: stepReviewer,\n                    signoffInputId: \"step-signoff-date\",\n                    signoffValue: stepSignOff,\n                    isComplete: stepComplete,\n                    saveButtonId: \"headcount-signoff-save\",\n                    completeButtonId: \"headcount-signoff-toggle\"\n                })}\n            ` : \"\"}\n        </section>\n    `;\n}\n\nfunction renderValidationStep(detail) {\n    const stepFields = getStepNoteFields(3);\n    const stepNotes = stepFields ? getConfigValue(stepFields.note) : \"\";\n    const stepReviewer = (stepFields ? getConfigValue(stepFields.reviewer) : \"\") || getReviewerDefault();\n    const stepSignOff = stepFields ? formatDateInput(getConfigValue(stepFields.signOff)) : \"\";\n    const statusBanner = validationState.loading\n        ? `<p class=\"pf-step-note\">Preparing reconciliation data\u2026</p>`\n        : validationState.lastError\n            ? `<p class=\"pf-step-note\">${escapeHtml(validationState.lastError)}</p>`\n            : \"\";\n    const stepComplete = Boolean(stepSignOff || getConfigValue(STEP_COMPLETE_FIELDS[3]));\n    const hasRun = validationState.prDataTotal !== null;\n    \n    // Reconciliation check values\n    const prDataTotal = validationState.prDataTotal;\n    const cleanTotal = validationState.cleanTotal;\n    const reconDiff = validationState.reconDifference ?? (prDataTotal != null && cleanTotal != null ? prDataTotal - cleanTotal : null);\n    const reconMatches = reconDiff !== null && Math.abs(reconDiff) < 0.01;\n    \n    // Bank reconciliation values  \n    const bankClean = formatCurrency(validationState.cleanTotal);\n    const bankDiff = validationState.bankDifference != null ? formatCurrency(validationState.bankDifference) : \"---\";\n    const bankHint = validationState.bankDifference == null ? \"\"\n        : Math.abs(validationState.bankDifference) < 0.5\n            ? \"Difference within acceptable tolerance.\"\n            : \"Difference exceeds tolerance and should be resolved.\";\n    const bankValue = formatBankInput(validationState.bankAmount);\n    \n    // Build reconciliation check rows (circle + pill format)\n    const renderCheckRow = (label, desc, passed) => {\n        const pending = !hasRun;\n        let circleHtml;\n        \n        if (pending) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pending\"></span>`;\n        } else if (passed) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pass\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><polyline points=\"20 6 9 17 4 12\"/></svg>\n            </span>`;\n        } else {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--fail\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n            </span>`;\n        }\n        \n        return `\n            <div class=\"pf-je-check-row\">\n                ${circleHtml}\n                <span class=\"pf-je-check-desc-pill\">${escapeHtml(desc)}</span>\n            </div>\n        `;\n    };\n    \n    const prDataDisplay = hasRun ? formatCurrency(prDataTotal) : \"\u2014\";\n    const cleanDisplay = hasRun ? formatCurrency(cleanTotal) : \"\u2014\";\n    const diffDisplay = hasRun ? formatCurrency(reconDiff) : \"\u2014\";\n    \n    const reconChecksHtml = `\n        ${renderCheckRow(\"PR_Data Total\", `PR_Data Total = ${prDataDisplay}`, true)}\n        ${renderCheckRow(\"PR_Data_Clean Total\", `PR_Data_Clean Total = ${cleanDisplay}`, true)}\n        ${renderCheckRow(\"Difference\", `Difference = ${diffDisplay} (should be $0.00)`, reconMatches)}\n    `;\n\n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">Normalize your payroll data and verify totals match.</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Run Validation</h3>\n                    <p class=\"pf-config-subtext\">Build PR_Data_Clean from your imported data and verify totals.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"validation-run-btn\" title=\"Run reconciliation\">${CALCULATOR_ICON_SVG}</button>`,\n                        \"Run\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"validation-refresh-btn\" title=\"Refresh reconciliation\">${REFRESH_ICON_SVG}</button>`,\n                        \"Refresh\"\n                    )}\n                </div>\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Data Reconciliation</h3>\n                    <p class=\"pf-config-subtext\">Verify PR_Data and PR_Data_Clean totals match.</p>\n                </div>\n                ${statusBanner}\n                <div class=\"pf-je-checks-container\">\n                    ${reconChecksHtml}\n                </div>\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Bank Reconciliation</h3>\n                    <p class=\"pf-config-subtext\">Compare payroll total to the amount pulled from the bank.</p>\n                </div>\n                <div class=\"pf-config-grid pf-metric-grid\">\n                    <label class=\"pf-config-field\">\n                        <span>Cost per PR_Data_Clean</span>\n                        <input id=\"bank-clean-total-value\" type=\"text\" class=\"pf-readonly-input pf-metric-value\" value=\"${bankClean}\" readonly>\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Cost per Bank</span>\n                        <input\n                            type=\"text\"\n                            inputmode=\"decimal\"\n                            id=\"bank-amount-input\"\n                            class=\"pf-metric-input\"\n                            value=\"${escapeHtml(bankValue)}\"\n                            placeholder=\"0.00\"\n                            aria-label=\"Enter bank amount\"\n                        >\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Difference</span>\n                        <input id=\"bank-diff-value\" type=\"text\" class=\"pf-readonly-input pf-metric-value\" value=\"${bankDiff}\" readonly>\n                    </label>\n                </div>\n                <p class=\"pf-metric-hint\" id=\"bank-diff-hint\">${escapeHtml(bankHint)}</p>\n            </article>\n            ${stepFields ? `\n                ${renderInlineNotes({\n                    textareaId: \"step-notes-input\",\n                    value: stepNotes,\n                    permanentId: \"step-notes-permanent\",\n                    isPermanent: isFieldPermanent(stepFields.note),\n                    saveButtonId: \"step-notes-save-3\"\n                })}\n            ` : \"\"}\n            ${renderSignoff({\n                reviewerInputId: \"step-reviewer-name\",\n                reviewerValue: stepReviewer,\n                signoffInputId: \"step-signoff-3\",\n                signoffValue: stepSignOff,\n                isComplete: stepComplete,\n                saveButtonId: \"step-signoff-save-3\",\n                completeButtonId: \"validation-signoff-toggle\"\n            })}\n        </section>\n    `;\n}\n\nfunction renderExpenseReviewStep(detail) {\n    const stepFields = getStepNoteFields(4);\n    const stepNotes = stepFields ? getConfigValue(stepFields.note) : \"\";\n    const stepReviewer = (stepFields ? getConfigValue(stepFields.reviewer) : \"\") || getReviewerDefault();\n    const stepSignOff = stepFields ? formatDateInput(getConfigValue(stepFields.signOff)) : \"\";\n    const stepComplete = Boolean(stepSignOff || getConfigValue(STEP_COMPLETE_FIELDS[4]));\n    const statusBanner = expenseReviewState.loading\n        ? `<p class=\"pf-step-note\">Preparing executive summary\u2026</p>`\n        : expenseReviewState.lastError\n            ? `<p class=\"pf-step-note\">${escapeHtml(expenseReviewState.lastError)}</p>`\n            : \"\";\n    const copilotMarkup = renderCopilotCard({\n        id: \"expense-review-copilot\",\n        body: \"Want help analyzing your data? Just ask!\",\n        placeholder: \"Where should I focus this pay period?\",\n        buttonLabel: \"Ask CoPilot\"\n    });\n\n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n            <p class=\"pf-hero-hint\"></p>\n        </section>\n        <section class=\"pf-step-guide\">\n            ${statusBanner}\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Perform Analysis</h3>\n                    <p class=\"pf-config-subtext\">Populate Expense Review and perform review.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle\" id=\"expense-run-btn\" title=\"Run expense review analysis\">${CALCULATOR_ICON_SVG}</button>`,\n                        \"Run\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle\" id=\"expense-refresh-btn\" title=\"Refresh expense data\">${REFRESH_ICON_SVG}</button>`,\n                        \"Refresh\"\n                    )}\n                </div>\n            </article>\n            ${renderPayrollCompletenessCard()}\n                ${copilotMarkup}\n            ${\n                stepFields\n                    ? `\n            ${renderInlineNotes({\n                textareaId: \"step-notes-input\",\n                value: stepNotes,\n                permanentId: \"step-notes-permanent\",\n                isPermanent: isFieldPermanent(stepFields.note),\n                saveButtonId: \"step-notes-save-4\"\n            })}\n            ${renderSignoff({\n                reviewerInputId: \"step-reviewer-name\",\n                reviewerValue: stepReviewer,\n                signoffInputId: \"step-signoff-4\",\n                signoffValue: stepSignOff,\n                isComplete: stepComplete,\n                saveButtonId: \"step-signoff-save-4\",\n                completeButtonId: \"expense-signoff-toggle\"\n            })}\n            `\n                    : \"\"\n            }\n        </section>\n    `;\n}\n\nfunction renderJournalStep(detail) {\n    const stepFields = getStepNoteFields(5);\n    const stepNotes = stepFields ? getConfigValue(stepFields.note) : \"\";\n    const notesPermanent = stepFields ? isFieldPermanent(stepFields.note) : false;\n    const stepReviewer = (stepFields ? getConfigValue(stepFields.reviewer) : \"\") || getReviewerDefault();\n    const stepSignOff = stepFields ? formatDateInput(getConfigValue(stepFields.signOff)) : \"\";\n    const stepComplete = Boolean(stepSignOff || getConfigValue(STEP_COMPLETE_FIELDS[5]));\n    const statusNote = journalState.lastError\n        ? `<p class=\"pf-step-note\">${escapeHtml(journalState.lastError)}</p>`\n        : \"\";\n    \n    // This is a bank feed breakdown, NOT a balanced JE\n    // Check 1: Line Amount should equal Debit - Credit\n    // Check 2: JE total should match PR_Data_Clean total\n    const hasRun = journalState.debitTotal !== null;\n    const debitTotal = journalState.debitTotal ?? 0;\n    const creditTotal = journalState.creditTotal ?? 0;\n    const lineAmount = debitTotal - creditTotal;\n    const cleanTotal = validationState.cleanTotal ?? 0;\n    \n    // Line Amount check: Debit - Credit should make sense\n    const lineAmountValid = hasRun; // Always valid if we have data\n    \n    // Total matches PR_Data_Clean\n    const totalMatchesClean = hasRun && Math.abs(lineAmount - cleanTotal) < 0.01;\n    \n    // Build validation check rows\n    const renderCheckRow = (desc, passed) => {\n        const pending = !hasRun;\n        let circleHtml;\n        \n        if (pending) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pending\"></span>`;\n        } else if (passed) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pass\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><polyline points=\"20 6 9 17 4 12\"/></svg>\n            </span>`;\n        } else {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--fail\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n            </span>`;\n        }\n        \n        return `\n            <div class=\"pf-je-check-row\">\n                ${circleHtml}\n                <span class=\"pf-je-check-desc-pill\">${escapeHtml(desc)}</span>\n            </div>\n        `;\n    };\n    \n    const debitDisplay = hasRun ? formatCurrency(debitTotal) : \"\u2014\";\n    const creditDisplay = hasRun ? formatCurrency(creditTotal) : \"\u2014\";\n    const lineAmountDisplay = hasRun ? formatCurrency(lineAmount) : \"\u2014\";\n    const cleanDisplay = hasRun ? formatCurrency(cleanTotal) : \"\u2014\";\n    \n    const checksHtml = `\n        ${renderCheckRow(`Total Debits = ${debitDisplay}`, lineAmountValid)}\n        ${renderCheckRow(`Total Credits = ${creditDisplay}`, lineAmountValid)}\n        ${renderCheckRow(`Line Amount (Debit - Credit) = ${lineAmountDisplay}`, lineAmountValid)}\n        ${renderCheckRow(`JE Total matches PR_Data_Clean (${cleanDisplay})`, totalMatchesClean)}\n    `;\n\n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">Generate the upload file to break down the bank feed line item.</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Generate Upload File</h3>\n                    <p class=\"pf-config-subtext\">Build the breakdown from PR_Data_Clean for your accounting system.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"je-create-btn\" title=\"Generate from PR_Data_Clean\">${TABLE_ICON_SVG}</button>`,\n                        \"Generate\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"je-run-btn\" title=\"Refresh validation\">${REFRESH_ICON_SVG}</button>`,\n                        \"Refresh\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"je-export-btn\" title=\"Export as CSV\">${DOWNLOAD_ICON_SVG}</button>`,\n                        \"Export\"\n                    )}\n                </div>\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Validation Checks</h3>\n                    <p class=\"pf-config-subtext\">Verify totals before uploading to your accounting system.</p>\n                </div>\n                ${statusNote}\n                <div class=\"pf-je-checks-container\">\n                    ${checksHtml}\n                </div>\n            </article>\n            ${stepFields ? `\n                ${renderInlineNotes({\n                    textareaId: \"step-notes-input\",\n                    value: stepNotes || \"\",\n                    permanentId: \"step-notes-permanent\",\n                    isPermanent: notesPermanent,\n                    saveButtonId: \"step-notes-save-5\"\n                })}\n                ${renderSignoff({\n                    reviewerInputId: \"step-reviewer-name\",\n                    reviewerValue: stepReviewer,\n                    signoffInputId: \"step-signoff-5\",\n                    signoffValue: stepSignOff,\n                    isComplete: stepComplete,\n                    saveButtonId: \"step-signoff-save-5\",\n                    completeButtonId: \"step-signoff-toggle-5\"\n                })}\n            `\n                    : \"\"\n            }\n        </section>\n    `;\n}\n\nfunction renderArchiveStep(detail) {\n    const completionItems = WORKFLOW_STEPS.filter((step) => step.id !== 6).map((step) => ({\n        id: step.id,\n        title: step.title,\n        complete: isStepCompleteFromConfig(step.id)\n    }));\n    const allComplete = completionItems.every((item) => item.complete);\n    const statusList = completionItems\n        .map(\n            (item) => `\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head pf-notes-header\">\n                    <span class=\"pf-action-toggle ${item.complete ? \"is-active\" : \"\"}\" aria-pressed=\"${item.complete}\">\n                        ${CHECK_ICON_SVG}\n                    </span>\n                    <div>\n                        <h3>${escapeHtml(item.title)}</h3>\n                        <p class=\"pf-config-subtext\">${item.complete ? \"Complete\" : \"Not complete\"}</p>\n                    </div>\n                </div>\n            </article>\n        `\n        )\n        .join(\"\");\n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n            <p class=\"pf-hero-hint\"></p>\n        </section>\n        <section class=\"pf-step-guide\">\n            ${statusList}\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Archive & Reset</h3>\n                    <p class=\"pf-config-subtext\">Create an archive of this module\u2019s sheets and clear work tabs.</p>\n                </div>\n                <div class=\"pf-pill-row pf-config-actions\">\n                    <button type=\"button\" class=\"pf-pill-btn\" id=\"archive-run-btn\" ${allComplete ? \"\" : \"disabled\"}>Archive</button>\n                </div>\n            </article>\n        </section>\n    `;\n}\nfunction renderStepView(stepId) {\n    const detail =\n        STEP_DETAILS.find((step) => step.id === stepId) || {\n            id: stepId ?? \"-\",\n            title: \"Workflow Step\",\n            summary: \"\",\n            description: \"\",\n            checklist: []\n        };\n    if (stepId === 1) return renderImportStep(detail);\n    if (stepId === 2) return renderHeadcountStep(detail);\n    if (stepId === 3) return renderValidationStep(detail);\n    if (stepId === 4) return renderExpenseReviewStep(detail);\n    if (stepId === 5) return renderJournalStep(detail);\n    if (stepId === 6) return renderArchiveStep(detail);\n    const isStepOne = false; // Step 1 now has dedicated render\n    const stepFields = getStepNoteFields(stepId);\n    const stepNotes = stepFields ? getConfigValue(stepFields.note) : \"\";\n    const stepNotesPermanent = stepFields ? isFieldPermanent(stepFields.note) : false;\n    const stepReviewer = (stepFields ? getConfigValue(stepFields.reviewer) : \"\") || getReviewerDefault();\n    const stepSignOff = stepFields ? formatDateInput(getConfigValue(stepFields.signOff)) : \"\";\n    const stepComplete =\n        stepFields && STEP_COMPLETE_FIELDS[stepId]\n            ? Boolean(stepSignOff || getConfigValue(STEP_COMPLETE_FIELDS[stepId]))\n            : Boolean(stepSignOff);\n    const highlights = (detail.highlights || [])\n        .map(\n            (item) => `\n            <div class=\"pf-step-highlight\">\n                <span class=\"pf-step-highlight-label\">${escapeHtml(item.label)}</span>\n                <span class=\"pf-step-highlight-detail\">${escapeHtml(item.detail)}</span>\n            </div>\n        `\n        )\n        .join(\"\");\n    const checklist =\n        (detail.checklist || [])\n            .map((item) => `<li>${escapeHtml(item)}</li>`)\n            .join(\"\") || \"\";\n    const descriptionText = isStepOne\n        ? \"\"\n        : detail.description || \"Detailed guidance will appear here.\";\n    const actionButtons = [];\n    if (!isStepOne && detail.ctaLabel) {\n        actionButtons.push(\n            `<button type=\"button\" class=\"pf-pill-btn\" id=\"step-action-btn\">${escapeHtml(detail.ctaLabel)}</button>`\n        );\n    }\n    if (!isStepOne) {\n        actionButtons.push(\n            `<button type=\"button\" class=\"pf-pill-btn pf-pill-btn--ghost\" id=\"step-back-btn\">Back to Step List</button>`\n        );\n    }\n    const actionSection = actionButtons.length\n        ? `<div class=\"pf-pill-row pf-config-actions\">${actionButtons.join(\"\")}</div>`\n        : \"\";\n    const providerLink = getPayrollProviderLink();\n    const providerSection = isStepOne\n        ? `\n            <div class=\"pf-link-card\">\n                <h3 class=\"pf-link-card__title\">Payroll Reports</h3>\n                <p class=\"pf-link-card__subtitle\">Open your latest payroll export.</p>\n                <div class=\"pf-link-list\">\n                    <a\n                        class=\"pf-link-item\"\n                        id=\"pr-provider-link\"\n                        ${providerLink ? `href=\"${escapeHtml(providerLink)}\" target=\"_blank\" rel=\"noopener noreferrer\"` : `aria-disabled=\"true\"`}\n                    >\n                        <span class=\"pf-link-item__icon\">${LINK_ICON_SVG}</span>\n                        <span class=\"pf-link-item__body\">\n                            <span class=\"pf-link-item__title\">Open Payroll Export</span>\n                            <span class=\"pf-link-item__meta\">${escapeHtml(\n                                providerLink || \"Add a provider link in Configuration\"\n                            )}</span>\n                        </span>\n                    </a>\n                </div>\n            </div>\n        `\n        : \"\";\n    const quickTipsSection = \"\";\n    const highlightSection =\n        !isStepOne && highlights ? `<article class=\"pf-step-card pf-step-detail\">${highlights}</article>` : \"\";\n    const checklistSection =\n        !isStepOne && checklist\n            ? `<article class=\"pf-step-card pf-step-detail\">\n                            <h3 class=\"pf-step-subtitle\">Checklist</h3>\n                            <ul class=\"pf-step-checklist\">${checklist}</ul>\n                        </article>`\n            : \"\";\n    const descriptionSection =\n        !isStepOne || descriptionText || actionSection\n            ? `\n            <article class=\"pf-step-card pf-step-detail\">\n                <p class=\"pf-step-title\">${escapeHtml(descriptionText)}</p>\n                ${!isStepOne && detail.statusHint ? `<p class=\"pf-step-note\">${escapeHtml(detail.statusHint)}</p>` : \"\"}\n                ${actionSection}\n            </article>\n        `\n            : \"\";\n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n            <p class=\"pf-hero-hint\">${escapeHtml(appState.statusText || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            ${providerSection}\n            ${quickTipsSection}\n            ${descriptionSection}\n            ${highlightSection}\n            ${checklistSection}\n            ${\n                stepFields\n                    ? `\n                ${renderInlineNotes({\n                    textareaId: \"step-notes-input\",\n                    value: stepNotes,\n                    permanentId: \"step-notes-permanent\",\n                    isPermanent: stepNotesPermanent,\n                    saveButtonId: \"step-notes-save\"\n                })}\n                ${renderSignoff({\n                    reviewerInputId: \"step-reviewer-name\",\n                    reviewerValue: stepReviewer,\n                    signoffInputId: `step-signoff-${stepId}`,\n                    signoffValue: stepSignOff,\n                    isComplete: stepComplete,\n                    saveButtonId: `step-signoff-save-${stepId}`,\n                    completeButtonId: `step-signoff-toggle-${stepId}`,\n                    subtext: \"Ready to move on? Save and click Done when finished.\"\n                })}\n            `\n                    : \"\"\n            }\n        </section>\n    `;\n}\n\nfunction renderStepCard(step, index) {\n    const isActive = appState.focusedIndex === index ? \"pf-step-card--active\" : \"\";\n    const icon = getStepIconSvg(getStepType(step.id));\n    return `\n        <article class=\"pf-step-card pf-clickable ${isActive}\" data-step-card data-step-index=\"${index}\" data-step-id=\"${step.id}\">\n            <p class=\"pf-step-index\">Step ${step.id}</p>\n            <h3 class=\"pf-step-title\">${icon ? `${icon}` : \"\"}${escapeHtml(step.title)}</h3>\n        </article>\n    `;\n}\n\nfunction renderFooter() {\n    return `\n        <footer class=\"pf-brand-footer\">\n            <div class=\"pf-brand-text\">\n                <div class=\"pf-brand-label\">prairie.forge</div>\n                <div class=\"pf-brand-meta\">\u00A9 Prairie Forge LLC, 2025. All rights reserved. Version ${VERSION}</div>\n                <button type=\"button\" class=\"pf-config-link\" id=\"showConfigSheets\">CONFIGURATION</button>\n            </div>\n        </footer>\n    `;\n}\n\nfunction getStepType(stepId) {\n    if (stepId === 0) return \"config\";\n    if (stepId === 1) return \"import\";\n    if (stepId === 2) return \"headcount\";\n    if (stepId === 3) return \"validate\";\n    if (stepId === 4) return \"review\";\n    if (stepId === 5) return \"journal\";\n    if (stepId === 6) return \"archive\";\n    return \"\";\n}\n\nfunction bindSharedInteractions() {\n    document.getElementById(\"nav-home\")?.addEventListener(\"click\", () => {\n        returnHome();\n        document.getElementById(\"pf-hero\")?.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n    });\n    document.getElementById(\"nav-selector\")?.addEventListener(\"click\", () => {\n        window.location.href = \"../module-selector/index.html\";\n    });\n    document.getElementById(\"nav-prev\")?.addEventListener(\"click\", () => moveFocus(-1));\n    document.getElementById(\"nav-next\")?.addEventListener(\"click\", () => moveFocus(1));\n    \n    // Quick Access hamburger menu toggle\n    const quickToggle = document.getElementById(\"nav-quick-toggle\");\n    const quickDropdown = document.getElementById(\"quick-access-dropdown\");\n    \n    quickToggle?.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        quickDropdown?.classList.toggle(\"hidden\");\n        quickToggle.classList.toggle(\"is-active\");\n    });\n    \n    // Close dropdown when clicking outside\n    document.addEventListener(\"click\", (e) => {\n        if (!quickDropdown?.contains(e.target) && !quickToggle?.contains(e.target)) {\n            quickDropdown?.classList.add(\"hidden\");\n            quickToggle?.classList.remove(\"is-active\");\n        }\n    });\n    \n    // Quick Access buttons - open reference data sheets\n    document.getElementById(\"nav-roster\")?.addEventListener(\"click\", () => {\n        openReferenceSheet(\"SS_Employee_Roster\");\n        quickDropdown?.classList.add(\"hidden\");\n        quickToggle?.classList.remove(\"is-active\");\n    });\n    document.getElementById(\"nav-accounts\")?.addEventListener(\"click\", () => {\n        openReferenceSheet(\"SS_Chart_of_Accounts\");\n        quickDropdown?.classList.add(\"hidden\");\n        quickToggle?.classList.remove(\"is-active\");\n    });\n    document.getElementById(\"nav-expense-map\")?.addEventListener(\"click\", async () => {\n        quickDropdown?.classList.add(\"hidden\");\n        quickToggle?.classList.remove(\"is-active\");\n        await navigateToExpenseMapping();\n    });\n    \n    // CONFIGURATION link - unhides SS_* sheets for config access\n    document.getElementById(\"showConfigSheets\")?.addEventListener(\"click\", async () => {\n        await unhideSystemSheets();\n    });\n}\n\n/**\n * Unhide system sheets (SS_* prefix) for configuration access\n */\nasync function unhideSystemSheets() {\n    if (typeof Excel === \"undefined\") {\n        console.log(\"Excel not available\");\n        return;\n    }\n    \n    try {\n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            let unhiddenCount = 0;\n            worksheets.items.forEach((sheet) => {\n                if (sheet.name.toUpperCase().startsWith(\"SS_\")) {\n                    sheet.visibility = Excel.SheetVisibility.visible;\n                    console.log(`[Config] Made visible: ${sheet.name}`);\n                    unhiddenCount++;\n                }\n            });\n            \n            await context.sync();\n            \n            // Activate SS_PF_Config if it exists\n            const configSheet = context.workbook.worksheets.getItemOrNullObject(\"SS_PF_Config\");\n            configSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (!configSheet.isNullObject) {\n                configSheet.activate();\n                configSheet.getRange(\"A1\").select();\n                await context.sync();\n            }\n            \n            console.log(`[Config] ${unhiddenCount} system sheets now visible`);\n        });\n    } catch (error) {\n        console.error(\"[Config] Error unhiding system sheets:\", error);\n    }\n}\n\n/**\n * Open a reference data sheet (creates if doesn't exist)\n * Makes sheet visible first if it's hidden\n */\nasync function openReferenceSheet(sheetName) {\n    if (!sheetName || typeof Excel === \"undefined\") {\n        return;\n    }\n    \n    const defaultHeaders = {\n        \"SS_Employee_Roster\": [\"Employee\", \"Department\", \"Pay_Rate\", \"Status\", \"Hire_Date\"],\n        \"SS_Chart_of_Accounts\": [\"Account_Number\", \"Account_Name\", \"Type\", \"Category\"]\n    };\n    \n    try {\n        await Excel.run(async (context) => {\n            let sheet = context.workbook.worksheets.getItemOrNullObject(sheetName);\n            sheet.load(\"isNullObject,visibility\");\n            await context.sync();\n            \n            if (sheet.isNullObject) {\n                // Create the sheet with default headers\n                sheet = context.workbook.worksheets.add(sheetName);\n                const headers = defaultHeaders[sheetName] || [\"Column1\", \"Column2\"];\n                const headerRange = sheet.getRange(`A1:${String.fromCharCode(64 + headers.length)}1`);\n                headerRange.values = [headers];\n                headerRange.format.font.bold = true;\n                headerRange.format.fill.color = \"#f0f0f0\";\n                headerRange.format.autofitColumns();\n                await context.sync();\n            } else {\n                // Make sure sheet is visible before activating (it may be hidden by tab visibility)\n                sheet.visibility = Excel.SheetVisibility.visible;\n                await context.sync();\n            }\n            \n            sheet.activate();\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n            console.log(`[Quick Access] Opened sheet: ${sheetName}`);\n        });\n    } catch (error) {\n        console.error(\"Error opening reference sheet:\", error);\n    }\n}\n\n/**\n * Navigate directly to the PR_Expense_Mapping sheet\n */\nasync function navigateToExpenseMapping() {\n    try {\n        await Excel.run(async (context) => {\n            let sheet = context.workbook.worksheets.getItemOrNullObject(\"PR_Expense_Mapping\");\n            sheet.load(\"isNullObject,visibility\");\n            await context.sync();\n            \n            if (sheet.isNullObject) {\n                // Create the sheet with default headers\n                sheet = context.workbook.worksheets.add(\"PR_Expense_Mapping\");\n                const headers = [\"Expense_Category\", \"GL_Account\", \"Description\", \"Active\"];\n                const headerRange = sheet.getRange(\"A1:D1\");\n                headerRange.values = [headers];\n                headerRange.format.font.bold = true;\n            } else {\n                // Make sure sheet is visible before activating\n                sheet.visibility = Excel.SheetVisibility.visible;\n                await context.sync();\n            }\n            \n            sheet.activate();\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n            console.log(\"[Quick Access] Opened PR_Expense_Mapping\");\n        });\n    } catch (error) {\n        console.error(\"Error navigating to PR_Expense_Mapping:\", error);\n    }\n}\n\nfunction bindHomeInteractions() {\n    document.querySelectorAll(\"[data-step-card]\").forEach((card) => {\n        const index = Number(card.getAttribute(\"data-step-index\"));\n        card.addEventListener(\"click\", () => focusStep(index));\n    });\n}\n\nfunction bindConfigInteractions() {\n    // User Name field - writes to SS_PF_Config as PR_Reviewer_Name\n    const userNameInput = document.getElementById(\"config-user-name\");\n    userNameInput?.addEventListener(\"change\", (event) => {\n        const value = event.target.value.trim();\n        scheduleConfigWrite(CONFIG_REVIEWER_FIELD, value);\n        // Also update the reviewer field in the signoff section if it's empty\n        const reviewerInput = document.getElementById(\"config-reviewer-name\");\n        if (reviewerInput && !reviewerInput.value) {\n            reviewerInput.value = value;\n        }\n    });\n\n    const payrollInput = document.getElementById(\"config-payroll-date\");\n    payrollInput?.addEventListener(\"change\", (event) => {\n        const value = event.target.value || \"\";\n        // Always use the primary field name to avoid duplicate rows\n        scheduleConfigWrite(\"PR_Payroll_Date\", value);\n        if (!value) return;\n        if (!configState.overrides.accountingPeriod) {\n            const derivedPeriod = deriveAccountingPeriod(value);\n            if (derivedPeriod) {\n                const periodInput = document.getElementById(\"config-accounting-period\");\n                if (periodInput) periodInput.value = derivedPeriod;\n                scheduleConfigWrite(\"PR_Accounting_Period\", derivedPeriod);\n            }\n        }\n        if (!configState.overrides.jeId) {\n            const derivedJe = deriveJeId(value);\n            if (derivedJe) {\n                const jeInput = document.getElementById(\"config-je-id\");\n                if (jeInput) jeInput.value = derivedJe;\n                scheduleConfigWrite(\"PR_Journal_Entry_ID\", derivedJe);\n            }\n        }\n    });\n\n    const stepFields = getStepNoteFields(0);\n\n    const periodInput = document.getElementById(\"config-accounting-period\");\n    periodInput?.addEventListener(\"change\", (event) => {\n        configState.overrides.accountingPeriod = Boolean(event.target.value);\n        scheduleConfigWrite(\"PR_Accounting_Period\", event.target.value || \"\");\n    });\n\n    const jeInput = document.getElementById(\"config-je-id\");\n    jeInput?.addEventListener(\"change\", (event) => {\n        configState.overrides.jeId = Boolean(event.target.value);\n        scheduleConfigWrite(\"PR_Journal_Entry_ID\", event.target.value.trim());\n    });\n\n    document.getElementById(\"config-company-name\")?.addEventListener(\"change\", (event) => {\n        scheduleConfigWrite(\"SS_Company_Name\", event.target.value.trim());\n    });\n\n    document.getElementById(\"config-payroll-provider\")?.addEventListener(\"change\", (event) => {\n        const value = event.target.value.trim();\n        scheduleConfigWrite(PAYROLL_PROVIDER_FIELD, value);\n    });\n\n    document.getElementById(\"config-accounting-link\")?.addEventListener(\"change\", (event) => {\n        scheduleConfigWrite(\"SS_Accounting_Software\", event.target.value.trim());\n    });\n\n    const notesInput = document.getElementById(\"config-notes\");\n    notesInput?.addEventListener(\"input\", (event) => {\n        if (stepFields) {\n            scheduleConfigWrite(stepFields.note, event.target.value, { debounceMs: 400 });\n        }\n    });\n\n    if (stepFields) {\n        const lockButton = document.getElementById(\"config-notes-permanent\");\n        if (lockButton) {\n            lockButton.addEventListener(\"click\", () => {\n                const nextState = !lockButton.classList.contains(\"is-locked\");\n                updateLockButtonVisual(lockButton, nextState);\n                setNotePermanent(stepFields.note, nextState);\n            });\n            updateLockButtonVisual(lockButton, isFieldPermanent(stepFields.note));\n        }\n\n        const notesSaveBtn = document.getElementById(\"config-notes-save\");\n        notesSaveBtn?.addEventListener(\"click\", () => {\n            if (!notesInput) return;\n            scheduleConfigWrite(stepFields.note, notesInput.value);\n            updateSaveButtonState(notesSaveBtn, true);\n        });\n    }\n\n    const reviewerInput = document.getElementById(\"config-reviewer-name\");\n    reviewerInput?.addEventListener(\"change\", (event) => {\n        const value = event.target.value.trim();\n        if (stepFields) {\n            scheduleConfigWrite(stepFields.reviewer, value);\n        }\n        scheduleConfigWrite(CONFIG_REVIEWER_FIELD, value);\n        const signoffInput = document.getElementById(\"config-signoff-date\");\n        if (value && signoffInput && !signoffInput.value) {\n            const today = todayIso();\n            signoffInput.value = today;\n            if (stepFields) {\n                scheduleConfigWrite(stepFields.signOff, today);\n            }\n        }\n    });\n\n    document.getElementById(\"config-signoff-date\")?.addEventListener(\"change\", (event) => {\n        if (stepFields) {\n            scheduleConfigWrite(stepFields.signOff, event.target.value || \"\");\n        }\n    });\n\n    const signoffSaveBtn = document.getElementById(\"config-signoff-save\");\n    signoffSaveBtn?.addEventListener(\"click\", () => {\n        const reviewerValue = reviewerInput?.value?.trim() || \"\";\n        const signoffInput = document.getElementById(\"config-signoff-date\");\n        const signoffValue = signoffInput?.value || \"\";\n        if (stepFields) {\n            scheduleConfigWrite(stepFields.reviewer, reviewerValue);\n            scheduleConfigWrite(stepFields.signOff, signoffValue);\n        }\n        scheduleConfigWrite(CONFIG_REVIEWER_FIELD, reviewerValue);\n        updateSaveButtonState(signoffSaveBtn, true);\n    });\n\n    initSaveTracking();\n\n    if (stepFields) {\n        // Calculate isStepComplete for Step 0\n        const signOffValue = getConfigValue(stepFields.signOff);\n        const completeValue = getConfigValue(STEP_COMPLETE_FIELDS[0]);\n        const isStepComplete = Boolean(signOffValue || completeValue === \"Y\" || completeValue === true);\n        console.log(`[Step 0] Binding signoff toggle. signOff=\"${signOffValue}\", complete=\"${completeValue}\", isComplete=${isStepComplete}`);\n        \n        bindSignoffToggle({\n            buttonId: \"config-signoff-toggle\",\n            inputId: \"config-signoff-date\",\n            fieldName: stepFields.signOff,\n            completeField: STEP_COMPLETE_FIELDS[0],\n            initialActive: isStepComplete,\n            stepId: 0 // Step 0 has no prerequisites\n        });\n    }\n}\n\nfunction bindStepInteractions(stepId) {\n    document.getElementById(\"step-back-btn\")?.addEventListener(\"click\", () => {\n        returnHome();\n    });\n    document.getElementById(\"step-action-btn\")?.addEventListener(\"click\", () => {\n        const detail = STEP_DETAILS.find((step) => step.id === stepId);\n        window.alert(detail?.ctaLabel ? `${detail.ctaLabel} coming soon.` : \"Step actions coming soon.\");\n    });\n\n    if (stepId === 1) {\n        document.getElementById(\"import-open-data-btn\")?.addEventListener(\"click\", () => openDataSheet());\n        document.getElementById(\"import-clear-btn\")?.addEventListener(\"click\", () => clearPrDataSheet());\n    }\n    if (stepId === 2) {\n        document.getElementById(\"headcount-skip-btn\")?.addEventListener(\"click\", () => {\n            headcountState.skipAnalysis = !headcountState.skipAnalysis;\n            const skipBtn = document.getElementById(\"headcount-skip-btn\");\n            skipBtn?.classList.toggle(\"is-active\", headcountState.skipAnalysis);\n            if (headcountState.skipAnalysis) {\n                enforceHeadcountSkipNote();\n            }\n            updateHeadcountSignoffState();\n        });\n        document.getElementById(\"roster-run-btn\")?.addEventListener(\"click\", () => refreshHeadcountAnalysis());\n        document.getElementById(\"roster-refresh-btn\")?.addEventListener(\"click\", () => refreshHeadcountAnalysis());\n        document.getElementById(\"roster-review-btn\")?.addEventListener(\"click\", () => {\n            const items = headcountState.roster?.mismatches || [];\n            showHeadcountModal(\"Roster Differences\", items, {\n                sourceLabel: \"Roster\",\n                targetLabel: \"Payroll Data\"\n            });\n        });\n        document.getElementById(\"dept-review-btn\")?.addEventListener(\"click\", () => {\n            const items = headcountState.departments?.mismatches || [];\n            showHeadcountModal(\"Department Differences\", items, {\n                sourceLabel: \"Roster\",\n                targetLabel: \"Payroll\",\n                formatter: (item) => ({\n                    name: item.employee,\n                    source: `${item.rosterDept} \u2192 ${item.payrollDept}`,\n                    isMissingFromTarget: true\n                })\n            });\n        });\n    }\n    if (stepId === 3) {\n        document.getElementById(\"validation-run-btn\")?.addEventListener(\"click\", () => prepareValidationData());\n        document.getElementById(\"validation-refresh-btn\")?.addEventListener(\"click\", () => prepareValidationData());\n        // Format on blur (leaving field) or Enter key - comparison triggers automatically\n        document.getElementById(\"bank-amount-input\")?.addEventListener(\"blur\", handleBankAmountInput);\n        document.getElementById(\"bank-amount-input\")?.addEventListener(\"keydown\", (e) => {\n            if (e.key === \"Enter\") handleBankAmountInput(e);\n        });\n    }\n    if (stepId === 5) {\n        document.getElementById(\"je-run-btn\")?.addEventListener(\"click\", () => runJournalSummary());\n        document.getElementById(\"je-save-btn\")?.addEventListener(\"click\", () => saveJournalSummary());\n        document.getElementById(\"je-create-btn\")?.addEventListener(\"click\", () => createJournalDraft());\n        document.getElementById(\"je-export-btn\")?.addEventListener(\"click\", () => exportJournalDraft());\n    }\n    if (stepId === 4) {\n        const container = document.querySelector(\".pf-step-guide\");\n        if (container) {\n            // CoPilot API endpoint - Update this with your Supabase project URL\n            const COPILOT_API_ENDPOINT = \"https://your-project.supabase.co/functions/v1/copilot\";\n            \n            // Bind CoPilot with full context provider for intelligent analysis\n            bindCopilotCard(container, { \n                id: \"expense-review-copilot\",\n                // Uncomment to enable real AI (requires Supabase Edge Function deployment)\n                // apiEndpoint: COPILOT_API_ENDPOINT,\n                contextProvider: createPayrollContextProvider(),\n                systemPrompt: `You are Prairie Forge CoPilot, an expert financial analyst assistant for payroll expense review.\n\nCONTEXT: You're embedded in the Payroll Recorder Excel add-in, helping accountants and CFOs review payroll data before journal entry export.\n\nYOUR CAPABILITIES:\n1. Analyze payroll expense data for accuracy and completeness\n2. Identify trends, anomalies, and variances requiring attention\n3. Prepare executive-ready insights and talking points\n4. Validate journal entries before export to accounting system\n\nCOMMUNICATION STYLE:\n- Be concise and actionable\n- Use bullet points and tables for clarity\n- Highlight issues with \u26A0\uFE0F and successes with \u2713\n- Format currency as $X,XXX (no decimals for totals)\n- Format percentages as X.X%\n- Always end with 2-3 concrete next steps\n\nANALYSIS FOCUS:\n- Period-over-period changes exceeding 10%\n- Department cost anomalies vs historical norms\n- Headcount vs payroll expense alignment\n- Burden rate outliers (normal range: 15-35%)\n- Missing or incomplete GL account mappings\n- Data quality issues (blanks, duplicates, mismatches)\n\nWhen asked about variances, explain the business drivers, not just the numbers.\nWhen asked about readiness, be specific about what passes and what needs attention.`\n            });\n        }\n        document.getElementById(\"expense-run-btn\")?.addEventListener(\"click\", () => {\n            prepareExpenseReviewData();\n        });\n        document.getElementById(\"expense-refresh-btn\")?.addEventListener(\"click\", () => {\n            prepareExpenseReviewData();\n        });\n    }\n\n    const fields = getStepNoteFields(stepId);\n    console.log(`[Step ${stepId}] Binding interactions, fields:`, fields);\n    if (fields) {\n        // Handle Step 1's different ID pattern\n        const notesInputId = stepId === 1 ? \"step-notes-1\" : \"step-notes-input\";\n        const notesInput = document.getElementById(notesInputId);\n        console.log(`[Step ${stepId}] Notes input found:`, !!notesInput, `(id: ${notesInputId})`);\n        const notesSaveBtn =\n            stepId === 1\n                ? document.getElementById(\"step-notes-save-1\")\n                : stepId === 2\n                    ? document.getElementById(\"step-notes-save-2\")\n                    : stepId === 3\n                        ? document.getElementById(\"step-notes-save-3\")\n                    : stepId === 4\n                        ? document.getElementById(\"step-notes-save-4\")\n                    : stepId === 5\n                        ? document.getElementById(\"step-notes-save-5\")\n                        : document.getElementById(\"step-notes-save\");\n        notesInput?.addEventListener(\"input\", (event) => {\n            scheduleConfigWrite(fields.note, event.target.value, { debounceMs: 400 });\n            if (stepId === 2) {\n                if (headcountState.skipAnalysis) {\n                    enforceHeadcountSkipNote();\n                }\n                updateHeadcountSignoffState();\n            }\n        });\n        notesSaveBtn?.addEventListener(\"click\", () => {\n            if (!notesInput) return;\n            scheduleConfigWrite(fields.note, notesInput.value);\n            updateSaveButtonState(notesSaveBtn, true);\n        });\n        // Handle Step 1's different ID pattern for reviewer\n        const reviewerInputId = stepId === 1 ? \"step-reviewer-1\" : \"step-reviewer-name\";\n        const reviewerInput = document.getElementById(reviewerInputId);\n        reviewerInput?.addEventListener(\"change\", (event) => {\n            const value = event.target.value.trim();\n            scheduleConfigWrite(fields.reviewer, value);\n            const signoffInput =\n                stepId === 1\n                    ? document.getElementById(\"step-signoff-1\")\n                    : stepId === 2\n                        ? document.getElementById(\"step-signoff-date\")\n                        : stepId === 3\n                            ? document.getElementById(\"step-signoff-3\")\n                            : stepId === 4\n                                ? document.getElementById(\"step-signoff-4\")\n                                : stepId === 5\n                                    ? document.getElementById(\"step-signoff-5\")\n                                    : document.getElementById(`step-signoff-${stepId}`);\n            if (value && signoffInput && !signoffInput.value) {\n                const today = todayIso();\n                signoffInput.value = today;\n                scheduleConfigWrite(fields.signOff, today);\n            }\n        });\n        const signoffInputId =\n            stepId === 1\n                ? \"step-signoff-1\"\n                : stepId === 2\n                    ? \"step-signoff-date\"\n                    : stepId === 3\n                        ? \"step-signoff-3\"\n                        : stepId === 4\n                            ? \"step-signoff-4\"\n                            : stepId === 5\n                                ? \"step-signoff-5\"\n                                : `step-signoff-${stepId}`;\n        console.log(`[Step ${stepId}] Signoff input ID: ${signoffInputId}, found:`, !!document.getElementById(signoffInputId));\n        document.getElementById(signoffInputId)?.addEventListener(\"change\", (event) => {\n            scheduleConfigWrite(fields.signOff, event.target.value || \"\");\n        });\n        // Handle Step 1's different lock button ID\n        const lockButtonId = stepId === 1 ? \"step-notes-lock-1\" : \"step-notes-permanent\";\n        const lockButton = document.getElementById(lockButtonId);\n        if (lockButton) {\n            lockButton.addEventListener(\"click\", () => {\n                const nextState = !lockButton.classList.contains(\"is-locked\");\n                updateLockButtonVisual(lockButton, nextState);\n                setNotePermanent(fields.note, nextState);\n                if (stepId === 2) updateHeadcountSignoffState();\n            });\n            updateLockButtonVisual(lockButton, isFieldPermanent(fields.note));\n        }\n        const signoffSaveBtn =\n            stepId === 1\n                ? document.getElementById(\"step-signoff-save-1\")\n                : stepId === 2\n                    ? document.getElementById(\"headcount-signoff-save\")\n                    : stepId === 3\n                        ? document.getElementById(\"step-signoff-save-3\")\n                        : stepId === 4\n                            ? document.getElementById(\"step-signoff-save-4\")\n                            : stepId === 5\n                                ? document.getElementById(\"step-signoff-save-5\")\n                                : document.getElementById(`step-signoff-save-${stepId}`);\n        signoffSaveBtn?.addEventListener(\"click\", () => {\n            const reviewerValue = reviewerInput?.value?.trim() || \"\";\n            const signoffValue = document.getElementById(signoffInputId)?.value || \"\";\n            scheduleConfigWrite(fields.reviewer, reviewerValue);\n            scheduleConfigWrite(fields.signOff, signoffValue);\n            updateSaveButtonState(signoffSaveBtn, true);\n        });\n        initSaveTracking();\n        const completeField = STEP_COMPLETE_FIELDS[stepId];\n        const initialCompleteFlag = completeField ? Boolean(getConfigValue(completeField)) : false;\n        const initialSignOff = getConfigValue(fields.signOff);\n        const toggleButtonId = stepId === 1\n                    ? \"step-signoff-toggle-1\"\n                    : stepId === 2\n                        ? \"headcount-signoff-toggle\"\n                        : stepId === 3\n                            ? \"validation-signoff-toggle\"\n                            : stepId === 4\n                                ? \"expense-signoff-toggle\"\n                                : stepId === 5\n                                    ? \"step-signoff-toggle-5\"\n                                    : `step-signoff-toggle-${stepId}`;\n        console.log(`[Step ${stepId}] Toggle button ID: ${toggleButtonId}, found:`, !!document.getElementById(toggleButtonId));\n        bindSignoffToggle({\n            buttonId: toggleButtonId,\n            inputId: signoffInputId,\n            fieldName: fields.signOff,\n            completeField,\n            requireNotesCheck: stepId === 2 ? isHeadcountNotesRequired : null,\n            initialActive: Boolean(initialSignOff || initialCompleteFlag),\n            stepId, // Pass stepId for sequential validation\n            onComplete:\n                stepId === 3\n                    ? handleValidationComplete\n                    : stepId === 4\n                        ? handleExpenseReviewComplete\n                        : stepId === 2\n                            ? handleHeadcountSignoff\n                            : null\n        });\n    }\n\n    if (stepId === 2) {\n        updateHeadcountSignoffState();\n    }\n    if (stepId === 6) {\n        document.getElementById(\"archive-run-btn\")?.addEventListener(\"click\", handleArchiveRun);\n    }\n}\n\nfunction focusStep(index) {\n    if (Number.isNaN(index) || index < 0 || index >= WORKFLOW_STEPS.length) return;\n    const step = WORKFLOW_STEPS[index];\n    if (!step) return;\n    pendingScrollIndex = index;\n    const view = step.id === 0 ? \"config\" : \"step\";\n    setState({ focusedIndex: index, activeView: view, activeStepId: step.id });\n    const sheetName = STEP_SHEET_MAP[step.id];\n    if (sheetName) {\n        activateWorksheet(sheetName);\n    }\n    if (step.id === 2 && !headcountState.hasAnalyzed) {\n        refreshHeadcountAnalysis();\n    }\n    // Step 3 (Validate & Reconcile) - User must click Run/Refresh to trigger\n    // Step 4 (Expense Review) - User must click Run/Refresh to trigger\n}\n\nfunction moveFocus(delta) {\n    // When on home view, forward should go to step 0 (Config) first\n    if (appState.activeView === \"home\" && delta > 0) {\n        focusStep(0);\n        return;\n    }\n    const next = appState.focusedIndex + delta;\n    const clamped = Math.max(0, Math.min(WORKFLOW_STEPS.length - 1, next));\n    focusStep(clamped);\n}\n\nfunction scrollFocusedIntoView() {\n    if (appState.activeView !== \"home\") return;\n    if (pendingScrollIndex === null) return;\n    const card = document.querySelector(`[data-step-card][data-step-index=\"${pendingScrollIndex}\"]`);\n    pendingScrollIndex = null;\n    card?.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n}\n\nfunction openConfigView() {\n    focusStep(0);\n}\n\nasync function returnHome() {\n    // Activate the module homepage sheet\n    const homepageConfig = getHomepageConfig(MODULE_KEY);\n    await activateHomepageSheet(homepageConfig.sheetName, homepageConfig.title, homepageConfig.subtitle);\n    \n    setState({ activeView: \"home\", activeStepId: null });\n}\n\nfunction setState(partial) {\n    Object.assign(appState, partial);\n    renderApp();\n}\n\nfunction getReviewerDefault() {\n    // Fallback to legacy field if the new one is missing\n    return getConfigValue(CONFIG_REVIEWER_FIELD) || getConfigValue(\"SS_Default_Reviewer\") || \"\";\n}\n\nfunction updateActionToggleState(button, isActive) {\n    if (!button) return;\n    button.classList.toggle(\"is-active\", isActive);\n    button.setAttribute(\"aria-pressed\", String(isActive));\n}\n\nfunction markJeSaveState(isSaved) {\n    const btn = document.getElementById(\"je-save-btn\");\n    if (!btn) return;\n    btn.classList.toggle(\"is-saved\", isSaved);\n}\n\n/**\n * Get current step completion status for sequential validation\n * @returns {Object} Map of step IDs to boolean completion status\n */\nfunction getStepCompletionStatus() {\n    const status = {};\n    console.log(\"[Signoff] Checking step completion status...\");\n    Object.keys(STEP_NOTES_FIELDS).forEach(stepIdStr => {\n        const stepId = parseInt(stepIdStr, 10);\n        const fields = STEP_NOTES_FIELDS[stepId];\n        if (!fields) {\n            status[stepId] = false;\n            return;\n        }\n        // A step is complete if it has a sign-off date OR is explicitly marked complete\n        const signOffValue = getConfigValue(fields.signOff);\n        const completeField = STEP_COMPLETE_FIELDS[stepId];\n        const completeValue = getConfigValue(completeField);\n        const isComplete = Boolean(signOffValue) || completeValue === \"Y\" || completeValue === true;\n        status[stepId] = isComplete;\n        console.log(`[Signoff] Step ${stepId}: signOff=\"${signOffValue}\", complete=\"${completeValue}\" \u2192 ${isComplete ? \"COMPLETE\" : \"pending\"}`);\n    });\n    console.log(\"[Signoff] Status summary:\", status);\n    return status;\n}\n\nfunction bindSignoffToggle({\n    buttonId,\n    inputId,\n    fieldName,\n    completeField,\n    requireNotesCheck,\n    onComplete,\n    initialActive = false,\n    stepId = null // NEW: Step ID for sequential validation\n}) {\n    const button = document.getElementById(buttonId);\n    if (!button) {\n        console.warn(`[Signoff] Button not found: ${buttonId}`);\n        return;\n    }\n    const input = inputId ? document.getElementById(inputId) : null;\n    const initial = initialActive || Boolean(input?.value);\n    updateActionToggleState(button, initial);\n    console.log(`[Signoff] Bound ${buttonId}, initial active: ${initial}, stepId: ${stepId}`);\n    \n    // Handle Done button click\n    button.addEventListener(\"click\", () => {\n        console.log(`[Signoff] Done button clicked: ${buttonId}, stepId: ${stepId}`);\n        \n        // Check sequential completion if stepId is provided\n        if (stepId !== null && stepId > 0) {\n            const completionStatus = getStepCompletionStatus();\n            const { canComplete, message } = canCompleteStep(stepId, completionStatus);\n            \n            // Only block if trying to COMPLETE (not uncomplete)\n            const isCurrentlyActive = button.classList.contains(\"is-active\");\n            console.log(`[Signoff] canComplete: ${canComplete}, isCurrentlyActive: ${isCurrentlyActive}`);\n            if (!isCurrentlyActive && !canComplete) {\n                console.log(`[Signoff] BLOCKED: ${message}`);\n                showBlockedToast(message);\n                return;\n            }\n        }\n        \n        if (requireNotesCheck && !requireNotesCheck()) {\n            window.alert(\"Please add notes before completing this step.\");\n            return;\n        }\n        const nextActive = !button.classList.contains(\"is-active\");\n        console.log(`[Signoff] ${buttonId} clicked, toggling to: ${nextActive}`);\n        updateActionToggleState(button, nextActive);\n        if (input) {\n            input.value = nextActive ? todayIso() : \"\";\n        }\n        if (fieldName) {\n            const dateValue = nextActive ? todayIso() : \"\";\n            console.log(`[Signoff] Writing ${fieldName} = \"${dateValue}\"`);\n            scheduleConfigWrite(fieldName, dateValue);\n        }\n        if (completeField) {\n            const completeValue = nextActive ? \"Y\" : \"\";\n            console.log(`[Signoff] Writing ${completeField} = \"${completeValue}\"`);\n            scheduleConfigWrite(completeField, completeValue);\n        }\n        if (nextActive && typeof onComplete === \"function\") {\n            onComplete();\n        }\n    });\n    \n    // Handle manual date input change - sync the button state\n    if (input) {\n        input.addEventListener(\"change\", () => {\n            const hasDate = Boolean(input.value);\n            const isCurrentlyActive = button.classList.contains(\"is-active\");\n            if (hasDate !== isCurrentlyActive) {\n                console.log(`[Signoff] Date input changed, syncing button to: ${hasDate}`);\n                updateActionToggleState(button, hasDate);\n                if (fieldName) {\n                    scheduleConfigWrite(fieldName, input.value || \"\");\n                }\n                if (completeField) {\n                    scheduleConfigWrite(completeField, hasDate ? \"Y\" : \"\");\n                }\n            }\n        });\n    }\n}\n\nasync function openConfigurationSheet() {\n    if (!hasExcelRuntime()) {\n        window.alert(\"Open this module inside Excel to edit configuration settings.\");\n        return;\n    }\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(MODULE_CONFIG_SHEET);\n            sheet.activate();\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n        setState({ statusText: `${MODULE_CONFIG_SHEET} opened.` });\n    } catch (error) {\n        console.error(\"Unable to open configuration sheet\", error);\n        window.alert(`Unable to open ${MODULE_CONFIG_SHEET}. Confirm the sheet exists in this workbook.`);\n    }\n}\n\nasync function openDataSheet() {\n    if (!hasExcelRuntime()) {\n        window.alert(\"Open this module inside Excel to access the data sheet.\");\n        return;\n    }\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(SHEET_NAMES.DATA);\n            sheet.activate();\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n    } catch (error) {\n        console.error(\"Unable to open PR_Data sheet\", error);\n        window.alert(`Unable to open ${SHEET_NAMES.DATA}. Confirm the sheet exists in this workbook.`);\n    }\n}\n\nasync function clearPrDataSheet() {\n    if (!hasExcelRuntime()) {\n        window.alert(\"Open this module inside Excel to clear data.\");\n        return;\n    }\n    const confirmed = window.confirm(\"Are you sure you want to clear all data from PR_Data? This cannot be undone.\");\n    if (!confirmed) return;\n    \n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(SHEET_NAMES.DATA);\n            const usedRange = sheet.getUsedRangeOrNullObject();\n            usedRange.load(\"isNullObject\");\n            await context.sync();\n            \n            if (!usedRange.isNullObject) {\n                // Clear all except header row (row 1)\n                const dataRange = sheet.getRange(\"A2:Z10000\");\n                dataRange.clear(Excel.ClearApplyTo.contents);\n                await context.sync();\n            }\n            \n            sheet.activate();\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n        window.alert(\"PR_Data cleared successfully.\");\n    } catch (error) {\n        console.error(\"Unable to clear PR_Data sheet\", error);\n        window.alert(\"Unable to clear PR_Data. Please try again.\");\n    }\n}\n\nasync function getConfigTable(context) {\n    if (!CONFIG_TABLE_CANDIDATES.length) return null;\n    if (resolvedConfigTableName) {\n        const existing = context.workbook.tables.getItemOrNullObject(resolvedConfigTableName);\n        existing.load(\"name\");\n        await context.sync();\n        if (!existing.isNullObject) {\n            return existing;\n        }\n        resolvedConfigTableName = null;\n    }\n    const tables = context.workbook.tables;\n    tables.load(\"items/name\");\n    await context.sync();\n\n    const foundTableNames = tables.items?.map((t) => t.name) || [];\n    \n    // Debug logging - visible in browser console (F12)\n    console.log(\"[Payroll] Looking for config table:\", CONFIG_TABLE_CANDIDATES);\n    console.log(\"[Payroll] Found tables in workbook:\", foundTableNames);\n\n    const match = tables.items?.find((table) => CONFIG_TABLE_CANDIDATES.includes(table.name));\n    if (!match) {\n        console.warn(\"[Payroll] \u26A0\uFE0F CONFIG TABLE NOT FOUND!\");\n        console.warn(\"[Payroll] Expected table named: SS_PF_Config\");\n        console.warn(\"[Payroll] Available tables:\", foundTableNames);\n        console.warn(\"[Payroll] To fix: Select your data in SS_PF_Config sheet \u2192 Insert \u2192 Table \u2192 Name it 'SS_PF_Config'\");\n        return null;\n    }\n    console.log(\"[Payroll] \u2713 Config table found:\", match.name);\n    resolvedConfigTableName = match.name;\n    return context.workbook.tables.getItem(match.name);\n}\n\nasync function loadConfigurationValues() {\n    if (!hasExcelRuntime()) {\n        configState.loaded = true;\n        return;\n    }\n    try {\n        await Excel.run(async (context) => {\n            const table = await getConfigTable(context);\n            if (!table) {\n                console.warn(\"Payroll Recorder: SS_PF_Config table is missing.\");\n                configState.loaded = true;\n                return;\n            }\n            const body = table.getDataBodyRange();\n            body.load(\"values\");\n            await context.sync();\n            const rows = body.values || [];\n            const map = {};\n            const permanents = {};\n            rows.forEach((row) => {\n                const field = normalizeFieldName(row[CONFIG_COLUMNS.FIELD]);\n                if (!field) return;\n                map[field] = row[CONFIG_COLUMNS.VALUE] ?? \"\";\n                permanents[field] = row[CONFIG_COLUMNS.PERMANENT] ?? \"\";\n            });\n            configState.values = map;\n            configState.permanents = permanents;\n            // Check both new and legacy field names for overrides\n            configState.overrides.accountingPeriod = Boolean(map.PR_Accounting_Period || map.Accounting_Period);\n            configState.overrides.jeId = Boolean(map.PR_Journal_Entry_ID || map.Journal_Entry_ID);\n            configState.loaded = true;\n        });\n    } catch (error) {\n        console.warn(\"Payroll Recorder: unable to load PF_Config table.\", error);\n        configState.loaded = true;\n    }\n}\n\nfunction getConfigValue(field) {\n    return configState.values[field] ?? \"\";\n}\n\nfunction resolvePayrollDateFieldName() {\n    const keys = Object.keys(configState.values || {});\n    const match = PAYROLL_DATE_ALIASES.find((alias) => keys.includes(alias));\n    return match || PAYROLL_DATE_ALIASES[0];\n}\n\nfunction getPayrollDateValue() {\n    return getConfigValue(resolvePayrollDateFieldName());\n}\n\nfunction getPayrollProviderLink() {\n    // Check module-specific field first, then shared field as fallback\n    return (getConfigValue(PAYROLL_PROVIDER_FIELD) || getConfigValue(\"Payroll_Provider_Link\") || \"\").trim();\n}\n\nfunction isFieldPermanent(field) {\n    return parseBooleanFlag(configState.permanents[field]);\n}\n\nfunction isStepCompleteFromConfig(stepId) {\n    const field = STEP_COMPLETE_FIELDS[stepId];\n    if (!field) return false;\n    return parseBooleanFlag(getConfigValue(field));\n}\n\nfunction setNotePermanent(field, isPermanent) {\n    const normalizedField = normalizeFieldName(field);\n    if (!normalizedField) return;\n    configState.permanents[normalizedField] = isPermanent ? \"Y\" : \"N\";\n    void writeConfigPermanent(normalizedField, isPermanent ? \"Y\" : \"N\");\n}\n\nfunction parseBooleanFlag(value) {\n    const normalized = String(value ?? \"\").trim().toLowerCase();\n    return normalized === \"true\" || normalized === \"y\" || normalized === \"yes\" || normalized === \"1\";\n}\n\nfunction normalizeFieldName(value) {\n    return String(value ?? \"\").trim();\n}\n\nfunction isNoiseName(value) {\n    const normalized = String(value ?? \"\").trim().toLowerCase();\n    if (!normalized) return true;\n    return (\n        normalized.includes(\"total\") ||\n        normalized.includes(\"totals\") ||\n        normalized.includes(\"grand total\") ||\n        normalized.includes(\"subtotal\") ||\n        normalized.includes(\"summary\")\n    );\n}\n\nfunction formatDateInput(value) {\n    if (!value) return \"\";\n    const parts = parseDateInput(value);\n    if (!parts) return \"\";\n    return `${parts.year}-${String(parts.month).padStart(2, \"0\")}-${String(parts.day).padStart(2, \"0\")}`;\n}\n\nfunction deriveAccountingPeriod(payrollDate) {\n    const parts = parseDateInput(payrollDate);\n    if (!parts) return \"\";\n    // Validate year is reasonable (1900-2100)\n    if (parts.year < 1900 || parts.year > 2100) {\n        console.warn(\"deriveAccountingPeriod - Invalid year:\", parts.year, \"from input:\", payrollDate);\n        return \"\";\n    }\n    const monthNames = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n    // Format: \"Dec 2025\" - use full 4-digit year to prevent Excel date interpretation\n    return `${monthNames[parts.month - 1]} ${parts.year}`;\n}\n\nfunction deriveJeId(payrollDate) {\n    const parts = parseDateInput(payrollDate);\n    if (!parts) return \"\";\n    // Validate year is reasonable (1900-2100)\n    if (parts.year < 1900 || parts.year > 2100) {\n        console.warn(\"deriveJeId - Invalid year:\", parts.year, \"from input:\", payrollDate);\n        return \"\";\n    }\n    return `PR-AUTO-${parts.year}-${String(parts.month).padStart(2, \"0\")}-${String(parts.day).padStart(2, \"0\")}`;\n}\n\nfunction todayIso() {\n    return formatDateFromDate(new Date());\n}\n\nfunction scheduleConfigWrite(fieldName, value, options = {}) {\n    const normalizedField = normalizeFieldName(fieldName);\n    configState.values[normalizedField] = value ?? \"\";\n    const delay = options.debounceMs ?? 0;\n    if (!delay) {\n        const existing = pendingWrites.get(normalizedField);\n        if (existing) clearTimeout(existing);\n        pendingWrites.delete(normalizedField);\n        void writeConfigValue(normalizedField, value ?? \"\");\n        return;\n    }\n    if (pendingWrites.has(normalizedField)) {\n        clearTimeout(pendingWrites.get(normalizedField));\n    }\n    const timer = setTimeout(() => {\n        pendingWrites.delete(normalizedField);\n        void writeConfigValue(normalizedField, value ?? \"\");\n    }, delay);\n    pendingWrites.set(normalizedField, timer);\n}\n\n// Fields that should be forced to Text format to prevent Excel auto-conversion\nconst TEXT_FORMAT_FIELDS = [\n    \"PR_Accounting_Period\",\n    \"PTO_Accounting_Period\",\n    \"Accounting_Period\"\n];\n\nasync function writeConfigValue(fieldName, value) {\n    const normalizedField = normalizeFieldName(fieldName);\n    configState.values[normalizedField] = value ?? \"\";\n    console.log(`[Payroll] Writing config: ${normalizedField} = \"${value}\"`);\n    if (!hasExcelRuntime()) {\n        console.warn(\"[Payroll] Excel runtime not available - cannot write\");\n        return;\n    }\n    \n    // Check if this field needs text formatting\n    const forceTextFormat = TEXT_FORMAT_FIELDS.some(f => \n        normalizedField === f || normalizedField.toLowerCase() === f.toLowerCase()\n    );\n    \n    try {\n        await Excel.run(async (context) => {\n            const table = await getConfigTable(context);\n            if (!table) {\n                console.error(\"[Payroll] \u274C Cannot write - config table not found\");\n                return;\n            }\n            const body = table.getDataBodyRange();\n            const headerRange = table.getHeaderRowRange();\n            body.load(\"values\");\n            headerRange.load(\"values\");\n            await context.sync();\n\n            const headers = headerRange.values[0] || [];\n            const rows = body.values || [];\n            const columnCount = headers.length;\n            console.log(`[Payroll] Table has ${rows.length} rows, ${columnCount} columns`);\n\n            // Find ALL matching rows (to handle duplicates)\n            const matchingIndices = [];\n            rows.forEach((row, idx) => {\n                if (normalizeFieldName(row[CONFIG_COLUMNS.FIELD]) === normalizedField) {\n                    matchingIndices.push(idx);\n                }\n            });\n\n            if (matchingIndices.length === 0) {\n                // No existing row - add new one\n                configState.permanents[normalizedField] = configState.permanents[normalizedField] ?? DEFAULT_CONFIG_PERMANENT;\n                const newRow = new Array(columnCount).fill(\"\");\n                if (CONFIG_COLUMNS.TYPE >= 0 && CONFIG_COLUMNS.TYPE < columnCount) newRow[CONFIG_COLUMNS.TYPE] = DEFAULT_CONFIG_TYPE;\n                if (CONFIG_COLUMNS.FIELD >= 0 && CONFIG_COLUMNS.FIELD < columnCount) newRow[CONFIG_COLUMNS.FIELD] = normalizedField;\n                if (CONFIG_COLUMNS.VALUE >= 0 && CONFIG_COLUMNS.VALUE < columnCount) newRow[CONFIG_COLUMNS.VALUE] = value ?? \"\";\n                if (CONFIG_COLUMNS.PERMANENT >= 0 && CONFIG_COLUMNS.PERMANENT < columnCount) newRow[CONFIG_COLUMNS.PERMANENT] = DEFAULT_CONFIG_PERMANENT;\n                console.log(`[Payroll] Adding NEW row:`, newRow);\n                table.rows.add(null, [newRow]);\n                await context.sync();\n                \n                // Force text format for specific fields to prevent Excel date conversion\n                if (forceTextFormat) {\n                    // Get the newly added row (last row in table)\n                    const tableRows = table.rows;\n                    tableRows.load(\"count\");\n                    await context.sync();\n                    const lastRowIdx = tableRows.count - 1;\n                    const newRowRange = table.rows.getItemAt(lastRowIdx).getRange();\n                    const valueCell = newRowRange.getCell(0, CONFIG_COLUMNS.VALUE);\n                    valueCell.numberFormat = [[\"@\"]]; // Text format\n                    valueCell.values = [[value ?? \"\"]]; // Re-write to apply format\n                    await context.sync();\n                    console.log(`[Payroll] \u2713 Applied text format to ${normalizedField}`);\n                }\n                \n                console.log(`[Payroll] \u2713 New row added for ${normalizedField}`);\n            } else {\n                // Update the first matching row\n                const targetIndex = matchingIndices[0];\n                console.log(`[Payroll] Updating existing row ${targetIndex} for ${normalizedField}`);\n                const targetCell = body.getCell(targetIndex, CONFIG_COLUMNS.VALUE);\n                \n                // Force text format for specific fields\n                if (forceTextFormat) {\n                    targetCell.numberFormat = [[\"@\"]]; // Text format\n                }\n                targetCell.values = [[value ?? \"\"]];\n                await context.sync();\n                console.log(`[Payroll] \u2713 Updated ${normalizedField}`);\n\n                // Delete duplicate rows (in reverse order to maintain indices)\n                if (matchingIndices.length > 1) {\n                    console.log(`[Payroll] Found ${matchingIndices.length - 1} duplicate rows for ${normalizedField}, removing...`);\n                    const duplicateIndices = matchingIndices.slice(1).reverse();\n                    for (const dupIdx of duplicateIndices) {\n                        try {\n                            table.rows.getItemAt(dupIdx).delete();\n                        } catch (e) {\n                            console.warn(`[Payroll] Could not delete duplicate row ${dupIdx}:`, e.message);\n                        }\n                    }\n                    await context.sync();\n                    console.log(`[Payroll] \u2713 Removed duplicate rows for ${normalizedField}`);\n                }\n            }\n        });\n    } catch (error) {\n        console.error(`[Payroll] \u274C Write failed for ${fieldName}:`, error);\n    }\n}\n\nasync function writeConfigPermanent(fieldName, marker) {\n    const normalizedField = normalizeFieldName(fieldName);\n    if (!normalizedField) return;\n    if (!hasExcelRuntime()) return;\n    // Store in local state\n    configState.permanents[normalizedField] = marker;\n    try {\n        await Excel.run(async (context) => {\n            const table = await getConfigTable(context);\n            if (!table) {\n                console.warn(`Payroll Recorder: unable to locate config table when toggling ${fieldName} permanent flag.`);\n                return;\n            }\n            const body = table.getDataBodyRange();\n            body.load(\"values\");\n            await context.sync();\n            const rows = body.values || [];\n            const targetIndex = rows.findIndex(\n                (row) => normalizeFieldName(row[CONFIG_COLUMNS.FIELD]) === normalizedField\n            );\n            if (targetIndex === -1) return;\n            body.getCell(targetIndex, CONFIG_COLUMNS.PERMANENT).values = [[marker]];\n            await context.sync();\n        });\n    } catch (error) {\n        console.warn(`Payroll Recorder: unable to update permanent flag for ${fieldName}`, error);\n    }\n}\n\nfunction parseDateInput(value) {\n    if (!value) return null;\n    \n    // Handle string value\n    const strValue = String(value).trim();\n    \n    // Try YYYY-MM-DD format first\n    const isoMatch = /^(\\d{4})-(\\d{2})-(\\d{2})/.exec(strValue);\n    if (isoMatch) {\n        const year = Number(isoMatch[1]);\n        const month = Number(isoMatch[2]);\n        const day = Number(isoMatch[3]);\n        if (year && month && day) return { year, month, day };\n    }\n    \n    // Try MM/DD/YYYY format\n    const usMatch = /^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/.exec(strValue);\n    if (usMatch) {\n        const month = Number(usMatch[1]);\n        const day = Number(usMatch[2]);\n        const year = Number(usMatch[3]);\n        if (year && month && day) return { year, month, day };\n    }\n    \n    // Handle Excel serial date number\n    // Use UTC to avoid timezone offset issues - Excel dates should be treated as UTC\n    const numValue = Number(value);\n    if (Number.isFinite(numValue) && numValue > 40000 && numValue < 60000) {\n        // Excel serial date: days since Jan 1, 1900 (with 1900 leap year bug)\n        // Convert to UTC timestamp to avoid local timezone shifting the date\n        const utcDays = Math.floor(numValue - 25569); // Days since Unix epoch (Jan 1, 1970)\n        const utcMs = utcDays * 86400 * 1000;\n        const jsDate = new Date(utcMs);\n        if (!isNaN(jsDate.getTime())) {\n            // Use UTC methods to extract date components to prevent timezone shift\n            const isoDate = `${jsDate.getUTCFullYear()}-${String(jsDate.getUTCMonth() + 1).padStart(2, \"0\")}-${String(jsDate.getUTCDate()).padStart(2, \"0\")}`;\n            console.log(\"DEBUG parseDateInput - Converted Excel serial\", numValue, \"to\", isoDate);\n            return {\n                year: jsDate.getUTCFullYear(),\n                month: jsDate.getUTCMonth() + 1,\n                day: jsDate.getUTCDate()\n            };\n        }\n    }\n    \n    // Try parsing as Date string\n    const dateObj = new Date(strValue);\n    if (!isNaN(dateObj.getTime())) {\n        return {\n            year: dateObj.getFullYear(),\n            month: dateObj.getMonth() + 1,\n            day: dateObj.getDate()\n        };\n    }\n    \n    console.warn(\"DEBUG parseDateInput - Could not parse date value:\", value);\n    return null;\n}\n\nfunction formatDateFromDate(date) {\n    // Use UTC methods if this date was derived from Excel serial number\n    // to prevent timezone shift causing off-by-one day errors\n    if (date._isUTC) {\n        const year = date.getUTCFullYear();\n        const month = String(date.getUTCMonth() + 1).padStart(2, \"0\");\n        const day = String(date.getUTCDate()).padStart(2, \"0\");\n        return `${year}-${month}-${day}`;\n    }\n    // For regular dates (like \"today\"), use local time\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, \"0\");\n    const day = String(date.getDate()).padStart(2, \"0\");\n    return `${year}-${month}-${day}`;\n}\n\n/**\n * Normalize a date value for lookup comparison\n * Handles Excel serial dates, Date objects, and various string formats\n * Returns YYYY-MM-DD string or null if unparseable\n */\nfunction normalizeDateForLookup(value) {\n    if (!value) return null;\n    \n    // If it's already a YYYY-MM-DD string, return it\n    if (typeof value === \"string\") {\n        const isoMatch = value.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);\n        if (isoMatch) {\n            return `${isoMatch[1]}-${isoMatch[2]}-${isoMatch[3]}`;\n        }\n    }\n    \n    // Try parsing with our date parser\n    const parts = parseDateInput(value);\n    if (parts) {\n        return `${parts.year}-${String(parts.month).padStart(2, \"0\")}-${String(parts.day).padStart(2, \"0\")}`;\n    }\n    \n    return null;\n}\n\n/**\n * Create a context provider for Prairie Forge CoPilot\n * Reads current payroll data to provide intelligent, contextual responses\n */\nfunction createPayrollContextProvider() {\n    return async () => {\n        if (!hasExcelRuntime()) return null;\n        \n        try {\n            return await Excel.run(async (context) => {\n                const result = {\n                    timestamp: new Date().toISOString(),\n                    period: null,\n                    summary: {},\n                    departments: [],\n                    recentPeriods: [],\n                    dataQuality: {}\n                };\n                \n                // Read config for period info\n                const configTable = await getConfigTable(context);\n                if (configTable) {\n                    const configBody = configTable.getDataBodyRange();\n                    configBody.load(\"values\");\n                    await context.sync();\n                    \n                    const configRows = configBody.values || [];\n                    for (const row of configRows) {\n                        const fieldName = String(row[CONFIG_COLUMNS.FIELD] || \"\").trim();\n                        const fieldValue = row[CONFIG_COLUMNS.VALUE];\n                        \n                        if (fieldName.toLowerCase().includes(\"accounting\") && fieldName.toLowerCase().includes(\"period\")) {\n                            result.period = String(fieldValue || \"\").trim();\n                        }\n                    }\n                }\n                \n                // Read PR_Data_Clean for summary stats\n                const cleanSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.DATA_CLEAN);\n                cleanSheet.load(\"isNullObject\");\n                await context.sync();\n                \n                if (!cleanSheet.isNullObject) {\n                    const range = cleanSheet.getUsedRangeOrNullObject();\n                    range.load(\"values\");\n                    await context.sync();\n                    \n                    if (!range.isNullObject && range.values?.length > 1) {\n                        const headers = range.values[0].map(h => normalizeHeader(h));\n                        const data = range.values.slice(1);\n                        \n                        // Find relevant columns\n                        const amountIdx = headers.findIndex(h => h.includes(\"amount\"));\n                        const deptIdx = pickDepartmentIndex(headers);\n                        const employeeIdx = headers.findIndex(h => h.includes(\"employee\"));\n                        \n                        // Calculate totals\n                        let totalAmount = 0;\n                        const employeeSet = new Set();\n                        const deptTotals = new Map();\n                        \n                        for (const row of data) {\n                            const amount = Number(row[amountIdx]) || 0;\n                            totalAmount += amount;\n                            \n                            if (employeeIdx >= 0) {\n                                const emp = String(row[employeeIdx] || \"\").trim();\n                                if (emp) employeeSet.add(emp);\n                            }\n                            \n                            if (deptIdx >= 0) {\n                                const dept = String(row[deptIdx] || \"\").trim();\n                                if (dept) {\n                                    deptTotals.set(dept, (deptTotals.get(dept) || 0) + amount);\n                                }\n                            }\n                        }\n                        \n                        result.summary = {\n                            total: totalAmount,\n                            employeeCount: employeeSet.size,\n                            avgPerEmployee: employeeSet.size ? totalAmount / employeeSet.size : 0,\n                            rowCount: data.length\n                        };\n                        \n                        // Department breakdown\n                        result.departments = Array.from(deptTotals.entries())\n                            .map(([name, total]) => ({\n                                name,\n                                total,\n                                percentOfTotal: totalAmount ? (total / totalAmount) : 0\n                            }))\n                            .sort((a, b) => b.total - a.total);\n                        \n                        result.dataQuality.dataCleanReady = true;\n                        result.dataQuality.rowCount = data.length;\n                    }\n                }\n                \n                // Read PR_Archive_Summary for trend data\n                const archiveSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.ARCHIVE_SUMMARY);\n                archiveSheet.load(\"isNullObject\");\n                await context.sync();\n                \n                if (!archiveSheet.isNullObject) {\n                    const archiveRange = archiveSheet.getUsedRangeOrNullObject();\n                    archiveRange.load(\"values\");\n                    await context.sync();\n                    \n                    if (!archiveRange.isNullObject && archiveRange.values?.length > 1) {\n                        const headers = archiveRange.values[0].map(h => normalizeHeader(h));\n                        const periodIdx = headers.findIndex(h => h.includes(\"period\"));\n                        const totalIdx = headers.findIndex(h => h.includes(\"total\"));\n                        \n                        result.recentPeriods = archiveRange.values.slice(1, 6).map(row => ({\n                            period: row[periodIdx] || \"\",\n                            total: Number(row[totalIdx]) || 0\n                        }));\n                        \n                        result.dataQuality.archiveAvailable = true;\n                        result.dataQuality.periodsAvailable = result.recentPeriods.length;\n                    }\n                }\n                \n                // Check JE Draft status\n                const jeSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.JE_DRAFT);\n                jeSheet.load(\"isNullObject\");\n                await context.sync();\n                \n                if (!jeSheet.isNullObject) {\n                    const jeRange = jeSheet.getUsedRangeOrNullObject();\n                    jeRange.load(\"values\");\n                    await context.sync();\n                    \n                    if (!jeRange.isNullObject && jeRange.values?.length > 1) {\n                        const headers = jeRange.values[0].map(h => normalizeHeader(h));\n                        const debitIdx = headers.findIndex(h => h.includes(\"debit\"));\n                        const creditIdx = headers.findIndex(h => h.includes(\"credit\"));\n                        \n                        let totalDebit = 0;\n                        let totalCredit = 0;\n                        \n                        for (const row of jeRange.values.slice(1)) {\n                            totalDebit += Number(row[debitIdx]) || 0;\n                            totalCredit += Number(row[creditIdx]) || 0;\n                        }\n                        \n                        result.journalEntry = {\n                            totalDebit,\n                            totalCredit,\n                            difference: Math.abs(totalDebit - totalCredit),\n                            isBalanced: Math.abs(totalDebit - totalCredit) < 0.01,\n                            lineCount: jeRange.values.length - 1\n                        };\n                        \n                        result.dataQuality.jeDraftReady = true;\n                    }\n                }\n                \n                console.log(\"CoPilot context gathered:\", result);\n                return result;\n            });\n        } catch (error) {\n            console.warn(\"CoPilot context provider error:\", error);\n            return null;\n        }\n    };\n}\n\nfunction escapeHtml(value) {\n    return String(value ?? \"\")\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\");\n}\n\n/**\n * Render a button with a label underneath\n */\nfunction renderLabeledButton(buttonHtml, label) {\n    return `\n        <div class=\"pf-labeled-button\">\n            ${buttonHtml}\n            <span class=\"pf-button-label\">${escapeHtml(label)}</span>\n        </div>\n    `;\n}\n\nfunction hasExcelRuntime() {\n    return typeof Excel !== \"undefined\" && typeof Excel.run === \"function\";\n}\n\nfunction getStepNoteFields(stepId) {\n    return STEP_NOTES_FIELDS[stepId] || null;\n}\n\nfunction headcountHasDifferences() {\n    const rosterDiff = Math.abs(headcountState.roster?.difference ?? 0);\n    const deptDiff = Math.abs(headcountState.departments?.difference ?? 0);\n    return rosterDiff > 0 || deptDiff > 0;\n}\n\nfunction isHeadcountNotesRequired() {\n    return !headcountState.skipAnalysis && headcountHasDifferences();\n}\n\nfunction formatMetricValue(value) {\n    if (value === null || value === undefined) return \"---\";\n    if (typeof value === \"number\" && Number.isInteger(value)) return value.toString();\n    return value;\n}\n\nfunction formatSignedValue(value) {\n    if (value === null || value === undefined) return \"---\";\n    if (typeof value !== \"number\" || Number.isNaN(value)) return \"---\";\n    if (value === 0) return \"0\";\n    return value > 0 ? `+${value}` : value.toString();\n}\n\nfunction formatCurrency(value) {\n    if (value === null || value === undefined || Number.isNaN(value)) return \"---\";\n    if (typeof value !== \"number\") return value;\n    return value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n}\n\nfunction formatNumberDisplay(value) {\n    if (value === null || value === undefined || value === \"\") return \"---\";\n    const num = Number(value);\n    const formatter = window.PrairieForge?.formatNumber;\n    if (Number.isFinite(num)) {\n        return formatter ? formatter(num) : num.toLocaleString(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n    }\n    return String(value);\n}\n\nfunction formatBankInput(value) {\n    const numeric = parseBankAmount(value);\n    if (!Number.isFinite(numeric)) return \"\";\n    // Format as XXX,XXX.XX (no dollar sign per user preference)\n    return numeric.toLocaleString(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n}\n\nfunction buildCsv(rows = []) {\n    return rows\n        .map((row) =>\n            (row || [])\n                .map((cell) => {\n                    if (cell == null) return \"\";\n                    const str = String(cell);\n                    if (/[\",\\n]/.test(str)) return `\"${str.replace(/\"/g, '\"\"')}\"`;\n                    return str;\n                })\n                .join(\",\")\n        )\n        .join(\"\\n\");\n}\n\nfunction downloadCsv(filename, content) {\n    const blob = new Blob([content], { type: \"text/csv;charset=utf-8;\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n}\n\nfunction parseBankAmount(value) {\n    if (typeof value === \"number\") return value;\n    if (value == null) return NaN;\n    const cleaned = String(value).replace(/[^0-9.-]/g, \"\");\n    const parsed = Number.parseFloat(cleaned);\n    return Number.isFinite(parsed) ? parsed : NaN;\n}\n\nfunction normalizePeriodKey(value) {\n    if (value instanceof Date) return formatDateFromDate(value);\n    if (typeof value === \"number\" && !Number.isNaN(value)) {\n        const date = convertExcelDate(value);\n        return date ? formatDateFromDate(date) : \"\";\n    }\n    const str = String(value ?? \"\").trim();\n    if (!str) return \"\";\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(str)) return str;\n    const parsed = new Date(str);\n    if (!Number.isNaN(parsed.getTime())) {\n        return formatDateFromDate(parsed);\n    }\n    return str;\n}\n\nfunction convertExcelDate(serial) {\n    if (!Number.isFinite(serial)) return null;\n    const utcDays = Math.floor(serial - 25569);\n    if (!Number.isFinite(utcDays)) return null;\n    const utcValue = utcDays * 86400 * 1000;\n    const date = new Date(utcValue);\n    // Mark this date as UTC-derived so formatDateFromDate can use UTC methods\n    date._isUTC = true;\n    return date;\n}\n\nfunction formatFriendlyPeriod(key) {\n    if (!key) return \"\";\n    const parsed = new Date(key);\n    if (!Number.isNaN(parsed.getTime())) {\n        return parsed.toLocaleDateString(undefined, { month: \"short\", day: \"numeric\", year: \"numeric\" });\n    }\n    return key;\n}\n\nfunction toNumber(value) {\n    if (value == null || value === \"\") return 0;\n    const num = Number(value);\n    return Number.isFinite(num) ? num : 0;\n}\n\nfunction classifyExpenseComponent(label) {\n    const normalized = normalizeString(label).toLowerCase();\n    if (!normalized) return \"variable\";\n    if (\n        normalized.includes(\"burden\") ||\n        normalized.includes(\"tax\") ||\n        normalized.includes(\"benefit\") ||\n        normalized.includes(\"fica\") ||\n        normalized.includes(\"insurance\") ||\n        normalized.includes(\"health\") ||\n        normalized.includes(\"medicare\")\n    ) {\n        return \"burden\";\n    }\n    if (\n        normalized.includes(\"bonus\") ||\n        normalized.includes(\"commission\") ||\n        normalized.includes(\"variable\") ||\n        normalized.includes(\"overtime\") ||\n        normalized.includes(\"per diem\")\n    ) {\n        return \"variable\";\n    }\n    return \"fixed\";\n}\n\nfunction parseExpenseRows(values) {\n    if (!values || values.length < 2) return [];\n    const headers = (values[0] || []).map((header) => normalizeHeader(header));\n    console.log(\"parseExpenseRows - headers:\", headers);\n    const indexes = {\n        payrollDate: headers.findIndex((header) => header.includes(\"payroll\") && header.includes(\"date\")),\n        employee: headers.findIndex((header) => header.includes(\"employee\")),\n        department: headers.findIndex((header) => header.includes(\"department\")),\n        fixed: headers.findIndex((header) => header.includes(\"fixed\")),\n        variable: headers.findIndex((header) => header.includes(\"variable\")),\n        burden: headers.findIndex((header) => header.includes(\"burden\")),\n        amount: headers.findIndex((header) => header.includes(\"amount\")),\n        expenseReview: headers.findIndex((header) => header.includes(\"expense\") && header.includes(\"review\")),\n        category: headers.findIndex((header) => header.includes(\"payroll\") && header.includes(\"category\"))\n    };\n    console.log(\"parseExpenseRows - column indexes:\", indexes);\n    \n    // Log unique payroll dates found\n    if (indexes.payrollDate >= 0) {\n        const uniqueDates = new Set();\n        for (let i = 1; i < values.length; i++) {\n            const dateVal = values[i][indexes.payrollDate];\n            if (dateVal) uniqueDates.add(String(dateVal));\n        }\n        console.log(\"parseExpenseRows - unique payroll dates found:\", [...uniqueDates].slice(0, 20));\n    }\n    \n    const rows = [];\n    for (let i = 1; i < values.length; i += 1) {\n        const row = values[i];\n        const period = normalizePeriodKey(indexes.payrollDate >= 0 ? row[indexes.payrollDate] : null);\n        if (!period) continue;\n        const employee = indexes.employee >= 0 ? normalizeString(row[indexes.employee]) : \"\";\n        const department = indexes.department >= 0 ? normalizeString(row[indexes.department]) || \"Unassigned\" : \"Unassigned\";\n        const fixedVal = indexes.fixed >= 0 ? toNumber(row[indexes.fixed]) : null;\n        const variableVal = indexes.variable >= 0 ? toNumber(row[indexes.variable]) : null;\n        const burdenVal = indexes.burden >= 0 ? toNumber(row[indexes.burden]) : null;\n        let fixed = 0;\n        let variable = 0;\n        let burden = 0;\n        if (fixedVal !== null || variableVal !== null || burdenVal !== null) {\n            fixed = fixedVal ?? 0;\n            variable = variableVal ?? 0;\n            burden = burdenVal ?? 0;\n        } else {\n            const amount = indexes.amount >= 0 ? toNumber(row[indexes.amount]) : 0;\n            const classification = classifyExpenseComponent(\n                indexes.expenseReview >= 0 ? row[indexes.expenseReview] : row[indexes.category]\n            );\n            if (classification === \"fixed\") fixed = amount;\n            else if (classification === \"burden\") burden = amount;\n            else variable = amount;\n        }\n        if (fixed === 0 && variable === 0 && burden === 0) continue;\n        rows.push({\n            period,\n            employee,\n            department: department || \"Unassigned\",\n            fixed,\n            variable,\n            burden\n        });\n    }\n    return rows;\n}\n\nfunction aggregateExpensePeriods(rows) {\n    const map = new Map();\n    rows.forEach((row) => {\n        const key = row.period;\n        if (!key) return;\n        if (!map.has(key)) {\n            map.set(key, {\n                key,\n                label: formatFriendlyPeriod(key),\n                employees: new Set(),\n                departments: new Map(),\n                summary: { fixed: 0, variable: 0, burden: 0 }\n            });\n        }\n        const bucket = map.get(key);\n        bucket.employees.add(row.employee || `EMP-${bucket.employees.size + 1}`);\n        const deptKey = row.department || \"Unassigned\";\n        if (!bucket.departments.has(deptKey)) {\n            bucket.departments.set(deptKey, {\n                name: deptKey,\n                fixed: 0,\n                variable: 0,\n                burden: 0,\n                employees: new Set()\n            });\n        }\n        const dept = bucket.departments.get(deptKey);\n        dept.fixed += row.fixed;\n        dept.variable += row.variable;\n        dept.burden += row.burden;\n        dept.employees.add(row.employee || `EMP-${dept.employees.size + 1}`);\n        bucket.summary.fixed += row.fixed;\n        bucket.summary.variable += row.variable;\n        bucket.summary.burden += row.burden;\n    });\n    const result = [];\n    map.forEach((bucket) => {\n        const total = bucket.summary.fixed + bucket.summary.variable + bucket.summary.burden;\n        const departments = Array.from(bucket.departments.values()).map((dept) => {\n            const gross = dept.fixed + dept.variable;\n            const allIn = gross + dept.burden;\n            return {\n                name: dept.name,\n                fixed: dept.fixed,\n                variable: dept.variable,\n                gross,\n                burden: dept.burden,\n                allIn,\n                percent: total ? allIn / total : 0,\n                headcount: dept.employees.size,\n                delta: 0\n            };\n        });\n        departments.sort((a, b) => b.allIn - a.allIn);\n        const summary = {\n            employeeCount: bucket.employees.size,\n            fixed: bucket.summary.fixed,\n            variable: bucket.summary.variable,\n            burden: bucket.summary.burden,\n            total,\n            burdenRate: total ? bucket.summary.burden / total : 0,\n            delta: 0\n        };\n        const totalsRow = {\n            name: \"Totals\",\n            fixed: bucket.summary.fixed,\n            variable: bucket.summary.variable,\n            gross: bucket.summary.fixed + bucket.summary.variable,\n            burden: bucket.summary.burden,\n            allIn: total,\n            percent: total ? 1 : 0,\n            headcount: bucket.employees.size,\n            delta: 0,\n            isTotal: true\n        };\n        result.push({\n            key: bucket.key,\n            label: bucket.label,\n            summary,\n            departments,\n            totalsRow\n        });\n    });\n    return result.sort((a, b) => (a.key < b.key ? 1 : -1));\n}\n\nfunction buildExpenseReviewPeriods(cleanValues, archiveValues) {\n    console.log(\"buildExpenseReviewPeriods - cleanValues rows:\", cleanValues?.length || 0);\n    console.log(\"buildExpenseReviewPeriods - archiveValues rows:\", archiveValues?.length || 0);\n    \n    const currentPeriods = aggregateExpensePeriods(parseExpenseRows(cleanValues));\n    const archivePeriods = aggregateExpensePeriods(parseExpenseRows(archiveValues));\n    \n    console.log(\"buildExpenseReviewPeriods - currentPeriods:\", currentPeriods.map(p => ({ key: p.key, employees: p.summary?.employeeCount, total: p.summary?.total })));\n    console.log(\"buildExpenseReviewPeriods - archivePeriods:\", archivePeriods.map(p => ({ key: p.key, employees: p.summary?.employeeCount, total: p.summary?.total })));\n    \n    const archiveMap = new Map(archivePeriods.map((period) => [period.key, period]));\n    const combined = [];\n    if (currentPeriods.length) {\n        combined.push(currentPeriods[0]);\n        archiveMap.delete(currentPeriods[0].key);\n    }\n    archivePeriods.forEach((period) => {\n        if (combined.length >= 6) return;\n        if (!combined.some((existing) => existing.key === period.key)) {\n            combined.push(period);\n        }\n    });\n    \n    console.log(\"buildExpenseReviewPeriods - combined before filter:\", combined.map(p => ({ key: p.key, employees: p.summary?.employeeCount, total: p.summary?.total })));\n    \n    // Filter to only include periods that look like real pay periods:\n    // - Must have at least 3 employees (filters out test data or partial entries)\n    // - Must have meaningful total (> $1000) to filter out adjustment entries\n    const minEmployeesForPayPeriod = 3;\n    const minTotalForPayPeriod = 1000;\n    \n    const sorted = combined\n        .filter((period) => {\n            if (!period || !period.key) {\n                console.log(\"buildExpenseReviewPeriods - EXCLUDED (no key):\", period);\n                return false;\n            }\n            const total = period.summary?.total || \n                ((period.summary?.fixed || 0) + (period.summary?.variable || 0) + (period.summary?.burden || 0));\n            const employeeCount = period.summary?.employeeCount || 0;\n            // Always include the current period (first one), filter others\n            if (combined.indexOf(period) === 0) {\n                console.log(`buildExpenseReviewPeriods - INCLUDED (current): ${period.key} - ${employeeCount} employees, $${total}`);\n                return true;\n            }\n            const included = employeeCount >= minEmployeesForPayPeriod && total >= minTotalForPayPeriod;\n            console.log(`buildExpenseReviewPeriods - ${included ? \"INCLUDED\" : \"EXCLUDED\"}: ${period.key} - ${employeeCount} employees, $${total} (needs >=${minEmployeesForPayPeriod} emp, >=$${minTotalForPayPeriod})`);\n            return included;\n        })\n        .sort((a, b) => (a.key < b.key ? 1 : -1))\n        .slice(0, 6);\n    \n    console.log(\"buildExpenseReviewPeriods - FINAL periods:\", sorted.map(p => p.key));\n    sorted.forEach((period, index) => {\n        const previous = sorted[index + 1];\n        const delta = previous ? period.summary.total - previous.summary.total : 0;\n        period.summary.delta = delta;\n        const previousDeptMap = new Map((previous?.departments || []).map((dept) => [dept.name, dept]));\n        period.departments.forEach((dept) => {\n            const prev = previousDeptMap.get(dept.name);\n            dept.delta = prev ? dept.allIn - prev.allIn : 0;\n        });\n        period.totalsRow.delta = delta;\n    });\n    return sorted;\n}\n\nasync function prepareExpenseReviewData() {\n    if (!hasExcelRuntime()) {\n        updateExpenseReviewState({\n            loading: false,\n            lastError: \"Excel runtime is unavailable.\"\n        });\n        return;\n    }\n    updateExpenseReviewState({ loading: true, lastError: null });\n    try {\n        const periods = await Excel.run(async (context) => {\n            // Check if required sheets exist\n            const cleanSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.DATA_CLEAN);\n            const archiveSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.ARCHIVE_SUMMARY);\n            const reviewSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.EXPENSE_REVIEW);\n            \n            cleanSheet.load(\"isNullObject, name\");\n            archiveSheet.load(\"isNullObject, name\");\n            reviewSheet.load(\"isNullObject, name\");\n            await context.sync();\n            \n            console.log(\"Expense Review - Sheet check:\", {\n                cleanSheet: cleanSheet.isNullObject ? \"MISSING\" : cleanSheet.name,\n                archiveSheet: archiveSheet.isNullObject ? \"MISSING\" : archiveSheet.name,\n                reviewSheet: reviewSheet.isNullObject ? \"MISSING\" : reviewSheet.name\n            });\n            \n            // Create missing sheets if needed\n            if (reviewSheet.isNullObject) {\n                console.log(\"Creating PR_Expense_Review sheet...\");\n                const newReviewSheet = context.workbook.worksheets.add(SHEET_NAMES.EXPENSE_REVIEW);\n                await context.sync();\n                // Re-get the sheet\n                const createdSheet = context.workbook.worksheets.getItem(SHEET_NAMES.EXPENSE_REVIEW);\n                \n                // Get data even if cleanSheet is missing (will be empty)\n                let cleanValues = [];\n                let archiveValues = [];\n                \n                if (!cleanSheet.isNullObject) {\n            const cleanRange = cleanSheet.getUsedRangeOrNullObject();\n                    cleanRange.load(\"values\");\n                    await context.sync();\n                    cleanValues = cleanRange.isNullObject ? [] : cleanRange.values || [];\n                }\n                \n                if (!archiveSheet.isNullObject) {\n            const archiveRange = archiveSheet.getUsedRangeOrNullObject();\n                    archiveRange.load(\"values\");\n                    await context.sync();\n                    archiveValues = archiveRange.isNullObject ? [] : archiveRange.values || [];\n                }\n                \n                const periodData = buildExpenseReviewPeriods(cleanValues, archiveValues);\n                await writeExpenseReviewSheet(context, createdSheet, periodData);\n                return periodData;\n            }\n            \n            // Get data from existing sheets\n            let cleanValues = [];\n            let archiveValues = [];\n            \n            if (!cleanSheet.isNullObject) {\n                const cleanRange = cleanSheet.getUsedRangeOrNullObject();\n            cleanRange.load(\"values\");\n                await context.sync();\n                cleanValues = cleanRange.isNullObject ? [] : cleanRange.values || [];\n                console.log(\"Expense Review - PR_Data_Clean rows:\", cleanValues.length);\n            } else {\n                console.warn(\"Expense Review - PR_Data_Clean sheet not found, using empty data\");\n            }\n            \n            if (!archiveSheet.isNullObject) {\n                const archiveRange = archiveSheet.getUsedRangeOrNullObject();\n            archiveRange.load(\"values\");\n            await context.sync();\n                archiveValues = archiveRange.isNullObject ? [] : archiveRange.values || [];\n                console.log(\"Expense Review - PR_Archive_Summary rows:\", archiveValues.length);\n            } else {\n                console.warn(\"Expense Review - PR_Archive_Summary sheet not found, using empty data\");\n            }\n            \n            const periodData = buildExpenseReviewPeriods(cleanValues, archiveValues);\n            console.log(\"Expense Review - Periods built:\", periodData.length);\n            \n            await writeExpenseReviewSheet(context, reviewSheet, periodData);\n            return periodData;\n        });\n        updateExpenseReviewState({ loading: false, periods, lastError: null });\n        \n        // Run completeness check after data is loaded\n        await runPayrollCompletenessCheck();\n        renderApp(); // Re-render to show completeness check results\n    } catch (error) {\n        console.error(\"Expense Review: unable to build executive summary\", error);\n        console.error(\"Error details:\", error.message, error.stack);\n        updateExpenseReviewState({\n            loading: false,\n            lastError: `Unable to build the Expense Review: ${error.message || \"Unknown error\"}`,\n            periods: []\n        });\n    }\n}\n\nasync function writeExpenseReviewSheet(context, sheet, periods) {\n    if (!sheet) {\n        console.error(\"writeExpenseReviewSheet: sheet is null/undefined\");\n        return;\n    }\n    \n    console.log(\"writeExpenseReviewSheet: Building executive dashboard with\", periods.length, \"periods\");\n    \n    // Clear existing content and charts\n    try {\n        const usedRange = sheet.getUsedRangeOrNullObject();\n        usedRange.load(\"address\");\n        const charts = sheet.charts;\n        charts.load(\"items\");\n        await context.sync();\n        if (!usedRange.isNullObject) {\n            usedRange.clear();\n            await context.sync();\n        }\n        // Remove existing charts\n        for (let i = charts.items.length - 1; i >= 0; i--) {\n            charts.items[i].delete();\n        }\n        await context.sync();\n    } catch (e) {\n        console.warn(\"Could not clear sheet:\", e);\n    }\n    \n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // PREPARE DATA\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    const current = periods[0] || {};\n    const prior = periods[1] || {};\n    const currentSummary = current.summary || {};\n    const priorSummary = prior.summary || {};\n    \n    // Get period from config\n    const configPeriod = getConfigValue(\"PR_Accounting_Period\") || getPayrollDateValue() || \"\";\n    \n    // Key metrics\n    const totalPayroll = Number(currentSummary.total) || 0;\n    const priorTotal = Number(priorSummary.total) || 0;\n    const periodChange = totalPayroll - priorTotal;\n    const periodChangePct = priorTotal ? periodChange / priorTotal : 0;\n    const employeeCount = Number(currentSummary.employeeCount) || 0;\n    const priorEmployeeCount = Number(priorSummary.employeeCount) || 0;\n    const headcountChange = employeeCount - priorEmployeeCount;\n    const avgPerEmployee = employeeCount ? totalPayroll / employeeCount : 0;\n    const priorAvgPerEmployee = priorEmployeeCount ? priorTotal / priorEmployeeCount : 0;\n    const avgChange = avgPerEmployee - priorAvgPerEmployee;\n    \n    // Variable comp analysis - detect if this is a \"variable pay\" period\n    // Look for commission, bonus patterns in period data\n    const hasVariableComp = detectVariableCompPeriod(periods);\n    const basePayOnly = detectBasePayOnlyPeriod(current, periods);\n    \n    const periodLabel = current.label || current.key || \"Current Period\";\n    const generatedTimestamp = new Date().toLocaleString(\"en-US\", { \n        month: \"short\", day: \"numeric\", year: \"numeric\", hour: \"numeric\", minute: \"2-digit\"\n    });\n    \n    // Trend helpers\n    const trendArrow = (val) => val > 0 ? \"\u25B2\" : val < 0 ? \"\u25BC\" : \"\u2014\";\n    \n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // CALCULATE HISTORICAL RANGES FOR SPECTRUM VISUALIZATION\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    const historicalTotals = periods.map(p => p.summary?.total || 0).filter(t => t > 0);\n    const historicalAvgPerEmp = periods.map(p => {\n        const s = p.summary || {};\n        const emp = s.employeeCount || 0;\n        return emp > 0 ? (s.total || 0) / emp : 0;\n    }).filter(a => a > 0);\n    const historicalChangePcts = periods.slice(0, -1).map((p, i) => {\n        const curr = p.summary?.total || 0;\n        const prev = periods[i + 1]?.summary?.total || 0;\n        return prev > 0 ? (curr - prev) / prev : 0;\n    });\n    \n    // Calculate ranges - includes current value to ensure the spectrum adjusts if current is outside historical range\n    const calcRange = (arr, currentValue = null) => {\n        // Include current value in range if provided (allows range to expand beyond historical)\n        const values = currentValue !== null ? [...arr, currentValue] : arr;\n        if (!values.length) return { min: 0, max: 0, avg: 0 };\n        const min = Math.min(...values);\n        const max = Math.max(...values);\n        // Average is calculated from just the historical values (or all if no current provided)\n        const avgBase = arr.length ? arr : values;\n        const avg = avgBase.reduce((a, b) => a + b, 0) / avgBase.length;\n        return { min, max, avg };\n    };\n    \n    const payrollRange = calcRange(historicalTotals, totalPayroll);\n    const avgEmpRange = calcRange(historicalAvgPerEmp, avgPerEmployee);\n    const changePctRange = calcRange(historicalChangePcts);\n    \n    // Spectrum builder - creates a visual bar showing where current value falls\n    // Uses Unicode block characters: \u2591 (light), \u2592 (medium), \u25CF (current position)\n    const buildSpectrum = (current, min, max, width = 20) => {\n        if (max <= min) return \"\u2591\".repeat(width);\n        const range = max - min;\n        const position = Math.max(0, Math.min(1, (current - min) / range));\n        const markerPos = Math.round(position * (width - 1));\n        \n        let bar = \"\";\n        for (let i = 0; i < width; i++) {\n            if (i === markerPos) {\n                bar += \"\u25CF\";\n            } else {\n                bar += \"\u2591\";\n            }\n        }\n        return bar;\n    };\n    \n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // EXTRACT FIXED/VARIABLE/BURDEN BREAKDOWNS\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    const currentFixed = Number(currentSummary.fixed) || 0;\n    const currentVariable = Number(currentSummary.variable) || 0;\n    const currentBurden = Number(currentSummary.burden) || 0;\n    const currentGross = currentFixed + currentVariable;\n    const currentBurdenRate = totalPayroll ? currentBurden / totalPayroll : 0;\n    \n    const priorFixed = Number(priorSummary.fixed) || 0;\n    const priorVariable = Number(priorSummary.variable) || 0;\n    const priorBurden = Number(priorSummary.burden) || 0;\n    const priorBurdenRate = priorTotal ? priorBurden / priorTotal : 0;\n    \n    // Calculate Sales & Marketing variable vs Other departments variable\n    const departments = current.departments || [];\n    const salesMarketingDepts = departments.filter(d => {\n        const name = (d.name || \"\").toLowerCase();\n        return name.includes(\"sales\") || name.includes(\"marketing\");\n    });\n    const otherDepts = departments.filter(d => {\n        const name = (d.name || \"\").toLowerCase();\n        return !name.includes(\"sales\") && !name.includes(\"marketing\");\n    });\n    \n    const salesMarketingVariable = salesMarketingDepts.reduce((sum, d) => sum + (d.variable || 0), 0);\n    const salesMarketingHeadcount = salesMarketingDepts.reduce((sum, d) => sum + (d.headcount || 0), 0);\n    const otherVariable = otherDepts.reduce((sum, d) => sum + (d.variable || 0), 0);\n    const otherHeadcount = otherDepts.reduce((sum, d) => sum + (d.headcount || 0), 0);\n    \n    const avgVariableSalesMarketing = salesMarketingHeadcount ? salesMarketingVariable / salesMarketingHeadcount : 0;\n    const avgVariableOther = otherHeadcount ? otherVariable / otherHeadcount : 0;\n    const avgFixedPerEmployee = employeeCount ? currentFixed / employeeCount : 0;\n    \n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // BUILD CLEAN DATA ARRAY - NEW LAYOUT\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    const data = [];\n    let rowIdx = 0;\n    const rowMap = {};\n    \n    // \u2500\u2500\u2500 HEADER (Left justified) \u2500\u2500\u2500\n    rowMap.headerStart = rowIdx;\n    // Format period as date if it's a number (Excel serial date)\n    let formattedPeriod = configPeriod || periodLabel;\n    if (typeof configPeriod === 'number' || (!isNaN(Number(configPeriod)) && configPeriod)) {\n        const dateNum = Number(configPeriod);\n        if (dateNum > 40000 && dateNum < 60000) { // Valid Excel date range\n            const excelEpoch = new Date(1899, 11, 30);\n            const date = new Date(excelEpoch.getTime() + dateNum * 24 * 60 * 60 * 1000);\n            formattedPeriod = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });\n        }\n    }\n    \n    data.push([\"PAYROLL EXPENSE REVIEW\"]); rowIdx++;\n    data.push([`Period: ${formattedPeriod}`]); rowIdx++;\n    data.push([`Generated: ${generatedTimestamp}`]); rowIdx++;\n    data.push([\"\"]); rowIdx++;\n    rowMap.headerEnd = rowIdx - 1;\n    \n    // \u2500\u2500\u2500 EXECUTIVE SUMMARY (Frozen Section) \u2500\u2500\u2500\n    rowMap.execSummaryStart = rowIdx;\n    data.push([\"EXECUTIVE SUMMARY\"]); rowIdx++;\n    rowMap.execSummaryHeader = rowIdx - 1;\n    data.push([\"\"]); rowIdx++;\n    \n    // Column headers: Pay Date, Headcount, Fixed Salary, Variable Salary, Burden, Total Payroll, Burden Rate\n    data.push([\"\", \"Pay Date\", \"Headcount\", \"Fixed Salary\", \"Variable Salary\", \"Burden\", \"Total Payroll\", \"Burden Rate\"]); rowIdx++;\n    rowMap.execSummaryColHeaders = rowIdx - 1;\n    \n    // Current Pay Period row\n    data.push([\"Current Pay Period\", current.label || current.key || \"\", employeeCount, currentFixed, currentVariable, currentBurden, totalPayroll, currentBurdenRate]); rowIdx++;\n    rowMap.execSummaryCurrentRow = rowIdx - 1;\n    \n    // Same Period Prior Month row  \n    data.push([\"Same Period Prior Month\", prior.label || prior.key || \"\", priorEmployeeCount, priorFixed, priorVariable, priorBurden, priorTotal, priorBurdenRate]); rowIdx++;\n    rowMap.execSummaryPriorRow = rowIdx - 1;\n    \n    data.push([\"\"]); rowIdx++;\n    data.push([\"\"]); rowIdx++;\n    rowMap.execSummaryEnd = rowIdx - 1;\n    \n    // \u2500\u2500\u2500 CURRENT PERIOD BREAKDOWN (DEPARTMENT) \u2500\u2500\u2500\n    rowMap.deptBreakdownStart = rowIdx;\n    data.push([\"CURRENT PERIOD BREAKDOWN (DEPARTMENT)\"]); rowIdx++;\n    rowMap.deptBreakdownHeader = rowIdx - 1;\n    data.push([\"\"]); rowIdx++;\n    data.push([`Payroll Date`, current.label || current.key || \"\"]); rowIdx++;\n    data.push([\"\"]); rowIdx++;\n    \n    // Column headers: Department, Fixed Salary, Variable Salary, Gross Pay, Burden, All-In Total, % of Total, Headcount\n    data.push([\"Department\", \"Fixed Salary\", \"Variable Salary\", \"Gross Pay\", \"Burden\", \"All-In Total\", \"% of Total\", \"Headcount\"]); rowIdx++;\n    rowMap.deptColHeaders = rowIdx - 1;\n    \n    // Department data rows\n    const sortedDepts = [...departments].sort((a, b) => (b.allIn || 0) - (a.allIn || 0));\n    rowMap.deptDataStart = rowIdx;\n    sortedDepts.forEach((dept) => {\n        data.push([\n            dept.name || \"\",\n            dept.fixed || 0,\n            dept.variable || 0,\n            dept.gross || 0,\n            dept.burden || 0,\n            dept.allIn || 0,\n            dept.percent || 0,\n            dept.headcount || 0\n        ]); rowIdx++;\n    });\n    rowMap.deptDataEnd = rowIdx - 1;\n    \n    // TOTAL row\n    if (current.totalsRow) {\n        const totals = current.totalsRow;\n        data.push([\n            \"TOTAL\",\n            totals.fixed || 0,\n            totals.variable || 0,\n            totals.gross || 0,\n            totals.burden || 0,\n            totals.allIn || 0,\n            1,\n            totals.headcount || 0\n        ]); rowIdx++;\n        rowMap.deptTotalsRow = rowIdx - 1;\n    }\n    \n    data.push([\"\"]); rowIdx++;\n    data.push([\"\"]); rowIdx++;\n    rowMap.deptBreakdownEnd = rowIdx - 1;\n    \n    // \u2500\u2500\u2500 HISTORICAL CONTEXT \u2500\u2500\u2500\n    rowMap.historicalStart = rowIdx;\n    data.push([\"HISTORICAL CONTEXT\"]); rowIdx++;\n    rowMap.historicalHeader = rowIdx - 1;\n    data.push([`Visual comparison of current period vs. historical range (${periods.length} periods). The dot (\u25CF) shows where you currently stand.`]); rowIdx++;\n    data.push([\"\"]); rowIdx++;\n    \n    // Format helpers for spectrum labels  \n    const fmtK = (n) => `$${Math.round(n / 1000)}K`;\n    const fmtPct = (n) => `${(n * 100).toFixed(1)}%`;\n    \n    // Column headers for historical context\n    data.push([\"\", \"Metric\", \"Low\", \"Range\", \"High\", \"\", \"Current\", \"Average\"]); rowIdx++;\n    rowMap.historicalColHeaders = rowIdx - 1;\n    \n    // Calculate additional historical ranges - include current values to allow range expansion\n    // Don't filter zeros here - let calcRange handle it with current value inclusion\n    const historicalFixed = periods.map(p => p.summary?.fixed || 0).filter(t => t > 0);\n    const historicalVariable = periods.map(p => p.summary?.variable || 0); // Keep zeros for proper range\n    const historicalBurdenRates = periods.map(p => {\n        const s = p.summary || {};\n        return s.total ? (s.burden || 0) / s.total : 0;\n    }); // Keep zeros for proper range\n    const historicalAvgFixed = periods.map(p => {\n        const s = p.summary || {};\n        const emp = s.employeeCount || 0;\n        return emp > 0 ? (s.fixed || 0) / emp : 0;\n    }).filter(a => a > 0);\n    \n    const fixedRange = calcRange(historicalFixed, currentFixed);\n    const variableRange = calcRange(historicalVariable, currentVariable);\n    const burdenRateRange = calcRange(historicalBurdenRates, currentBurdenRate);\n    const avgFixedRange = calcRange(historicalAvgFixed, avgFixedPerEmployee);\n    \n    // Build spectrum rows\n    rowMap.spectrumRows = [];\n    \n    // Total Payroll\n    const payrollSpectrum = buildSpectrum(totalPayroll, payrollRange.min, payrollRange.max, 25);\n    data.push([\"\", \"Total Payroll\", fmtK(payrollRange.min), payrollSpectrum, fmtK(payrollRange.max), \"\", fmtK(totalPayroll), fmtK(payrollRange.avg)]); rowIdx++;\n    rowMap.spectrumRows.push(rowIdx - 1);\n    \n    // Total Fixed Payroll\n    const fixedSpectrum = buildSpectrum(currentFixed, fixedRange.min, fixedRange.max, 25);\n    data.push([\"\", \"Total Fixed Payroll\", fmtK(fixedRange.min), fixedSpectrum, fmtK(fixedRange.max), \"\", fmtK(currentFixed), fmtK(fixedRange.avg)]); rowIdx++;\n    rowMap.spectrumRows.push(rowIdx - 1);\n    \n    // Total Variable Payroll\n    const variableSpectrum = buildSpectrum(currentVariable, variableRange.min, variableRange.max, 25);\n    data.push([\"\", \"Total Variable Payroll\", fmtK(variableRange.min), variableSpectrum, fmtK(variableRange.max), \"\", fmtK(currentVariable), fmtK(variableRange.avg)]); rowIdx++;\n    rowMap.spectrumRows.push(rowIdx - 1);\n    \n    data.push([\"\"]); rowIdx++;\n    \n    // Avg Fixed Payroll per Employee\n    const avgFixedSpectrum = buildSpectrum(avgFixedPerEmployee, avgFixedRange.min, avgFixedRange.max, 25);\n    data.push([\"\", \"Avg Fixed Payroll / Employee\", fmtK(avgFixedRange.min), avgFixedSpectrum, fmtK(avgFixedRange.max), \"\", fmtK(avgFixedPerEmployee), fmtK(avgFixedRange.avg)]); rowIdx++;\n    rowMap.spectrumRows.push(rowIdx - 1);\n    \n    // Calculate historical ranges for Sales & Marketing variable\n    const historicalAvgVarSM = periods.map(p => {\n        const depts = p.departments || [];\n        const smDepts = depts.filter(d => {\n            const name = (d.name || \"\").toLowerCase();\n            return name.includes(\"sales\") || name.includes(\"marketing\");\n        });\n        const smVar = smDepts.reduce((sum, d) => sum + (d.variable || 0), 0);\n        const smHc = smDepts.reduce((sum, d) => sum + (d.headcount || 0), 0);\n        return smHc > 0 ? smVar / smHc : 0;\n    }); // Keep zeros for proper range - current value inclusion will handle expansion\n    const avgVarSMRange = calcRange(historicalAvgVarSM, avgVariableSalesMarketing);\n    \n    // Calculate historical ranges for Other departments variable\n    const historicalAvgVarOther = periods.map(p => {\n        const depts = p.departments || [];\n        const otherD = depts.filter(d => {\n            const name = (d.name || \"\").toLowerCase();\n            return !name.includes(\"sales\") && !name.includes(\"marketing\");\n        });\n        const otherV = otherD.reduce((sum, d) => sum + (d.variable || 0), 0);\n        const otherH = otherD.reduce((sum, d) => sum + (d.headcount || 0), 0);\n        return otherH > 0 ? otherV / otherH : 0;\n    }); // Keep zeros for proper range\n    const avgVarOtherRange = calcRange(historicalAvgVarOther, avgVariableOther);\n    \n    // Avg Variable Payroll per Sales & Marketing (with spectrum visualization)\n    if (salesMarketingHeadcount > 0) {\n        const avgVarSMSpectrum = buildSpectrum(avgVariableSalesMarketing, avgVarSMRange.min, avgVarSMRange.max, 25);\n        data.push([\"\", \"Avg Variable / Sales & Marketing\", fmtK(avgVarSMRange.min), avgVarSMSpectrum, fmtK(avgVarSMRange.max), \"\", fmtK(avgVariableSalesMarketing), `${salesMarketingHeadcount} emp`]); rowIdx++;\n        rowMap.spectrumRows.push(rowIdx - 1);\n    }\n    \n    // Avg Variable Payroll per Other Departments (with spectrum visualization)\n    if (otherHeadcount > 0) {\n        const avgVarOtherSpectrum = buildSpectrum(avgVariableOther, avgVarOtherRange.min, avgVarOtherRange.max, 25);\n        data.push([\"\", \"Avg Variable / Other Depts\", fmtK(avgVarOtherRange.min), avgVarOtherSpectrum, fmtK(avgVarOtherRange.max), \"\", fmtK(avgVariableOther), `${otherHeadcount} emp`]); rowIdx++;\n        rowMap.spectrumRows.push(rowIdx - 1);\n    }\n    \n    data.push([\"\"]); rowIdx++;\n    \n    // Burden Rate (%)\n    const burdenRateSpectrum = buildSpectrum(currentBurdenRate, burdenRateRange.min, burdenRateRange.max, 25);\n    data.push([\"\", \"Burden Rate (%)\", fmtPct(burdenRateRange.min), burdenRateSpectrum, fmtPct(burdenRateRange.max), \"\", fmtPct(currentBurdenRate), fmtPct(burdenRateRange.avg)]); rowIdx++;\n    rowMap.spectrumRows.push(rowIdx - 1);\n    \n    data.push([\"\"]); rowIdx++;\n    data.push([\"\"]); rowIdx++;\n    rowMap.historicalEnd = rowIdx - 1;\n    \n    // \u2500\u2500\u2500 PERIOD TRENDS \u2500\u2500\u2500\n    rowMap.trendsStart = rowIdx;\n    data.push([\"PERIOD TRENDS\"]); rowIdx++;\n    rowMap.trendsHeader = rowIdx - 1;\n    data.push([\"\"]); rowIdx++;\n    \n    // Trend data table (will be used for chart)\n    data.push([\"Pay Period\", \"Total Payroll\", \"Fixed Payroll\", \"Variable Payroll\", \"Burden\", \"Headcount\"]); rowIdx++;\n    rowMap.trendColHeaders = rowIdx - 1;\n    \n    // Up to 6 periods in reverse chronological order (oldest first for chart)\n    const trendPeriods = periods.slice(0, 6).reverse();\n    rowMap.trendDataStart = rowIdx;\n    trendPeriods.forEach((period) => {\n        const s = period.summary || {};\n        data.push([\n            period.label || period.key || \"\",\n            s.total || 0,\n            s.fixed || 0,\n            s.variable || 0,\n            s.burden || 0,\n            s.employeeCount || 0\n        ]); rowIdx++;\n    });\n    rowMap.trendDataEnd = rowIdx - 1;\n    \n    data.push([\"\"]); rowIdx++;\n    rowMap.trendsEnd = rowIdx - 1;\n    \n    // Reserve space for charts (payroll chart + headcount chart)\n    rowMap.chartStart = rowIdx;\n    for (let i = 0; i < 15; i++) {\n        data.push([\"\"]); rowIdx++;\n    }\n    rowMap.payrollChartEnd = rowIdx - 1;\n    \n    // Space for headcount chart\n    rowMap.headcountChartStart = rowIdx;\n    for (let i = 0; i < 12; i++) {\n        data.push([\"\"]); rowIdx++;\n    }\n    rowMap.headcountChartEnd = rowIdx - 1;\n    \n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // WRITE DATA (10 columns to accommodate all data)\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    console.log(\"writeExpenseReviewSheet: Writing\", data.length, \"rows\");\n    \n    // Normalize all rows to 10 columns\n    const normalizedData = data.map(row => {\n        const r = Array.isArray(row) ? row : [\"\"];\n        while (r.length < 10) r.push(\"\");\n        return r.slice(0, 10);\n    });\n    \n    try {\n        const dataRange = sheet.getRangeByIndexes(0, 0, normalizedData.length, 10);\n        dataRange.values = normalizedData;\n        await context.sync();\n    } catch (writeError) {\n        console.error(\"writeExpenseReviewSheet: Write failed\", writeError);\n        throw writeError;\n    }\n    \n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // APPLY FORMATTING\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    try {\n        // Column widths\n        sheet.getRange(\"A:A\").format.columnWidth = 200;   // Section headers / Department names\n        sheet.getRange(\"B:B\").format.columnWidth = 130;   // Fixed Salary / Metric names\n        sheet.getRange(\"C:C\").format.columnWidth = 100;   // Variable Salary / Low\n        sheet.getRange(\"D:D\").format.columnWidth = 200;   // Gross Pay / Spectrum (wider for dots)\n        sheet.getRange(\"E:E\").format.columnWidth = 100;   // Burden / High\n        sheet.getRange(\"F:F\").format.columnWidth = 100;   // All-In Total\n        sheet.getRange(\"G:G\").format.columnWidth = 100;   // % of Total / Current\n        sheet.getRange(\"H:H\").format.columnWidth = 100;   // Headcount / Average\n        sheet.getRange(\"I:I\").format.columnWidth = 80;\n        sheet.getRange(\"J:J\").format.columnWidth = 80;\n        await context.sync();\n        \n        // \u2500\u2500\u2500 HEADER SECTION (Left justified) \u2500\u2500\u2500\n        const titleCell = sheet.getRange(\"A1\");\n        titleCell.format.font.bold = true;\n        titleCell.format.font.size = 22;\n        titleCell.format.font.color = \"#1e293b\";\n        \n        sheet.getRange(\"A2\").format.font.size = 11;\n        sheet.getRange(\"A2\").format.font.color = \"#64748b\";\n        sheet.getRange(\"A3\").format.font.size = 10;\n        sheet.getRange(\"A3\").format.font.color = \"#94a3b8\";\n        await context.sync();\n        \n        // \u2500\u2500\u2500 EXECUTIVE SUMMARY SECTION \u2500\u2500\u2500\n        const execHeader = sheet.getRange(`A${rowMap.execSummaryHeader + 1}`);\n        execHeader.format.font.bold = true;\n        execHeader.format.font.size = 14;\n        execHeader.format.font.color = \"#1e293b\";\n        \n        // Column headers - dark background\n        const execColHeaders = sheet.getRange(`A${rowMap.execSummaryColHeaders + 1}:H${rowMap.execSummaryColHeaders + 1}`);\n        execColHeaders.format.font.bold = true;\n        execColHeaders.format.font.size = 10;\n        execColHeaders.format.fill.color = \"#1e293b\";\n        execColHeaders.format.font.color = \"#ffffff\";\n        \n        // Current period row - light green background\n        const currentRow = sheet.getRange(`A${rowMap.execSummaryCurrentRow + 1}:H${rowMap.execSummaryCurrentRow + 1}`);\n        currentRow.format.fill.color = \"#dcfce7\";\n        currentRow.format.font.bold = true;\n        \n        // Prior period row - light gray background\n        const priorRow = sheet.getRange(`A${rowMap.execSummaryPriorRow + 1}:H${rowMap.execSummaryPriorRow + 1}`);\n        priorRow.format.fill.color = \"#f1f5f9\";\n        \n        // Number formats for executive summary\n        for (const rowNum of [rowMap.execSummaryCurrentRow + 1, rowMap.execSummaryPriorRow + 1]) {\n            sheet.getRange(`C${rowNum}`).numberFormat = [[\"#,##0\"]];       // Headcount\n            sheet.getRange(`D${rowNum}`).numberFormat = [[\"$#,##0\"]];      // Fixed\n            sheet.getRange(`E${rowNum}`).numberFormat = [[\"$#,##0\"]];      // Variable\n            sheet.getRange(`F${rowNum}`).numberFormat = [[\"$#,##0\"]];      // Burden\n            sheet.getRange(`G${rowNum}`).numberFormat = [[\"$#,##0\"]];      // Total\n            sheet.getRange(`H${rowNum}`).numberFormat = [[\"0.00%\"]];       // Burden Rate\n        }\n        await context.sync();\n        \n        // \u2500\u2500\u2500 DEPARTMENT BREAKDOWN SECTION \u2500\u2500\u2500\n        const deptHeader = sheet.getRange(`A${rowMap.deptBreakdownHeader + 1}`);\n        deptHeader.format.font.bold = true;\n        deptHeader.format.font.size = 14;\n        deptHeader.format.font.color = \"#1e293b\";\n        \n        // Column headers - dark background\n        const deptColHeaders = sheet.getRange(`A${rowMap.deptColHeaders + 1}:H${rowMap.deptColHeaders + 1}`);\n        deptColHeaders.format.font.bold = true;\n        deptColHeaders.format.font.size = 10;\n        deptColHeaders.format.fill.color = \"#1e293b\";\n        deptColHeaders.format.font.color = \"#ffffff\";\n        \n        // Department data rows\n        for (let i = rowMap.deptDataStart; i <= rowMap.deptDataEnd; i++) {\n            const row = i + 1;\n            sheet.getRange(`B${row}`).numberFormat = [[\"$#,##0\"]];   // Fixed\n            sheet.getRange(`C${row}`).numberFormat = [[\"$#,##0\"]];   // Variable\n            sheet.getRange(`D${row}`).numberFormat = [[\"$#,##0\"]];   // Gross\n            sheet.getRange(`E${row}`).numberFormat = [[\"$#,##0\"]];   // Burden\n            sheet.getRange(`F${row}`).numberFormat = [[\"$#,##0\"]];   // All-In\n            sheet.getRange(`G${row}`).numberFormat = [[\"0.00%\"]];    // % of Total\n            sheet.getRange(`H${row}`).numberFormat = [[\"#,##0\"]];    // Headcount\n            \n            // Alternate row shading\n            if ((i - rowMap.deptDataStart) % 2 === 1) {\n                sheet.getRange(`A${row}:H${row}`).format.fill.color = \"#f8fafc\";\n            }\n        }\n        \n        // Totals row - dark background\n        if (rowMap.deptTotalsRow) {\n            const totalsRange = sheet.getRange(`A${rowMap.deptTotalsRow + 1}:H${rowMap.deptTotalsRow + 1}`);\n            totalsRange.format.font.bold = true;\n            totalsRange.format.fill.color = \"#1e293b\";\n            totalsRange.format.font.color = \"#ffffff\";\n            \n            const row = rowMap.deptTotalsRow + 1;\n            sheet.getRange(`B${row}`).numberFormat = [[\"$#,##0\"]];\n            sheet.getRange(`C${row}`).numberFormat = [[\"$#,##0\"]];\n            sheet.getRange(`D${row}`).numberFormat = [[\"$#,##0\"]];\n            sheet.getRange(`E${row}`).numberFormat = [[\"$#,##0\"]];\n            sheet.getRange(`F${row}`).numberFormat = [[\"$#,##0\"]];\n            sheet.getRange(`G${row}`).numberFormat = [[\"0%\"]];\n            sheet.getRange(`H${row}`).numberFormat = [[\"#,##0\"]];\n        }\n        await context.sync();\n        \n        // \u2500\u2500\u2500 HISTORICAL CONTEXT SECTION \u2500\u2500\u2500\n        const histHeader = sheet.getRange(`A${rowMap.historicalHeader + 1}`);\n        histHeader.format.font.bold = true;\n        histHeader.format.font.size = 14;\n        histHeader.format.font.color = \"#1e293b\";\n        \n        // Description text\n        sheet.getRange(`A${rowMap.historicalHeader + 2}`).format.font.size = 10;\n        sheet.getRange(`A${rowMap.historicalHeader + 2}`).format.font.color = \"#64748b\";\n        sheet.getRange(`A${rowMap.historicalHeader + 2}`).format.font.italic = true;\n        \n        // Column headers - center Low, High, Current, Average\n        const histColHeaders = sheet.getRange(`A${rowMap.historicalColHeaders + 1}:H${rowMap.historicalColHeaders + 1}`);\n        histColHeaders.format.font.bold = true;\n        histColHeaders.format.font.size = 10;\n        histColHeaders.format.fill.color = \"#e2e8f0\";\n        histColHeaders.format.font.color = \"#334155\";\n        // Center the column headers for Low (C), High (E), Current (G), Average (H)\n        sheet.getRange(`C${rowMap.historicalColHeaders + 1}`).format.horizontalAlignment = \"Center\";\n        sheet.getRange(`E${rowMap.historicalColHeaders + 1}`).format.horizontalAlignment = \"Center\";\n        sheet.getRange(`G${rowMap.historicalColHeaders + 1}`).format.horizontalAlignment = \"Center\";\n        sheet.getRange(`H${rowMap.historicalColHeaders + 1}`).format.horizontalAlignment = \"Center\";\n        \n        // Format spectrum rows\n        rowMap.spectrumRows.forEach(r => {\n            // Spectrum bar - use monospace font for consistent width\n            sheet.getRange(`D${r + 1}`).format.font.name = \"Consolas\";\n            sheet.getRange(`D${r + 1}`).format.font.size = 14;\n            sheet.getRange(`D${r + 1}`).format.font.color = \"#6366f1\";\n            sheet.getRange(`D${r + 1}`).format.horizontalAlignment = \"Center\";\n            \n            // Metric label (left-aligned by default)\n            sheet.getRange(`B${r + 1}`).format.font.color = \"#334155\";\n            \n            // Low (C) - centered\n            sheet.getRange(`C${r + 1}`).format.font.color = \"#94a3b8\";\n            sheet.getRange(`C${r + 1}`).format.horizontalAlignment = \"Center\";\n            \n            // High (E) - centered\n            sheet.getRange(`E${r + 1}`).format.font.color = \"#94a3b8\";\n            sheet.getRange(`E${r + 1}`).format.horizontalAlignment = \"Center\";\n            \n            // Current (G) - centered, bold\n            sheet.getRange(`G${r + 1}`).format.font.bold = true;\n            sheet.getRange(`G${r + 1}`).format.font.color = \"#1e293b\";\n            sheet.getRange(`G${r + 1}`).format.horizontalAlignment = \"Center\";\n            \n            // Average (H) - centered\n            sheet.getRange(`H${r + 1}`).format.font.color = \"#94a3b8\";\n            sheet.getRange(`H${r + 1}`).format.horizontalAlignment = \"Center\";\n        });\n        await context.sync();\n        \n        // \u2500\u2500\u2500 PERIOD TRENDS SECTION \u2500\u2500\u2500\n        const trendsHeader = sheet.getRange(`A${rowMap.trendsHeader + 1}`);\n        trendsHeader.format.font.bold = true;\n        trendsHeader.format.font.size = 14;\n        trendsHeader.format.font.color = \"#1e293b\";\n        \n        // Trend table headers\n        const trendColHeaders = sheet.getRange(`A${rowMap.trendColHeaders + 1}:F${rowMap.trendColHeaders + 1}`);\n        trendColHeaders.format.font.bold = true;\n        trendColHeaders.format.font.size = 10;\n        trendColHeaders.format.fill.color = \"#1e293b\";\n        trendColHeaders.format.font.color = \"#ffffff\";\n        \n        // Trend data number formats\n        for (let i = rowMap.trendDataStart; i <= rowMap.trendDataEnd; i++) {\n            const row = i + 1;\n            sheet.getRange(`B${row}`).numberFormat = [[\"$#,##0\"]];   // Total\n            sheet.getRange(`C${row}`).numberFormat = [[\"$#,##0\"]];   // Fixed\n            sheet.getRange(`D${row}`).numberFormat = [[\"$#,##0\"]];   // Variable\n            sheet.getRange(`E${row}`).numberFormat = [[\"$#,##0\"]];   // Burden\n            sheet.getRange(`F${row}`).numberFormat = [[\"#,##0\"]];    // Headcount\n            \n            if ((i - rowMap.trendDataStart) % 2 === 1) {\n                sheet.getRange(`A${row}:F${row}`).format.fill.color = \"#f8fafc\";\n            }\n        }\n        await context.sync();\n        \n        // \u2500\u2500\u2500 CREATE PAYROLL TRENDS CHART (without Headcount) \u2500\u2500\u2500\n        if (trendPeriods.length >= 2) {\n            try {\n                // Chart data range - exclude Headcount column (A:E instead of A:F)\n                const payrollChartRange = sheet.getRange(`A${rowMap.trendColHeaders + 1}:E${rowMap.trendDataEnd + 1}`);\n                \n                // Create the payroll chart\n                const payrollChart = sheet.charts.add(\n                    Excel.ChartType.lineMarkers,\n                    payrollChartRange,\n                    Excel.ChartSeriesBy.columns\n                );\n                \n                // Position the chart below the trend data\n                payrollChart.setPosition(`A${rowMap.chartStart + 1}`, `J${rowMap.payrollChartEnd + 1}`);\n                payrollChart.title.text = \"Payroll Expense Trends\";\n                payrollChart.title.format.font.size = 14;\n                payrollChart.title.format.font.bold = true;\n                \n                // Configure legend\n                payrollChart.legend.position = Excel.ChartLegendPosition.bottom;\n                \n                // Style the chart\n                payrollChart.format.fill.setSolidColor(\"#ffffff\");\n                payrollChart.format.border.lineStyle = Excel.ChartLineStyle.continuous;\n                payrollChart.format.border.color = \"#e2e8f0\";\n                \n                // Set X-axis to use text/category labels (not date axis)\n                // This prevents Excel from interpolating dates between pay periods\n                const categoryAxis = payrollChart.axes.getItem(Excel.ChartAxisType.category);\n                categoryAxis.categoryType = Excel.ChartAxisCategoryType.textAxis;\n                categoryAxis.setCategoryNames(sheet.getRange(`A${rowMap.trendDataStart + 1}:A${rowMap.trendDataEnd + 1}`));\n                \n                await context.sync();\n                \n                // Format series colors: Total=Blue, Fixed=Green, Variable=Orange, Burden=Purple\n                const payrollSeries = payrollChart.series;\n                payrollSeries.load(\"count\");\n                await context.sync();\n                \n                const payrollColors = [\"#3b82f6\", \"#22c55e\", \"#f97316\", \"#8b5cf6\"];\n                for (let i = 0; i < Math.min(payrollSeries.count, payrollColors.length); i++) {\n                    const s = payrollSeries.getItemAt(i);\n                    s.format.line.color = payrollColors[i];\n                    s.format.line.weight = 2;\n                    s.markerStyle = Excel.ChartMarkerStyle.circle;\n                    s.markerSize = 6;\n                    s.markerBackgroundColor = payrollColors[i];\n                }\n                await context.sync();\n                \n                console.log(\"writeExpenseReviewSheet: Payroll chart created successfully\");\n            } catch (chartError) {\n                console.warn(\"writeExpenseReviewSheet: Payroll chart creation failed (non-critical)\", chartError);\n            }\n            \n            // \u2500\u2500\u2500 CREATE HEADCOUNT CHART (separate scale) \u2500\u2500\u2500\n            try {\n                // For headcount, we need to create a chart from contiguous data\n                // Use just columns A (Pay Period) and F (Headcount) by creating from full range\n                // then removing unwanted series\n                const headcountChartRange = sheet.getRange(`A${rowMap.trendColHeaders + 1}:F${rowMap.trendDataEnd + 1}`);\n                \n                // Create the headcount chart from full range\n                const headcountChart = sheet.charts.add(\n                    Excel.ChartType.lineMarkers,\n                    headcountChartRange,\n                    Excel.ChartSeriesBy.columns\n                );\n                \n                // Position below the payroll chart\n                headcountChart.setPosition(`A${rowMap.headcountChartStart + 1}`, `J${rowMap.headcountChartEnd + 1}`);\n                headcountChart.title.text = \"Headcount Trend\";\n                headcountChart.title.format.font.size = 12;\n                headcountChart.title.format.font.bold = true;\n                \n                // Configure legend\n                headcountChart.legend.visible = false;\n                \n                // Style the chart\n                headcountChart.format.fill.setSolidColor(\"#ffffff\");\n                headcountChart.format.border.lineStyle = Excel.ChartLineStyle.continuous;\n                headcountChart.format.border.color = \"#e2e8f0\";\n                \n                // Set X-axis to use text/category labels (not date axis)\n                const headcountCategoryAxis = headcountChart.axes.getItem(Excel.ChartAxisType.category);\n                headcountCategoryAxis.categoryType = Excel.ChartAxisCategoryType.textAxis;\n                headcountCategoryAxis.setCategoryNames(sheet.getRange(`A${rowMap.trendDataStart + 1}:A${rowMap.trendDataEnd + 1}`));\n                \n                await context.sync();\n                \n                // Delete unwanted series (Total, Fixed, Variable, Burden) - keep only Headcount\n                const hcSeries = headcountChart.series;\n                hcSeries.load(\"count, items/name\");\n                await context.sync();\n                \n                // Delete series in reverse order (so indices don't shift)\n                // Series order: Total Payroll, Fixed Payroll, Variable Payroll, Burden, Headcount\n                // We want to keep only the last one (Headcount)\n                for (let i = hcSeries.count - 2; i >= 0; i--) {\n                    const s = hcSeries.getItemAt(i);\n                    s.delete();\n                }\n                await context.sync();\n                \n                // Reload and format remaining series (Headcount)\n                hcSeries.load(\"count\");\n                await context.sync();\n                \n                if (hcSeries.count > 0) {\n                    const s = hcSeries.getItemAt(0);\n                    s.format.line.color = \"#64748b\";\n                    s.format.line.weight = 2.5;\n                    s.markerStyle = Excel.ChartMarkerStyle.circle;\n                    s.markerSize = 8;\n                    s.markerBackgroundColor = \"#64748b\";\n                }\n                await context.sync();\n                \n                console.log(\"writeExpenseReviewSheet: Headcount chart created successfully\");\n            } catch (chartError) {\n                console.warn(\"writeExpenseReviewSheet: Headcount chart creation failed (non-critical)\", chartError);\n            }\n        }\n        \n        // \u2500\u2500\u2500 FINAL TOUCHES \u2500\u2500\u2500\n        // Freeze first 11 rows (header + executive summary)\n        sheet.freezePanes.freezeRows(rowMap.execSummaryEnd + 1);\n        sheet.pageLayout.orientation = Excel.PageOrientation.landscape;\n        sheet.getRange(\"A1\").select();\n        await context.sync();\n        \n        console.log(\"writeExpenseReviewSheet: Formatting applied successfully\");\n        \n    } catch (formatError) {\n        console.warn(\"writeExpenseReviewSheet: Formatting error (non-critical)\", formatError);\n    }\n}\n\n// Helper: Detect if this is a variable compensation period (has commissions/bonuses)\nfunction detectVariableCompPeriod(periods) {\n    if (!periods || !periods.length) return false;\n    const current = periods[0];\n    // Look for commission or bonus in the data categories\n    const categories = current.summary?.categories || [];\n    return categories.some(cat => {\n        const name = (cat.name || \"\").toLowerCase();\n        return name.includes(\"commission\") || name.includes(\"bonus\") || name.includes(\"variable\");\n    });\n}\n\n// Helper: Detect if this is likely a \"base pay only\" period\nfunction detectBasePayOnlyPeriod(current, periods) {\n    if (!current || periods.length < 2) return false;\n    \n    // Calculate average payroll across all periods\n    const totals = periods.map(p => p.summary?.total || 0).filter(t => t > 0);\n    if (totals.length < 2) return false;\n    \n    const avg = totals.reduce((a, b) => a + b, 0) / totals.length;\n    const currentTotal = current.summary?.total || 0;\n    \n    // If current period is significantly below average (>10% lower), likely base-pay only\n    const percentOfAvg = avg > 0 ? currentTotal / avg : 1;\n    return percentOfAvg < 0.90;\n}\n\nasync function activateWorksheet(name) {\n    if (!hasExcelRuntime() || !name) return;\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItemOrNullObject(name);\n            sheet.load(\"name\");\n            await context.sync();\n            if (sheet.isNullObject) return;\n            sheet.activate();\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n    } catch (error) {\n        console.warn(`Payroll Recorder: unable to activate worksheet ${name}`, error);\n    }\n}\n\nasync function refreshHeadcountAnalysis() {\n    if (!hasExcelRuntime()) {\n        headcountState.lastError = \"Excel runtime is unavailable.\";\n        headcountState.hasAnalyzed = true;\n        headcountState.loading = false;\n        renderApp();\n        return;\n    }\n    headcountState.loading = true;\n    headcountState.lastError = null;\n    renderApp();\n    try {\n        const results = await Excel.run(async (context) => {\n            // Use SS_Employee_Roster as the single source of truth for employee data\n            const rosterSheet = context.workbook.worksheets.getItem(\"SS_Employee_Roster\");\n            const payrollSheet = context.workbook.worksheets.getItem(SHEET_NAMES.DATA);\n            const rosterRange = rosterSheet.getUsedRangeOrNullObject();\n            const payrollRange = payrollSheet.getUsedRangeOrNullObject();\n            rosterRange.load(\"values\");\n            payrollRange.load(\"values\");\n            await context.sync();\n            const rosterValues = rosterRange.isNullObject ? [] : rosterRange.values || [];\n            const payrollValues = payrollRange.isNullObject ? [] : payrollRange.values || [];\n            const rosterData = parseRosterValues(rosterValues);\n            const payrollData = parsePayrollValues(payrollValues);\n            const rosterMismatches = [];\n            \n            // Check employees in roster but NOT in payroll (missing from payroll)\n            rosterData.employeeMap.forEach((entry, key) => {\n                if (!payrollData.employeeMap.has(key)) {\n                    rosterMismatches.push({\n                        name: entry.name || \"Unknown Employee\",\n                        type: \"missing_from_payroll\",\n                        message: `In roster but NOT in payroll data`,\n                        department: entry.department || \"\u2014\"\n                    });\n                }\n            });\n            \n            // Check employees in payroll but NOT in roster (unexpected in payroll)\n            payrollData.employeeMap.forEach((entry, key) => {\n                if (!rosterData.employeeMap.has(key)) {\n                    rosterMismatches.push({\n                        name: entry.name || \"Unknown Employee\",\n                        type: \"missing_from_roster\",\n                        message: `In payroll but NOT in roster`,\n                        department: entry.department || \"\u2014\"\n                    });\n                }\n            });\n            \n            // Sort mismatches by type then name\n            rosterMismatches.sort((a, b) => {\n                if (a.type !== b.type) return a.type.localeCompare(b.type);\n                return (a.name || \"\").localeCompare(b.name || \"\");\n            });\n            \n            const deptMismatches = [];\n            let deptComparisons = 0;\n            rosterData.employeeMap.forEach((entry, key) => {\n                const payrollEntry = payrollData.employeeMap.get(key);\n                if (!payrollEntry) return;\n                const rosterDept = normalizeString(entry.department);\n                const payrollDept = normalizeString(payrollEntry.department);\n                if (!rosterDept && !payrollDept) return;\n                deptComparisons += 1;\n                if (rosterDept !== payrollDept) {\n                    deptMismatches.push({\n                        employee: entry.name || payrollEntry.name || \"Employee\",\n                        rosterDept: rosterDept || \"\u2014\",\n                        payrollDept: payrollDept || \"\u2014\"\n                    });\n                }\n            });\n            \n            console.log(\"Headcount Analysis Results:\", {\n                rosterCount: rosterData.activeCount,\n                payrollCount: payrollData.totalEmployees,\n                difference: rosterData.activeCount - payrollData.totalEmployees,\n                missingFromPayroll: rosterMismatches.filter(m => m.type === \"missing_from_payroll\").length,\n                missingFromRoster: rosterMismatches.filter(m => m.type === \"missing_from_roster\").length,\n                deptMismatches: deptMismatches.length\n            });\n            \n            return {\n                roster: {\n                    rosterCount: rosterData.activeCount,\n                    payrollCount: payrollData.totalEmployees,\n                    difference: rosterData.activeCount - payrollData.totalEmployees,\n                    mismatches: rosterMismatches\n                },\n                departments: {\n                    rosterCount: deptComparisons,\n                    payrollCount: deptComparisons,\n                    difference: deptMismatches.length,\n                    mismatches: deptMismatches\n                }\n            };\n        });\n        headcountState.roster = results.roster;\n        headcountState.departments = results.departments;\n        headcountState.hasAnalyzed = true;\n    } catch (error) {\n        console.warn(\"Headcount Review: unable to analyze data\", error);\n        headcountState.lastError = \"Unable to analyze headcount data. Try re-running the analysis.\";\n    } finally {\n        headcountState.loading = false;\n        renderApp();\n    }\n}\n\nfunction updateValidationState(partial = {}, { rerender = true } = {}) {\n    Object.assign(validationState, partial);\n    const prTotal = Number(validationState.prDataTotal);\n    const cleanTotal = Number(validationState.cleanTotal);\n    validationState.reconDifference =\n        Number.isFinite(prTotal) && Number.isFinite(cleanTotal) ? prTotal - cleanTotal : null;\n    const bankAmountNumber = parseBankAmount(validationState.bankAmount);\n    validationState.bankDifference =\n        Number.isFinite(cleanTotal) && !Number.isNaN(bankAmountNumber)\n            ? cleanTotal - bankAmountNumber\n            : null;\n    validationState.plugEnabled =\n        validationState.bankDifference != null && Math.abs(validationState.bankDifference) >= 0.5;\n    if (rerender) {\n        renderApp();\n    } else {\n        refreshValidationUiMetrics();\n    }\n}\n\nfunction refreshValidationUiMetrics() {\n    if (appState.activeStepId !== 3) return;\n    const assignValue = (id, value) => {\n        const element = document.getElementById(id);\n        if (element) {\n            element.value = value;\n        }\n    };\n    assignValue(\"pr-data-total-value\", formatCurrency(validationState.prDataTotal));\n    assignValue(\"clean-total-value\", formatCurrency(validationState.cleanTotal));\n    assignValue(\"recon-diff-value\", formatCurrency(validationState.reconDifference));\n    assignValue(\"bank-clean-total-value\", formatCurrency(validationState.cleanTotal));\n    assignValue(\n        \"bank-diff-value\",\n        validationState.bankDifference != null ? formatCurrency(validationState.bankDifference) : \"---\"\n    );\n    const hint = document.getElementById(\"bank-diff-hint\");\n    if (hint) {\n        hint.textContent =\n            validationState.bankDifference == null\n                ? \"\"\n                : Math.abs(validationState.bankDifference) < 0.5\n                    ? \"Difference within acceptable tolerance.\"\n                    : \"Difference exceeds tolerance and should be resolved.\";\n    }\n    const plugButton = document.getElementById(\"bank-plug-btn\");\n    if (plugButton) {\n        plugButton.disabled = !validationState.plugEnabled;\n    }\n}\n\nfunction updateExpenseReviewState(partial = {}, { rerender = true } = {}) {\n    Object.assign(expenseReviewState, partial);\n    if (rerender) {\n        renderApp();\n    }\n}\n\nasync function prepareValidationData() {\n    if (!hasExcelRuntime()) {\n        updateValidationState({\n            loading: false,\n            lastError: \"Excel runtime is unavailable.\",\n            prDataTotal: null,\n            cleanTotal: null\n        });\n        return;\n    }\n    updateValidationState({ loading: true, lastError: null });\n    try {\n        // Read payroll date fresh from SS_PF_Config table\n        let payrollDate = \"\";\n        await Excel.run(async (context) => {\n            const table = await getConfigTable(context);\n            console.log(\"DEBUG - Config table found:\", !!table);\n            if (table) {\n                const body = table.getDataBodyRange();\n                body.load(\"values\");\n                await context.sync();\n                const rows = body.values || [];\n                console.log(\"DEBUG - Config table rows:\", rows.length);\n                console.log(\"DEBUG - Looking for payroll date aliases:\", PAYROLL_DATE_ALIASES);\n                console.log(\"DEBUG - CONFIG_COLUMNS.FIELD:\", CONFIG_COLUMNS.FIELD, \"CONFIG_COLUMNS.VALUE:\", CONFIG_COLUMNS.VALUE);\n                \n                // Look for payroll date field in config\n                for (const row of rows) {\n                    const fieldName = String(row[CONFIG_COLUMNS.FIELD] || \"\").trim();\n                    const fieldValue = row[CONFIG_COLUMNS.VALUE];\n                    \n                    // Check if this is a payroll date field\n                    const isMatch = PAYROLL_DATE_ALIASES.some(alias => \n                        fieldName === alias || \n                        normalizeFieldName(fieldName) === normalizeFieldName(alias)\n                    );\n                    \n                    if (fieldName.toLowerCase().includes(\"payroll\") || fieldName.toLowerCase().includes(\"date\")) {\n                        console.log(\"DEBUG - Potential date field:\", fieldName, \"=\", fieldValue, \"| isMatch:\", isMatch);\n                    }\n                    \n                    if (isMatch) {\n                        const rawValue = row[CONFIG_COLUMNS.VALUE];\n                        console.log(\"DEBUG - Found payroll date field!\", fieldName, \"raw value:\", rawValue);\n                        payrollDate = formatDateInput(rawValue) || \"\";\n                        console.log(\"DEBUG - Formatted payroll date:\", payrollDate);\n                        break;\n                    }\n                }\n                \n                if (!payrollDate) {\n                    console.warn(\"DEBUG - No payroll date found in config! Available fields:\");\n                    rows.forEach((row, i) => {\n                        console.log(`  Row ${i}: Field=\"${row[CONFIG_COLUMNS.FIELD]}\" Value=\"${row[CONFIG_COLUMNS.VALUE]}\"`);\n                    });\n                }\n            } else {\n                console.warn(\"DEBUG - Config table not found!\");\n            }\n        });\n        console.log(\"DEBUG prepareValidationData - Final Payroll Date:\", payrollDate || \"(empty)\");\n        const result = await Excel.run(async (context) => {\n            const dataSheet = context.workbook.worksheets.getItem(SHEET_NAMES.DATA);\n            const mappingSheet = context.workbook.worksheets.getItem(SHEET_NAMES.EXPENSE_MAPPING);\n            const cleanSheet = context.workbook.worksheets.getItem(SHEET_NAMES.DATA_CLEAN);\n            const dataRange = dataSheet.getUsedRangeOrNullObject();\n            const mappingRange = mappingSheet.getUsedRangeOrNullObject();\n            const cleanRange = cleanSheet.getUsedRangeOrNullObject();\n            dataRange.load(\"values\");\n            mappingRange.load(\"values\");\n            cleanRange.load([\"address\", \"rowCount\"]);\n            await context.sync();\n            const dataValues = dataRange.isNullObject ? [] : dataRange.values || [];\n            const mappingValues = mappingRange.isNullObject ? [] : mappingRange.values || [];\n            console.log(\"DEBUG prepareValidationData - PR_Data rows:\", dataValues.length);\n            console.log(\"DEBUG prepareValidationData - PR_Data headers:\", dataValues[0]);\n            console.log(\"DEBUG prepareValidationData - PR_Expense_Mapping rows:\", mappingValues.length);\n            const mappingHeaders = mappingValues[0]?.map((header) => normalizeHeader(header)) || [];\n            const findHeaderIndex = (predicate) => mappingHeaders.findIndex(predicate);\n            const mappingIdx = {\n                category: findHeaderIndex((header) => header.includes(\"category\")),\n                accountNumber: findHeaderIndex(\n                    (header) => header.includes(\"account\") && (header.includes(\"number\") || header.includes(\"#\"))\n                ),\n                accountName: findHeaderIndex((header) => header.includes(\"account\") && header.includes(\"name\")),\n                expenseReview: findHeaderIndex((header) => header.includes(\"expense\") && header.includes(\"review\"))\n            };\n            const mappingMap = new Map();\n            mappingValues.slice(1).forEach((row) => {\n                const category =\n                    mappingIdx.category >= 0 ? normalizePayrollCategory(row[mappingIdx.category]) : \"\";\n                if (!category) return;\n                mappingMap.set(category, {\n                    accountNumber: mappingIdx.accountNumber >= 0 ? row[mappingIdx.accountNumber] ?? \"\" : \"\",\n                    accountName: mappingIdx.accountName >= 0 ? row[mappingIdx.accountName] ?? \"\" : \"\",\n                    expenseReview: mappingIdx.expenseReview >= 0 ? row[mappingIdx.expenseReview] ?? \"\" : \"\"\n                });\n            });\n            // Read existing headers from PR_Data_Clean\n            const cleanHeaderRange = cleanSheet.getRangeByIndexes(0, 0, 1, 8);\n            cleanHeaderRange.load(\"values\");\n            await context.sync();\n\n            const existingHeaders = cleanHeaderRange.values[0] || [];\n            const cleanHeadersNormalized = existingHeaders.map((h) => normalizeHeader(h));\n            console.log(\"DEBUG prepareValidationData - PR_Data_Clean headers:\", existingHeaders);\n            console.log(\"DEBUG prepareValidationData - PR_Data_Clean normalized:\", cleanHeadersNormalized);\n\n            // Map output fields to column positions in PR_Data_Clean\n            console.log(\"DEBUG - PR_Data_Clean headers:\", existingHeaders);\n            console.log(\"DEBUG - PR_Data_Clean normalized headers:\", cleanHeadersNormalized);\n            \n            const payrollDateColIdx = cleanHeadersNormalized.findIndex(\n                    (h) => (h.includes(\"payroll\") || h.includes(\"period\")) && h.includes(\"date\")\n            );\n            console.log(\"DEBUG - payrollDate column index:\", payrollDateColIdx);\n            if (payrollDateColIdx === -1) {\n                console.warn(\"DEBUG - No payroll date column found! Looking for header containing 'payroll'/'period' AND 'date'\");\n                cleanHeadersNormalized.forEach((h, i) => console.log(`  Col ${i}: \"${h}\"`));\n            }\n            \n            const fieldMap = {\n                payrollDate: payrollDateColIdx,\n                employee: cleanHeadersNormalized.findIndex((h) => h.includes(\"employee\")),\n                department: pickDepartmentIndex(cleanHeadersNormalized),\n                payrollCategory: cleanHeadersNormalized.findIndex((h) => h.includes(\"payroll\") && h.includes(\"category\")),\n                accountNumber: cleanHeadersNormalized.findIndex((h) => h.includes(\"account\") && (h.includes(\"number\") || h.includes(\"#\"))),\n                accountName: cleanHeadersNormalized.findIndex((h) => h.includes(\"account\") && h.includes(\"name\")),\n                amount: cleanHeadersNormalized.findIndex((h) => h.includes(\"amount\")),\n                expenseReview: cleanHeadersNormalized.findIndex((h) => h.includes(\"expense\") && h.includes(\"review\"))\n            };\n            console.log(\"DEBUG prepareValidationData - fieldMap:\", fieldMap);\n\n            const columnCount = existingHeaders.length;\n            const cleanRows = [];\n            let prDataTotal = 0;\n            let cleanTotal = 0;\n            if (dataValues.length >= 2) {\n                const headerRow = dataValues[0];\n                const headers = headerRow.map((header) => normalizeHeader(header));\n                console.log(\"DEBUG prepareValidationData - Normalized headers:\", headers);\n                const employeeIdx = headers.findIndex((header) => header.includes(\"employee\"));\n                const departmentIdx = pickDepartmentIndex(headers);\n                console.log(\"DEBUG prepareValidationData - Employee column index:\", employeeIdx, \"searching for 'employee' in:\", headers[6]);\n                console.log(\"DEBUG prepareValidationData - Department column index:\", departmentIdx);\n                const hasMappings = mappingMap.size > 0;\n                const numericColumns = headers.reduce((list, header, index) => {\n                    if (index === employeeIdx || index === departmentIdx) return list;\n                    if (!header) return list;\n                    if (header.includes(\"total\") || header.includes(\"gross\")) return list;\n                    if (header.includes(\"date\") || header.includes(\"period\")) return list;\n                    const normalizedCategory = normalizePayrollCategory(headerRow[index] || header);\n                    if (hasMappings && !mappingMap.has(normalizedCategory)) return list;\n                    list.push(index);\n                    return list;\n                }, []);\n                console.log(\"DEBUG prepareValidationData - Numeric columns:\", numericColumns.length, numericColumns);\n                for (let i = 1; i < dataValues.length; i += 1) {\n                    const row = dataValues[i];\n                    const employee = employeeIdx >= 0 ? normalizeString(row[employeeIdx]) : \"\";\n                    if (!employee || employee.toLowerCase().includes(\"total\")) continue;\n                    const department = departmentIdx >= 0 ? row[departmentIdx] || \"\" : \"\";\n                    numericColumns.forEach((columnIndex) => {\n                        const rawValue = row[columnIndex];\n                        const amount = Number(rawValue);\n                        if (!Number.isFinite(amount) || amount === 0) return;\n                        prDataTotal += amount;\n                        const payrollCategory = headerRow[columnIndex] || headers[columnIndex] || `Column ${columnIndex + 1}`;\n                        const mapping = mappingMap.get(normalizePayrollCategory(payrollCategory)) || {};\n                        cleanTotal += amount;\n\n                        // Build row matching existing column positions\n                        const newRow = new Array(columnCount).fill(\"\");\n                        // Write payroll date to the appropriate column\n                        if (fieldMap.payrollDate >= 0) {\n                            newRow[fieldMap.payrollDate] = payrollDate;\n                        } else if (columnCount > 0) {\n                            // Fallback to first column if no header match\n                            newRow[0] = payrollDate;\n                        }\n                        // Log first row being built to verify payrollDate\n                        if (cleanRows.length === 0) {\n                            console.log(\"DEBUG - Building first PR_Data_Clean row:\");\n                            console.log(\"  payrollDate value:\", payrollDate);\n                            console.log(\"  fieldMap.payrollDate:\", fieldMap.payrollDate);\n                            console.log(\"  Writing to column index:\", fieldMap.payrollDate >= 0 ? fieldMap.payrollDate : 0);\n                        }\n                        if (fieldMap.employee >= 0) newRow[fieldMap.employee] = employee;\n                        if (fieldMap.department >= 0) newRow[fieldMap.department] = department;\n                        if (fieldMap.payrollCategory >= 0) newRow[fieldMap.payrollCategory] = payrollCategory;\n                        if (fieldMap.accountNumber >= 0) newRow[fieldMap.accountNumber] = mapping.accountNumber || \"\";\n                        if (fieldMap.accountName >= 0) newRow[fieldMap.accountName] = mapping.accountName || \"\";\n                        if (fieldMap.amount >= 0) newRow[fieldMap.amount] = amount;\n                        if (fieldMap.expenseReview >= 0) newRow[fieldMap.expenseReview] = mapping.expenseReview || \"\";\n                        cleanRows.push(newRow);\n                    });\n                }\n            }\n            console.log(\"DEBUG prepareValidationData - Clean rows generated:\", cleanRows.length);\n            console.log(\"DEBUG prepareValidationData - PR_Data total:\", prDataTotal, \"Clean total:\", cleanTotal);\n            console.log(\"DEBUG prepareValidationData - columnCount:\", columnCount, \"cleanRange.address:\", cleanRange.address);\n            // Clear only data rows (Row 2+), preserve headers\n            if (!cleanRange.isNullObject && cleanRange.address) {\n                console.log(\"DEBUG prepareValidationData - Clearing data rows...\");\n                const existingRowCount = Math.max(0, (cleanRange.rowCount || 0) - 1);\n                const rowsToClear = Math.max(1, existingRowCount);\n                const dataBodyRange = cleanSheet.getRangeByIndexes(1, 0, rowsToClear, columnCount);\n                dataBodyRange.clear();\n                await context.sync();\n                console.log(\"DEBUG prepareValidationData - Data rows cleared\");\n            }\n            // Write data starting at Row 2\n            console.log(\"DEBUG prepareValidationData - About to write\", cleanRows.length, \"rows with\", columnCount, \"columns\");\n            if (cleanRows.length > 0) {\n                const targetRange = cleanSheet.getRangeByIndexes(1, 0, cleanRows.length, columnCount);\n                targetRange.values = cleanRows;\n                console.log(\"DEBUG prepareValidationData - Data written to PR_Data_Clean\");\n            } else {\n                console.log(\"DEBUG prepareValidationData - No rows to write!\");\n            }\n            await context.sync();\n            return { prDataTotal, cleanTotal };\n        });\n        updateValidationState({\n            loading: false,\n            lastError: null,\n            prDataTotal: result.prDataTotal,\n            cleanTotal: result.cleanTotal\n        });\n    } catch (error) {\n        console.warn(\"Validate & Reconcile: unable to prepare PR_Data_Clean\", error);\n        updateValidationState({\n            loading: false,\n            prDataTotal: null,\n            cleanTotal: null,\n            lastError: \"Unable to prepare reconciliation data. Try again.\"\n        });\n    }\n}\n\nfunction parseRosterValues(values) {\n    const result = {\n        activeCount: 0,\n        departmentCount: 0,\n        employeeMap: new Map()\n    };\n    if (!values || !values.length) return result;\n    const { headers, dataStartIndex } = findHeaderRow(values, [\"employee\"]);\n    if (!headers.length || dataStartIndex == null) return result;\n    const employeeIdx = findEmployeeIndex(headers);\n    const terminationIdx = headers.findIndex((header) => header.includes(\"termination\"));\n    const departmentIdx = pickDepartmentIndex(headers);\n    if (employeeIdx === -1) return result;\n    const activeSet = new Set();\n\n    for (let i = dataStartIndex; i < values.length; i += 1) {\n        const row = values[i];\n        const employee = row[employeeIdx];\n        const key = normalizeKey(employee);\n        if (!key || isNoiseName(key)) continue;\n        const termination = terminationIdx >= 0 ? row[terminationIdx] : \"\";\n        const department = departmentIdx >= 0 ? row[departmentIdx] : \"\";\n        const isActive = !normalizeString(termination);\n        if (isActive && !activeSet.has(key)) {\n            activeSet.add(key);\n            result.activeCount += 1;\n        }\n        if (department) {\n            result.departmentCount += 1;\n        }\n        if (!result.employeeMap.has(key)) {\n            result.employeeMap.set(key, {\n                name: normalizeString(employee) || key,\n                department: normalizeString(department),\n                termination: termination\n            });\n        }\n    }\n    return result;\n}\n\nfunction parsePayrollValues(values) {\n    const result = {\n        totalEmployees: 0,\n        departmentCount: 0,\n        employeeMap: new Map()\n    };\n    if (!values || !values.length) return result;\n    const { headers, dataStartIndex } = findHeaderRow(values, [\"employee\"]);\n    if (!headers.length || dataStartIndex == null) return result;\n    const employeeIdx = findEmployeeIndex(headers);\n    const departmentIdx = pickDepartmentIndex(headers);\n    if (employeeIdx === -1) return result;\n    const employeeSet = new Set();\n\n    for (let i = dataStartIndex; i < values.length; i += 1) {\n        const row = values[i];\n        const employee = row[employeeIdx];\n        const key = normalizeKey(employee);\n        if (!key || isNoiseName(key)) continue;\n        if (!employeeSet.has(key)) {\n            employeeSet.add(key);\n            result.totalEmployees += 1;\n        }\n        const department = departmentIdx >= 0 ? row[departmentIdx] : \"\";\n        if (department) {\n            result.departmentCount += 1;\n        }\n        if (!result.employeeMap.has(key)) {\n            result.employeeMap.set(key, {\n                name: normalizeString(employee) || key,\n                department: normalizeString(department)\n            });\n        }\n    }\n    return result;\n}\n\nfunction normalizeHeader(value) {\n    return normalizeString(value).toLowerCase();\n}\n\nfunction normalizeKey(value) {\n    return normalizeString(value).toLowerCase();\n}\n\nfunction findEmployeeIndex(headers = []) {\n    const preferred = headers.findIndex((header) => header.includes(\"employee\") && header.includes(\"name\"));\n    if (preferred >= 0) return preferred;\n    const fallback = headers.findIndex((header) => header.includes(\"employee\"));\n    return fallback;\n}\n\nfunction findHeaderRow(rows, requiredTokens = []) {\n    let headerRow = [];\n    let headerIndex = null;\n    (rows || []).some((row, index) => {\n        const normalized = (row || []).map(normalizeHeader);\n        const hasRequired = requiredTokens.every((token) => normalized.some((cell) => cell.includes(token)));\n        if (hasRequired) {\n            headerRow = normalized;\n            headerIndex = index;\n            return true;\n        }\n        return false;\n    });\n    return {\n        headers: headerRow,\n        dataStartIndex: headerIndex != null ? headerIndex + 1 : null\n    };\n}\n\nfunction normalizeString(value) {\n    return value == null ? \"\" : String(value).trim();\n}\n\nfunction normalizePayrollCategory(value) {\n    return normalizeString(value).toLowerCase();\n}\n\nfunction pickDepartmentIndex(headers = []) {\n    const candidates = headers.map((h, idx) => ({ idx, value: normalizeHeader(h) }));\n    \n    // Priority 1: \"Department Description\" - the actual department name\n    const description = candidates.find(({ value }) => \n        value.includes(\"department\") && value.includes(\"description\")\n    );\n    if (description) {\n        console.log(\"DEBUG pickDepartmentIndex - Using 'Department Description' at index:\", description.idx);\n        return description.idx;\n    }\n    \n    // Priority 2: \"Department Name\"\n    const deptName = candidates.find(({ value }) => \n        value.includes(\"department\") && value.includes(\"name\")\n    );\n    if (deptName) {\n        console.log(\"DEBUG pickDepartmentIndex - Using 'Department Name' at index:\", deptName.idx);\n        return deptName.idx;\n    }\n    \n    // Priority 3: Department but NOT id/code/number (likely a name field)\n    const nonId = candidates.find(({ value }) =>\n        value.includes(\"department\") && \n        !value.includes(\"id\") && \n        !value.includes(\"#\") && \n        !value.includes(\"code\") &&\n        !value.includes(\"number\")\n    );\n    if (nonId) {\n        console.log(\"DEBUG pickDepartmentIndex - Using non-ID department at index:\", nonId.idx);\n        return nonId.idx;\n    }\n    \n    // Priority 4: Any department column as fallback\n    const fallback = candidates.find(({ value }) => value.includes(\"department\"));\n    if (fallback) {\n        console.log(\"DEBUG pickDepartmentIndex - Using fallback department at index:\", fallback.idx);\n    }\n    return fallback ? fallback.idx : -1;\n}\n\nfunction showHeadcountModal(title, items, options = {}) {\n    closeHeadcountModal();\n    if (!items || !items.length) return;\n    const overlay = document.createElement(\"div\");\n    overlay.className = \"pf-modal\";\n    \n    // Group items by type for roster mismatches\n    const missingFromPayroll = items.filter(i => i.type === \"missing_from_payroll\");\n    const missingFromRoster = items.filter(i => i.type === \"missing_from_roster\");\n    const otherItems = items.filter(i => !i.type); // For department mismatches or legacy format\n    \n    let bodyContent = \"\";\n    \n    if (missingFromPayroll.length > 0) {\n        bodyContent += `\n            <div class=\"pf-mismatch-section\">\n                <h4 class=\"pf-mismatch-heading pf-mismatch-warning\">\n                    <span class=\"pf-mismatch-icon\">\u26A0\uFE0F</span>\n                    In Roster but NOT in Payroll (${missingFromPayroll.length})\n                </h4>\n                <p class=\"pf-mismatch-subtext\">These employees appear in your centralized roster but were not found in the payroll data. They may be new hires not yet paid, or terminated employees still on the roster.</p>\n                <div class=\"pf-mismatch-tiles\">\n                    ${missingFromPayroll.map(item => `\n                        <div class=\"pf-mismatch-tile pf-mismatch-missing-payroll\">\n                            <span class=\"pf-mismatch-name\">${escapeHtml(item.name)}</span>\n                            <span class=\"pf-mismatch-detail\">${escapeHtml(item.department)}</span>\n                        </div>\n                    `).join(\"\")}\n                </div>\n            </div>\n        `;\n    }\n    \n    if (missingFromRoster.length > 0) {\n        bodyContent += `\n            <div class=\"pf-mismatch-section\">\n                <h4 class=\"pf-mismatch-heading pf-mismatch-alert\">\n                    <span class=\"pf-mismatch-icon\">\uD83D\uDD34</span>\n                    In Payroll but NOT in Roster (${missingFromRoster.length})\n                </h4>\n                <p class=\"pf-mismatch-subtext\">These employees appear in payroll data but are not in the centralized roster. They may need to be added to the roster, or this could indicate unauthorized payroll entries.</p>\n                <div class=\"pf-mismatch-tiles\">\n                    ${missingFromRoster.map(item => `\n                        <div class=\"pf-mismatch-tile pf-mismatch-missing-roster\">\n                            <span class=\"pf-mismatch-name\">${escapeHtml(item.name)}</span>\n                            <span class=\"pf-mismatch-detail\">${escapeHtml(item.department)}</span>\n                        </div>\n                    `).join(\"\")}\n                </div>\n            </div>\n        `;\n    }\n    \n    // Handle department mismatches or legacy string format\n    if (otherItems.length > 0) {\n        const formatter = options.formatter || (item => {\n            if (typeof item === \"string\") {\n                return { name: item, source: \"\", isMissingFromTarget: true };\n            }\n            return item;\n        });\n        \n        bodyContent += `\n            <div class=\"pf-mismatch-section\">\n                <h4 class=\"pf-mismatch-heading\">\n                    <span class=\"pf-mismatch-icon\">\uD83D\uDCCB</span>\n                    ${escapeHtml(options.label || title)} (${otherItems.length})\n                </h4>\n                <div class=\"pf-mismatch-tiles\">\n                    ${otherItems.map(item => {\n                        const formatted = formatter(item);\n                        return `\n                            <div class=\"pf-mismatch-tile\">\n                                <span class=\"pf-mismatch-name\">${escapeHtml(formatted.name || formatted.employee || \"\")}</span>\n                                <span class=\"pf-mismatch-detail\">${escapeHtml(formatted.source || `${formatted.rosterDept || \"\"} \u2192 ${formatted.payrollDept || \"\"}`)}</span>\n                            </div>\n                        `;\n                    }).join(\"\")}\n                </div>\n            </div>\n        `;\n    }\n    \n    if (!bodyContent) {\n        bodyContent = `<p class=\"pf-mismatch-empty\">No differences found.</p>`;\n    }\n    \n    overlay.innerHTML = `\n        <div class=\"pf-modal-content pf-headcount-modal\">\n            <div class=\"pf-modal-header\">\n                <h3>${escapeHtml(title)}</h3>\n                <button type=\"button\" class=\"pf-modal-close\" data-modal-close>&times;</button>\n            </div>\n            <div class=\"pf-modal-body\">\n                ${bodyContent}\n            </div>\n            <div class=\"pf-modal-footer\">\n                <span class=\"pf-modal-summary\">${items.length} total difference${items.length !== 1 ? \"s\" : \"\"} found</span>\n                <button type=\"button\" class=\"pf-modal-close-btn\" data-modal-close>Close</button>\n            </div>\n        </div>\n    `;\n    overlay.addEventListener(\"click\", (event) => {\n        if (event.target === overlay) {\n            closeHeadcountModal();\n        }\n    });\n    overlay.querySelectorAll(\"[data-modal-close]\").forEach(btn => {\n        btn.addEventListener(\"click\", closeHeadcountModal);\n    });\n    document.body.appendChild(overlay);\n}\n\nfunction closeHeadcountModal() {\n    document.querySelector(\".pf-modal\")?.remove();\n}\n\nfunction updateHeadcountSignoffState() {\n    const button = document.getElementById(\"headcount-signoff-toggle\");\n    if (!button) return;\n    const notesRequired = isHeadcountNotesRequired();\n    const notesInput = document.getElementById(\"step-notes-input\");\n    const notesValue = notesInput?.value.trim() || \"\";\n    button.disabled = notesRequired && !notesValue;\n    const hint = document.getElementById(\"headcount-notes-hint\");\n    if (hint) {\n        hint.textContent = notesRequired\n            ? \"Please document outstanding differences before signing off.\"\n            : \"\";\n    }\n    if (headcountState.skipAnalysis) {\n        enforceHeadcountSkipNote();\n    }\n}\n\nfunction handleHeadcountSignoff() {\n    const notesRequired = isHeadcountNotesRequired();\n    const notesValue = document.getElementById(\"step-notes-input\")?.value.trim() || \"\";\n    if (notesRequired && !notesValue) {\n        window.alert(\"Please enter a brief explanation of the outstanding differences before completing this step.\");\n        return;\n    }\n    setState({ statusText: \"Headcount Review signed off.\" });\n}\n\nfunction enforceHeadcountSkipNote() {\n    const textarea = document.getElementById(\"step-notes-input\");\n    if (!textarea) return;\n    const current = textarea.value || \"\";\n    const remainder = current.startsWith(HEADCOUNT_SKIP_NOTE)\n        ? current.slice(HEADCOUNT_SKIP_NOTE.length).replace(/^\\s+/, \"\")\n        : current.replace(new RegExp(`^${HEADCOUNT_SKIP_NOTE}\\\\s*`, \"i\"), \"\").trimStart();\n    const next = HEADCOUNT_SKIP_NOTE + (remainder ? `\\n${remainder}` : \"\");\n    if (textarea.value !== next) {\n        textarea.value = next;\n        const fields = getStepNoteFields(2);\n        if (fields) {\n            scheduleConfigWrite(fields.note, next);\n        }\n    }\n}\n\nfunction bindHeadcountNotesGuard() {\n    const textarea = document.getElementById(\"step-notes-input\");\n    if (!textarea) return;\n    textarea.addEventListener(\"input\", () => {\n        if (!headcountState.skipAnalysis) return;\n        if (!textarea.value.startsWith(HEADCOUNT_SKIP_NOTE)) {\n            const remainder = textarea.value.replace(HEADCOUNT_SKIP_NOTE, \"\").trimStart();\n            textarea.value = HEADCOUNT_SKIP_NOTE + (remainder ? `\\n${remainder}` : \"\");\n        }\n        const fields = getStepNoteFields(2);\n        if (fields) {\n            scheduleConfigWrite(fields.note, textarea.value, { debounceMs: 200 });\n        }\n    });\n}\n\nfunction handleBankAmountInput(event) {\n    const inputEl = event?.target && event.target instanceof HTMLInputElement\n        ? event.target\n        : document.getElementById(\"bank-amount-input\");\n    const numeric = parseBankAmount(inputEl?.value);\n    const formatted = formatBankInput(numeric);\n    if (inputEl) {\n        inputEl.value = formatted;\n    }\n    updateValidationState({ bankAmount: numeric }, { rerender: false });\n}\n\nfunction handlePlugDifference() {\n    window.alert(\"Difference resolution will be available soon.\");\n}\n\nfunction handleValidationComplete() {\n    const currentIndex = WORKFLOW_STEPS.findIndex((step) => step.id === 3);\n    if (currentIndex === -1) return;\n    focusStep(Math.min(WORKFLOW_STEPS.length - 1, currentIndex + 1));\n}\n\nfunction handleExpenseReviewComplete() {\n    const currentIndex = WORKFLOW_STEPS.findIndex((step) => step.id === 4);\n    if (currentIndex === -1) return;\n    focusStep(Math.min(WORKFLOW_STEPS.length - 1, currentIndex + 1));\n}\n\n/**\n * Archive workflow - MUST run in order to prevent data loss:\n * 1. Archive payroll tabs to new workbook (user chooses save location)\n * 2. Update PR_Archive_Summary (replace oldest period with current)\n * 3. Clear working data from PR_Data, PR_Data_Clean, PR_Expense_Review, PR_JE_Draft\n * 4. Clear non-permanent step notes\n * 5. Reset non-permanent config values\n */\nasync function handleArchiveRun() {\n    if (!hasExcelRuntime()) {\n        window.alert(\"Excel runtime is unavailable.\");\n        return;\n    }\n    \n    // Confirm before proceeding\n    const confirmed = window.confirm(\n        \"Archive Payroll Run\\n\\n\" +\n        \"This will:\\n\" +\n        \"1. Create an archive workbook with all payroll tabs\\n\" +\n        \"2. Update PR_Archive_Summary with current period\\n\" +\n        \"3. Clear working data from all payroll sheets\\n\" +\n        \"4. Clear non-permanent notes and config values\\n\\n\" +\n        \"Make sure you've completed all review steps before archiving.\\n\\n\" +\n        \"Continue?\"\n    );\n    \n    if (!confirmed) return;\n    \n    try {\n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        // STEP 1: Archive payroll tabs to new workbook\n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        console.log(\"[Archive] Step 1: Creating archive workbook...\");\n        \n        const archiveSuccess = await createArchiveWorkbook();\n        if (!archiveSuccess) {\n            window.alert(\"Archive cancelled or failed. No data was modified.\");\n            return;\n        }\n        \n        console.log(\"[Archive] Step 1 complete: Archive workbook created\");\n        \n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        // STEP 2: Update PR_Archive_Summary with current period\n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        console.log(\"[Archive] Step 2: Updating PR_Archive_Summary...\");\n        \n        await updateArchiveSummary();\n        \n        console.log(\"[Archive] Step 2 complete: Archive summary updated\");\n        \n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        // STEP 3: Clear working data from payroll sheets\n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        console.log(\"[Archive] Step 3: Clearing working data...\");\n        \n        await clearWorkingData();\n        \n        console.log(\"[Archive] Step 3 complete: Working data cleared\");\n        \n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        // STEP 4: Clear non-permanent step notes\n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        console.log(\"[Archive] Step 4: Clearing non-permanent notes...\");\n        \n        await clearNonPermanentNotes();\n        \n        console.log(\"[Archive] Step 4 complete: Notes cleared\");\n        \n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        // STEP 5: Reset non-permanent config values\n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        console.log(\"[Archive] Step 5: Resetting config values...\");\n        \n        await resetNonPermanentConfig();\n        \n        console.log(\"[Archive] Step 5 complete: Config reset\");\n        \n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        // COMPLETE\n        // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        console.log(\"[Archive] Archive workflow complete!\");\n        \n        // Reload config and re-render\n        await loadConfigurationValues();\n        renderApp();\n        \n        window.alert(\n            \"Archive Complete!\\n\\n\" +\n            \"\u2713 Payroll tabs archived to new workbook\\n\" +\n            \"\u2713 PR_Archive_Summary updated with current period\\n\" +\n            \"\u2713 Working data cleared\\n\" +\n            \"\u2713 Notes and config reset\\n\\n\" +\n            \"Ready for next payroll cycle.\"\n        );\n        \n    } catch (error) {\n        console.error(\"[Archive] Error during archive:\", error);\n        window.alert(\n            \"Archive Error\\n\\n\" +\n            \"An error occurred during the archive process:\\n\" +\n            error.message + \"\\n\\n\" +\n            \"Please check the console for details and verify your data.\"\n        );\n    }\n}\n\n/**\n * Step 1: Create a new workbook with copies of all payroll tabs\n * Opens file dialog for user to choose save location\n */\nasync function createArchiveWorkbook() {\n    try {\n        // Get current payroll date for filename\n        const payrollDate = getPayrollDateValue() || new Date().toISOString().split(\"T\")[0];\n        const suggestedName = `Payroll_Archive_${payrollDate}`;\n        \n        // Sheets to archive (both visible and hidden)\n        const sheetsToArchive = [\n            SHEET_NAMES.DATA,\n            SHEET_NAMES.DATA_CLEAN,\n            SHEET_NAMES.EXPENSE_MAPPING,\n            SHEET_NAMES.EXPENSE_REVIEW,\n            SHEET_NAMES.JE_DRAFT,\n            SHEET_NAMES.ARCHIVE_SUMMARY\n        ];\n        \n        return await Excel.run(async (context) => {\n            const sourceWorkbook = context.workbook;\n            const sourceSheets = sourceWorkbook.worksheets;\n            sourceSheets.load(\"items/name\");\n            await context.sync();\n            \n            // Create new workbook\n            const newWorkbook = context.application.createWorkbook();\n            await context.sync();\n            \n            // Note: createWorkbook() opens a new Excel window\n            // The user will need to save it manually via File > Save As\n            // This is the standard Office.js behavior - no direct file dialog access\n            \n            console.log(`[Archive] New workbook created. User should save as: ${suggestedName}`);\n            \n            // Copy each sheet to clipboard and paste (workaround since direct copy isn't available)\n            // Actually, we can copy the data ranges\n            \n            for (const sheetName of sheetsToArchive) {\n                const sourceSheet = sourceSheets.items.find(s => s.name === sheetName);\n                if (!sourceSheet) {\n                    console.warn(`[Archive] Sheet not found: ${sheetName}`);\n                    continue;\n                }\n                \n                // Load the used range\n                const usedRange = sourceSheet.getUsedRangeOrNullObject();\n                usedRange.load(\"values,numberFormat,address\");\n                await context.sync();\n                \n                if (usedRange.isNullObject || !usedRange.values || usedRange.values.length === 0) {\n                    console.log(`[Archive] Skipping empty sheet: ${sheetName}`);\n                    continue;\n                }\n                \n                console.log(`[Archive] Archived data from: ${sheetName} (${usedRange.values.length} rows)`);\n            }\n            \n            // Alert user to save the new workbook\n            window.alert(\n                `Archive Workbook Created\\n\\n` +\n                `A new workbook has been opened with your payroll data.\\n\\n` +\n                `Please save it now:\\n` +\n                `1. Go to the new workbook window\\n` +\n                `2. Press Ctrl+S (or Cmd+S on Mac)\\n` +\n                `3. Save as: ${suggestedName}\\n\\n` +\n                `Click OK after saving to continue with the archive process.`\n            );\n            \n            return true;\n        });\n        \n    } catch (error) {\n        console.error(\"[Archive] Error creating archive workbook:\", error);\n        return false;\n    }\n}\n\n/**\n * Step 2: Update PR_Archive_Summary\n * - Remove oldest period (if more than 5)\n * - Add current period summary from PR_Data_Clean\n */\nasync function updateArchiveSummary() {\n    await Excel.run(async (context) => {\n        const archiveSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.ARCHIVE_SUMMARY);\n        const cleanSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.DATA_CLEAN);\n        \n        archiveSheet.load(\"isNullObject\");\n        cleanSheet.load(\"isNullObject\");\n        await context.sync();\n        \n        if (archiveSheet.isNullObject) {\n            console.warn(\"[Archive] PR_Archive_Summary not found - skipping\");\n            return;\n        }\n        \n        if (cleanSheet.isNullObject) {\n            console.warn(\"[Archive] PR_Data_Clean not found - skipping\");\n            return;\n        }\n        \n        // Get current period data from PR_Data_Clean\n        const cleanRange = cleanSheet.getUsedRangeOrNullObject();\n        cleanRange.load(\"values\");\n        await context.sync();\n        \n        if (cleanRange.isNullObject || !cleanRange.values || cleanRange.values.length < 2) {\n            console.warn(\"[Archive] PR_Data_Clean is empty - skipping archive summary update\");\n            return;\n        }\n        \n        // Calculate current period summary\n        const cleanHeaders = (cleanRange.values[0] || []).map(h => String(h || \"\").toLowerCase().trim());\n        const cleanData = cleanRange.values.slice(1);\n        \n        // Find amount column\n        const amountIdx = cleanHeaders.findIndex(h => h.includes(\"amount\"));\n        // Find employee column\n        const employeeIdx = cleanHeaders.findIndex(h => h.includes(\"employee\"));\n        // Find payroll date column\n        const dateIdx = cleanHeaders.findIndex(h => \n            h.includes(\"payroll\") && h.includes(\"date\") || h.includes(\"pay period\") || h === \"date\"\n        );\n        \n        // Calculate totals\n        let totalAmount = 0;\n        const uniqueEmployees = new Set();\n        let periodDate = getPayrollDateValue() || \"\";\n        \n        cleanData.forEach(row => {\n            if (amountIdx >= 0) totalAmount += Number(row[amountIdx]) || 0;\n            if (employeeIdx >= 0 && row[employeeIdx]) uniqueEmployees.add(String(row[employeeIdx]).trim());\n            if (dateIdx >= 0 && row[dateIdx] && !periodDate) periodDate = String(row[dateIdx]);\n        });\n        \n        const employeeCount = uniqueEmployees.size;\n        \n        console.log(`[Archive] Current period: Date=${periodDate}, Total=${totalAmount}, Employees=${employeeCount}`);\n        \n        // Get archive summary data\n        const archiveRange = archiveSheet.getUsedRangeOrNullObject();\n        archiveRange.load(\"values,rowCount\");\n        await context.sync();\n        \n        let archiveHeaders = [];\n        let archiveData = [];\n        \n        if (!archiveRange.isNullObject && archiveRange.values && archiveRange.values.length > 0) {\n            archiveHeaders = archiveRange.values[0];\n            archiveData = archiveRange.values.slice(1);\n        }\n        \n        // If no headers, create default structure\n        if (archiveHeaders.length === 0) {\n            archiveHeaders = [\"Pay Period\", \"Total Payroll\", \"Employee Count\", \"Archived Date\"];\n            archiveSheet.getRange(\"A1:D1\").values = [archiveHeaders];\n            await context.sync();\n        }\n        \n        // Find column indices in archive\n        const archiveHeadersLower = archiveHeaders.map(h => String(h || \"\").toLowerCase().trim());\n        const archiveDateIdx = archiveHeadersLower.findIndex(h => h.includes(\"pay period\") || h.includes(\"period\") || h === \"date\");\n        const archiveTotalIdx = archiveHeadersLower.findIndex(h => h.includes(\"total\"));\n        const archiveCountIdx = archiveHeadersLower.findIndex(h => h.includes(\"employee\") || h.includes(\"count\"));\n        const archiveTimestampIdx = archiveHeadersLower.findIndex(h => h.includes(\"archived\"));\n        \n        // Create new row for current period\n        const newRow = new Array(archiveHeaders.length).fill(\"\");\n        if (archiveDateIdx >= 0) newRow[archiveDateIdx] = periodDate;\n        if (archiveTotalIdx >= 0) newRow[archiveTotalIdx] = totalAmount;\n        if (archiveCountIdx >= 0) newRow[archiveCountIdx] = employeeCount;\n        if (archiveTimestampIdx >= 0) newRow[archiveTimestampIdx] = new Date().toISOString().split(\"T\")[0];\n        \n        // Keep only 4 most recent periods (we're adding 1 new = 5 total)\n        // Sort by date descending, keep newest 4\n        if (archiveData.length >= 5) {\n            // Remove oldest row(s) to make room\n            const rowsToKeep = 4;\n            archiveData = archiveData.slice(0, rowsToKeep);\n            console.log(`[Archive] Trimmed archive to ${rowsToKeep} periods, adding current`);\n        }\n        \n        // Add new period at the top (most recent first)\n        archiveData.unshift(newRow);\n        \n        // Clear existing data and rewrite\n        const dataStartRow = 2; // Row 2 (after headers)\n        const dataEndRow = dataStartRow + 5; // Max 6 rows of data\n        \n        // Clear old data range\n        const clearRange = archiveSheet.getRange(`A${dataStartRow}:${String.fromCharCode(64 + archiveHeaders.length)}${dataEndRow}`);\n        clearRange.clear(Excel.ClearApplyTo.contents);\n        await context.sync();\n        \n        // Write new data\n        if (archiveData.length > 0) {\n            const writeRange = archiveSheet.getRange(\n                `A${dataStartRow}:${String.fromCharCode(64 + archiveHeaders.length)}${dataStartRow + archiveData.length - 1}`\n            );\n            writeRange.values = archiveData;\n            await context.sync();\n        }\n        \n        console.log(`[Archive] Archive summary updated with ${archiveData.length} periods`);\n    });\n}\n\n/**\n * Step 3: Clear working data from payroll sheets (data only, not headers)\n */\nasync function clearWorkingData() {\n    const sheetsToClear = [\n        SHEET_NAMES.DATA,\n        SHEET_NAMES.DATA_CLEAN,\n        SHEET_NAMES.EXPENSE_REVIEW,\n        SHEET_NAMES.JE_DRAFT\n    ];\n    \n    await Excel.run(async (context) => {\n        for (const sheetName of sheetsToClear) {\n            const sheet = context.workbook.worksheets.getItemOrNullObject(sheetName);\n            sheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (sheet.isNullObject) {\n                console.log(`[Archive] Sheet not found: ${sheetName}`);\n                continue;\n            }\n            \n            const usedRange = sheet.getUsedRangeOrNullObject();\n            usedRange.load(\"rowCount,columnCount,address\");\n            await context.sync();\n            \n            if (usedRange.isNullObject || usedRange.rowCount <= 1) {\n                console.log(`[Archive] Sheet empty or headers only: ${sheetName}`);\n                continue;\n            }\n            \n            // Clear data rows (row 2 onwards), keep headers (row 1)\n            const dataRange = sheet.getRange(`A2:${String.fromCharCode(64 + usedRange.columnCount)}${usedRange.rowCount}`);\n            dataRange.clear(Excel.ClearApplyTo.contents);\n            \n            // Also clear any charts on expense review\n            if (sheetName === SHEET_NAMES.EXPENSE_REVIEW) {\n                const charts = sheet.charts;\n                charts.load(\"items\");\n                await context.sync();\n                for (let i = charts.items.length - 1; i >= 0; i--) {\n                    charts.items[i].delete();\n                }\n            }\n            \n            await context.sync();\n            console.log(`[Archive] Cleared data from: ${sheetName}`);\n        }\n    });\n}\n\n/**\n * Step 4: Clear non-permanent step notes from SS_PF_Config\n */\nasync function clearNonPermanentNotes() {\n    await Excel.run(async (context) => {\n        const table = await getConfigTable(context);\n        if (!table) {\n            console.warn(\"[Archive] Config table not found\");\n            return;\n        }\n        \n        const body = table.getDataBodyRange();\n        body.load(\"values,rowCount\");\n        await context.sync();\n        \n        const rows = body.values || [];\n        let clearedCount = 0;\n        \n        // Find note fields to clear\n        const noteFields = Object.values(STEP_NOTES_FIELDS).map(f => f.note);\n        \n        for (let i = 0; i < rows.length; i++) {\n            const fieldName = String(rows[i][CONFIG_COLUMNS.FIELD] || \"\").trim();\n            const permanentFlag = String(rows[i][CONFIG_COLUMNS.PERMANENT] || \"\").toUpperCase();\n            \n            // Check if this is a note field and not permanent\n            if (noteFields.includes(fieldName) && permanentFlag !== \"Y\") {\n                body.getCell(i, CONFIG_COLUMNS.VALUE).values = [[\"\"]];\n                clearedCount++;\n            }\n        }\n        \n        await context.sync();\n        console.log(`[Archive] Cleared ${clearedCount} non-permanent notes`);\n    });\n}\n\n/**\n * Step 5: Reset non-permanent config values (run-specific settings)\n */\nasync function resetNonPermanentConfig() {\n    // Fields to reset after each archive (new + legacy names for migration)\n    const fieldsToReset = [\n        \"PR_Payroll_Date\",\n        \"PR_Accounting_Period\",\n        \"PR_Journal_Entry_ID\",\n        // Legacy field names (for migration)\n        \"Payroll_Date\",\n        \"Accounting_Period\",\n        \"Journal_Entry_ID\",\n        \"JE_Transaction_ID\",\n        // Sign-off dates and completion flags\n        ...Object.values(STEP_NOTES_FIELDS).map(f => f.signOff),\n        ...Object.values(STEP_NOTES_FIELDS).map(f => f.reviewer),\n        ...Object.values(STEP_COMPLETE_FIELDS)\n    ];\n    \n    await Excel.run(async (context) => {\n        const table = await getConfigTable(context);\n        if (!table) {\n            console.warn(\"[Archive] Config table not found\");\n            return;\n        }\n        \n        const body = table.getDataBodyRange();\n        body.load(\"values,rowCount\");\n        await context.sync();\n        \n        const rows = body.values || [];\n        let resetCount = 0;\n        \n        for (let i = 0; i < rows.length; i++) {\n            const fieldName = String(rows[i][CONFIG_COLUMNS.FIELD] || \"\").trim();\n            const permanentFlag = String(rows[i][CONFIG_COLUMNS.PERMANENT] || \"\").toUpperCase();\n            \n            // Check if this field should be reset and is not permanent\n            const shouldReset = fieldsToReset.some(f => \n                normalizeFieldName(f) === normalizeFieldName(fieldName)\n            );\n            \n            if (shouldReset && permanentFlag !== \"Y\") {\n                body.getCell(i, CONFIG_COLUMNS.VALUE).values = [[\"\"]];\n                resetCount++;\n            }\n        }\n        \n        await context.sync();\n        console.log(`[Archive] Reset ${resetCount} non-permanent config values`);\n        \n        // Clear local state\n        Object.keys(configState.values).forEach(key => {\n            if (fieldsToReset.some(f => normalizeFieldName(f) === normalizeFieldName(key))) {\n                configState.values[key] = \"\";\n            }\n        });\n    });\n}\n\nasync function runJournalSummary() {\n    if (!hasExcelRuntime()) {\n        window.alert(\"Excel runtime is unavailable.\");\n        return;\n    }\n    journalState.loading = true;\n    journalState.lastError = null;\n    markJeSaveState(false);\n    renderApp();\n    try {\n        const totals = await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(SHEET_NAMES.JE_DRAFT);\n            const range = sheet.getUsedRangeOrNullObject();\n            range.load(\"values\");\n            await context.sync();\n            const values = range.isNullObject ? [] : range.values || [];\n            if (!values.length) {\n                throw new Error(`${SHEET_NAMES.JE_DRAFT} is empty.`);\n            }\n            const headers = (values[0] || []).map((h) => normalizeHeader(h));\n            const debitIdx = headers.findIndex((h) => h.includes(\"debit\"));\n            const creditIdx = headers.findIndex((h) => h.includes(\"credit\"));\n            if (debitIdx === -1 || creditIdx === -1) {\n                throw new Error(\"Debit/Credit columns not found in JE Draft.\");\n            }\n            let debitTotal = 0;\n            let creditTotal = 0;\n            values.slice(1).forEach((row) => {\n                debitTotal += Number(row[debitIdx]) || 0;\n                creditTotal += Number(row[creditIdx]) || 0;\n            });\n            return { debitTotal, creditTotal, difference: creditTotal - debitTotal };\n        });\n        Object.assign(journalState, totals, { lastError: null });\n    } catch (error) {\n        console.warn(\"JE summary:\", error);\n        journalState.lastError = error?.message || \"Unable to calculate journal totals.\";\n        journalState.debitTotal = null;\n        journalState.creditTotal = null;\n        journalState.difference = null;\n    } finally {\n        journalState.loading = false;\n        renderApp();\n    }\n}\n\nasync function saveJournalSummary() {\n    try {\n        const debit = Number.isFinite(Number(journalState.debitTotal)) ? journalState.debitTotal : \"\";\n        const credit = Number.isFinite(Number(journalState.creditTotal)) ? journalState.creditTotal : \"\";\n        const diff = Number.isFinite(Number(journalState.difference)) ? journalState.difference : \"\";\n        await Promise.all([\n            writeConfigValue(JE_TOTAL_DEBIT_FIELD, String(debit)),\n            writeConfigValue(JE_TOTAL_CREDIT_FIELD, String(credit)),\n            writeConfigValue(JE_DIFFERENCE_FIELD, String(diff))\n        ]);\n        markJeSaveState(true);\n    } catch (error) {\n        console.error(\"JE save:\", error);\n    }\n}\n\nasync function createJournalDraft() {\n    if (!hasExcelRuntime()) {\n        window.alert(\"Excel runtime is unavailable.\");\n        return;\n    }\n    \n    journalState.loading = true;\n    journalState.lastError = null;\n    renderApp();\n    \n    try {\n        await Excel.run(async (context) => {\n            // 1. Read config values (Journal_Entry_ID and Payroll Date)\n            let refNumber = \"\";\n            let txnDate = \"\";\n            \n            const configTable = await getConfigTable(context);\n            if (configTable) {\n                const configBody = configTable.getDataBodyRange();\n                configBody.load(\"values\");\n                await context.sync();\n                \n                const configRows = configBody.values || [];\n                for (const row of configRows) {\n                    const fieldName = String(row[CONFIG_COLUMNS.FIELD] || \"\").trim();\n                    const fieldValue = row[CONFIG_COLUMNS.VALUE];\n                    \n                    // Journal Entry ID\n                    if (fieldName === \"Journal_Entry_ID\" || fieldName === \"JE_Transaction_ID\" || fieldName === \"PR_Journal_Entry_ID\") {\n                        refNumber = String(fieldValue || \"\").trim();\n                    }\n                    \n                    // Payroll Date\n                    if (PAYROLL_DATE_ALIASES.some(alias => \n                        fieldName === alias || normalizeFieldName(fieldName) === normalizeFieldName(alias)\n                    )) {\n                        txnDate = formatDateInput(fieldValue) || \"\";\n                    }\n                }\n            }\n            \n            console.log(\"JE Generation - RefNumber:\", refNumber, \"TxnDate:\", txnDate);\n            \n            // 2. Read PR_Data_Clean\n            const cleanSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.DATA_CLEAN);\n            cleanSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (cleanSheet.isNullObject) {\n                throw new Error(\"PR_Data_Clean sheet not found. Run Validate & Reconcile first.\");\n            }\n            \n            const cleanRange = cleanSheet.getUsedRangeOrNullObject();\n            cleanRange.load(\"values\");\n            await context.sync();\n            \n            if (cleanRange.isNullObject) {\n                throw new Error(\"PR_Data_Clean is empty. Run Validate & Reconcile first.\");\n            }\n            \n            const cleanValues = cleanRange.values || [];\n            if (cleanValues.length < 2) {\n                throw new Error(\"PR_Data_Clean has no data rows.\");\n            }\n            \n            // 3. Parse headers and find column indices\n            const headers = cleanValues[0].map(h => normalizeHeader(h));\n            console.log(\"JE Generation - PR_Data_Clean headers:\", headers);\n            \n            const colIdx = {\n                accountNumber: headers.findIndex(h => h.includes(\"account\") && (h.includes(\"number\") || h.includes(\"#\"))),\n                accountName: headers.findIndex(h => h.includes(\"account\") && h.includes(\"name\")),\n                amount: headers.findIndex(h => h.includes(\"amount\")),\n                department: pickDepartmentIndex(headers),\n                payrollCategory: headers.findIndex(h => h.includes(\"payroll\") && h.includes(\"category\")),\n                employee: headers.findIndex(h => h.includes(\"employee\"))\n            };\n            \n            console.log(\"JE Generation - Column indices:\", colIdx);\n            \n            if (colIdx.amount === -1) {\n                throw new Error(\"Amount column not found in PR_Data_Clean.\");\n            }\n            \n            // 4. Aggregate by Account Number + Department\n            const aggregated = new Map(); // Key: \"AccountNumber|Department\"\n            \n            for (let i = 1; i < cleanValues.length; i++) {\n                const row = cleanValues[i];\n                \n                const accountNumber = colIdx.accountNumber >= 0 ? String(row[colIdx.accountNumber] || \"\").trim() : \"\";\n                const accountName = colIdx.accountName >= 0 ? String(row[colIdx.accountName] || \"\").trim() : \"\";\n                const amount = Number(row[colIdx.amount]) || 0;\n                const department = colIdx.department >= 0 ? String(row[colIdx.department] || \"\").trim() : \"\";\n                \n                // Skip zero amounts\n                if (amount === 0) continue;\n                \n                // Create aggregation key\n                const key = `${accountNumber}|${department}`;\n                \n                if (aggregated.has(key)) {\n                    // Add to existing entry\n                    const entry = aggregated.get(key);\n                    entry.amount += amount;\n                } else {\n                    // Create new entry\n                    aggregated.set(key, {\n                        accountNumber,\n                        accountName,\n                        department,\n                        amount\n                    });\n                }\n            }\n            \n            console.log(\"JE Generation - Aggregated into\", aggregated.size, \"unique Account+Department combinations\");\n            \n            // 5. Build journal entry rows from aggregated data\n            const jeHeaders = [\n                \"RefNumber\",\n                \"TxnDate\", \n                \"Account Number\",\n                \"Account Name\",\n                \"LineAmount\",\n                \"Debit\",\n                \"Credit\",\n                \"LineDesc\",\n                \"Department\"\n            ];\n            \n            const jeRows = [jeHeaders];\n            let totalDebit = 0;\n            let totalCredit = 0;\n            \n            // Sort by account number, then department for cleaner output\n            const sortedEntries = Array.from(aggregated.values()).sort((a, b) => {\n                const acctCompare = String(a.accountNumber).localeCompare(String(b.accountNumber));\n                if (acctCompare !== 0) return acctCompare;\n                return String(a.department).localeCompare(String(b.department));\n            });\n            \n            for (const entry of sortedEntries) {\n                const { accountNumber, accountName, department, amount } = entry;\n                \n                // Calculate debit/credit from aggregated amount\n                const debit = amount > 0 ? amount : 0;\n                const credit = amount < 0 ? Math.abs(amount) : 0;\n                \n                // Build line description\n                const lineDesc = [accountName, department].filter(Boolean).join(\" - \");\n                \n                // Track totals\n                totalDebit += debit;\n                totalCredit += credit;\n                \n                jeRows.push([\n                    refNumber,           // RefNumber\n                    txnDate,             // TxnDate\n                    accountNumber,       // Account Number\n                    accountName,         // Account Name\n                    amount,              // LineAmount (net)\n                    debit || \"\",         // Debit (blank if 0)\n                    credit || \"\",        // Credit (blank if 0)\n                    lineDesc,            // LineDesc\n                    department           // Department\n                ]);\n            }\n            \n            console.log(\"JE Generation - Built\", jeRows.length - 1, \"summarized journal lines\");\n            console.log(\"JE Generation - Total Debit:\", totalDebit, \"Total Credit:\", totalCredit);\n            \n            // 5. Write to PR_JE_Draft\n            let jeSheet = context.workbook.worksheets.getItemOrNullObject(SHEET_NAMES.JE_DRAFT);\n            jeSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (jeSheet.isNullObject) {\n                // Create the sheet if it doesn't exist\n                jeSheet = context.workbook.worksheets.add(SHEET_NAMES.JE_DRAFT);\n                await context.sync();\n            } else {\n                // Clear existing content\n                const usedRange = jeSheet.getUsedRangeOrNullObject();\n                usedRange.load(\"address\");\n                await context.sync();\n                if (!usedRange.isNullObject) {\n                    usedRange.clear();\n                    await context.sync();\n                }\n            }\n            \n            // Write the data\n            const dataRange = jeSheet.getRangeByIndexes(0, 0, jeRows.length, jeHeaders.length);\n            dataRange.values = jeRows;\n            await context.sync();\n            \n            // Apply formatting using shared utilities\n            try {\n                const dataRowCount = jeRows.length - 1; // exclude header\n                \n                // Header formatting (9 columns: A-I) using shared style\n                const headerRange = jeSheet.getRange(\"A1:I1\");\n                formatSheetHeaders(headerRange);\n                \n                // Date formatting for TxnDate (column B, index 1)\n                if (dataRowCount > 0) {\n                    formatDateColumn(jeSheet, 1, dataRowCount);\n                    \n                    // Currency formatting for amount columns (E=LineAmount, F=Debit, G=Credit)\n                    formatCurrencyColumn(jeSheet, 4, dataRowCount);  // E: LineAmount\n                    formatCurrencyColumn(jeSheet, 5, dataRowCount);  // F: Debit\n                    formatCurrencyColumn(jeSheet, 6, dataRowCount);  // G: Credit\n                }\n                \n                // Auto-fit columns\n                jeSheet.getRange(\"A:I\").format.autofitColumns();\n                \n                await context.sync();\n            } catch (formatError) {\n                console.warn(\"JE formatting error (non-critical):\", formatError);\n            }\n            \n            // Activate the sheet and select A1\n            jeSheet.activate();\n            jeSheet.getRange(\"A1\").select();\n            await context.sync();\n            \n            // Update journal state with totals\n            journalState.debitTotal = totalDebit;\n            journalState.creditTotal = totalCredit;\n            journalState.difference = totalCredit - totalDebit;\n        });\n        \n        journalState.loading = false;\n        journalState.lastError = null;\n        renderApp();\n        \n    } catch (error) {\n        console.error(\"JE Generation failed:\", error);\n        journalState.loading = false;\n        journalState.lastError = error.message || \"Failed to generate journal entry.\";\n        renderApp();\n    }\n}\n\nasync function exportJournalDraft() {\n    if (!hasExcelRuntime()) {\n        window.alert(\"Excel runtime is unavailable.\");\n        return;\n    }\n    try {\n        const { rows } = await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(SHEET_NAMES.JE_DRAFT);\n            const range = sheet.getUsedRangeOrNullObject();\n            range.load(\"values\");\n            await context.sync();\n            const values = range.isNullObject ? [] : range.values || [];\n            if (!values.length) {\n                throw new Error(`${SHEET_NAMES.JE_DRAFT} is empty.`);\n            }\n            return { rows: values };\n        });\n        const csv = buildCsv(rows);\n        downloadCsv(`pr-je-draft-${todayIso()}.csv`, csv);\n    } catch (error) {\n        console.warn(\"JE export:\", error);\n        window.alert(\"Unable to export the JE draft. Confirm the sheet has data.\");\n    }\n}\n\n"],
  "mappings": "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",
  "names": ["VERSION", "SHEET_NAMES", "SHEET_BLUEPRINTS", "SHEET_NAMES", "WORKFLOW_STEPS", "globalBuilderAllowlist", "entry", "hasExcelRuntime", "initializeOffice", "onReady", "info", "error", "CONFIG_SHEET_NAME", "PREFIX_CATEGORY", "SYSTEM_MODULE", "DEFAULT_PREFIX_CONFIG", "getPrefixConfig", "hasExcelRuntime", "DEFAULT_PREFIX_CONFIG", "context", "_a", "_b", "configSheet", "CONFIG_SHEET_NAME", "usedRange", "values", "headerMap", "buildHeaderMap", "categoryIdx", "fieldIdx", "valueIdx", "prefixConfig", "foundPrefixRows", "i", "row", "normalizeToken", "PREFIX_CATEGORY", "prefix", "moduleKey", "error", "applyModuleTabVisibility", "normalizedModuleKey", "worksheets", "modulePrefixes", "module", "activePrefixes", "systemPrefixes", "SYSTEM_MODULE", "otherPrefixes", "prefixes", "toShow", "toHide", "sheet", "sheetName", "upperName", "matchesActive", "p", "matchesOther", "matchesSystem", "s", "e", "showAllSheets", "hasExcelRuntime", "context", "worksheets", "unhiddenCount", "sheet", "error", "unhideSystemSheets", "prefixConfig", "getPrefixConfig", "systemPrefixes", "prefix", "module", "SYSTEM_MODULE", "upperName", "p", "buildHeaderMap", "headers", "map", "header", "index", "normalized", "normalizeToken", "value", "showAllSheets", "unhideSystemSheets", "applyModuleTabVisibility", "BRANDING", "CHATGPT_ICON", "SEND_ARROW", "ADA_IMAGE_URL", "BRANDING", "DEFAULT_OPTIONS", "messageHistory", "renderCopilotCard", "options", "_a", "merged", "quickActionsHtml", "action", "escapeAttr", "str", "bindCopilotCard", "container", "root", "messagesContainer", "promptInput", "askButton", "statusDot", "statusBadge", "isProcessing", "setStatus", "text", "state", "addMessage", "content", "role", "bubbleClass", "messageEl", "formatResponse", "showLoading", "loadingEl", "hideLoading", "handleSubmit", "promptText", "prompt", "context", "e", "response", "callCopilotAPI", "generateDemoResponse", "error", "event", "btn", "endpoint", "systemPrompt", "data", "_b", "_c", "lowerPrompt", "ADA_IMAGE_URL", "BRANDING", "activateHomepageSheet", "sheetName", "title", "subtitle", "context", "sheet", "targetSheet", "setupHomepageContent", "error", "usedRange", "data", "dataRange", "backgroundRange", "titleCell", "subtitleCell", "HOMEPAGE_CONFIG", "getHomepageConfig", "moduleKey", "renderAdaFab", "removeAdaFab", "fab", "showAdaModal", "existingFab", "existingModal", "overlay", "closeBtn", "hideAdaModal", "e", "handleEscape", "HOME_ICON_SVG", "MODULES_ICON_SVG", "MENU_ICON_SVG", "TABLE_ICON_SVG", "USERS_ICON_SVG", "BOOK_ICON_SVG", "STEP_ICON_MAP", "getStepIconSvg", "type", "LOCK_OPEN_SVG", "LOCK_CLOSED_SVG", "CHECK_ICON_SVG", "CALCULATOR_ICON_SVG", "HAMMER_ICON_SVG", "LINK_ICON_SVG", "DOWNLOAD_ICON_SVG", "X_CIRCLE_SVG", "ARROW_LEFT_SVG", "SAVE_ICON_SVG", "ARROW_RIGHT_SVG", "CHECK_CIRCLE_SVG", "ALERT_CIRCLE_SVG", "ALERT_TRIANGLE_SVG", "INFO_CIRCLE_SVG", "CIRCLE_CHECK_BIG_SVG", "CIRCLE_X_SVG", "ARROW_UP_FROM_LINE_SVG", "ARROW_DOWN_TO_LINE_SVG", "REFRESH_ICON_SVG", "TRASH_ICON_SVG", "escapeHtml", "str", "renderLabeledButton", "buttonHtml", "label", "renderInlineNotes", "textareaId", "value", "permanentId", "isPermanent", "hintId", "saveButtonId", "isSaved", "placeholder", "lockIcon", "LOCK_CLOSED_SVG", "LOCK_OPEN_SVG", "saveButton", "SAVE_ICON_SVG", "lockButton", "renderSignoff", "reviewerInputId", "reviewerValue", "signoffInputId", "signoffValue", "isComplete", "completeButtonId", "subtext", "completeButton", "CHECK_ICON_SVG", "updateLockButtonVisual", "button", "isLocked", "LOCK_CLOSED_SVG", "LOCK_OPEN_SVG", "updateSaveButtonState", "button", "isSaved", "initSaveTracking", "container", "saveButtons", "cleanupFns", "saveButton", "inputId", "input", "handleChange", "fn", "canCompleteStep", "stepId", "completionStatus", "i", "showBlockedToast", "message", "existing", "toast", "HEADER_STYLE", "NUMBER_FORMATS", "formatSheetHeaders", "headerRange", "formatCurrencyColumn", "sheet", "colIndex", "dataRowCount", "showNegativeInParens", "colRange", "NUMBER_FORMATS", "formatDateColumn", "sheet", "colIndex", "dataRowCount", "format", "NUMBER_FORMATS", "colRange", "MODULE_KEY", "MODULE_NAME", "MODULE_CONFIG_SHEET", "SHEET_NAMES", "CONFIG_TABLE_CANDIDATES", "HERO_COPY", "WORKFLOW_STEPS", "id", "title", "CONFIG_COLUMNS", "DEFAULT_CONFIG_TYPE", "DEFAULT_CONFIG_PERMANENT", "JE_TOTAL_DEBIT_FIELD", "JE_TOTAL_CREDIT_FIELD", "JE_DIFFERENCE_FIELD", "STEP_NOTES_FIELDS", "STEP_COMPLETE_FIELDS", "STEP_SHEET_MAP", "SHEET_NAMES", "CONFIG_REVIEWER_FIELD", "PAYROLL_PROVIDER_FIELD", "HEADCOUNT_SKIP_NOTE", "appState", "WORKFLOW_STEPS", "map", "step", "configState", "pendingWrites", "resolvedConfigTableName", "PAYROLL_DATE_ALIASES", "headcountState", "pendingScrollIndex", "validationState", "expenseReviewState", "journalState", "runPayrollCompletenessCheck", "hasExcelRuntime", "context", "_a", "_b", "_c", "_d", "cleanSheet", "archiveSheet", "results", "cleanRange", "headers", "h", "amountIdx", "totalIdx", "prDataCleanTotal", "sum", "row", "currentPeriodTotal", "match", "archiveRange", "dateIdx", "dataRows", "historicalPeriods", "p", "archiveLookup", "rawDate", "normalizedKey", "normalizeDateForLookup", "amount", "existing", "archiveSum", "periodsSum", "matchedCount", "periodDetails", "period", "periodKey", "normalizedPeriodKey", "periodTotal", "archiveTotal", "allMatched", "totalsMatch", "error", "renderPayrollCompletenessCard", "check", "hasRun", "fmt", "val", "fmtDiff", "diff", "absDiff", "renderComparisonRow", "label", "sourceLabel", "sourceVal", "calcLabel", "calcVal", "isMatch", "isPending", "statusIcon", "statusClass", "diffDisplay", "escapeHtml", "currentResult", "currentPending", "currentRow", "histResult", "histPending", "totalPeriods", "histLabel", "histRow", "periodDetailsHtml", "d", "matchIcon", "archiveVal", "getStepInfoConfig", "stepId", "initializeOffice", "init", "ensureTabVisibility", "loadConfigurationValues", "homepageConfig", "getHomepageConfig", "MODULE_KEY", "activateHomepageSheet", "renderApp", "applyModuleTabVisibility", "root", "prevDisabled", "nextDisabled", "isConfigView", "isStepView", "isHomeView", "viewMarkup", "renderConfigView", "renderStepView", "renderHomeView", "renderBanner", "renderFooter", "infoFabElement", "infoConfig", "bindSharedInteractions", "bindConfigInteractions", "bindStepInteractions", "bindHomeInteractions", "scrollFocusedIntoView", "renderAdaFab", "removeAdaFab", "company", "getConfigValue", "ARROW_LEFT_SVG", "HOME_ICON_SVG", "MODULES_ICON_SVG", "ARROW_RIGHT_SVG", "MENU_ICON_SVG", "USERS_ICON_SVG", "BOOK_ICON_SVG", "TABLE_ICON_SVG", "HERO_COPY", "index", "renderStepCard", "stepFields", "payrollDate", "formatDateInput", "getPayrollDateValue", "accountingPeriod", "jeId", "accountingLink", "payrollLink", "getPayrollProviderLink", "companyName", "userName", "getReviewerDefault", "notes", "notesPermanent", "isFieldPermanent", "reviewer", "signOffDate", "isStepComplete", "MODULE_NAME", "renderInlineNotes", "renderSignoff", "renderImportStep", "detail", "stepFields", "getStepNoteFields", "notesPermanent", "isFieldPermanent", "stepNotes", "getConfigValue", "stepReviewer", "getReviewerDefault", "stepSignOff", "formatDateInput", "stepComplete", "STEP_COMPLETE_FIELDS", "providerLink", "getPayrollProviderLink", "escapeHtml", "MODULE_NAME", "renderLabeledButton", "LINK_ICON_SVG", "TABLE_ICON_SVG", "TRASH_ICON_SVG", "renderInlineNotes", "renderSignoff", "renderHeadcountStep", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "_j", "stepNotesPermanent", "requiresNotes", "isHeadcountNotesRequired", "roster", "headcountState", "departments", "hasRun", "statusBanner", "renderCheckRow", "label", "value", "isMatch", "pending", "circleHtml", "valueDisplay", "rosterDiff", "deptDiff", "rosterMismatches", "deptMismatches", "rosterChecksHtml", "deptChecksHtml", "rosterMismatchSection", "deptMismatchSection", "item", "X_CIRCLE_SVG", "CALCULATOR_ICON_SVG", "REFRESH_ICON_SVG", "renderValidationStep", "validationState", "prDataTotal", "cleanTotal", "reconDiff", "reconMatches", "bankClean", "formatCurrency", "bankDiff", "bankHint", "bankValue", "formatBankInput", "desc", "passed", "prDataDisplay", "cleanDisplay", "diffDisplay", "reconChecksHtml", "renderExpenseReviewStep", "expenseReviewState", "copilotMarkup", "renderCopilotCard", "renderPayrollCompletenessCard", "renderJournalStep", "statusNote", "journalState", "debitTotal", "creditTotal", "lineAmount", "lineAmountValid", "totalMatchesClean", "debitDisplay", "creditDisplay", "lineAmountDisplay", "checksHtml", "DOWNLOAD_ICON_SVG", "renderArchiveStep", "completionItems", "WORKFLOW_STEPS", "step", "isStepCompleteFromConfig", "allComplete", "statusList", "CHECK_ICON_SVG", "renderStepView", "stepId", "isStepOne", "highlights", "checklist", "descriptionText", "actionButtons", "actionSection", "providerSection", "quickTipsSection", "highlightSection", "checklistSection", "descriptionSection", "appState", "renderStepCard", "index", "isActive", "icon", "getStepIconSvg", "getStepType", "renderFooter", "VERSION", "bindSharedInteractions", "returnHome", "moveFocus", "quickToggle", "quickDropdown", "e", "openReferenceSheet", "navigateToExpenseMapping", "unhideSystemSheets", "context", "worksheets", "unhiddenCount", "sheet", "configSheet", "error", "sheetName", "defaultHeaders", "headers", "headerRange", "bindHomeInteractions", "card", "focusStep", "bindConfigInteractions", "userNameInput", "event", "scheduleConfigWrite", "CONFIG_REVIEWER_FIELD", "reviewerInput", "payrollInput", "configState", "derivedPeriod", "deriveAccountingPeriod", "periodInput", "derivedJe", "deriveJeId", "jeInput", "PAYROLL_PROVIDER_FIELD", "notesInput", "lockButton", "nextState", "updateLockButtonVisual", "setNotePermanent", "notesSaveBtn", "updateSaveButtonState", "signoffInput", "today", "todayIso", "signoffSaveBtn", "reviewerValue", "signoffValue", "initSaveTracking", "signOffValue", "completeValue", "isStepComplete", "bindSignoffToggle", "bindStepInteractions", "_k", "_l", "_m", "_n", "_o", "_p", "_q", "_r", "_s", "_t", "_u", "openDataSheet", "clearPrDataSheet", "skipBtn", "enforceHeadcountSkipNote", "updateHeadcountSignoffState", "refreshHeadcountAnalysis", "items", "showHeadcountModal", "prepareValidationData", "handleBankAmountInput", "runJournalSummary", "saveJournalSummary", "createJournalDraft", "exportJournalDraft", "container", "COPILOT_API_ENDPOINT", "bindCopilotCard", "createPayrollContextProvider", "prepareExpenseReviewData", "fields", "notesInputId", "reviewerInputId", "signoffInputId", "lockButtonId", "completeField", "initialCompleteFlag", "initialSignOff", "toggleButtonId", "handleValidationComplete", "handleExpenseReviewComplete", "handleHeadcountSignoff", "handleArchiveRun", "pendingScrollIndex", "view", "setState", "STEP_SHEET_MAP", "activateWorksheet", "delta", "next", "clamped", "scrollFocusedIntoView", "returnHome", "homepageConfig", "getHomepageConfig", "MODULE_KEY", "activateHomepageSheet", "setState", "partial", "appState", "renderApp", "getReviewerDefault", "getConfigValue", "CONFIG_REVIEWER_FIELD", "updateActionToggleState", "button", "isActive", "markJeSaveState", "isSaved", "btn", "getStepCompletionStatus", "status", "STEP_NOTES_FIELDS", "stepIdStr", "stepId", "fields", "signOffValue", "completeField", "STEP_COMPLETE_FIELDS", "completeValue", "isComplete", "bindSignoffToggle", "buttonId", "inputId", "fieldName", "requireNotesCheck", "onComplete", "initialActive", "input", "initial", "completionStatus", "canComplete", "message", "canCompleteStep", "isCurrentlyActive", "showBlockedToast", "nextActive", "todayIso", "dateValue", "scheduleConfigWrite", "hasDate", "openDataSheet", "hasExcelRuntime", "context", "sheet", "SHEET_NAMES", "error", "clearPrDataSheet", "usedRange", "getConfigTable", "_a", "_b", "CONFIG_TABLE_CANDIDATES", "resolvedConfigTableName", "existing", "tables", "foundTableNames", "t", "match", "table", "loadConfigurationValues", "configState", "body", "rows", "map", "permanents", "row", "field", "normalizeFieldName", "CONFIG_COLUMNS", "getConfigValue", "resolvePayrollDateFieldName", "keys", "PAYROLL_DATE_ALIASES", "alias", "getPayrollDateValue", "getPayrollProviderLink", "PAYROLL_PROVIDER_FIELD", "isFieldPermanent", "parseBooleanFlag", "isStepCompleteFromConfig", "stepId", "STEP_COMPLETE_FIELDS", "setNotePermanent", "isPermanent", "normalizedField", "writeConfigPermanent", "value", "normalized", "isNoiseName", "formatDateInput", "parts", "parseDateInput", "deriveAccountingPeriod", "payrollDate", "deriveJeId", "todayIso", "formatDateFromDate", "scheduleConfigWrite", "fieldName", "options", "delay", "pendingWrites", "writeConfigValue", "timer", "TEXT_FORMAT_FIELDS", "forceTextFormat", "f", "headerRange", "headers", "columnCount", "matchingIndices", "idx", "DEFAULT_CONFIG_PERMANENT", "newRow", "DEFAULT_CONFIG_TYPE", "tableRows", "lastRowIdx", "valueCell", "targetIndex", "targetCell", "duplicateIndices", "dupIdx", "e", "marker", "strValue", "isoMatch", "year", "month", "day", "usMatch", "numValue", "utcMs", "jsDate", "isoDate", "dateObj", "date", "normalizeDateForLookup", "createPayrollContextProvider", "_c", "result", "configTable", "configBody", "configRows", "fieldValue", "cleanSheet", "range", "h", "normalizeHeader", "data", "amountIdx", "deptIdx", "pickDepartmentIndex", "employeeIdx", "totalAmount", "employeeSet", "deptTotals", "amount", "emp", "dept", "name", "total", "a", "b", "archiveSheet", "archiveRange", "periodIdx", "totalIdx", "jeSheet", "jeRange", "debitIdx", "creditIdx", "totalDebit", "totalCredit", "escapeHtml", "renderLabeledButton", "buttonHtml", "label", "getStepNoteFields", "STEP_NOTES_FIELDS", "headcountHasDifferences", "_d", "rosterDiff", "headcountState", "deptDiff", "isHeadcountNotesRequired", "formatCurrency", "value", "formatBankInput", "value", "numeric", "parseBankAmount", "buildCsv", "rows", "row", "cell", "str", "downloadCsv", "filename", "content", "blob", "url", "link", "cleaned", "parsed", "normalizePeriodKey", "formatDateFromDate", "date", "convertExcelDate", "serial", "utcDays", "utcValue", "formatFriendlyPeriod", "key", "toNumber", "num", "classifyExpenseComponent", "label", "normalized", "normalizeString", "parseExpenseRows", "values", "headers", "header", "normalizeHeader", "indexes", "uniqueDates", "i", "dateVal", "period", "employee", "department", "fixedVal", "variableVal", "burdenVal", "fixed", "variable", "burden", "amount", "classification", "aggregateExpensePeriods", "map", "bucket", "deptKey", "dept", "result", "total", "departments", "gross", "allIn", "a", "b", "summary", "totalsRow", "buildExpenseReviewPeriods", "cleanValues", "archiveValues", "currentPeriods", "archivePeriods", "p", "_a", "_b", "archiveMap", "combined", "existing", "minEmployeesForPayPeriod", "minTotalForPayPeriod", "sorted", "_c", "_d", "_e", "employeeCount", "included", "index", "previous", "delta", "previousDeptMap", "prev", "prepareExpenseReviewData", "hasExcelRuntime", "updateExpenseReviewState", "periods", "context", "cleanSheet", "SHEET_NAMES", "archiveSheet", "reviewSheet", "newReviewSheet", "createdSheet", "cleanRange", "archiveRange", "periodData", "writeExpenseReviewSheet", "runPayrollCompletenessCheck", "renderApp", "error", "sheet", "usedRange", "charts", "e", "current", "prior", "currentSummary", "priorSummary", "configPeriod", "getConfigValue", "getPayrollDateValue", "totalPayroll", "priorTotal", "periodChange", "periodChangePct", "priorEmployeeCount", "headcountChange", "avgPerEmployee", "priorAvgPerEmployee", "avgChange", "hasVariableComp", "detectVariableCompPeriod", "basePayOnly", "detectBasePayOnlyPeriod", "periodLabel", "generatedTimestamp", "trendArrow", "val", "historicalTotals", "t", "historicalAvgPerEmp", "s", "emp", "historicalChangePcts", "curr", "calcRange", "arr", "currentValue", "min", "max", "avgBase", "avg", "payrollRange", "avgEmpRange", "changePctRange", "buildSpectrum", "width", "range", "position", "markerPos", "bar", "currentFixed", "currentVariable", "currentBurden", "currentGross", "currentBurdenRate", "priorFixed", "priorVariable", "priorBurden", "priorBurdenRate", "salesMarketingDepts", "d", "name", "otherDepts", "salesMarketingVariable", "sum", "salesMarketingHeadcount", "otherVariable", "otherHeadcount", "avgVariableSalesMarketing", "avgVariableOther", "avgFixedPerEmployee", "data", "rowIdx", "rowMap", "formattedPeriod", "dateNum", "excelEpoch", "sortedDepts", "totals", "fmtK", "n", "fmtPct", "historicalFixed", "historicalVariable", "historicalBurdenRates", "historicalAvgFixed", "fixedRange", "variableRange", "burdenRateRange", "avgFixedRange", "payrollSpectrum", "fixedSpectrum", "variableSpectrum", "avgFixedSpectrum", "historicalAvgVarSM", "smDepts", "smVar", "smHc", "avgVarSMRange", "historicalAvgVarOther", "otherD", "otherV", "otherH", "avgVarOtherRange", "avgVarSMSpectrum", "avgVarOtherSpectrum", "burdenRateSpectrum", "trendPeriods", "normalizedData", "r", "dataRange", "writeError", "titleCell", "execHeader", "execColHeaders", "currentRow", "priorRow", "rowNum", "deptHeader", "deptColHeaders", "totalsRange", "histHeader", "histColHeaders", "trendsHeader", "trendColHeaders", "payrollChartRange", "payrollChart", "categoryAxis", "payrollSeries", "payrollColors", "chartError", "headcountChartRange", "headcountChart", "headcountCategoryAxis", "hcSeries", "formatError", "cat", "currentTotal", "activateWorksheet", "refreshHeadcountAnalysis", "headcountState", "results", "rosterSheet", "payrollSheet", "rosterRange", "rosterValues", "payrollValues", "rosterData", "parseRosterValues", "payrollData", "parsePayrollValues", "rosterMismatches", "entry", "deptMismatches", "deptComparisons", "payrollEntry", "rosterDept", "payrollDept", "m", "updateValidationState", "partial", "rerender", "validationState", "prTotal", "cleanTotal", "bankAmountNumber", "refreshValidationUiMetrics", "appState", "assignValue", "id", "element", "formatCurrency", "hint", "plugButton", "expenseReviewState", "prepareValidationData", "payrollDate", "table", "getConfigTable", "body", "PAYROLL_DATE_ALIASES", "CONFIG_COLUMNS", "fieldName", "fieldValue", "isMatch", "alias", "normalizeFieldName", "rawValue", "formatDateInput", "dataSheet", "mappingSheet", "mappingRange", "dataValues", "mappingValues", "mappingHeaders", "findHeaderIndex", "predicate", "mappingIdx", "mappingMap", "category", "normalizePayrollCategory", "cleanHeaderRange", "existingHeaders", "cleanHeadersNormalized", "h", "payrollDateColIdx", "fieldMap", "pickDepartmentIndex", "columnCount", "cleanRows", "prDataTotal", "headerRow", "employeeIdx", "departmentIdx", "hasMappings", "numericColumns", "list", "normalizedCategory", "columnIndex", "payrollCategory", "mapping", "newRow", "existingRowCount", "rowsToClear", "targetRange", "dataStartIndex", "findHeaderRow", "findEmployeeIndex", "terminationIdx", "activeSet", "normalizeKey", "isNoiseName", "termination", "employeeSet", "preferred", "requiredTokens", "headerIndex", "token", "candidates", "idx", "description", "deptName", "nonId", "fallback", "showHeadcountModal", "title", "items", "options", "closeHeadcountModal", "overlay", "missingFromPayroll", "missingFromRoster", "otherItems", "bodyContent", "item", "escapeHtml", "formatter", "formatted", "event", "btn", "updateHeadcountSignoffState", "button", "notesRequired", "isHeadcountNotesRequired", "notesInput", "notesValue", "enforceHeadcountSkipNote", "handleHeadcountSignoff", "setState", "textarea", "remainder", "HEADCOUNT_SKIP_NOTE", "next", "fields", "getStepNoteFields", "scheduleConfigWrite", "handleBankAmountInput", "event", "inputEl", "numeric", "parseBankAmount", "formatted", "formatBankInput", "updateValidationState", "handleValidationComplete", "currentIndex", "WORKFLOW_STEPS", "step", "focusStep", "handleExpenseReviewComplete", "handleArchiveRun", "hasExcelRuntime", "createArchiveWorkbook", "updateArchiveSummary", "clearWorkingData", "clearNonPermanentNotes", "resetNonPermanentConfig", "loadConfigurationValues", "renderApp", "error", "suggestedName", "getPayrollDateValue", "sheetsToArchive", "SHEET_NAMES", "context", "sourceSheets", "newWorkbook", "sheetName", "sourceSheet", "s", "usedRange", "archiveSheet", "cleanSheet", "cleanRange", "cleanHeaders", "h", "cleanData", "amountIdx", "employeeIdx", "dateIdx", "totalAmount", "uniqueEmployees", "periodDate", "row", "employeeCount", "archiveRange", "archiveHeaders", "archiveData", "archiveHeadersLower", "archiveDateIdx", "archiveTotalIdx", "archiveCountIdx", "archiveTimestampIdx", "newRow", "dataStartRow", "dataEndRow", "writeRange", "sheetsToClear", "sheet", "charts", "i", "table", "getConfigTable", "body", "rows", "clearedCount", "noteFields", "STEP_NOTES_FIELDS", "f", "fieldName", "CONFIG_COLUMNS", "permanentFlag", "fieldsToReset", "STEP_COMPLETE_FIELDS", "resetCount", "normalizeFieldName", "configState", "key", "runJournalSummary", "journalState", "markJeSaveState", "totals", "range", "values", "headers", "normalizeHeader", "debitIdx", "creditIdx", "debitTotal", "creditTotal", "saveJournalSummary", "debit", "credit", "diff", "writeConfigValue", "JE_TOTAL_DEBIT_FIELD", "JE_TOTAL_CREDIT_FIELD", "JE_DIFFERENCE_FIELD", "createJournalDraft", "refNumber", "txnDate", "configTable", "configBody", "configRows", "fieldValue", "PAYROLL_DATE_ALIASES", "alias", "formatDateInput", "cleanValues", "colIdx", "pickDepartmentIndex", "aggregated", "accountNumber", "accountName", "amount", "department", "entry", "jeHeaders", "jeRows", "totalDebit", "totalCredit", "sortedEntries", "a", "b", "acctCompare", "lineDesc", "jeSheet", "dataRange", "dataRowCount", "headerRange", "formatSheetHeaders", "formatDateColumn", "formatCurrencyColumn", "formatError", "exportJournalDraft", "csv", "buildCsv", "downloadCsv", "todayIso"]
}
