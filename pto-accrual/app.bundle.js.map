{
  "version": 3,
  "sources": ["../Common/gateway.js", "../Common/tab-visibility.js", "../Common/constants.js", "../Common/homepage-sheet.js", "../Common/icons.js", "../Common/notes-signoff.js", "../Common/workflow-validation.js", "../Common/sheet-formatting.js", "src/index.js"],
  "sourcesContent": ["/**\n * Gateway - Shared Office/Excel initialization and helpers for all modules\n */\n\n// Excel runtime check\nexport function hasExcelRuntime() {\n    return typeof Excel !== \"undefined\" && typeof Excel.run === \"function\";\n}\n\n// Initialize Office and call the provided callback when ready\nexport function initializeOffice(onReady) {\n    try {\n        Office.onReady((info) => {\n            console.log(\"Office.onReady fired:\", info);\n            if (info.host === Office.HostType.Excel) {\n                onReady(info);\n            } else {\n                console.warn(\"Not running in Excel, host:\", info.host);\n                onReady(info); // Still init for testing\n            }\n        });\n    } catch (error) {\n        console.warn(\"Office.onReady failed:\", error);\n        onReady(null);\n    }\n}\n\n// Shared config table name - single source of truth for all modules\nexport const SHARED_CONFIG_TABLE = \"SS_PF_Config\";\n\n// Find a config table by name candidates (prioritizes SS_PF_Config)\nexport async function getConfigTable(context, tableCandidates = [SHARED_CONFIG_TABLE]) {\n    const tables = context.workbook.tables;\n    tables.load(\"items/name\");\n    await context.sync();\n\n    const match = tables.items?.find((t) => tableCandidates.includes(t.name));\n    if (!match) {\n        console.warn(\"Config table not found. Looking for:\", tableCandidates);\n        return null;\n    }\n\n    return context.workbook.tables.getItem(match.name);\n}\n\n// Get column indices from table headers\nexport function getColumnIndices(headers) {\n    const normalizedHeaders = headers.map(h => String(h || \"\").trim().toLowerCase());\n    return {\n        field: normalizedHeaders.findIndex(h => h === \"field\" || h === \"field name\" || h === \"setting\"),\n        value: normalizedHeaders.findIndex(h => h === \"value\" || h === \"setting value\"),\n        type: normalizedHeaders.findIndex(h => h === \"type\" || h === \"category\"),\n        title: normalizedHeaders.findIndex(h => h === \"title\" || h === \"display name\"),\n        permanent: normalizedHeaders.findIndex(h => h === \"permanent\" || h === \"persist\")\n    };\n}\n\n// Load configuration from a config table\nexport async function loadConfigFromTable(tableCandidates = [SHARED_CONFIG_TABLE]) {\n    if (!hasExcelRuntime()) {\n        return {};\n    }\n\n    try {\n        return await Excel.run(async (context) => {\n            const table = await getConfigTable(context, tableCandidates);\n            if (!table) {\n                return {};\n            }\n\n            const body = table.getDataBodyRange();\n            const headerRange = table.getHeaderRowRange();\n            body.load(\"values\");\n            headerRange.load(\"values\");\n            await context.sync();\n\n            const headers = headerRange.values[0] || [];\n            const cols = getColumnIndices(headers);\n\n            if (cols.field === -1 || cols.value === -1) {\n                console.warn(\"Config table missing FIELD or VALUE columns. Headers:\", headers);\n                return {};\n            }\n\n            const values = {};\n            const rows = body.values || [];\n            rows.forEach((row) => {\n                const field = String(row[cols.field] || \"\").trim();\n                if (field) {\n                    values[field] = row[cols.value] ?? \"\";\n                }\n            });\n\n            console.log(\"Configuration loaded:\", Object.keys(values).length, \"fields\");\n            return values;\n        });\n    } catch (error) {\n        console.error(\"Failed to load configuration:\", error);\n        return {};\n    }\n}\n\n// Save a config value to a config table\nexport async function saveConfigValue(fieldName, value, tableCandidates = [SHARED_CONFIG_TABLE]) {\n    if (!hasExcelRuntime()) return false;\n\n    try {\n        await Excel.run(async (context) => {\n            const table = await getConfigTable(context, tableCandidates);\n            if (!table) {\n                console.warn(\"Config table not found for write\");\n                return;\n            }\n\n            const body = table.getDataBodyRange();\n            const headerRange = table.getHeaderRowRange();\n            body.load(\"values\");\n            headerRange.load(\"values\");\n            await context.sync();\n\n            const headers = headerRange.values[0] || [];\n            const cols = getColumnIndices(headers);\n\n            if (cols.field === -1 || cols.value === -1) {\n                console.error(\"Config table missing FIELD or VALUE columns\");\n                return;\n            }\n\n            const rows = body.values || [];\n            const targetIndex = rows.findIndex(\n                (row) => String(row[cols.field] || \"\").trim() === fieldName\n            );\n\n            if (targetIndex >= 0) {\n                body.getCell(targetIndex, cols.value).values = [[value]];\n            } else {\n                // Add new row with Category, Field, Value, Permanent structure\n                const newRow = new Array(headers.length).fill(\"\");\n                if (cols.type >= 0) newRow[cols.type] = \"Run Settings\";\n                newRow[cols.field] = fieldName;\n                newRow[cols.value] = value;\n                if (cols.permanent >= 0) newRow[cols.permanent] = \"N\";\n                if (cols.title >= 0) newRow[cols.title] = \"\";\n                table.rows.add(null, [newRow]);\n                console.log(\"Added new config row:\", fieldName, \"=\", value);\n            }\n\n            await context.sync();\n            console.log(\"Saved config:\", fieldName, \"=\", value);\n        });\n        return true;\n    } catch (error) {\n        console.error(\"Failed to save config:\", fieldName, error);\n        return false;\n    }\n}\n\n// Activate a worksheet by name\nexport async function activateWorksheet(sheetName) {\n    if (!hasExcelRuntime()) return;\n\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItemOrNullObject(sheetName);\n            await context.sync();\n            if (!sheet.isNullObject) {\n                sheet.activate();\n                await context.sync();\n            }\n        });\n    } catch (error) {\n        console.error(\"Failed to activate worksheet:\", sheetName, error);\n    }\n}\n\n// Get used range values from a worksheet\nexport async function getSheetData(sheetName) {\n    if (!hasExcelRuntime()) return [];\n\n    try {\n        return await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(sheetName);\n            const range = sheet.getUsedRangeOrNullObject();\n            range.load(\"values\");\n            await context.sync();\n\n            if (range.isNullObject) {\n                return [];\n            }\n            return range.values || [];\n        });\n    } catch (error) {\n        console.error(\"Failed to get sheet data:\", sheetName, error);\n        return [];\n    }\n}\n\n// Write data to a worksheet (clears existing data first)\nexport async function writeSheetData(sheetName, data) {\n    if (!hasExcelRuntime() || !data.length) return false;\n\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(sheetName);\n            const existingRange = sheet.getUsedRangeOrNullObject();\n            await context.sync();\n\n            if (!existingRange.isNullObject) {\n                existingRange.clear();\n            }\n\n            const targetRange = sheet.getRangeByIndexes(0, 0, data.length, data[0].length);\n            targetRange.values = data;\n            await context.sync();\n        });\n        return true;\n    } catch (error) {\n        console.error(\"Failed to write sheet data:\", sheetName, error);\n        return false;\n    }\n}\n", "import { hasExcelRuntime } from \"./gateway.js\";\n\nconst CONFIG_SHEET_NAME = \"SS_PF_Config\";\nconst PREFIX_CATEGORY = \"module-prefix\";\nconst SYSTEM_MODULE = \"system\"; // Special module key for SS_ prefix\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PREFIX-BASED TAB VISIBILITY\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// \n// Tab visibility is driven by prefixes defined in SS_PF_Config:\n// \n// | Category      | Field (Prefix) | Value (Module)    |\n// |---------------|----------------|-------------------|\n// | module-prefix | PR_            | payroll-recorder  |\n// | module-prefix | PTO_           | pto-accrual       |\n// | module-prefix | SS_            | system            |\n// \n// When entering a module:\n// 1. Show tabs with that module's prefix\n// 2. Hide tabs with other module prefixes  \n// 3. Always hide \"system\" prefix tabs (SS_*)\n// 4. Leave non-prefixed tabs as-is\n//\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n// Fallback prefix config if SS_PF_Config doesn't have module-prefix rows\nconst DEFAULT_PREFIX_CONFIG = {\n    \"PR_\": \"payroll-recorder\",\n    \"PTO_\": \"pto-accrual\",\n    \"CC_\": \"credit-card-expense\",\n    \"COM_\": \"commission-calc\",\n    \"SS_\": \"system\"\n};\n\n// Valid categories for SS_PF_Config\nexport const VALID_CATEGORIES = {\n    \"module-prefix\": {\n        label: \"Module Prefix\",\n        description: \"Maps tab prefixes to modules (e.g., PR_ \u2192 payroll-recorder)\",\n        requiresValue2: false\n    },\n    \"run-settings\": {\n        label: \"Run Settings\",\n        description: \"Per-period configuration values (payroll date, accounting period, etc.)\",\n        requiresValue2: false\n    },\n    \"step-notes\": {\n        label: \"Step Notes\",\n        description: \"Notes and sign-off data for workflow steps\",\n        requiresValue2: false\n    },\n    \"shared\": {\n        label: \"Shared\",\n        description: \"Global settings shared across all modules\",\n        requiresValue2: false\n    },\n    \"column-mapping\": {\n        label: \"Column Mapping\",\n        description: \"Maps source columns to target columns for data import\",\n        requiresValue2: false\n    }\n};\n\n// Get list of valid category values\nexport function getValidCategoryKeys() {\n    return Object.keys(VALID_CATEGORIES);\n}\n\n/**\n * Read prefix \u2192 module mappings from SS_PF_Config\n * Falls back to DEFAULT_PREFIX_CONFIG if not found\n * @returns {Promise<Object>} Map of prefix \u2192 moduleKey\n */\nasync function getPrefixConfig() {\n    if (!hasExcelRuntime()) return { ...DEFAULT_PREFIX_CONFIG };\n    \n    try {\n        return await Excel.run(async (context) => {\n            const configSheet = context.workbook.worksheets.getItemOrNullObject(CONFIG_SHEET_NAME);\n            await context.sync();\n            \n            if (configSheet.isNullObject) {\n                console.log(\"[Tab Visibility] Config sheet not found, using defaults\");\n                return { ...DEFAULT_PREFIX_CONFIG };\n            }\n            \n            const usedRange = configSheet.getUsedRangeOrNullObject();\n            usedRange.load(\"values\");\n            await context.sync();\n            \n            if (usedRange.isNullObject || !usedRange.values?.length) {\n                return { ...DEFAULT_PREFIX_CONFIG };\n            }\n            \n            const values = usedRange.values;\n            const headerMap = buildHeaderMap(values[0]);\n            const categoryIdx = headerMap.get(\"category\");\n            const fieldIdx = headerMap.get(\"field\");\n            const valueIdx = headerMap.get(\"value\");\n            \n            if (categoryIdx === undefined || fieldIdx === undefined || valueIdx === undefined) {\n                console.warn(\"[Tab Visibility] Missing required columns, using defaults\");\n                return { ...DEFAULT_PREFIX_CONFIG };\n            }\n            \n            const prefixConfig = {};\n            let foundPrefixRows = false;\n            \n            for (let i = 1; i < values.length; i++) {\n                const row = values[i];\n                const category = normalizeToken(row[categoryIdx]);\n                \n                if (category === PREFIX_CATEGORY) {\n                    const prefix = String(row[fieldIdx] ?? \"\").trim().toUpperCase();\n                    const moduleKey = normalizeToken(row[valueIdx]);\n                    \n                    if (prefix && moduleKey) {\n                        prefixConfig[prefix] = moduleKey;\n                        foundPrefixRows = true;\n                    }\n                }\n            }\n            \n            if (!foundPrefixRows) {\n                console.log(\"[Tab Visibility] No module-prefix rows found, using defaults\");\n                return { ...DEFAULT_PREFIX_CONFIG };\n            }\n            \n            console.log(\"[Tab Visibility] Loaded prefix config:\", prefixConfig);\n            return prefixConfig;\n        });\n    } catch (error) {\n        console.warn(\"[Tab Visibility] Error reading prefix config:\", error);\n        return { ...DEFAULT_PREFIX_CONFIG };\n    }\n}\n\n/**\n * Apply tab visibility based on module prefixes\n * @param {string} moduleKey - The module being activated (e.g., \"payroll-recorder\")\n */\nexport async function applyModuleTabVisibility(moduleKey) {\n    if (!hasExcelRuntime()) return;\n    \n    const normalizedModuleKey = normalizeToken(moduleKey);\n    console.log(`[Tab Visibility] Applying visibility for module: ${normalizedModuleKey}`);\n    \n    try {\n        const prefixConfig = await getPrefixConfig();\n        \n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            // Build reverse map: moduleKey \u2192 [prefixes]\n            const modulePrefixes = {};\n            for (const [prefix, module] of Object.entries(prefixConfig)) {\n                if (!modulePrefixes[module]) modulePrefixes[module] = [];\n                modulePrefixes[module].push(prefix);\n            }\n            \n            // Get prefixes for the active module\n            const activePrefixes = modulePrefixes[normalizedModuleKey] || [];\n            const systemPrefixes = modulePrefixes[SYSTEM_MODULE] || [];\n            \n            // Get all OTHER module prefixes (to hide)\n            const otherPrefixes = [];\n            for (const [module, prefixes] of Object.entries(modulePrefixes)) {\n                if (module !== normalizedModuleKey && module !== SYSTEM_MODULE) {\n                    otherPrefixes.push(...prefixes);\n                }\n            }\n            \n            console.log(`[Tab Visibility] Active prefixes: ${activePrefixes.join(\", \")}`);\n            console.log(`[Tab Visibility] Other module prefixes (to hide): ${otherPrefixes.join(\", \")}`);\n            console.log(`[Tab Visibility] System prefixes (always hide): ${systemPrefixes.join(\", \")}`);\n            \n            const toShow = [];\n            const toHide = [];\n            \n            worksheets.items.forEach((sheet) => {\n                const sheetName = sheet.name;\n                const upperName = sheetName.toUpperCase();\n                \n                // Check if sheet matches active module prefix \u2192 SHOW\n                const matchesActive = activePrefixes.some(p => upperName.startsWith(p));\n                \n                // Check if sheet matches other module prefix \u2192 HIDE\n                const matchesOther = otherPrefixes.some(p => upperName.startsWith(p));\n                \n                // Check if sheet matches system prefix \u2192 ALWAYS HIDE\n                const matchesSystem = systemPrefixes.some(p => upperName.startsWith(p));\n                \n                if (matchesActive) {\n                    toShow.push(sheet);\n                    console.log(`[Tab Visibility] SHOW: ${sheetName} (matches active module prefix)`);\n                } else if (matchesSystem) {\n                    toHide.push(sheet);\n                    console.log(`[Tab Visibility] HIDE: ${sheetName} (system sheet)`);\n                } else if (matchesOther) {\n                    toHide.push(sheet);\n                    console.log(`[Tab Visibility] HIDE: ${sheetName} (other module prefix)`);\n                } else {\n                    // Non-prefixed sheet - leave as-is\n                    console.log(`[Tab Visibility] SKIP: ${sheetName} (no prefix match, leaving as-is)`);\n                }\n            });\n            \n            // First, show all tabs that should be visible\n            for (const sheet of toShow) {\n                sheet.visibility = Excel.SheetVisibility.visible;\n            }\n            await context.sync();\n            \n            // Count visible sheets to ensure we don't hide all of them\n            const visibleCount = worksheets.items.filter(\n                s => s.visibility === Excel.SheetVisibility.visible\n            ).length;\n            \n            // Then hide tabs (ensure at least one stays visible)\n            if (visibleCount > toHide.length) {\n                for (const sheet of toHide) {\n                    try {\n                        sheet.visibility = Excel.SheetVisibility.hidden;\n                    } catch (e) {\n                        console.warn(`[Tab Visibility] Could not hide \"${sheet.name}\":`, e.message);\n                    }\n                }\n                await context.sync();\n            } else {\n                console.warn(\"[Tab Visibility] Skipping hide - would leave no visible sheets\");\n            }\n            \n            console.log(`[Tab Visibility] Done! Showed ${toShow.length}, hid ${toHide.length} tabs`);\n        });\n    } catch (error) {\n        console.warn(`[Tab Visibility] Error applying visibility:`, error);\n    }\n}\n\n/**\n * Hide system sheets (SS_* prefix)\n * Called on workbook open\n */\nexport async function hideSystemSheets() {\n    if (!hasExcelRuntime()) return;\n    \n    try {\n        const prefixConfig = await getPrefixConfig();\n        const systemPrefixes = [];\n        \n        for (const [prefix, module] of Object.entries(prefixConfig)) {\n            if (module === SYSTEM_MODULE) {\n                systemPrefixes.push(prefix);\n            }\n        }\n        \n        if (!systemPrefixes.length) {\n            systemPrefixes.push(\"SS_\"); // Fallback\n        }\n        \n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            const visibleSheets = worksheets.items.filter(\n                sheet => sheet.visibility === Excel.SheetVisibility.visible\n            );\n            \n            let hiddenCount = 0;\n            \n            worksheets.items.forEach((sheet) => {\n                const upperName = sheet.name.toUpperCase();\n                const isSystem = systemPrefixes.some(p => upperName.startsWith(p));\n                \n                if (isSystem && visibleSheets.length - hiddenCount > 1) {\n                    sheet.visibility = Excel.SheetVisibility.hidden;\n                    hiddenCount++;\n                    console.log(`[Tab Visibility] Hidden system sheet: ${sheet.name}`);\n                }\n            });\n            \n            await context.sync();\n        });\n    } catch (error) {\n        console.warn(\"[Tab Visibility] Error hiding system sheets:\", error);\n    }\n}\n\n/**\n * Force ALL sheets to be visible (emergency recovery / debugging)\n * Can be called from console: window.PrairieForge.showAllSheets()\n */\nexport async function showAllSheets() {\n    if (!hasExcelRuntime()) {\n        console.log(\"Excel not available\");\n        return;\n    }\n    \n    try {\n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            let unhiddenCount = 0;\n            worksheets.items.forEach((sheet) => {\n                if (sheet.visibility !== Excel.SheetVisibility.visible) {\n                    sheet.visibility = Excel.SheetVisibility.visible;\n                    console.log(`[ShowAll] Made visible: ${sheet.name}`);\n                    unhiddenCount++;\n                }\n            });\n            \n            await context.sync();\n            console.log(`[ShowAll] Done! Made ${unhiddenCount} sheets visible. Total: ${worksheets.items.length}`);\n        });\n    } catch (error) {\n        console.error(\"[Tab Visibility] Unable to show all sheets:\", error);\n    }\n}\n\n/**\n * Force unhide system sheets\n * Can be called from console: window.PrairieForge.unhideSystemSheets()\n */\nexport async function unhideSystemSheets() {\n    if (!hasExcelRuntime()) {\n        console.log(\"Excel not available\");\n        return;\n    }\n    \n    try {\n        const prefixConfig = await getPrefixConfig();\n        const systemPrefixes = [];\n        \n        for (const [prefix, module] of Object.entries(prefixConfig)) {\n            if (module === SYSTEM_MODULE) {\n                systemPrefixes.push(prefix);\n            }\n        }\n        \n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            worksheets.items.forEach((sheet) => {\n                const upperName = sheet.name.toUpperCase();\n                if (systemPrefixes.some(p => upperName.startsWith(p))) {\n                    sheet.visibility = Excel.SheetVisibility.visible;\n                    console.log(`[Unhide] Made visible: ${sheet.name}`);\n                }\n            });\n            \n            await context.sync();\n            console.log(\"[Unhide] System sheets are now visible!\");\n        });\n    } catch (error) {\n        console.error(\"[Tab Visibility] Unable to unhide system sheets:\", error);\n    }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// HELPER FUNCTIONS\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction buildHeaderMap(headers = []) {\n    const map = new Map();\n    headers.forEach((header, index) => {\n        const normalized = normalizeToken(header);\n        if (normalized) {\n            map.set(normalized, index);\n        }\n    });\n    return map;\n}\n\nfunction normalizeToken(value) {\n    return String(value ?? \"\")\n        .trim()\n        .toLowerCase()\n        .replace(/[\\s_]+/g, \"-\");\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// VALIDATION (for config sheet validation tools)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport function validateConfigRow(row, rowIndex) {\n    const errors = [];\n    const warnings = [];\n    \n    const category = normalizeToken(row.category || row[0] || \"\");\n    const field = String(row.field || row[1] || \"\").trim();\n    const value = String(row.value || row[2] || \"\").trim();\n    \n    if (!category) {\n        errors.push(`Row ${rowIndex}: Missing Category`);\n    } else if (!VALID_CATEGORIES[category]) {\n        errors.push(`Row ${rowIndex}: Invalid Category \"${row.category || row[0]}\". Valid: ${Object.keys(VALID_CATEGORIES).join(\", \")}`);\n    }\n    \n    if (!field) {\n        errors.push(`Row ${rowIndex}: Missing Field name`);\n    }\n    \n    if (!value && category !== \"step-notes\") {\n        warnings.push(`Row ${rowIndex}: Value is empty for \"${field}\"`);\n    }\n    \n    // Prefix validation\n    if (category === PREFIX_CATEGORY) {\n        if (!field.endsWith(\"_\")) {\n            warnings.push(`Row ${rowIndex}: Prefix \"${field}\" should end with underscore (e.g., \"PR_\")`);\n        }\n    }\n    \n    return { errors, warnings, isValid: errors.length === 0 };\n}\n\nexport async function validateConfigSheet() {\n    if (!hasExcelRuntime()) return { errors: [], warnings: [], isValid: true };\n    \n    const results = { errors: [], warnings: [], isValid: true, rowCount: 0 };\n    \n    try {\n        await Excel.run(async (context) => {\n            const configSheet = context.workbook.worksheets.getItemOrNullObject(CONFIG_SHEET_NAME);\n            await context.sync();\n            \n            if (configSheet.isNullObject) {\n                results.errors.push(\"SS_PF_Config sheet not found\");\n                results.isValid = false;\n                return;\n            }\n            \n            const usedRange = configSheet.getUsedRangeOrNullObject();\n            usedRange.load(\"values\");\n            await context.sync();\n            \n            if (usedRange.isNullObject || !usedRange.values || usedRange.values.length < 2) {\n                results.warnings.push(\"SS_PF_Config appears empty or has no data rows\");\n                return;\n            }\n            \n            const rows = usedRange.values;\n            results.rowCount = rows.length - 1;\n            \n            for (let i = 1; i < rows.length; i++) {\n                const row = rows[i];\n                const validation = validateConfigRow({\n                    category: row[0],\n                    field: row[1],\n                    value: row[2]\n                }, i + 1);\n                \n                results.errors.push(...validation.errors);\n                results.warnings.push(...validation.warnings);\n                if (!validation.isValid) results.isValid = false;\n            }\n        });\n    } catch (error) {\n        results.errors.push(`Validation error: ${error.message}`);\n        results.isValid = false;\n    }\n    \n    return results;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// GLOBAL EXPORTS (for console access)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nif (typeof window !== \"undefined\") {\n    window.PrairieForge = window.PrairieForge || {};\n    window.PrairieForge.showAllSheets = showAllSheets;\n    window.PrairieForge.unhideSystemSheets = unhideSystemSheets;\n    window.PrairieForge.applyModuleTabVisibility = applyModuleTabVisibility;\n}\n", "// Shared constants and utilities for Prairie Forge Payroll Recorder\n// Used by both Google Sheets (Apps Script) and Excel (Office.js) versions\n\n// Common worksheet names\nexport const WORKSHEET_NAMES = {\n  EMPLOYEES: 'Employees',\n  PAYROLL: 'PR_Data',\n  VALIDATION: 'PR_Data_Clean',\n  CONFIGURATION: 'SS_PF_Config',\n  EXPENSE_REVIEW: 'PR_Expense_Review',\n  JOURNAL_ENTRY: 'PR_JE_Draft',\n  ARCHIVE: 'PR_Archive_Summary',\n  HEADCOUNT: 'SS_Headcount_Review',\n  RECONCILIATION: 'Reconciliation',\n  IMPORTS: 'Imports',\n  REPORTS: 'Reports',\n  SUMMARY: 'Summary',\n  DASHBOARD: 'Dashboard'\n};\n\n// Common table names for Excel\nexport const TABLE_NAMES = {\n  EMPLOYEE_LIST: 'EmployeeTable',\n  PAYROLL_DATA: 'PayrollTable', \n  CONFIGURATION_SETTINGS: 'ConfigTable',\n  EXPENSE_ITEMS: 'ExpenseTable',\n  JOURNAL_ENTRIES: 'JournalTable'\n};\n\n// Branding constants\nexport const BRANDING = {\n  COMPANY_NAME: 'Prairie Forge LLC',\n  PRODUCT_NAME: 'Prairie Forge Tools',\n  SUPPORT_URL: 'https://prairieforge.ai/support',\n  ADA_IMAGE_URL: 'https://assets.prairieforge.ai/storage/v1/object/public/Other%20Public%20Material/Prairie%20Forge/Ada%20Image.png'\n};\n\n// GitHub repository information\nexport const REPOSITORY = {\n  OWNER: 'prairie-forge-ai',\n  NAME: 'prairie-forge-templates',\n  GITHUB_PAGES_BASE: 'https://prairie-forge-ai.github.io/prairie-forge-templates'\n};\n", "/**\n * Homepage Sheet Utilities\n * Creates and manages module landing pages with clean black backgrounds\n */\n\nimport { BRANDING } from \"./constants.js\";\n\n// Ada Assistant Configuration - imported from constants\nconst ADA_IMAGE_URL = BRANDING.ADA_IMAGE_URL;\n\n/**\n * Creates or activates a module homepage sheet with formatted styling\n * @param {string} sheetName - Name of the homepage sheet (e.g., \"PR_Homepage\")\n * @param {string} title - Module title to display (e.g., \"Payroll Recorder\")\n * @param {string} subtitle - Description/subtext for the module\n */\nexport async function activateHomepageSheet(sheetName, title, subtitle) {\n    if (typeof Excel === \"undefined\") {\n        console.warn(\"Excel runtime not available for homepage sheet\");\n        return;\n    }\n    \n    try {\n        await Excel.run(async (context) => {\n            // Check if sheet exists\n            const sheet = context.workbook.worksheets.getItemOrNullObject(sheetName);\n            sheet.load(\"isNullObject, name\");\n            await context.sync();\n            \n            let targetSheet;\n            \n            if (sheet.isNullObject) {\n                // Create the sheet\n                targetSheet = context.workbook.worksheets.add(sheetName);\n                await context.sync();\n                \n                // Set up the homepage content\n                await setupHomepageContent(context, targetSheet, title, subtitle);\n            } else {\n                targetSheet = sheet;\n                // Update content in case title/subtitle changed\n                await setupHomepageContent(context, targetSheet, title, subtitle);\n            }\n            \n            // Activate the sheet\n            targetSheet.activate();\n            targetSheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n    } catch (error) {\n        console.error(`Error activating homepage sheet ${sheetName}:`, error);\n    }\n}\n\n/**\n * Sets up the homepage sheet content and formatting\n */\nasync function setupHomepageContent(context, sheet, title, subtitle) {\n    // Clear existing content\n    try {\n        const usedRange = sheet.getUsedRangeOrNullObject();\n        usedRange.load(\"isNullObject\");\n        await context.sync();\n        if (!usedRange.isNullObject) {\n            usedRange.clear();\n            await context.sync();\n        }\n    } catch (e) {\n        // Ignore clear errors\n    }\n    \n    // Hide gridlines\n    sheet.showGridlines = false;\n    \n    // Set up column widths for a clean look\n    sheet.getRange(\"A:A\").format.columnWidth = 400; // Content area\n    sheet.getRange(\"B:B\").format.columnWidth = 50;  // Right padding\n    \n    // Set row heights\n    sheet.getRange(\"1:1\").format.rowHeight = 60;  // Title row\n    sheet.getRange(\"2:2\").format.rowHeight = 30;  // Subtitle row\n    \n    // Write content starting at A1\n    const data = [\n        [title, \"\"],\n        [subtitle, \"\"],\n        [\"\", \"\"],\n        [\"\", \"\"]\n    ];\n    \n    const dataRange = sheet.getRangeByIndexes(0, 0, 4, 2);\n    dataRange.values = data;\n    \n    // Apply black background to entire visible area\n    const backgroundRange = sheet.getRange(\"A1:Z100\");\n    backgroundRange.format.fill.color = \"#0f0f0f\";\n    \n    // Format title (A1)\n    const titleCell = sheet.getRange(\"A1\");\n    titleCell.format.font.bold = true;\n    titleCell.format.font.size = 36;\n    titleCell.format.font.color = \"#ffffff\";\n    titleCell.format.font.name = \"Segoe UI Light\";\n    titleCell.format.verticalAlignment = \"Center\";\n    \n    // Format subtitle (A2)\n    const subtitleCell = sheet.getRange(\"A2\");\n    subtitleCell.format.font.size = 14;\n    subtitleCell.format.font.color = \"#a0a0a0\";\n    subtitleCell.format.font.name = \"Segoe UI\";\n    subtitleCell.format.verticalAlignment = \"Top\";\n    \n    // Freeze panes to prevent scrolling issues\n    sheet.freezePanes.freezeRows(0);\n    sheet.freezePanes.freezeColumns(0);\n    \n    await context.sync();\n}\n\n/**\n * Homepage configurations for each module\n */\nexport const HOMEPAGE_CONFIG = {\n    \"module-selector\": {\n        sheetName: \"SS_Homepage\",\n        title: \"ForgeSuite\",\n        subtitle: \"Select a module from the side panel to get started.\"\n    },\n    \"payroll-recorder\": {\n        sheetName: \"PR_Homepage\",\n        title: \"Payroll Recorder\",\n        subtitle: \"Normalize payroll exports, enforce controls, and prep journal entries without leaving Excel.\"\n    },\n    \"pto-accrual\": {\n        sheetName: \"PTO_Homepage\",\n        title: \"PTO Accrual\",\n        subtitle: \"Calculate employee PTO liabilities, compare period-over-period changes, and prepare accrual journal entries.\"\n    }\n};\n\n/**\n * Get homepage config by module key\n */\nexport function getHomepageConfig(moduleKey) {\n    return HOMEPAGE_CONFIG[moduleKey] || HOMEPAGE_CONFIG[\"module-selector\"];\n}\n\n/**\n * Renders the floating Ada assistant button\n * Call this when showing the home view\n */\nexport function renderAdaFab() {\n    // Remove existing FAB if present\n    removeAdaFab();\n    \n    const fab = document.createElement(\"button\");\n    fab.className = \"pf-ada-fab\";\n    fab.id = \"pf-ada-fab\";\n    fab.setAttribute(\"aria-label\", \"Ask Ada\");\n    fab.setAttribute(\"title\", \"Ask Ada\");\n    fab.innerHTML = `\n        <span class=\"pf-ada-fab__ring\"></span>\n        <img \n            class=\"pf-ada-fab__image\" \n            src=\"${ADA_IMAGE_URL}\" \n            alt=\"Ada - Your AI Assistant\"\n            onerror=\"this.style.display='none'\"\n        />\n    `;\n    \n    document.body.appendChild(fab);\n    \n    // Bind click event\n    fab.addEventListener(\"click\", showAdaModal);\n    \n    return fab;\n}\n\n/**\n * Removes the Ada FAB from the DOM\n * Call this when navigating away from home view\n */\nexport function removeAdaFab() {\n    const existingFab = document.getElementById(\"pf-ada-fab\");\n    if (existingFab) {\n        existingFab.remove();\n    }\n    \n    // Also remove modal if open\n    const existingModal = document.getElementById(\"pf-ada-modal-overlay\");\n    if (existingModal) {\n        existingModal.remove();\n    }\n}\n\n/**\n * Shows the Ada assistant modal\n */\nexport function showAdaModal() {\n    // Remove existing modal if present\n    const existingModal = document.getElementById(\"pf-ada-modal-overlay\");\n    if (existingModal) {\n        existingModal.remove();\n    }\n    \n    const overlay = document.createElement(\"div\");\n    overlay.className = \"pf-ada-modal-overlay\";\n    overlay.id = \"pf-ada-modal-overlay\";\n    \n    overlay.innerHTML = `\n        <div class=\"pf-ada-modal\">\n            <div class=\"pf-ada-modal__header\">\n                <button class=\"pf-ada-modal__close\" id=\"ada-modal-close\" aria-label=\"Close\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                        <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n                        <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n                    </svg>\n                </button>\n                <img class=\"pf-ada-modal__avatar\" src=\"${ADA_IMAGE_URL}\" alt=\"Ada\" />\n                <h2 class=\"pf-ada-modal__title\"><span style=\"font-weight:400;\">ask</span><span style=\"font-weight:700;\">ADA</span></h2>\n                <p class=\"pf-ada-modal__subtitle\">Your AI-powered assistant</p>\n            </div>\n            <div class=\"pf-ada-modal__body\">\n                <div class=\"pf-ada-modal__features\">\n                    <div class=\"pf-ada-modal__feature\">\n                        <div class=\"pf-ada-modal__feature-icon\">\uD83D\uDCAC</div>\n                        <span class=\"pf-ada-modal__feature-text\">Ask questions about your data</span>\n                    </div>\n                    <div class=\"pf-ada-modal__feature\">\n                        <div class=\"pf-ada-modal__feature-icon\">\uD83D\uDCCA</div>\n                        <span class=\"pf-ada-modal__feature-text\">Get insights and trend analysis</span>\n                    </div>\n                    <div class=\"pf-ada-modal__feature\">\n                        <div class=\"pf-ada-modal__feature-icon\">\uD83D\uDD0D</div>\n                        <span class=\"pf-ada-modal__feature-text\">Troubleshoot issues quickly</span>\n                    </div>\n                </div>\n            </div>\n            <div class=\"pf-ada-modal__footer\">\n                <span class=\"pf-ada-modal__powered-by\">Powered by ChatGPT</span>\n            </div>\n        </div>\n    `;\n    \n    document.body.appendChild(overlay);\n    \n    // Trigger animation\n    requestAnimationFrame(() => {\n        overlay.classList.add(\"is-visible\");\n    });\n    \n    // Bind close events\n    const closeBtn = document.getElementById(\"ada-modal-close\");\n    closeBtn?.addEventListener(\"click\", hideAdaModal);\n    \n    // Close on overlay click\n    overlay.addEventListener(\"click\", (e) => {\n        if (e.target === overlay) {\n            hideAdaModal();\n        }\n    });\n    \n    // Close on Escape key\n    const handleEscape = (e) => {\n        if (e.key === \"Escape\") {\n            hideAdaModal();\n            document.removeEventListener(\"keydown\", handleEscape);\n        }\n    };\n    document.addEventListener(\"keydown\", handleEscape);\n}\n\n/**\n * Hides the Ada assistant modal\n */\nexport function hideAdaModal() {\n    const overlay = document.getElementById(\"pf-ada-modal-overlay\");\n    if (overlay) {\n        overlay.classList.remove(\"is-visible\");\n        setTimeout(() => {\n            overlay.remove();\n        }, 300);\n    }\n}\n\n", "export const HOME_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8\" />\n        <path\n            d=\"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"\n        />\n    </svg>\n`.trim();\n\n// Grid/Apps icon - 2x2 grid for module selector\nexport const MODULES_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <rect width=\"7\" height=\"7\" x=\"3\" y=\"3\" rx=\"1\" />\n        <rect width=\"7\" height=\"7\" x=\"14\" y=\"3\" rx=\"1\" />\n        <rect width=\"7\" height=\"7\" x=\"14\" y=\"14\" rx=\"1\" />\n        <rect width=\"7\" height=\"7\" x=\"3\" y=\"14\" rx=\"1\" />\n    </svg>\n`.trim();\n\n// Quick Access menu icon (hamburger/more)\nexport const MENU_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"1\"/>\n        <circle cx=\"12\" cy=\"5\" r=\"1\"/>\n        <circle cx=\"12\" cy=\"19\" r=\"1\"/>\n    </svg>\n`.trim();\n\n// Table/Grid icon for expense mapping\nexport const TABLE_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M12 3v18\"/>\n        <rect width=\"18\" height=\"18\" x=\"3\" y=\"3\" rx=\"2\"/>\n        <path d=\"M3 9h18\"/>\n        <path d=\"M3 15h18\"/>\n    </svg>\n`.trim();\n\n// Quick Access icons\nexport const USERS_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/>\n        <circle cx=\"9\" cy=\"7\" r=\"4\"/>\n        <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/>\n        <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/>\n    </svg>\n`.trim();\n\nexport const BOOK_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20\"/>\n        <path d=\"M8 7h6\"/>\n        <path d=\"M8 11h8\"/>\n    </svg>\n`.trim();\n\nconst STEP_ICON_MAP = {\n    config: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <circle cx=\"12\" cy=\"12\" r=\"3\" />\n            <path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.82 2.82l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.82-2.82l.06-.06A1.65 1.65 0 0 0 3 15a1.65 1.65 0 0 0-1.51-1H1a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 3 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.82-2.82l.06.06A1.65 1.65 0 0 0 9 3.6a1.65 1.65 0 0 0 1-1.51V2a2 2 0 0 1 4 0v.09A1.65 1.65 0 0 0 15 3.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.82 2.82l-.06.06A1.65 1.65 0 0 0 21 9c0 .3.09.58.24.82.17.28.43.51.76.68.21.1.44.18.68.19H23a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z\" />\n        </svg>\n    `,\n    import: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M12 3v14\" />\n            <path d=\"m7 13 5 5 5-5\" />\n            <path d=\"M5 21h14\" />\n        </svg>\n    `,\n    headcount: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\" />\n            <circle cx=\"9\" cy=\"7\" r=\"4\" />\n            <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\" />\n            <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\n        </svg>\n    `,\n    validate: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M20 6 9 17l-5-5\" />\n        </svg>\n    `,\n    review: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M3 12h3l2-5 4 10 2-5h5\" />\n        </svg>\n    `,\n    journal: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M12 7c-3-1-6-1-9 0v12c3-1 6-1 9 0 3-1 6-1 9 0V7c-3-1-6-1-9 0Z\" />\n            <path d=\"M12 7v12\" />\n        </svg>\n    `,\n    archive: `\n        <svg class=\"pf-icon pf-step-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"4\" rx=\"1\" />\n            <path d=\"M5 7v11a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7\" />\n            <path d=\"M10 12h4\" />\n        </svg>\n    `\n};\n\nexport function getStepIconSvg(type) {\n    if (!type) return \"\";\n    return STEP_ICON_MAP[type] || \"\";\n}\n\nexport const LOCK_OPEN_SVG = `\n    <svg\n        class=\"pf-icon pf-lock-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n        <path d=\"M7 11V7a5 5 0 0 1 10 0\" />\n    </svg>\n`.trim();\n\nexport const LOCK_CLOSED_SVG = `\n    <svg\n        class=\"pf-icon pf-lock-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\" />\n        <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\n        <path d=\"M12 15v2\" />\n    </svg>\n`.trim();\n\nexport const CHECK_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M5 12l4 4 10-10\" />\n    </svg>\n`.trim();\n\nexport const CALCULATOR_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <rect x=\"4\" y=\"3\" width=\"16\" height=\"18\" rx=\"2\" />\n        <rect x=\"8\" y=\"7\" width=\"8\" height=\"3\" />\n        <path d=\"M8 14h.01\" />\n        <path d=\"M12 14h.01\" />\n        <path d=\"M16 14h.01\" />\n        <path d=\"M8 17h.01\" />\n        <path d=\"M12 17h.01\" />\n        <path d=\"M16 17h.01\" />\n    </svg>\n`.trim();\n\nexport const HAMMER_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M18 5.5 20.5 8 16 12.5 13.5 10 18 5.5Z\" />\n        <path d=\"m12 11 6-6\" />\n        <path d=\"M3 22 12 13\" />\n        <path d=\"m3 18 4 4\" />\n        <path d=\"m11 11 3 3\" />\n    </svg>\n`.trim();\n\nexport const LINK_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\" />\n        <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 1 0 7.07 7.07l1.71-1.71\" />\n    </svg>\n`.trim();\n\nexport const DOWNLOAD_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\n        <path d=\"M7 10l5 5 5-5\" />\n        <path d=\"M12 15V3\" />\n    </svg>\n`.trim();\n\nexport const X_CIRCLE_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\" />\n        <path d=\"m15 9-6 6\" />\n        <path d=\"m9 9 6 6\" />\n    </svg>\n`.trim();\nexport const ARROW_LEFT_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m12 19-7-7 7-7\" />\n        <path d=\"M19 12H5\" />\n    </svg>\n`.trim();\n\nexport const SAVE_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z\" />\n        <path d=\"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7\" />\n        <path d=\"M7 3v4a1 1 0 0 0 1 1h7\" />\n    </svg>\n`.trim();\n\nexport const ARROW_RIGHT_SVG = `\n    <svg\n        class=\"pf-icon pf-nav-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m12 5 7 7-7 7\" />\n        <path d=\"M5 12h14\" />\n    </svg>\n`.trim();\n\n// Status/Feedback icons\nexport const CHECK_CIRCLE_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <path d=\"m9 12 2 2 4-4\"/>\n    </svg>\n`.trim();\n\nexport const ALERT_CIRCLE_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <line x1=\"12\" x2=\"12\" y1=\"8\" y2=\"12\"/>\n        <line x1=\"12\" x2=\"12.01\" y1=\"16\" y2=\"16\"/>\n    </svg>\n`.trim();\n\nexport const ALERT_TRIANGLE_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3\"/>\n        <path d=\"M12 9v4\"/>\n        <path d=\"M12 17h.01\"/>\n    </svg>\n`.trim();\n\nexport const INFO_CIRCLE_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <path d=\"M12 16v-4\"/>\n        <path d=\"M12 8h.01\"/>\n    </svg>\n`.trim();\n\nexport const CIRCLE_CHECK_BIG_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"M21.801 10A10 10 0 1 1 17 3.335\"/>\n        <path d=\"m9 11 3 3L22 4\"/>\n    </svg>\n`.trim();\n\nexport const CIRCLE_X_SVG = `\n    <svg\n        class=\"pf-icon pf-status-icon\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <path d=\"m15 9-6 6\"/>\n        <path d=\"m9 9 6 6\"/>\n    </svg>\n`.trim();\n\n// Mismatch tile icons\nexport const ARROW_UP_FROM_LINE_SVG = `\n    <svg\n        class=\"pf-icon pf-mismatch-icon-svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m18 9-6-6-6 6\"/>\n        <path d=\"M12 3v14\"/>\n        <path d=\"M5 21h14\"/>\n    </svg>\n`.trim();\n\nexport const ARROW_DOWN_TO_LINE_SVG = `\n    <svg\n        class=\"pf-icon pf-mismatch-icon-svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n    >\n        <path d=\"m6 15 6 6 6-6\"/>\n        <path d=\"M12 21V7\"/>\n        <path d=\"M5 3h14\"/>\n    </svg>\n`.trim();\n\nexport const REFRESH_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\"/>\n        <path d=\"M21 3v5h-5\"/>\n        <path d=\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\"/>\n        <path d=\"M3 21v-5h5\"/>\n    </svg>\n`.trim();\n\nexport const TRASH_ICON_SVG = `\n    <svg\n        class=\"pf-icon pf-action-icon\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n    >\n        <path d=\"M3 6h18\"/>\n        <path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"/>\n        <path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"/>\n        <line x1=\"10\" x2=\"10\" y1=\"11\" y2=\"17\"/>\n        <line x1=\"14\" x2=\"14\" y1=\"11\" y2=\"17\"/>\n    </svg>\n`.trim();\n", "import { LOCK_CLOSED_SVG, LOCK_OPEN_SVG, CHECK_ICON_SVG, SAVE_ICON_SVG } from \"./icons.js\";\n\n/**\n * Escape HTML special characters\n * @param {string} str - String to escape\n * @returns {string} Escaped string\n */\nfunction escapeHtml(str) {\n    if (str == null) return \"\";\n    return String(str)\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\")\n        .replace(/'/g, \"&#39;\");\n}\n\n/**\n * Render a labeled button (icon + label below)\n * @param {string} buttonHtml - The button HTML\n * @param {string} label - Label text to display below the button\n * @returns {string} HTML string wrapped with label\n */\nexport function renderLabeledButton(buttonHtml, label) {\n    return `\n        <div class=\"pf-labeled-btn\">\n            ${buttonHtml}\n            <span class=\"pf-btn-label\">${label}</span>\n        </div>\n    `;\n}\n\n/**\n * Render the notes section with save and lock buttons\n * @param {Object} options - Rendering options\n * @param {string} options.textareaId - ID for the textarea element\n * @param {string} options.value - Current notes value\n * @param {string} options.permanentId - ID for the lock button (optional)\n * @param {boolean} options.isPermanent - Whether notes are locked\n * @param {string} options.hintId - ID for hint element (optional)\n * @param {string} options.saveButtonId - ID for save button (optional)\n * @param {boolean} options.isSaved - Whether notes are currently saved (optional)\n * @param {string} options.placeholder - Placeholder text (optional)\n * @returns {string} HTML string\n */\nexport function renderInlineNotes({\n    textareaId,\n    value,\n    permanentId,\n    isPermanent,\n    hintId,\n    saveButtonId,\n    isSaved = false,\n    placeholder = \"Enter notes here...\"\n}) {\n    const lockIcon = isPermanent ? LOCK_CLOSED_SVG : LOCK_OPEN_SVG;\n\n    const saveButton = saveButtonId\n        ? `<button type=\"button\" class=\"pf-action-toggle pf-save-btn ${isSaved ? \"is-saved\" : \"\"}\" id=\"${saveButtonId}\" data-save-input=\"${textareaId}\" title=\"Save notes\">${SAVE_ICON_SVG}</button>`\n        : \"\";\n\n    const lockButton = permanentId\n        ? `<button type=\"button\" class=\"pf-action-toggle pf-notes-lock ${isPermanent ? \"is-locked\" : \"\"}\" id=\"${permanentId}\" aria-pressed=\"${isPermanent}\" title=\"Lock notes (retain after archive)\">${lockIcon}</button>`\n        : \"\";\n\n    return `\n        <article class=\"pf-step-card pf-step-detail pf-notes-card\">\n            <div class=\"pf-notes-header\">\n                <div>\n                    <h3 class=\"pf-notes-title\">Notes</h3>\n                    <p class=\"pf-notes-subtext\">Leave notes your future self will appreciate. Notes clear after archiving. Click lock to retain permanently.</p>\n                </div>\n            </div>\n            <div class=\"pf-notes-body\">\n                <textarea id=\"${textareaId}\" rows=\"6\" placeholder=\"${escapeHtml(placeholder)}\">${escapeHtml(value || \"\")}</textarea>\n                ${hintId ? `<p class=\"pf-signoff-hint\" id=\"${hintId}\"></p>` : \"\"}\n            </div>\n            <div class=\"pf-notes-action\">\n                ${permanentId ? renderLabeledButton(lockButton, \"Lock\") : \"\"}\n                ${saveButtonId ? renderLabeledButton(saveButton, \"Save\") : \"\"}\n            </div>\n        </article>\n    `;\n}\n\n/**\n * Render the sign-off section with save and complete buttons\n * @param {Object} options - Rendering options\n * @param {string} options.reviewerInputId - ID for reviewer name input\n * @param {string} options.reviewerValue - Current reviewer name\n * @param {string} options.signoffInputId - ID for sign-off date input\n * @param {string} options.signoffValue - Current sign-off date\n * @param {boolean} options.isComplete - Whether step is marked complete\n * @param {string} options.saveButtonId - ID for save button\n * @param {boolean} options.isSaved - Whether sign-off is currently saved (optional)\n * @param {string} options.completeButtonId - ID for complete toggle button\n * @param {string} options.subtext - Subtext description (optional)\n * @returns {string} HTML string\n */\nexport function renderSignoff({\n    reviewerInputId,\n    reviewerValue,\n    signoffInputId,\n    signoffValue,\n    isComplete,\n    saveButtonId, // retained for compatibility; no separate save button rendered\n    isSaved = false, // retained for compatibility\n    completeButtonId,\n    subtext = \"Sign-off below. Click checkmark icon. Done.\"\n}) {\n    const completeButton = `<button type=\"button\" class=\"pf-action-toggle ${isComplete ? \"is-active\" : \"\"}\" id=\"${completeButtonId}\" aria-pressed=\"${Boolean(isComplete)}\" title=\"Mark step complete\">${CHECK_ICON_SVG}</button>`;\n\n    return `\n        <article class=\"pf-step-card pf-step-detail pf-config-card\">\n            <div class=\"pf-config-head pf-notes-header\">\n                <div>\n                    <h3>Sign-off</h3>\n                    <p class=\"pf-config-subtext\">${escapeHtml(subtext)}</p>\n                </div>\n            </div>\n            <div class=\"pf-config-grid\">\n                <label class=\"pf-config-field\">\n                    <span>Reviewer Name</span>\n                    <input type=\"text\" id=\"${reviewerInputId}\" value=\"${escapeHtml(reviewerValue)}\" placeholder=\"Full name\">\n                </label>\n                <label class=\"pf-config-field\">\n                    <span>Sign-off Date</span>\n                    <input type=\"date\" id=\"${signoffInputId}\" value=\"${escapeHtml(signoffValue)}\" readonly>\n                </label>\n            </div>\n            <div class=\"pf-signoff-action\">\n                ${renderLabeledButton(completeButton, \"Done\")}\n            </div>\n        </article>\n    `;\n}\n\n/**\n * Render combined notes and sign-off sections\n * @param {Object} options - Combined options for both sections\n * @returns {string} HTML string\n */\nexport function renderNotesAndSignoff({\n    // Notes options\n    textareaId,\n    notesValue,\n    permanentId,\n    isPermanent,\n    hintId,\n    notesSaveButtonId,\n    placeholder,\n    // Sign-off options\n    reviewerInputId,\n    reviewerValue,\n    signoffInputId,\n    signoffValue,\n    isComplete,\n    signoffSaveButtonId,\n    completeButtonId,\n    subtext\n}) {\n    return `\n        ${renderInlineNotes({\n            textareaId,\n            value: notesValue,\n            permanentId,\n            isPermanent,\n            hintId,\n            saveButtonId: notesSaveButtonId,\n            placeholder\n        })}\n        ${renderSignoff({\n            reviewerInputId,\n            reviewerValue,\n            signoffInputId,\n            signoffValue,\n            isComplete,\n            saveButtonId: signoffSaveButtonId,\n            completeButtonId,\n            subtext\n        })}\n    `;\n}\n\n/**\n * Update lock button visual state\n * @param {HTMLElement} button - Lock button element\n * @param {boolean} isLocked - Whether locked\n */\nexport function updateLockButtonVisual(button, isLocked) {\n    if (!button) return;\n    button.classList.toggle(\"is-locked\", isLocked);\n    button.setAttribute(\"aria-pressed\", String(isLocked));\n    button.innerHTML = isLocked ? LOCK_CLOSED_SVG : LOCK_OPEN_SVG;\n}\n\n/**\n * Update action toggle button state\n * @param {HTMLElement} button - Toggle button element\n * @param {boolean} isActive - Whether active\n */\nexport function updateActionToggleState(button, isActive) {\n    if (!button) return;\n    button.classList.toggle(\"is-active\", isActive);\n    button.setAttribute(\"aria-pressed\", String(isActive));\n}\n\n/**\n * Update save button visual state\n * @param {HTMLElement} button - Save button element\n * @param {boolean} isSaved - Whether content is saved\n */\nexport function updateSaveButtonState(button, isSaved) {\n    if (!button) return;\n    button.classList.toggle(\"is-saved\", isSaved);\n}\n\n/**\n * Initialize save state tracking for all save buttons in a container.\n * Finds all buttons with class \"pf-save-btn\" and data-save-input attribute,\n * then auto-wires input change tracking to toggle the saved state.\n *\n * @param {HTMLElement|Document} container - Container to search for save buttons (defaults to document)\n * @returns {Function} Cleanup function to remove all event listeners\n */\nexport function initSaveTracking(container = document) {\n    const saveButtons = container.querySelectorAll(\".pf-save-btn[data-save-input]\");\n    const cleanupFns = [];\n\n    saveButtons.forEach((saveButton) => {\n        const inputId = saveButton.getAttribute(\"data-save-input\");\n        const input = document.getElementById(inputId);\n        if (!input) return;\n\n        const handleChange = () => {\n            updateSaveButtonState(saveButton, false);\n        };\n\n        input.addEventListener(\"input\", handleChange);\n        cleanupFns.push(() => input.removeEventListener(\"input\", handleChange));\n    });\n\n    return () => cleanupFns.forEach((fn) => fn());\n}\n", "/**\n * Workflow Validation Utilities\n * \n * Ensures steps are completed sequentially.\n * Users can VIEW any step, but cannot COMPLETE until previous steps are signed off.\n */\n\n/**\n * Check if a step can be completed based on previous step completion status\n * @param {number} stepId - The step ID to check (0-based)\n * @param {Object} completionStatus - Object mapping step IDs to completion status\n * @returns {{ canComplete: boolean, blockedBy: number|null, message: string }}\n */\nexport function canCompleteStep(stepId, completionStatus) {\n    // Step 0 can always be completed (no prerequisites)\n    if (stepId === 0) {\n        return { canComplete: true, blockedBy: null, message: \"\" };\n    }\n    \n    // Check all previous steps\n    for (let i = 0; i < stepId; i++) {\n        if (!completionStatus[i]) {\n            return {\n                canComplete: false,\n                blockedBy: i,\n                message: `Complete Step ${i} before signing off on this step.`\n            };\n        }\n    }\n    \n    return { canComplete: true, blockedBy: null, message: \"\" };\n}\n\n/**\n * Get completion status for all steps from config state\n * @param {Object} configState - The module's config state object\n * @param {Object} stepFields - Mapping of step IDs to their config field names\n * @returns {Object} Map of step IDs to boolean completion status\n */\nexport function getStepCompletionStatus(configState, stepFields) {\n    const status = {};\n    \n    Object.keys(stepFields).forEach(stepId => {\n        const id = parseInt(stepId, 10);\n        // A step is complete if it has a sign-off date OR is explicitly marked complete\n        const hasSignOff = Boolean(configState.signoffs?.[id] || configState.values?.[stepFields[id]?.signOff]);\n        const isMarkedComplete = Boolean(configState.completes?.[id]);\n        status[id] = hasSignOff || isMarkedComplete;\n    });\n    \n    return status;\n}\n\n/**\n * Handle sign-off attempt with sequential validation\n * @param {number} stepId - The step being signed off\n * @param {Object} completionStatus - Current completion status of all steps\n * @param {Function} onAllowed - Callback if sign-off is allowed\n * @param {Function} onBlocked - Callback if sign-off is blocked (receives blockedBy step ID and message)\n */\nexport function handleSignoffAttempt(stepId, completionStatus, onAllowed, onBlocked) {\n    const { canComplete, blockedBy, message } = canCompleteStep(stepId, completionStatus);\n    \n    if (canComplete) {\n        onAllowed();\n    } else {\n        onBlocked(blockedBy, message);\n    }\n}\n\n/**\n * Create a visual blocker overlay for sign-off section\n * @param {string} message - Message to display\n * @param {number} blockedByStep - The step number that needs completion\n * @returns {string} HTML string for the blocker overlay\n */\nexport function renderSignoffBlocker(message, blockedByStep) {\n    return `\n        <div class=\"pf-signoff-blocker\">\n            <div class=\"pf-signoff-blocker-content\">\n                <span class=\"pf-signoff-blocker-icon\">\uD83D\uDD12</span>\n                <p class=\"pf-signoff-blocker-message\">${message}</p>\n                <button type=\"button\" class=\"pf-signoff-blocker-btn\" data-goto-step=\"${blockedByStep}\">\n                    Go to Step ${blockedByStep}\n                </button>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Show a toast notification when sign-off is blocked\n * @param {string} message - Message to display\n */\nexport function showBlockedToast(message) {\n    // Remove any existing toast\n    const existing = document.querySelector('.pf-workflow-toast');\n    if (existing) existing.remove();\n    \n    const toast = document.createElement('div');\n    toast.className = 'pf-workflow-toast pf-workflow-toast--warning';\n    toast.innerHTML = `\n        <span class=\"pf-workflow-toast-icon\">\u26A0\uFE0F</span>\n        <span class=\"pf-workflow-toast-message\">${message}</span>\n    `;\n    \n    document.body.appendChild(toast);\n    \n    // Trigger animation\n    requestAnimationFrame(() => {\n        toast.classList.add('pf-workflow-toast--visible');\n    });\n    \n    // Auto-remove after 4 seconds\n    setTimeout(() => {\n        toast.classList.remove('pf-workflow-toast--visible');\n        setTimeout(() => toast.remove(), 300);\n    }, 4000);\n}\n\n/**\n * Bind workflow validation to sign-off buttons\n * @param {HTMLElement} container - Container element\n * @param {number} stepId - Current step ID\n * @param {Function} getCompletionStatus - Function that returns current completion status\n * @param {Function} onSignoff - Callback when sign-off is allowed and clicked\n * @param {Function} navigateToStep - Function to navigate to a specific step\n */\nexport function bindWorkflowValidation(container, stepId, getCompletionStatus, onSignoff, navigateToStep) {\n    // Find sign-off toggle buttons (they have IDs like \"step-signoff-toggle-X\" or similar patterns)\n    const signoffToggles = container.querySelectorAll('[id*=\"signoff-toggle\"], [id*=\"step-signoff-toggle\"]');\n    \n    signoffToggles.forEach(toggle => {\n        const originalClickHandler = toggle.onclick;\n        \n        toggle.addEventListener('click', (e) => {\n            const completionStatus = getCompletionStatus();\n            const { canComplete, blockedBy, message } = canCompleteStep(stepId, completionStatus);\n            \n            if (!canComplete) {\n                e.preventDefault();\n                e.stopPropagation();\n                showBlockedToast(message);\n                \n                // Optionally highlight the blocked step\n                if (navigateToStep && blockedBy !== null) {\n                    // Could add a \"Go to Step X\" button in the toast\n                }\n                return false;\n            }\n            \n            // If allowed, proceed with sign-off\n            if (onSignoff) {\n                onSignoff();\n            }\n        });\n    });\n}\n\n", "/**\n * Sheet Formatting - Shared utilities for consistent Excel sheet formatting\n * \n * Usage:\n *   import { formatSheetHeaders, formatCurrencyColumn, formatDateColumn, formatNumberColumn } from \"../../Common/sheet-formatting.js\";\n */\n\n// Standard Prairie Forge header style: black background, white bold text\nexport const HEADER_STYLE = {\n    fillColor: \"#000000\",\n    fontColor: \"#FFFFFF\",\n    bold: true\n};\n\n// Number format patterns\nexport const NUMBER_FORMATS = {\n    currency: \"$#,##0.00\",\n    currencyWithNegative: \"$#,##0.00;($#,##0.00)\",\n    number: \"#,##0.00\",\n    integer: \"#,##0\",\n    percent: \"0.00%\",\n    date: \"yyyy-mm-dd\",\n    dateTime: \"yyyy-mm-dd hh:mm\"\n};\n\n/**\n * Apply standard Prairie Forge header formatting to a range\n * @param {Excel.Range} headerRange - The header row range\n */\nexport function formatSheetHeaders(headerRange) {\n    headerRange.format.fill.color = HEADER_STYLE.fillColor;\n    headerRange.format.font.color = HEADER_STYLE.fontColor;\n    headerRange.format.font.bold = HEADER_STYLE.bold;\n}\n\n/**\n * Write data to a sheet with formatted headers\n * Clears existing content, writes headers + data, applies formatting\n * \n * @param {Excel.RequestContext} context - Excel context\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {string[]} headers - Array of header strings\n * @param {any[][]} dataRows - 2D array of data rows\n * @param {Object} [options] - Optional formatting options\n * @param {Object.<number, string>} [options.columnFormats] - Map of column index to format string\n * @returns {Promise<Excel.Range>} The data range (excluding headers)\n */\nexport async function writeSheetWithHeaders(context, sheet, headers, dataRows, options = {}) {\n    // Clear existing content\n    const used = sheet.getUsedRangeOrNullObject();\n    used.load(\"isNullObject\");\n    await context.sync();\n    if (!used.isNullObject) {\n        used.clear();\n    }\n    \n    const columnCount = headers.length;\n    const rowCount = dataRows.length + 1; // +1 for header row\n    \n    // Combine headers and data\n    const output = [headers, ...dataRows];\n    \n    // Write all data\n    const fullRange = sheet.getRangeByIndexes(0, 0, rowCount, columnCount);\n    fullRange.values = output;\n    \n    // Format header row\n    const headerRange = sheet.getRangeByIndexes(0, 0, 1, columnCount);\n    formatSheetHeaders(headerRange);\n    \n    // Apply column formats if specified\n    if (options.columnFormats && dataRows.length > 0) {\n        for (const [colIndex, format] of Object.entries(options.columnFormats)) {\n            const col = parseInt(colIndex, 10);\n            if (col >= 0 && col < columnCount) {\n                const colRange = sheet.getRangeByIndexes(1, col, dataRows.length, 1);\n                colRange.numberFormat = [[format]];\n            }\n        }\n    }\n    \n    // Auto-fit columns\n    fullRange.format.autofitColumns();\n    await context.sync();\n    \n    // Return the data range (for further operations if needed)\n    return dataRows.length > 0 \n        ? sheet.getRangeByIndexes(1, 0, dataRows.length, columnCount)\n        : null;\n}\n\n/**\n * Format a column as currency\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n * @param {boolean} [showNegativeInParens=false] - Show negative values in parentheses\n */\nexport function formatCurrencyColumn(sheet, colIndex, dataRowCount, showNegativeInParens = false) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[showNegativeInParens ? NUMBER_FORMATS.currencyWithNegative : NUMBER_FORMATS.currency]];\n}\n\n/**\n * Format a column as a number with commas and 2 decimal places\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n */\nexport function formatNumberColumn(sheet, colIndex, dataRowCount) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[NUMBER_FORMATS.number]];\n}\n\n/**\n * Format a column as a date\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n * @param {string} [format] - Custom date format (defaults to yyyy-mm-dd)\n */\nexport function formatDateColumn(sheet, colIndex, dataRowCount, format = NUMBER_FORMATS.date) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[format]];\n}\n\n/**\n * Format a column as integer (no decimals)\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n */\nexport function formatIntegerColumn(sheet, colIndex, dataRowCount) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[NUMBER_FORMATS.integer]];\n}\n\n/**\n * Format a column as percentage\n * @param {Excel.Worksheet} sheet - Target worksheet\n * @param {number} colIndex - 0-based column index\n * @param {number} dataRowCount - Number of data rows (excluding header)\n */\nexport function formatPercentColumn(sheet, colIndex, dataRowCount) {\n    if (dataRowCount <= 0) return;\n    const colRange = sheet.getRangeByIndexes(1, colIndex, dataRowCount, 1);\n    colRange.numberFormat = [[NUMBER_FORMATS.percent]];\n}\n\n", "import { applyModuleTabVisibility, showAllSheets } from \"../../Common/tab-visibility.js\";\nimport { bindInstructionsButton } from \"../../Common/instructions.js\";\nimport { activateHomepageSheet, getHomepageConfig, renderAdaFab, removeAdaFab } from \"../../Common/homepage-sheet.js\";\nimport {\n    HOME_ICON_SVG,\n    MODULES_ICON_SVG,\n    ARROW_LEFT_SVG,\n    USERS_ICON_SVG,\n    BOOK_ICON_SVG,\n    ARROW_RIGHT_SVG,\n    MENU_ICON_SVG,\n    LOCK_CLOSED_SVG,\n    LOCK_OPEN_SVG,\n    CHECK_ICON_SVG,\n    X_CIRCLE_SVG,\n    CALCULATOR_ICON_SVG,\n    LINK_ICON_SVG,\n    SAVE_ICON_SVG,\n    TABLE_ICON_SVG,\n    DOWNLOAD_ICON_SVG,\n    REFRESH_ICON_SVG,\n    TRASH_ICON_SVG,\n    getStepIconSvg\n} from \"../../Common/icons.js\";\nimport { renderInlineNotes, renderSignoff, renderLabeledButton, updateLockButtonVisual, updateSaveButtonState, initSaveTracking } from \"../../Common/notes-signoff.js\";\nimport { canCompleteStep, showBlockedToast } from \"../../Common/workflow-validation.js\";\nimport { loadConfigFromTable, saveConfigValue, hasExcelRuntime } from \"../../Common/gateway.js\";\nimport { formatSheetHeaders, formatCurrencyColumn, formatNumberColumn, formatDateColumn, NUMBER_FORMATS } from \"../../Common/sheet-formatting.js\";\n\nconst MODULE_VERSION = \"1.1.0\";\nconst MODULE_KEY = \"pto-accrual\";\nconst MODULE_ALIAS_TOKENS = [\"pto\", \"pto-accrual\", \"pto review\", \"accrual\"];\nconst MODULE_NAME = \"PTO Accrual\";\nconst HERO_COPY =\n    \"Calculate your PTO liability, compare against last period, and generate a balanced journal entry\u2014all without leaving Excel.\";\nconst SELECTOR_URL = \"../module-selector/index.html\";\nconst LOADER_ID = \"pf-loader-overlay\";\nconst CONFIG_TABLES = [\"SS_PF_Config\"];\n// PTO Config Fields - Pattern: PTO_{Descriptor}\nconst PTO_CONFIG_FIELDS = {\n    payrollProvider: \"PTO_Payroll_Provider\",\n    payrollDate: \"PTO_Analysis_Date\",\n    accountingPeriod: \"PTO_Accounting_Period\",\n    journalEntryId: \"PTO_Journal_Entry_ID\",\n    companyName: \"SS_Company_Name\",           // Shared field\n    accountingSoftware: \"SS_Accounting_Software\", // Shared field\n    reviewerName: \"PTO_Reviewer\",\n    validationDataBalance: \"PTO_Validation_Data_Balance\",\n    validationCleanBalance: \"PTO_Validation_Clean_Balance\",\n    validationDifference: \"PTO_Validation_Difference\",\n    headcountRosterCount: \"PTO_Headcount_Roster_Count\",\n    headcountPayrollCount: \"PTO_Headcount_Payroll_Count\",\n    headcountDifference: \"PTO_Headcount_Difference\",\n    journalDebitTotal: \"PTO_JE_Debit_Total\",\n    journalCreditTotal: \"PTO_JE_Credit_Total\",\n    journalDifference: \"PTO_JE_Difference\"\n};\nconst HEADCOUNT_SKIP_NOTE = \"User opted to skip the headcount review this period.\";\n// Step notes/sign-off fields - Pattern: PTO_{Type}_{StepName}\nconst STEP_CONFIG_FIELDS = {\n    0: { note: \"PTO_Notes_Config\", reviewer: \"PTO_Reviewer_Config\", signOff: \"PTO_SignOff_Config\" },\n    1: { note: \"PTO_Notes_Import\", reviewer: \"PTO_Reviewer_Import\", signOff: \"PTO_SignOff_Import\" },\n    2: { note: \"PTO_Notes_Headcount\", reviewer: \"PTO_Reviewer_Headcount\", signOff: \"PTO_SignOff_Headcount\" },\n    3: { note: \"PTO_Notes_Validate\", reviewer: \"PTO_Reviewer_Validate\", signOff: \"PTO_SignOff_Validate\" },\n    4: { note: \"PTO_Notes_Review\", reviewer: \"PTO_Reviewer_Review\", signOff: \"PTO_SignOff_Review\" },\n    5: { note: \"PTO_Notes_JE\", reviewer: \"PTO_Reviewer_JE\", signOff: \"PTO_SignOff_JE\" },\n    6: { note: \"PTO_Notes_Archive\", reviewer: \"PTO_Reviewer_Archive\", signOff: \"PTO_SignOff_Archive\" }\n};\nconst STEP_COMPLETE_FIELDS = {\n    0: \"PTO_Complete_Config\",\n    1: \"PTO_Complete_Import\",\n    2: \"PTO_Complete_Headcount\",\n    3: \"PTO_Complete_Validate\",\n    4: \"PTO_Complete_Review\",\n    5: \"PTO_Complete_JE\",\n    6: \"PTO_Complete_Archive\"\n};\n\nconst PTO_ACTIVITY_COLUMNS = [\n    { key: \"employeeId\", header: \"Employee ID\" },\n    { key: \"employeeName\", header: \"Employee Name\" },\n    { key: \"actionDate\", header: \"Action Date\" },\n    { key: \"actionType\", header: \"Action\" },\n    { key: \"hours\", header: \"Hours\" },\n    { key: \"notes\", header: \"Notes\" },\n    { key: \"source\", header: \"Source\" }\n];\n\n// PTO_Analysis columns - combines enriched data + analysis view\nconst PTO_ANALYSIS_COLUMNS = [\n    { key: \"analysisDate\", header: \"Analysis Date\" },\n    { key: \"employeeName\", header: \"Employee Name\" },\n    { key: \"department\", header: \"Department\" },\n    { key: \"payRate\", header: \"Pay Rate\" },\n    { key: \"accrualRate\", header: \"Accrual Rate\" },\n    { key: \"carryOver\", header: \"Carry Over\" },\n    { key: \"balance\", header: \"Balance\" },\n    { key: \"liabilityAmount\", header: \"Liability Amount\" }\n];\n\nconst PTO_EXPENSE_COLUMNS = [\n    { key: \"department\", header: \"Department\" },\n    { key: \"currentPeriod\", header: \"Current Period\" },\n    { key: \"priorPeriod\", header: \"Prior Period\" },\n    { key: \"variance\", header: \"Variance\" },\n    { key: \"comment\", header: \"Comment\" }\n];\n\nconst PTO_JOURNAL_COLUMNS = [\n    { key: \"account\", header: \"Account\" },\n    { key: \"description\", header: \"Description\" },\n    { key: \"debit\", header: \"Debit\" },\n    { key: \"credit\", header: \"Credit\" },\n    { key: \"reference\", header: \"Reference\" }\n];\n\nconst WORKFLOW_STEPS = [\n    {\n        id: 0,\n        title: \"Configuration\",\n        summary: \"Set the analysis date, accounting period, and review details for this run.\",\n        description: \"Complete this step first to ensure all downstream calculations use the correct period settings.\",\n        actionLabel: \"Configure Workbook\",\n        secondaryAction: { sheet: \"SS_PF_Config\", label: \"Open Config Sheet\" }\n    },\n    {\n        id: 1,\n        title: \"Import PTO Data\",\n        summary: \"Pull your latest PTO export from payroll and paste it into PTO_Data.\",\n        description: \"Open your payroll provider, download the PTO report, and paste the data into the PTO_Data tab.\",\n        actionLabel: \"Import Sample Data\",\n        secondaryAction: { sheet: \"PTO_Data\", label: \"Open Data Sheet\" }\n    },\n    {\n        id: 2,\n        title: \"Headcount Review\",\n        summary: \"Quick check to make sure your roster matches your PTO data.\",\n        description: \"Compare employees in PTO_Data against your employee roster to catch any discrepancies.\",\n        actionLabel: \"Open Headcount Review\",\n        secondaryAction: { sheet: \"SS_Employee_Roster\", label: \"Open Sheet\" }\n    },\n    {\n        id: 3,\n        title: \"Data Quality Review\",\n        summary: \"Scan your PTO data for potential errors before crunching numbers.\",\n        description: \"Identify negative balances, overdrawn accounts, and other anomalies that might need attention.\",\n        actionLabel: \"Click to Run Quality Check\"\n    },\n    {\n        id: 4,\n        title: \"PTO Accrual Review\",\n        summary: \"Review the calculated liability for each employee and compare to last period.\",\n        description: \"The analysis enriches your PTO data with pay rates and department info, then calculates the liability.\",\n        actionLabel: \"Click to Perform Review\"\n    },\n    {\n        id: 5,\n        title: \"Journal Entry Prep\",\n        summary: \"Generate a balanced journal entry, run validation checks, and export when ready.\",\n        description: \"Build the JE from your PTO data, verify debits equal credits, and export for upload to your accounting system.\",\n        actionLabel: \"Open Journal Draft\",\n        secondaryAction: { sheet: \"PTO_JE_Draft\", label: \"Open Sheet\" }\n    },\n    {\n        id: 6,\n        title: \"Archive & Reset\",\n        summary: \"Save this period's results and prepare for the next cycle.\",\n        description: \"Archive the current analysis so it becomes the 'prior period' for your next review.\",\n        actionLabel: \"Archive Run\"\n    }\n];\n\nconst WORKBOOK_SHEETS = [\n    {\n        name: \"PTO_Instructions\",\n        description: \"Overview of the PTO workflow\",\n        position: \"beginning\",\n        onCreate: async (sheet, context) => {\n            const rows = [\n                [\"Prairie Forge PTO Accrual\", `Version ${MODULE_VERSION}`],\n                [\"Step 0 \u2014 Configuration\", \"Set your analysis date, accounting period, and JE reference.\"],\n                [\"Step 1 \u2014 Import PTO Data\", \"Pull data from payroll and paste into PTO_Data.\"],\n                [\"Step 2 \u2014 Headcount Review\", \"Verify employees match between roster and PTO data.\"],\n                [\"Step 3 \u2014 Data Quality\", \"Scan for balance issues and anomalies.\"],\n                [\"Step 4 \u2014 Accrual Review\", \"Calculate liabilities and compare to prior period.\"],\n                [\"Step 5 \u2014 Journal Entry\", \"Generate JE, validate, and export for upload.\"],\n                [\"Step 6 \u2014 Archive\", \"Save results for next period comparison.\"]\n            ];\n            const target = sheet.getRangeByIndexes(0, 0, rows.length, 2);\n            target.values = rows;\n            target.format.autofitColumns();\n\n            const header = sheet.getRange(\"A1:B1\");\n            header.merge();\n            header.format.font.bold = true;\n            header.format.font.size = 18;\n            header.format.font.color = \"#111827\";\n\n            const info = sheet.getRange(\"A2:B8\");\n            info.format.fill.color = \"#f1f5f9\";\n            await context.sync();\n        }\n    },\n    // PTO_Config removed - consolidated into SS_PF_Config\n    { name: \"SS_PF_Config\", description: \"Prairie Forge shared configuration (all modules)\" },\n    { name: \"PTO_Rates\", description: \"Accrual rate definitions\" },\n    { name: \"PTO_Data\", description: \"Raw PTO transactions\" },\n    { name: \"PTO_Analysis\", description: \"Calculated balances\" },\n    { name: \"PTO_ExpenseReview\", description: \"Expense review workspace\" },\n    { name: \"PTO_JE_Draft\", description: \"Journal entry prep\" },\n    { name: \"PTO_Archive\", description: \"Archive register\" },\n    { name: \"SS_Employee_Roster\", description: \"Centralized employee roster\" }\n];\n\nconst TABLE_DEFINITIONS = [\n    // PTO_Config table removed - all config consolidated into SS_PF_Config\n    {\n        sheetName: \"PTO_Rates\",\n        tableName: \"PTORates\",\n        headers: [\"Tier\", \"Description\", \"Hours_Per_Period\", \"Max_Carryover\", \"Carryover_Reset\"],\n        sampleRows: [\n            [\"Standard\", \"0-4 years tenure\", 6.67, 80, \"Dec 31\"],\n            [\"Senior\", \"5-9 years tenure\", 10, 120, \"Dec 31\"],\n            [\"Executive\", \"10+ years\", 13.33, 160, \"Dec 31\"]\n        ]\n    },\n    {\n        sheetName: \"PTO_Archive\",\n        tableName: \"PTOArchiveLog\",\n        headers: [\"Timestamp\", \"Action\", \"Notes\"],\n        sampleRows: []\n    }\n];\n\nconst SAMPLE_PTO_ACTIVITY = [\n    { employeeId: \"AC1001\", employeeName: \"Kelly Mendez\", actionDate: \"2025-01-15\", actionType: \"Accrual\", hours: 6.67, notes: \"Monthly accrual\", source: \"Payroll\" },\n    { employeeId: \"AC1001\", employeeName: \"Kelly Mendez\", actionDate: \"2025-01-22\", actionType: \"Usage\", hours: 8, notes: \"Vacation day\", source: \"HRIS\" },\n    { employeeId: \"AC2044\", employeeName: \"Justin Reid\", actionDate: \"2025-01-15\", actionType: \"Accrual\", hours: 10, notes: \"Senior tier\", source: \"Payroll\" },\n    { employeeId: \"AC2044\", employeeName: \"Justin Reid\", actionDate: \"2025-01-28\", actionType: \"Usage\", hours: 4, notes: \"Doctor appointment\", source: \"HRIS\" },\n    { employeeId: \"AC3020\", employeeName: \"Amelia Yates\", actionDate: \"2025-01-15\", actionType: \"Accrual\", hours: 13.33, notes: \"Executive tier\", source: \"Payroll\" },\n    { employeeId: \"AC3020\", employeeName: \"Amelia Yates\", actionDate: \"2025-01-18\", actionType: \"Carryover\", hours: 20, notes: \"Year-end carryover\", source: \"Finance\" }\n];\n\n// Sample data will be generated dynamically from PTO_Data via syncPtoAnalysis\nconst SAMPLE_ANALYSIS_DATA = [];\n\nconst SAMPLE_EXPENSE_REVIEW = [\n    { department: \"Operations\", currentPeriod: 5400, priorPeriod: 5200, variance: 200, comment: \"Increased carryover true-up\" },\n    { department: \"Sales\", currentPeriod: 2300, priorPeriod: 2600, variance: -300, comment: \"Usage down vs. forecast\" },\n    { department: \"Executive\", currentPeriod: 4100, priorPeriod: 4100, variance: 0, comment: \"Steady quarter\" }\n];\n\nconst SAMPLE_JOURNAL_LINES = [\n    { account: \"2100.100\", description: \"PTO Accrual Expense\", debit: 11800, credit: 0, reference: \"PTO-EXP-2025-01\" },\n    { account: \"2190.250\", description: \"PTO Accrual Liability\", debit: 0, credit: 11800, reference: \"PTO-EXP-2025-01\" }\n];\n\nconst stepStatuses = WORKFLOW_STEPS.reduce((acc, step) => {\n    acc[step.id] = \"pending\";\n    return acc;\n}, {});\n\nconst appState = {\n    activeView: \"home\",\n    activeStepId: null,\n    focusedIndex: 0,\n    stepStatuses\n};\n\nconst configState = {\n    loaded: false,\n    steps: {},\n    permanents: {},\n    completes: {},\n    values: {},\n    overrides: {\n        accountingPeriod: false,\n        journalId: false\n    }\n};\n\nlet rootEl = null;\nlet loadingEl = null;\nlet pendingScrollIndex = null;\nconst pendingConfigWrites = new Map();\nconst headcountState = {\n    skipAnalysis: false,\n    roster: {\n        rosterCount: null,\n        payrollCount: null,\n        difference: null,\n        mismatches: []\n    },\n    loading: false,\n    hasAnalyzed: false,\n    lastError: null\n};\nconst journalState = {\n    debitTotal: null,\n    creditTotal: null,\n    difference: null,\n    lineAmountSum: null,        // Sum of all line amounts (should be 0)\n    analysisChangeTotal: null,  // Total Change from PTO_Analysis\n    jeChangeTotal: null,        // Total Change captured in JE (expense lines only)\n    loading: false,\n    lastError: null,\n    // Validation results with details\n    validationRun: false,\n    issues: []                  // [{check: \"name\", passed: false, detail: \"explanation\"}]\n};\nconst dataQualityState = {\n    hasRun: false,\n    loading: false,\n    acknowledged: false,       // User acknowledged issues and wants to proceed\n    // Quality check results\n    balanceIssues: [],         // [{name, issue, rowIndex}] - Negative balance or used more than available\n    zeroBalances: [],          // [{name, rowIndex}]\n    accrualOutliers: [],       // [{name, accrualRate, rowIndex}] - rates > 8 hrs/period\n    // Summary counts\n    totalIssues: 0,\n    totalEmployees: 0\n};\n\nconst analysisState = {\n    cleanDataReady: false,\n    employeeCount: 0,\n    lastRun: null,\n    loading: false,\n    lastError: null,\n    // Data quality tracking\n    missingPayRates: [],      // [{name: \"John Doe\", rowIndex: 2}, ...]\n    missingDepartments: [],   // [{name: \"Jane Smith\", rowIndex: 3}, ...]\n    ignoredMissingPayRates: new Set(), // Names user chose to ignore\n    // Data completeness check (PTO_Data vs PTO_Analysis sums)\n    completenessCheck: {\n        accrualRate: null,    // { match: true/false, ptoData: number, ptoAnalysis: number }\n        carryOver: null,\n        ytdAccrued: null,\n        ytdUsed: null,\n        balance: null\n    }\n};\n\nasync function init() {\n    try {\n        rootEl = document.getElementById(\"app\");\n        loadingEl = document.getElementById(\"loading\");\n        \n        await ensureTabVisibility();\n        await loadStepConfig();\n        // Load shared config for fallback values (Company Name, Default Reviewer, etc.)\n        if (window.PrairieForge?.loadSharedConfig) {\n            await window.PrairieForge.loadSharedConfig();\n        }\n        \n        // Activate module homepage on load\n        const homepageConfig = getHomepageConfig(MODULE_KEY);\n        await activateHomepageSheet(homepageConfig.sheetName, homepageConfig.title, homepageConfig.subtitle);\n        \n        if (loadingEl) loadingEl.remove();\n        if (rootEl) rootEl.hidden = false;\n        renderApp();\n    } catch (error) {\n        console.error(\"[PTO] Module initialization failed:\", error);\n        throw error;\n    }\n}\n\nasync function ensureTabVisibility() {\n    // Apply prefix-based tab visibility\n    // Shows PTO_* tabs, hides PR_* and SS_* tabs\n    try {\n        await applyModuleTabVisibility(MODULE_KEY);\n        console.log(`[PTO] Tab visibility applied for ${MODULE_KEY}`);\n    } catch (error) {\n        console.warn(\"[PTO] Could not apply tab visibility:\", error);\n    }\n}\n\nasync function loadStepConfig() {\n    if (!hasExcelRuntime()) {\n        configState.loaded = true;\n        return;\n    }\n    try {\n        // Load from module-specific config table (backwards compatibility)\n        const moduleValues = await loadConfigFromTable(CONFIG_TABLES);\n        \n        // Load from shared config (SS_PF_Config) - takes precedence\n        let sharedValues = {};\n        if (window.PrairieForge?.loadSharedConfig) {\n            await window.PrairieForge.loadSharedConfig();\n            // Convert cached Map to object\n            if (window.PrairieForge._sharedConfigCache) {\n                window.PrairieForge._sharedConfigCache.forEach((value, key) => {\n                    sharedValues[key] = value;\n                });\n            }\n        }\n        \n        // Merge: module values first, then shared values override\n        // Also map new naming convention to old field names\n        const values = { ...moduleValues };\n        \n        // Map shared config fields to PTO field names (new + legacy names)\n        const fieldMappings = {\n            \"SS_Default_Reviewer\": PTO_CONFIG_FIELDS.reviewerName,\n            \"Default_Reviewer\": PTO_CONFIG_FIELDS.reviewerName,\n            \"PTO_Reviewer\": PTO_CONFIG_FIELDS.reviewerName,\n            \"SS_Company_Name\": PTO_CONFIG_FIELDS.companyName,\n            \"Company_Name\": PTO_CONFIG_FIELDS.companyName,\n            \"SS_Payroll_Provider\": PTO_CONFIG_FIELDS.payrollProvider,\n            \"Payroll_Provider_Link\": PTO_CONFIG_FIELDS.payrollProvider,\n            \"SS_Accounting_Software\": PTO_CONFIG_FIELDS.accountingSoftware,\n            \"Accounting_Software_Link\": PTO_CONFIG_FIELDS.accountingSoftware\n        };\n        \n        // Apply shared values using mapped field names\n        Object.entries(fieldMappings).forEach(([sharedField, ptoField]) => {\n            if (sharedValues[sharedField] && !values[ptoField]) {\n                values[ptoField] = sharedValues[sharedField];\n            }\n        });\n        \n        // Also apply any exact-match PTO_* fields from shared config\n        Object.entries(sharedValues).forEach(([key, value]) => {\n            if (key.startsWith(\"PTO_\") && value) {\n                values[key] = value;\n            }\n        });\n        \n        configState.permanents = await loadPermanentFlags();\n        configState.values = values || {};\n        configState.overrides.accountingPeriod = Boolean(values?.[PTO_CONFIG_FIELDS.accountingPeriod]);\n        configState.overrides.journalId = Boolean(values?.[PTO_CONFIG_FIELDS.journalEntryId]);\n        Object.entries(STEP_CONFIG_FIELDS).forEach(([stepId, fields]) => {\n            configState.steps[stepId] = {\n                notes: values[fields.note] ?? \"\",\n                reviewer: values[fields.reviewer] ?? \"\",\n                signOffDate: values[fields.signOff] ?? \"\"\n            };\n        });\n        configState.completes = Object.entries(STEP_COMPLETE_FIELDS).reduce((acc, [stepId, field]) => {\n            acc[stepId] = values[field] ?? \"\";\n            return acc;\n        }, {});\n        configState.loaded = true;\n    } catch (error) {\n        console.warn(\"PTO: unable to load configuration fields\", error);\n        configState.loaded = true;\n    }\n}\n\nasync function loadPermanentFlags() {\n    const permanents = {};\n    if (!hasExcelRuntime()) return permanents;\n    const fieldToStep = new Map();\n    Object.entries(STEP_CONFIG_FIELDS).forEach(([stepId, fields]) => {\n        if (fields.note) {\n            fieldToStep.set(fields.note.trim(), Number(stepId));\n        }\n    });\n    try {\n        await Excel.run(async (context) => {\n            const table = context.workbook.tables.getItemOrNullObject(CONFIG_TABLES[0]);\n            await context.sync();\n            if (table.isNullObject) return;\n            const body = table.getDataBodyRange();\n            const header = table.getHeaderRowRange();\n            body.load(\"values\");\n            header.load(\"values\");\n            await context.sync();\n\n            const headers = header.values[0] || [];\n            const normalizedHeaders = headers.map((h) => String(h || \"\").trim().toLowerCase());\n            const idx = {\n                field: normalizedHeaders.findIndex((h) => h === \"field\" || h === \"field name\" || h === \"setting\"),\n                permanent: normalizedHeaders.findIndex((h) => h === \"permanent\" || h === \"persist\")\n            };\n            if (idx.field === -1 || idx.permanent === -1) return;\n            (body.values || []).forEach((row) => {\n                const fieldName = String(row[idx.field] || \"\").trim();\n                const stepId = fieldToStep.get(fieldName);\n                if (stepId == null) return;\n                const flag = parsePermanentFlag(row[idx.permanent]);\n                permanents[stepId] = flag;\n            });\n        });\n    } catch (error) {\n        console.warn(\"PTO: unable to load permanent flags\", error);\n    }\n    return permanents;\n}\n\nfunction renderApp() {\n    if (!rootEl) return;\n    const prevDisabled = appState.focusedIndex <= 0 ? \"disabled\" : \"\";\n    const nextDisabled = appState.focusedIndex >= WORKFLOW_STEPS.length - 1 ? \"disabled\" : \"\";\n    const isStepView = appState.activeView === \"step\" && appState.activeStepId != null;\n    const isConfigView = appState.activeView === \"config\";\n    const content = isConfigView\n        ? renderConfigView()\n        : isStepView\n            ? renderStepView(appState.activeStepId)\n            : `${renderHero()}${renderWorkflow()}`;\n    rootEl.innerHTML = `\n        <div class=\"pf-root\">\n            <div class=\"pf-brand-float\" aria-hidden=\"true\">\n                <span class=\"pf-brand-wave\"></span>\n            </div>\n            <header class=\"pf-banner\">\n                <div class=\"pf-nav-bar\">\n                    <button id=\"nav-prev\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" aria-label=\"Previous step\" ${prevDisabled}>\n                        ${ARROW_LEFT_SVG}\n                        <span class=\"sr-only\">Previous step</span>\n                    </button>\n                    <button id=\"nav-home\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" title=\"Module Home\">\n                        ${HOME_ICON_SVG}\n                        <span class=\"sr-only\">Module Home</span>\n                    </button>\n                    <button id=\"nav-selector\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" title=\"Module Selector\">\n                        ${MODULES_ICON_SVG}\n                        <span class=\"sr-only\">Module Selector</span>\n                    </button>\n                    <button id=\"nav-next\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" aria-label=\"Next step\" ${nextDisabled}>\n                        ${ARROW_RIGHT_SVG}\n                        <span class=\"sr-only\">Next step</span>\n                    </button>\n                    <span class=\"pf-nav-divider\"></span>\n                    <div class=\"pf-quick-access-wrapper\">\n                        <button id=\"nav-quick-toggle\" class=\"pf-nav-btn pf-nav-btn--icon pf-clickable\" type=\"button\" title=\"Quick Access\">\n                            ${MENU_ICON_SVG}\n                            <span class=\"sr-only\">Quick Access Menu</span>\n                        </button>\n                        <div id=\"quick-access-dropdown\" class=\"pf-quick-dropdown hidden\">\n                            <div class=\"pf-quick-dropdown-header\">Quick Access</div>\n                            <button id=\"nav-roster\" class=\"pf-quick-item pf-clickable\" type=\"button\">\n                                ${USERS_ICON_SVG}\n                                <span>Employee Roster</span>\n                            </button>\n                            <button id=\"nav-accounts\" class=\"pf-quick-item pf-clickable\" type=\"button\">\n                                ${BOOK_ICON_SVG}\n                                <span>Chart of Accounts</span>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </header>\n            ${content}\n            <footer class=\"pf-brand-footer\">\n                <div class=\"pf-brand-text\">\n                    <div class=\"pf-brand-label\">prairie.forge</div>\n                    <div class=\"pf-brand-meta\">\u00A9 Prairie Forge LLC, 2025. All rights reserved. Version ${MODULE_VERSION}</div>\n                    <button type=\"button\" class=\"pf-config-link\" id=\"showConfigSheets\">CONFIGURATION</button>\n                </div>\n            </footer>\n        </div>\n    `;\n    // Determine if on home view\n    const isHomeView = appState.activeView === \"home\" || (appState.activeView !== \"step\" && appState.activeView !== \"config\");\n    \n    // Mount info FAB with step-specific content (only on step/config views, not homepage)\n    const infoFabElement = document.getElementById(\"pf-info-fab-pto\");\n    if (isHomeView) {\n        // Remove info fab on homepage\n        if (infoFabElement) infoFabElement.remove();\n    } else if (window.PrairieForge?.mountInfoFab) {\n        const infoConfig = getStepInfoConfig(appState.activeStepId);\n        PrairieForge.mountInfoFab({ \n            title: infoConfig.title, \n            content: infoConfig.content, \n            buttonId: \"pf-info-fab-pto\" \n        });\n    }\n    \n    bindInteractions();\n    scrollFocusedIntoView();\n    \n    // Show/hide Ada FAB based on view\n    if (isHomeView) {\n        renderAdaFab();\n    } else {\n        removeAdaFab();\n    }\n}\n\n/**\n * Get step-specific info panel configuration\n */\nfunction getStepInfoConfig(stepId) {\n    switch (stepId) {\n        case 0:\n            return {\n                title: \"Configuration\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Sets up the key parameters for your PTO review. Complete this before importing data.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCB Key Fields</h4>\n                        <ul>\n                            <li><strong>Analysis Date</strong> \u2014 The period-end date (e.g., 11/30/2024)</li>\n                            <li><strong>Accounting Period</strong> \u2014 Shows up in your JE description</li>\n                            <li><strong>Journal Entry ID</strong> \u2014 Reference number for your accounting system</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>The accounting period and JE ID auto-generate based on your analysis date, but you can override them if needed.</p>\n                    </div>\n                `\n            };\n        case 1:\n            return {\n                title: \"Data Import\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Gets your PTO data into the workbook. Pull a report from your payroll provider and paste it into PTO_Data.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCB Required Columns</h4>\n                        <p>Your payroll export should include:</p>\n                        <ul>\n                            <li><strong>Employee Name</strong> \u2014 Full name (used to match against roster)</li>\n                            <li><strong>Accrual Rate</strong> \u2014 Hours accrued per pay period</li>\n                            <li><strong>Carry Over</strong> \u2014 Hours carried from prior year</li>\n                            <li><strong>YTD Accrued</strong> \u2014 Total hours accrued this year</li>\n                            <li><strong>YTD Used</strong> \u2014 Total hours used this year</li>\n                            <li><strong>Balance</strong> \u2014 Current available hours</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>Column headers don't need to match exactly\u2014the system is flexible with naming. Just make sure each field is present.</p>\n                    </div>\n                `\n            };\n        case 2:\n            return {\n                title: \"Headcount Review\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Compares employee counts between your roster and PTO data to catch discrepancies early.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCA Data Sources</h4>\n                        <ul>\n                            <li><strong>SS_Employee_Roster</strong> \u2014 Your centralized employee list</li>\n                            <li><strong>PTO_Data</strong> \u2014 The data you just imported</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDD0D What to Look For</h4>\n                        <ul>\n                            <li><strong>In Roster, Not in PTO</strong> \u2014 May need to add PTO records</li>\n                            <li><strong>In PTO, Not in Roster</strong> \u2014 Could be terminated employees</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>If discrepancies are expected (e.g., contractors without PTO), you can skip this check.</p>\n                    </div>\n                `\n            };\n        case 3:\n            return {\n                title: \"Data Quality Review\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Scans your PTO data for anomalies that could cause problems later in the process.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\u26A0\uFE0F Balance Issues (Critical)</h4>\n                        <p>Flags when:</p>\n                        <ul>\n                            <li><strong>Negative Balance</strong> \u2014 Balance is less than zero</li>\n                            <li><strong>Overdrawn</strong> \u2014 Used more than available (YTD Used > Carry Over + YTD Accrued)</li>\n                        </ul>\n                        <p class=\"pf-info-note\">Usually indicates missing accrual entries or data errors in payroll.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCA High Accrual Rates (Warning)</h4>\n                        <p>Employees with Accrual Rate > 8 hours/period may have data entry errors.</p>\n                        <p class=\"pf-info-note\">Most bi-weekly accruals are 3-6 hours.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>You can acknowledge issues and proceed, but it's best to fix them in your source system first.</p>\n                    </div>\n                `\n            };\n        case 4:\n            return {\n                title: \"PTO Accrual Review\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Calculates the PTO liability for each employee and compares it to last period.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCA Data Sources</h4>\n                        <ul>\n                            <li><strong>PTO_Data</strong> \u2014 Your imported PTO balances</li>\n                            <li><strong>SS_Employee_Roster</strong> \u2014 Department assignments</li>\n                            <li><strong>PR_Archive_Summary</strong> \u2014 Pay rates from payroll history</li>\n                            <li><strong>PTO_Archive_Summary</strong> \u2014 Last period's liability (for comparison)</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCB0 How Liability is Calculated</h4>\n                        <div class=\"pf-info-formula\">\n                            Liability = Balance (hours) \u00D7 Hourly Rate\n                        </div>\n                        <p class=\"pf-info-note\">Hourly rate comes from Regular Earnings \u00F7 80 hours in your payroll history.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCC8 How Change is Calculated</h4>\n                        <div class=\"pf-info-formula\">\n                            Change = Current Liability \u2212 Prior Period Liability\n                        </div>\n                        <ul>\n                            <li><span style=\"color: #30d158;\">Positive</span> = Liability went up (book expense)</li>\n                            <li><span style=\"color: #ff453a;\">Negative</span> = Liability went down (reverse expense)</li>\n                        </ul>\n                    </div>\n                `\n            };\n        case 5:\n            return {\n                title: \"Journal Entry Prep\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Generates a balanced journal entry from your PTO analysis, ready for upload to your accounting system.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCDD How the JE Works</h4>\n                        <p>Groups the <strong>Change</strong> amounts by department:</p>\n                        <ul>\n                            <li><span style=\"color: #30d158;\">Positive Change</span> \u2192 Debit expense account</li>\n                            <li><span style=\"color: #ff453a;\">Negative Change</span> \u2192 Credit expense account</li>\n                        </ul>\n                        <p>The offset always goes to <strong>21540</strong> (Accrued PTO liability).</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFE2 Department \u2192 Account Mapping</h4>\n                        <table style=\"width:100%; font-size: 12px; margin-top: 8px;\">\n                            <tr><td>General & Admin</td><td style=\"text-align:right\">64110</td></tr>\n                            <tr><td>R&D</td><td style=\"text-align:right\">62110</td></tr>\n                            <tr><td>Marketing</td><td style=\"text-align:right\">61610</td></tr>\n                            <tr><td>Sales & Marketing</td><td style=\"text-align:right\">61110</td></tr>\n                            <tr><td>COGS Onboarding</td><td style=\"text-align:right\">53110</td></tr>\n                            <tr><td>COGS Prof. Services</td><td style=\"text-align:right\">56110</td></tr>\n                            <tr><td>COGS Support</td><td style=\"text-align:right\">52110</td></tr>\n                            <tr><td>Client Success</td><td style=\"text-align:right\">61811</td></tr>\n                        </table>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\u2705 Validation Checks</h4>\n                        <ul>\n                            <li><strong>Debits = Credits</strong> \u2014 Entry must balance</li>\n                            <li><strong>Line Amounts = $0</strong> \u2014 Net change must be zero</li>\n                            <li><strong>JE Matches Analysis</strong> \u2014 Totals tie back to your data</li>\n                        </ul>\n                    </div>\n                `\n            };\n        case 6:\n            return {\n                title: \"Archive & Reset\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83C\uDFAF What This Step Does</h4>\n                        <p>Saves this period's results so they become the \"prior period\" for your next review.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCE6 What Gets Saved</h4>\n                        <ul>\n                            <li><strong>PTO_Archive_Summary</strong> \u2014 Employee name, liability amount, and analysis date</li>\n                            <li>This data is used to calculate the \"Change\" column next period</li>\n                        </ul>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\u26A0\uFE0F Important</h4>\n                        <p>Only the <strong>most recent period</strong> is kept in the archive. Running archive again will overwrite the previous data.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCA1 Tip</h4>\n                        <p>Make sure your JE has been uploaded to your accounting system before archiving.</p>\n                    </div>\n                `\n            };\n        default:\n            return {\n                title: \"PTO Accrual\",\n                content: `\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDC4B Welcome to PTO Accrual</h4>\n                        <p>This module helps you calculate PTO liabilities and generate journal entries each period.</p>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <h4>\uD83D\uDCCB Workflow Overview</h4>\n                        <ol style=\"margin: 8px 0; padding-left: 20px;\">\n                            <li>Configure your period settings</li>\n                            <li>Import PTO data from payroll</li>\n                            <li>Review headcount alignment</li>\n                            <li>Check data quality</li>\n                            <li>Review calculated liabilities</li>\n                            <li>Generate and export journal entry</li>\n                            <li>Archive for next period</li>\n                        </ol>\n                    </div>\n                    <div class=\"pf-info-section\">\n                        <p>Click a step card to get started, or tap the <strong>\u24D8</strong> button on any step for detailed guidance.</p>\n                    </div>\n                `\n            };\n    }\n}\n\nfunction renderHero() {\n    return `\n        <section class=\"pf-hero\" id=\"pf-hero\">\n            <h2 class=\"pf-hero-title\">PTO Accrual</h2>\n            <p class=\"pf-hero-copy\">${HERO_COPY}</p>\n        </section>\n    `;\n}\n\nfunction renderWorkflow() {\n    return `\n        <section class=\"pf-step-guide\">\n            <div class=\"pf-step-grid\">\n                ${WORKFLOW_STEPS.map((step, index) => renderStepCard(step, index)).join(\"\")}\n            </div>\n        </section>\n    `;\n}\n\nfunction renderStepCard(step, index) {\n    const status = appState.stepStatuses[step.id] || \"pending\";\n    const isActive =\n        appState.activeView === \"step\" && appState.focusedIndex === index ? \"pf-step-card--active\" : \"\";\n    const icon = getStepIconSvg(getStepType(step.id));\n    return `\n        <article class=\"pf-step-card pf-clickable ${isActive}\" data-step-card data-step-index=\"${index}\" data-step-id=\"${step.id}\">\n            <p class=\"pf-step-index\">Step ${step.id}</p>\n            <h3 class=\"pf-step-title\">${icon ? `${icon}` : \"\"}${step.title}</h3>\n        </article>\n    `;\n}\n\nfunction renderArchiveStep(detail) {\n    const completionItems = WORKFLOW_STEPS.filter((step) => step.id !== 6).map((step) => ({\n        id: step.id,\n        title: step.title,\n        complete: isStepComplete(step.id)\n    }));\n    const allComplete = completionItems.every((item) => item.complete);\n    const statusList = completionItems\n        .map(\n            (item) => `\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head pf-notes-header\">\n                    <span class=\"pf-action-toggle ${item.complete ? \"is-active\" : \"\"}\" aria-pressed=\"${item.complete}\">\n                        ${CHECK_ICON_SVG}\n                    </span>\n                    <div>\n                        <h3>${escapeHtml(item.title)}</h3>\n                        <p class=\"pf-config-subtext\">${item.complete ? \"Complete\" : \"Not complete\"}</p>\n                    </div>\n                </div>\n            </article>\n        `\n        )\n        .join(\"\");\n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            ${statusList}\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Archive & Reset</h3>\n                    <p class=\"pf-config-subtext\">Only enabled when all steps above are complete.</p>\n                </div>\n                <div class=\"pf-pill-row pf-config-actions\">\n                    <button type=\"button\" class=\"pf-pill-btn\" id=\"archive-run-btn\" ${allComplete ? \"\" : \"disabled\"}>Archive</button>\n                </div>\n            </article>\n        </section>\n    `;\n}\n\nfunction renderConfigView() {\n    if (!configState.loaded) {\n        return `\n            <section class=\"pf-step-guide\">\n                <article class=\"pf-step-card pf-step-detail\">\n                    <p class=\"pf-step-title\">Loading configuration\u2026</p>\n                </article>\n            </section>\n        `;\n    }\n    const payrollDate = formatDateInput(getConfigValue(PTO_CONFIG_FIELDS.payrollDate));\n    const accountingPeriod = formatDateInput(getConfigValue(PTO_CONFIG_FIELDS.accountingPeriod));\n    const journalEntryId = getConfigValue(PTO_CONFIG_FIELDS.journalEntryId);\n    const accountingLink = getConfigValue(PTO_CONFIG_FIELDS.accountingSoftware);\n    const payrollLink = getConfigValue(PTO_CONFIG_FIELDS.payrollProvider);\n    const companyName = getConfigValue(PTO_CONFIG_FIELDS.companyName);\n    const userName = getConfigValue(PTO_CONFIG_FIELDS.reviewerName);\n    const stepFields = getStepConfig(0);\n    const notesPermanent = Boolean(configState.permanents[0]);\n    const isStepComplete = Boolean(parseBooleanFlag(configState.completes[0]) || stepFields.signOffDate);\n    const stepReviewer = getReviewerWithFallback(stepFields?.reviewer);\n    const stepSignOff = stepFields?.signOffDate || \"\";\n\n    return `\n        <section class=\"pf-hero\" id=\"pf-config-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step 0</p>\n            <h2 class=\"pf-hero-title\">Configuration Setup</h2>\n            <p class=\"pf-hero-copy\">Make quick adjustments before every PTO run.</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Period Data</h3>\n                    <p class=\"pf-config-subtext\">Fields in this section may change each period.</p>\n                </div>\n                <div class=\"pf-config-grid\">\n                    <label class=\"pf-config-field\">\n                        <span>Your Name (Used for sign-offs)</span>\n                        <input type=\"text\" id=\"config-user-name\" value=\"${escapeHtml(userName)}\" placeholder=\"Full name\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>PTO Analysis Date</span>\n                        <input type=\"date\" id=\"config-payroll-date\" value=\"${escapeHtml(payrollDate)}\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Accounting Period</span>\n                        <input type=\"text\" id=\"config-accounting-period\" value=\"${escapeHtml(accountingPeriod)}\" placeholder=\"Nov 2025\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Journal Entry ID</span>\n                        <input type=\"text\" id=\"config-journal-id\" value=\"${escapeHtml(journalEntryId)}\" placeholder=\"PTO-AUTO-YYYY-MM-DD\">\n                    </label>\n                </div>\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Static Data</h3>\n                    <p class=\"pf-config-subtext\">Fields rarely change but should be reviewed.</p>\n                </div>\n                <div class=\"pf-config-grid\">\n                    <label class=\"pf-config-field\">\n                        <span>Company Name</span>\n                        <input type=\"text\" id=\"config-company-name\" value=\"${escapeHtml(companyName)}\" placeholder=\"Prairie Forge LLC\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Payroll Provider / Report Location</span>\n                        <input type=\"url\" id=\"config-payroll-provider\" value=\"${escapeHtml(payrollLink)}\" placeholder=\"https://\u2026\">\n                    </label>\n                    <label class=\"pf-config-field\">\n                        <span>Accounting Software / Import Location</span>\n                        <input type=\"url\" id=\"config-accounting-link\" value=\"${escapeHtml(accountingLink)}\" placeholder=\"https://\u2026\">\n                    </label>\n                </div>\n            </article>\n            ${renderInlineNotes({\n                textareaId: \"config-notes\",\n                value: stepFields.notes || \"\",\n                permanentId: \"config-notes-lock\",\n                isPermanent: notesPermanent,\n                hintId: \"\",\n                saveButtonId: \"config-notes-save\"\n            })}\n            ${renderSignoff({\n                reviewerInputId: \"config-reviewer\",\n                reviewerValue: stepReviewer,\n                signoffInputId: \"config-signoff-date\",\n                signoffValue: stepSignOff,\n                isComplete: isStepComplete,\n                saveButtonId: \"config-signoff-save\",\n                completeButtonId: \"config-signoff-toggle\"\n            })}\n        </section>\n    `;\n}\n\nfunction renderImportStep(detail) {\n    const stepFields = getStepConfig(1);\n    const notesPermanent = Boolean(configState.permanents[1]);\n    const stepReviewer = getReviewerWithFallback(stepFields?.reviewer);\n    const stepSignOff = stepFields?.signOffDate || \"\";\n    const stepComplete = Boolean(parseBooleanStrict(configState.completes[1]) || stepSignOff);\n    const providerLink = getConfigValue(PTO_CONFIG_FIELDS.payrollProvider);\n    \n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Payroll Report</h3>\n                    <p class=\"pf-config-subtext\">Access your payroll provider to download the latest PTO export, then paste into PTO_Data.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(\n                        providerLink \n                            ? `<a href=\"${escapeHtml(providerLink)}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"pf-action-toggle pf-clickable\" title=\"Open payroll provider\">${LINK_ICON_SVG}</a>`\n                            : `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"import-provider-btn\" disabled title=\"Add provider link in Configuration\">${LINK_ICON_SVG}</button>`,\n                        \"Provider\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"import-open-data-btn\" title=\"Open PTO_Data sheet\">${TABLE_ICON_SVG}</button>`,\n                        \"PTO_Data\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"import-clear-btn\" title=\"Clear PTO_Data to start over\">${TRASH_ICON_SVG}</button>`,\n                        \"Clear\"\n                    )}\n                </div>\n            </article>\n            ${renderInlineNotes({\n                textareaId: \"step-notes-1\",\n                value: stepFields?.notes || \"\",\n                permanentId: \"step-notes-lock-1\",\n                isPermanent: notesPermanent,\n                hintId: \"\",\n                saveButtonId: \"step-notes-save-1\"\n            })}\n            ${renderSignoff({\n                reviewerInputId: \"step-reviewer-1\",\n                reviewerValue: stepReviewer,\n                signoffInputId: \"step-signoff-1\",\n                signoffValue: stepSignOff,\n                isComplete: stepComplete,\n                saveButtonId: \"step-signoff-save-1\",\n                completeButtonId: \"step-signoff-toggle-1\"\n            })}\n        </section>\n    `;\n}\n\nfunction renderStepView(stepId) {\n    const detail = WORKFLOW_STEPS.find((step) => step.id === stepId);\n    if (!detail) return \"\";\n    if (stepId === 0) return renderConfigView();\n    if (stepId === 1) return renderImportStep(detail);\n    if (stepId === 2) return renderHeadcountStep(detail);\n    if (stepId === 3) return renderDataQualityStep(detail);\n    if (stepId === 4) return renderAccrualReviewStep(detail);\n    if (stepId === 5) return renderJournalStep(detail);\n    if (detail.id === 6) {\n        return renderArchiveStep(detail);\n    }\n    // Generic step rendering (shouldn't be reached now)\n    const stepFields = getStepConfig(stepId);\n    const notesPermanent = Boolean(configState.permanents[stepId]);\n    const stepReviewer = getReviewerWithFallback(stepFields?.reviewer);\n    const stepSignOff = stepFields?.signOffDate || \"\";\n    const stepComplete = Boolean(parseBooleanStrict(configState.completes[stepId]) || stepSignOff);\n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            ${renderInlineNotes({\n                textareaId: `step-notes-${stepId}`,\n                value: stepFields?.notes || \"\",\n                permanentId: `step-notes-lock-${stepId}`,\n                isPermanent: notesPermanent,\n                hintId: \"\",\n                saveButtonId: `step-notes-save-${stepId}`\n            })}\n            ${renderSignoff({\n                reviewerInputId: `step-reviewer-${stepId}`,\n                reviewerValue: stepReviewer,\n                signoffInputId: `step-signoff-${stepId}`,\n                signoffValue: stepSignOff,\n                isComplete: stepComplete,\n                saveButtonId: `step-signoff-save-${stepId}`,\n                completeButtonId: `step-signoff-toggle-${stepId}`\n            })}\n        </section>\n    `;\n}\n\nfunction bindInteractions() {\n    document.getElementById(\"nav-home\")?.addEventListener(\"click\", async () => {\n        // Activate the module homepage sheet\n        const homepageConfig = getHomepageConfig(MODULE_KEY);\n        await activateHomepageSheet(homepageConfig.sheetName, homepageConfig.title, homepageConfig.subtitle);\n        \n        setState({ activeView: \"home\", activeStepId: null });\n        document.getElementById(\"pf-hero\")?.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n    });\n    document.getElementById(\"nav-selector\")?.addEventListener(\"click\", () => {\n        window.location.href = SELECTOR_URL;\n    });\n    document.getElementById(\"nav-prev\")?.addEventListener(\"click\", () => moveFocus(-1));\n    document.getElementById(\"nav-next\")?.addEventListener(\"click\", () => moveFocus(1));\n    \n    // Quick Access hamburger menu toggle\n    const quickToggle = document.getElementById(\"nav-quick-toggle\");\n    const quickDropdown = document.getElementById(\"quick-access-dropdown\");\n    \n    quickToggle?.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n        quickDropdown?.classList.toggle(\"hidden\");\n        quickToggle.classList.toggle(\"is-active\");\n    });\n    \n    // Close dropdown when clicking outside\n    document.addEventListener(\"click\", (e) => {\n        if (!quickDropdown?.contains(e.target) && !quickToggle?.contains(e.target)) {\n            quickDropdown?.classList.add(\"hidden\");\n            quickToggle?.classList.remove(\"is-active\");\n        }\n    });\n    \n    // Quick Access buttons - open reference data sheets\n    document.getElementById(\"nav-roster\")?.addEventListener(\"click\", () => {\n        openReferenceSheet(\"SS_Employee_Roster\");\n        quickDropdown?.classList.add(\"hidden\");\n        quickToggle?.classList.remove(\"is-active\");\n    });\n    document.getElementById(\"nav-accounts\")?.addEventListener(\"click\", () => {\n        openReferenceSheet(\"SS_Chart_of_Accounts\");\n        quickDropdown?.classList.add(\"hidden\");\n        quickToggle?.classList.remove(\"is-active\");\n    });\n    \n    // CONFIGURATION link - unhides SS_* sheets for config access\n    document.getElementById(\"showConfigSheets\")?.addEventListener(\"click\", async () => {\n        await unhideSystemSheets();\n    });\n\n    document.querySelectorAll(\"[data-step-card]\").forEach((card) => {\n        const index = Number(card.getAttribute(\"data-step-index\"));\n        const stepId = Number(card.getAttribute(\"data-step-id\"));\n        card.addEventListener(\"click\", () => focusStep(index, stepId));\n    });\n    if (appState.activeView === \"config\") {\n        bindConfigView();\n    } else if (appState.activeView === \"step\" && appState.activeStepId != null) {\n        bindStepView(appState.activeStepId);\n    }\n}\n\nfunction bindStepView(stepId) {\n    const notesInput =\n        stepId === 2 ? document.getElementById(\"step-notes-input\") : document.getElementById(`step-notes-${stepId}`);\n    const reviewerInput =\n        stepId === 2 ? document.getElementById(\"step-reviewer-name\") : document.getElementById(`step-reviewer-${stepId}`);\n    const signoffInput =\n        stepId === 2 ? document.getElementById(\"step-signoff-date\") : document.getElementById(`step-signoff-${stepId}`);\n    const backBtn = document.getElementById(\"step-back-btn\");\n    const lockBtn =\n        stepId === 2 ? document.getElementById(\"step-notes-lock-2\") : document.getElementById(`step-notes-lock-${stepId}`);\n\n    // Save button for notes\n    const notesSaveBtn = stepId === 2 ? document.getElementById(\"step-notes-save-2\") : document.getElementById(`step-notes-save-${stepId}`);\n    notesSaveBtn?.addEventListener(\"click\", async () => {\n        const notes = notesInput?.value || \"\";\n        await saveStepField(stepId, \"notes\", notes);\n        updateSaveButtonState(notesSaveBtn, true);\n    });\n\n    // Save button for sign-off section (reviewer name)\n    const signoffSaveBtn = stepId === 2 ? document.getElementById(\"headcount-signoff-save\") : document.getElementById(`step-signoff-save-${stepId}`);\n    signoffSaveBtn?.addEventListener(\"click\", async () => {\n        const reviewer = reviewerInput?.value || \"\";\n        await saveStepField(stepId, \"reviewer\", reviewer);\n        updateSaveButtonState(signoffSaveBtn, true);\n    });\n\n    // Auto-wire save state tracking for all save buttons (marks as unsaved on input change)\n    initSaveTracking();\n\n    const signoffButtonId = stepId === 2 ? \"headcount-signoff-toggle\" : `step-signoff-toggle-${stepId}`;\n    const signoffInputId = stepId === 2 ? \"step-signoff-date\" : `step-signoff-${stepId}`;\n    bindSignoffToggle(stepId, {\n        buttonId: signoffButtonId,\n        inputId: signoffInputId,\n        canActivate:\n            stepId === 2\n                ? () => {\n                      if (!isHeadcountNotesRequired()) return true;\n                      const notes = document.getElementById(\"step-notes-input\")?.value.trim() || \"\";\n                      if (notes) return true;\n                      window.alert(\"Please enter a brief explanation of the headcount differences before completing this step.\");\n                      return false;\n                  }\n                : null,\n        onComplete: stepId === 2 ? handleHeadcountSignoff : null\n    });\n    backBtn?.addEventListener(\"click\", async () => {\n        const homepageConfig = getHomepageConfig(MODULE_KEY);\n        await activateHomepageSheet(homepageConfig.sheetName, homepageConfig.title, homepageConfig.subtitle);\n        setState({ activeView: \"home\", activeStepId: null });\n    });\n    lockBtn?.addEventListener(\"click\", async () => {\n        const nextLocked = !lockBtn.classList.contains(\"is-locked\");\n        updateLockButtonVisual(lockBtn, nextLocked);\n        await toggleNotePermanent(stepId, nextLocked);\n    });\n    if (stepId === 6) {\n        document.getElementById(\"archive-run-btn\")?.addEventListener(\"click\", () => {\n            // Archive flow coming soon\n        });\n    }\n    // Step 1: Import PTO Data\n    if (stepId === 1) {\n        document.getElementById(\"import-open-data-btn\")?.addEventListener(\"click\", () => openSheet(\"PTO_Data\"));\n        document.getElementById(\"import-clear-btn\")?.addEventListener(\"click\", () => clearPtoData());\n    }\n    // Step 2: Headcount Review\n    if (stepId === 2) {\n        document.getElementById(\"headcount-skip-btn\")?.addEventListener(\"click\", () => {\n            headcountState.skipAnalysis = !headcountState.skipAnalysis;\n            const skipBtn = document.getElementById(\"headcount-skip-btn\");\n            skipBtn?.classList.toggle(\"is-active\", headcountState.skipAnalysis);\n            if (headcountState.skipAnalysis) {\n                enforceHeadcountSkipNote();\n            }\n            updateHeadcountSignoffState();\n        });\n        document.getElementById(\"headcount-run-btn\")?.addEventListener(\"click\", () => refreshHeadcountAnalysis());\n        document.getElementById(\"headcount-refresh-btn\")?.addEventListener(\"click\", () => refreshHeadcountAnalysis());\n        bindHeadcountNotesGuard();\n        if (headcountState.skipAnalysis) {\n            enforceHeadcountSkipNote();\n        }\n        updateHeadcountSignoffState();\n    }\n    if (stepId === 3) {\n        document.getElementById(\"quality-run-btn\")?.addEventListener(\"click\", () => runDataQualityCheck());\n        document.getElementById(\"quality-refresh-btn\")?.addEventListener(\"click\", () => runDataQualityCheck());\n        document.getElementById(\"quality-acknowledge-btn\")?.addEventListener(\"click\", () => acknowledgeQualityIssues());\n    }\n    if (stepId === 4) {\n        // Both buttons trigger the full analysis with all checks\n        document.getElementById(\"analysis-refresh-btn\")?.addEventListener(\"click\", () => runFullAnalysis());\n        document.getElementById(\"analysis-run-btn\")?.addEventListener(\"click\", () => runFullAnalysis());\n        \n        // Missing pay rate card bindings\n        document.getElementById(\"payrate-save-btn\")?.addEventListener(\"click\", handlePayRateSave);\n        document.getElementById(\"payrate-ignore-btn\")?.addEventListener(\"click\", handlePayRateIgnore);\n        document.getElementById(\"payrate-input\")?.addEventListener(\"keydown\", (e) => {\n            if (e.key === \"Enter\") handlePayRateSave();\n        });\n    }\n    if (stepId === 5) {\n        document.getElementById(\"je-create-btn\")?.addEventListener(\"click\", () => createJournalDraft());\n        document.getElementById(\"je-run-btn\")?.addEventListener(\"click\", () => runJournalSummary());\n        document.getElementById(\"je-export-btn\")?.addEventListener(\"click\", () => exportJournalDraft());\n    }\n}\n\nfunction bindConfigView() {\n    const payrollInput = document.getElementById(\"config-payroll-date\");\n    payrollInput?.addEventListener(\"change\", (event) => {\n        const value = event.target.value || \"\";\n        scheduleConfigWrite(PTO_CONFIG_FIELDS.payrollDate, value);\n        if (!value) return;\n        if (!configState.overrides.accountingPeriod) {\n            const derivedPeriod = deriveAccountingPeriod(value);\n            if (derivedPeriod) {\n                const periodInput = document.getElementById(\"config-accounting-period\");\n                if (periodInput) periodInput.value = derivedPeriod;\n                scheduleConfigWrite(PTO_CONFIG_FIELDS.accountingPeriod, derivedPeriod);\n            }\n        }\n        if (!configState.overrides.journalId) {\n            const derivedJe = deriveJournalId(value);\n            if (derivedJe) {\n                const jeInput = document.getElementById(\"config-journal-id\");\n                if (jeInput) jeInput.value = derivedJe;\n                scheduleConfigWrite(PTO_CONFIG_FIELDS.journalEntryId, derivedJe);\n            }\n        }\n    });\n\n    const periodInput = document.getElementById(\"config-accounting-period\");\n    periodInput?.addEventListener(\"change\", (event) => {\n        configState.overrides.accountingPeriod = Boolean(event.target.value);\n        scheduleConfigWrite(PTO_CONFIG_FIELDS.accountingPeriod, event.target.value || \"\");\n    });\n\n    const journalInput = document.getElementById(\"config-journal-id\");\n    journalInput?.addEventListener(\"change\", (event) => {\n        configState.overrides.journalId = Boolean(event.target.value);\n        scheduleConfigWrite(PTO_CONFIG_FIELDS.journalEntryId, event.target.value.trim());\n    });\n\n    document.getElementById(\"config-company-name\")?.addEventListener(\"change\", (event) => {\n        scheduleConfigWrite(PTO_CONFIG_FIELDS.companyName, event.target.value.trim());\n    });\n\n    document.getElementById(\"config-payroll-provider\")?.addEventListener(\"change\", (event) => {\n        scheduleConfigWrite(PTO_CONFIG_FIELDS.payrollProvider, event.target.value.trim());\n    });\n\n    document.getElementById(\"config-accounting-link\")?.addEventListener(\"change\", (event) => {\n        scheduleConfigWrite(PTO_CONFIG_FIELDS.accountingSoftware, event.target.value.trim());\n    });\n\n    document.getElementById(\"config-user-name\")?.addEventListener(\"change\", (event) => {\n        scheduleConfigWrite(PTO_CONFIG_FIELDS.reviewerName, event.target.value.trim());\n    });\n\n    const notesInput = document.getElementById(\"config-notes\");\n    notesInput?.addEventListener(\"input\", (event) => {\n        saveStepField(0, \"notes\", event.target.value);\n    });\n\n    const lockButton = document.getElementById(\"config-notes-lock\");\n    lockButton?.addEventListener(\"click\", async () => {\n        const nextLocked = !lockButton.classList.contains(\"is-locked\");\n        updateLockButtonVisual(lockButton, nextLocked);\n        await toggleNotePermanent(0, nextLocked);\n    });\n\n    const notesSaveBtn = document.getElementById(\"config-notes-save\");\n    notesSaveBtn?.addEventListener(\"click\", async () => {\n        if (!notesInput) return;\n        await saveStepField(0, \"notes\", notesInput.value);\n        updateSaveButtonState(notesSaveBtn, true);\n    });\n\n    const reviewerInput = document.getElementById(\"config-reviewer\");\n    reviewerInput?.addEventListener(\"change\", (event) => {\n        const value = event.target.value.trim();\n        saveStepField(0, \"reviewer\", value);\n        const signoffInput = document.getElementById(\"config-signoff-date\");\n        if (value && signoffInput && !signoffInput.value) {\n            const today = todayIso();\n            signoffInput.value = today;\n            saveStepField(0, \"signOffDate\", today);\n            saveCompletionFlag(0, true);\n        }\n    });\n\n    document.getElementById(\"config-signoff-date\")?.addEventListener(\"change\", (event) => {\n        saveStepField(0, \"signOffDate\", event.target.value || \"\");\n    });\n    const signoffSaveBtn = document.getElementById(\"config-signoff-save\");\n    signoffSaveBtn?.addEventListener(\"click\", async () => {\n        const reviewerValue = reviewerInput?.value?.trim() || \"\";\n        const signoffValue = document.getElementById(\"config-signoff-date\")?.value || \"\";\n        await saveStepField(0, \"reviewer\", reviewerValue);\n        await saveStepField(0, \"signOffDate\", signoffValue);\n        updateSaveButtonState(signoffSaveBtn, true);\n    });\n\n    initSaveTracking();\n    bindSignoffToggle(0, {\n        buttonId: \"config-signoff-toggle\",\n        inputId: \"config-signoff-date\",\n        onComplete: persistConfigBasics\n    });\n}\n\nfunction focusStep(index, stepId = null) {\n    if (index < 0 || index >= WORKFLOW_STEPS.length) return;\n    pendingScrollIndex = index;\n    const resolvedStepId = stepId ?? WORKFLOW_STEPS[index].id;\n    const nextView = resolvedStepId === 0 ? \"config\" : \"step\";\n    setState({ focusedIndex: index, activeView: nextView, activeStepId: resolvedStepId });\n    if (resolvedStepId === 1) {\n        openSheet(\"PTO_Data\");\n    }\n    if (resolvedStepId === 2 && !headcountState.hasAnalyzed) {\n        void syncPtoAnalysis();\n        refreshHeadcountAnalysis();\n    }\n    if (resolvedStepId === 3) {\n        openSheet(\"PTO_Data\");\n    }\n    // Step 4 no longer runs checks automatically - user clicks Run/Refresh\n    if (resolvedStepId === 5) {\n        openSheet(\"PTO_JE_Draft\");\n    }\n}\n\nfunction moveFocus(delta) {\n    const next = appState.focusedIndex + delta;\n    const target = Math.max(0, Math.min(WORKFLOW_STEPS.length - 1, next));\n    focusStep(target, WORKFLOW_STEPS[target].id);\n}\n\nfunction scrollFocusedIntoView() {\n    if (pendingScrollIndex === null) return;\n    const card = document.querySelector(`[data-step-index=\"${pendingScrollIndex}\"]`);\n    pendingScrollIndex = null;\n    card?.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n}\n\nfunction isStepComplete(stepId) {\n    return parseBooleanFlag(configState.completes[stepId]);\n}\n\nfunction handleStepAction(stepId) {\n    switch (stepId) {\n        case 1:\n            importSampleData();\n            break;\n        case 2:\n            openSheet(\"SS_Employee_Roster\");\n            break;\n        case 3:\n            // Validation triggered via button only for explicit user control\n            break;\n        case 4:\n            openSheet(\"PTO_ExpenseReview\");\n            break;\n        case 5:\n            openSheet(\"PTO_JE_Draft\");\n            break;\n        case 6:\n            archiveAndReset();\n            break;\n        default:\n            break;\n    }\n}\n\nfunction setState(partial) {\n    if (partial.stepStatuses) {\n        appState.stepStatuses = { ...appState.stepStatuses, ...partial.stepStatuses };\n    }\n    Object.assign(appState, { ...partial, stepStatuses: appState.stepStatuses });\n    renderApp();\n}\n\nfunction hasExcel() {\n    return typeof Excel !== \"undefined\" && typeof Excel.run === \"function\";\n}\n\nasync function importSampleData() {\n    if (!hasExcel()) {\n        return;\n    }\n    toggleLoader(true, \"Importing sample data...\");\n    try {\n        await Excel.run(async (context) => {\n            await writeDatasetToSheet(context, \"PTO_Data\", PTO_ACTIVITY_COLUMNS, SAMPLE_PTO_ACTIVITY);\n            await writeDatasetToSheet(context, \"PTO_ExpenseReview\", PTO_EXPENSE_COLUMNS, SAMPLE_EXPENSE_REVIEW);\n            await writeDatasetToSheet(context, \"PTO_JE_Draft\", PTO_JOURNAL_COLUMNS, SAMPLE_JOURNAL_LINES);\n            // Sync PTO_Analysis from PTO_Data (enriches with department, pay rate, calculates liability)\n            await syncPtoAnalysis(context);\n            const dataSheet = context.workbook.worksheets.getItem(\"PTO_Data\");\n            dataSheet.activate();\n            dataSheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n\n        setState({ stepStatuses: { 1: \"complete\" } });\n    } catch (error) {\n        console.error(error);\n    } finally {\n        toggleLoader(false);\n    }\n}\n\nasync function refreshValidationData() {\n    if (!hasExcel()) {\n        window.alert(\"Excel is not available. Open this module inside Excel to refresh data.\");\n        return;\n    }\n    toggleLoader(true, \"Refreshing PTO_Analysis...\");\n    try {\n        await syncPtoAnalysis();\n        // After refresh, automatically run validation and completeness check\n        toggleLoader(false);\n        await runBalanceValidation();\n        await runCompletenessCheck();\n        // Re-render step 4 if we're on it to update the completeness pills\n        if (appState.activeStepId === 4) {\n            renderApp();\n        }\n    } catch (error) {\n        console.error(\"Refresh error:\", error);\n        window.alert(`Failed to refresh data: ${error.message}`);\n        toggleLoader(false);\n    }\n}\n\n/**\n * Handle save button click for missing pay rate card\n * Updates PTO_Analysis directly with the entered pay rate\n */\nasync function handlePayRateSave() {\n    const input = document.getElementById(\"payrate-input\");\n    if (!input) return;\n    \n    const payRate = parseFloat(input.value);\n    const employeeName = input.dataset.employee;\n    const rowIndex = parseInt(input.dataset.row, 10);\n    \n    if (isNaN(payRate) || payRate <= 0) {\n        window.alert(\"Please enter a valid pay rate greater than 0.\");\n        return;\n    }\n    \n    if (!employeeName || isNaN(rowIndex)) {\n        console.error(\"Missing employee data on input\");\n        return;\n    }\n    \n    toggleLoader(true, \"Updating pay rate...\");\n    \n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(\"PTO_Analysis\");\n            \n            // Pay Rate is column D (index 3)\n            const payRateCell = sheet.getCell(rowIndex - 1, 3); // -1 because Excel rows are 1-based but getCell is 0-based\n            payRateCell.values = [[payRate]];\n            \n            // Recalculate Liability Amount (column J, index 9) = Balance \u00D7 Pay Rate\n            const balanceCell = sheet.getCell(rowIndex - 1, 8); // Balance is column I (index 8)\n            balanceCell.load(\"values\");\n            await context.sync();\n            \n            const balance = Number(balanceCell.values[0][0]) || 0;\n            const liabilityAmount = balance * payRate;\n            \n            const liabilityCell = sheet.getCell(rowIndex - 1, 9);\n            liabilityCell.values = [[liabilityAmount]];\n            \n            // Also recalculate Change column (column L, index 11) = Liability - Prior\n            const priorCell = sheet.getCell(rowIndex - 1, 10); // Prior is column K (index 10)\n            priorCell.load(\"values\");\n            await context.sync();\n            \n            const priorLiability = Number(priorCell.values[0][0]) || 0;\n            const change = liabilityAmount - priorLiability;\n            \n            const changeCell = sheet.getCell(rowIndex - 1, 11);\n            changeCell.values = [[change]];\n            \n            await context.sync();\n        });\n        \n        // Remove this employee from missing list and re-render\n        analysisState.missingPayRates = analysisState.missingPayRates.filter(e => e.name !== employeeName);\n        toggleLoader(false);\n        \n        // Re-render to show next missing employee or remove card\n        focusStep(3, 3);\n        \n    } catch (error) {\n        console.error(\"Failed to save pay rate:\", error);\n        window.alert(`Failed to save pay rate: ${error.message}`);\n        toggleLoader(false);\n    }\n}\n\n/**\n * Handle ignore button click for missing pay rate card\n * Skips this employee and shows the next one\n */\nfunction handlePayRateIgnore() {\n    const input = document.getElementById(\"payrate-input\");\n    if (!input) return;\n    \n    const employeeName = input.dataset.employee;\n    if (employeeName) {\n        // Add to ignored set\n        analysisState.ignoredMissingPayRates.add(employeeName);\n        // Remove from current missing list\n        analysisState.missingPayRates = analysisState.missingPayRates.filter(e => e.name !== employeeName);\n    }\n    \n    // Re-render to show next missing employee or remove card\n    focusStep(3, 3);\n}\n\nasync function runDataQualityCheck() {\n    if (!hasExcel()) {\n        window.alert(\"Excel is not available. Open this module inside Excel to run quality check.\");\n        return;\n    }\n    \n    dataQualityState.loading = true;\n    toggleLoader(true, \"Analyzing data quality...\");\n    updateSaveButtonState(document.getElementById(\"quality-save-btn\"), false);\n    \n    try {\n        await Excel.run(async (context) => {\n            const dataSheet = context.workbook.worksheets.getItem(\"PTO_Data\");\n            const dataRange = dataSheet.getUsedRangeOrNullObject();\n            dataRange.load(\"values\");\n            await context.sync();\n            \n            const dataValues = dataRange.isNullObject ? [] : dataRange.values || [];\n            \n            if (!dataValues.length || dataValues.length < 2) {\n                throw new Error(\"PTO_Data is empty or has no data rows.\");\n            }\n            \n            // Parse headers\n            const headers = (dataValues[0] || []).map(h => normalizeName(h));\n            console.log(\"[Data Quality] PTO_Data headers:\", dataValues[0]);\n            \n            // Find employee name column - be specific to avoid matching company name\n            let nameIdx = headers.findIndex(h => h === \"employee name\" || h === \"employeename\");\n            if (nameIdx === -1) {\n                // Fallback: look for column containing \"employee\" AND \"name\"\n                nameIdx = headers.findIndex(h => h.includes(\"employee\") && h.includes(\"name\"));\n            }\n            if (nameIdx === -1) {\n                // Last resort: just \"name\" but not if it also contains \"company\" or \"form\"\n                nameIdx = headers.findIndex(h => h === \"name\" || (h.includes(\"name\") && !h.includes(\"company\") && !h.includes(\"form\")));\n            }\n            console.log(\"[Data Quality] Employee name column index:\", nameIdx, \"Header:\", dataValues[0]?.[nameIdx]);\n            const balanceIdx = findColumnIndex(headers, [\"balance\"]);\n            const accrualRateIdx = findColumnIndex(headers, [\"accrual rate\", \"accrualrate\"]);\n            const carryOverIdx = findColumnIndex(headers, [\"carry over\", \"carryover\"]);\n            const ytdAccruedIdx = findColumnIndex(headers, [\"ytd accrued\", \"ytdaccrued\"]);\n            const ytdUsedIdx = findColumnIndex(headers, [\"ytd used\", \"ytdused\"]);\n            \n            // Reset state\n            const balanceIssues = [];\n            const zeroBalances = [];\n            const accrualOutliers = [];\n            \n            // Process each employee row\n            const dataRows = dataValues.slice(1);\n            dataRows.forEach((row, idx) => {\n                const rowIndex = idx + 2; // 1-based, after header\n                const name = nameIdx !== -1 ? String(row[nameIdx] || \"\").trim() : `Row ${rowIndex}`;\n                if (!name) return;\n                \n                const balance = balanceIdx !== -1 ? Number(row[balanceIdx]) || 0 : 0;\n                const accrualRate = accrualRateIdx !== -1 ? Number(row[accrualRateIdx]) || 0 : 0;\n                const carryOver = carryOverIdx !== -1 ? Number(row[carryOverIdx]) || 0 : 0;\n                const ytdAccrued = ytdAccruedIdx !== -1 ? Number(row[ytdAccruedIdx]) || 0 : 0;\n                const ytdUsed = ytdUsedIdx !== -1 ? Number(row[ytdUsedIdx]) || 0 : 0;\n                \n                // Check 1: Balance issues - negative balance or used more than available\n                const maxUsable = carryOver + ytdAccrued;\n                if (balance < 0) {\n                    balanceIssues.push({ \n                        name, \n                        issue: `Negative balance: ${balance.toFixed(2)} hrs`,\n                        rowIndex \n                    });\n                } else if (ytdUsed > maxUsable && maxUsable > 0) {\n                    balanceIssues.push({ \n                        name, \n                        issue: `Used ${ytdUsed.toFixed(0)} hrs but only ${maxUsable.toFixed(0)} available`,\n                        rowIndex \n                    });\n                }\n                \n                // Check 2: Zero balances (informational)\n                if (balance === 0 && (carryOver > 0 || ytdAccrued > 0)) {\n                    zeroBalances.push({ name, rowIndex });\n                }\n                \n                // Check 3: Accrual rate outliers (> 8 hrs per period is unusual)\n                if (accrualRate > 8) {\n                    accrualOutliers.push({ name, accrualRate, rowIndex });\n                }\n            });\n            \n            // Update state\n            dataQualityState.balanceIssues = balanceIssues;\n            dataQualityState.zeroBalances = zeroBalances;\n            dataQualityState.accrualOutliers = accrualOutliers;\n            dataQualityState.totalIssues = balanceIssues.length;\n            dataQualityState.totalEmployees = dataRows.filter(r => r.some(c => c !== null && c !== \"\")).length;\n            dataQualityState.hasRun = true;\n        });\n        \n        // Update step status\n        const hasBlockingIssues = dataQualityState.balanceIssues.length > 0;\n        setState({ stepStatuses: { 3: hasBlockingIssues ? \"blocked\" : \"complete\" } });\n        \n    } catch (error) {\n        console.error(\"Data quality check error:\", error);\n        window.alert(`Quality check failed: ${error.message}`);\n        dataQualityState.hasRun = false;\n    } finally {\n        dataQualityState.loading = false;\n        toggleLoader(false);\n        renderApp();\n    }\n}\n\n/**\n * User acknowledges quality issues and wants to proceed anyway\n */\nfunction acknowledgeQualityIssues() {\n    dataQualityState.acknowledged = true;\n    // Allow sign-off even with issues\n    setState({ stepStatuses: { 3: \"complete\" } });\n    renderApp();\n}\n\n// Note: Save functions removed - auto-save happens via config writes during analysis\n\n/**\n * Run data completeness check comparing PTO_Data to PTO_Analysis column sums\n */\nasync function runCompletenessCheck() {\n    if (!hasExcel()) return;\n    \n    try {\n        await Excel.run(async (context) => {\n            const dataSheet = context.workbook.worksheets.getItem(\"PTO_Data\");\n            const analysisSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Analysis\");\n            \n            const dataRange = dataSheet.getUsedRangeOrNullObject();\n            dataRange.load(\"values\");\n            analysisSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (analysisSheet.isNullObject) {\n                // Reset all checks to null if no analysis sheet\n                analysisState.completenessCheck = {\n                    accrualRate: null,\n                    carryOver: null,\n                    ytdAccrued: null,\n                    ytdUsed: null,\n                    balance: null\n                };\n                return;\n            }\n            \n            const analysisRange = analysisSheet.getUsedRangeOrNullObject();\n            analysisRange.load(\"values\");\n            await context.sync();\n            \n            const dataValues = dataRange.isNullObject ? [] : dataRange.values || [];\n            const analysisValues = analysisRange.isNullObject ? [] : analysisRange.values || [];\n            \n            if (!dataValues.length || !analysisValues.length) {\n                analysisState.completenessCheck = {\n                    accrualRate: null,\n                    carryOver: null,\n                    ytdAccrued: null,\n                    ytdUsed: null,\n                    balance: null\n                };\n                return;\n            }\n            \n            // Helper to find column and sum values\n            const sumColumn = (rows, columnAliases, label) => {\n                const headers = (rows[0] || []).map(h => normalizeName(h));\n                const idx = findColumnIndex(headers, columnAliases);\n                if (idx === -1) return null;\n                const dataRows = rows.slice(1);\n                return dataRows.reduce((sum, row) => sum + (Number(row[idx]) || 0), 0);\n            };\n            \n            // Column mappings for each field\n            const fields = [\n                { key: \"accrualRate\", aliases: [\"accrual rate\", \"accrualrate\"] },\n                { key: \"carryOver\", aliases: [\"carry over\", \"carryover\", \"carry_over\"] },\n                { key: \"ytdAccrued\", aliases: [\"ytd accrued\", \"ytdaccrued\", \"ytd_accrued\"] },\n                { key: \"ytdUsed\", aliases: [\"ytd used\", \"ytdused\", \"ytd_used\"] },\n                { key: \"balance\", aliases: [\"balance\"] }\n            ];\n            \n            const results = {};\n            \n            for (const field of fields) {\n                const ptoDataSum = sumColumn(dataValues, field.aliases, \"PTO_Data\");\n                const analysisSum = sumColumn(analysisValues, field.aliases, \"PTO_Analysis\");\n                \n                if (ptoDataSum === null || analysisSum === null) {\n                    results[field.key] = null;\n                } else {\n                    // Use tolerance for floating point comparison\n                    const match = Math.abs(ptoDataSum - analysisSum) < 0.01;\n                    results[field.key] = {\n                        match,\n                        ptoData: ptoDataSum,\n                        ptoAnalysis: analysisSum\n                    };\n                }\n            }\n            \n            analysisState.completenessCheck = results;\n        });\n    } catch (error) {\n        console.error(\"Completeness check failed:\", error);\n    }\n}\n\n/**\n * Run full analysis - syncs data and runs all verification checks\n */\nasync function runFullAnalysis() {\n    if (!hasExcel()) {\n        window.alert(\"Excel is not available. Open this module inside Excel to run analysis.\");\n        return;\n    }\n    \n    toggleLoader(true, \"Running analysis...\");\n    \n    try {\n        // 1. Sync PTO_Analysis from PTO_Data with enrichment\n        await syncPtoAnalysis();\n        \n        // 2. Run completeness check (compare column sums)\n        await runCompletenessCheck();\n        \n        // 3. Update state\n        analysisState.cleanDataReady = true;\n        \n        // 4. Re-render to show results\n        renderApp();\n        \n    } catch (error) {\n        console.error(\"Full analysis error:\", error);\n        window.alert(`Analysis failed: ${error.message}`);\n    } finally {\n        toggleLoader(false);\n    }\n}\n\nasync function populatePtoAnalysis() {\n    if (!hasExcel()) {\n        analysisState.lastError = \"Excel is not available. Open this module inside Excel to run analysis.\";\n        renderApp();\n        return;\n    }\n    \n    analysisState.loading = true;\n    analysisState.lastError = null;\n    renderApp();\n    \n    try {\n        // Sync PTO_Analysis directly from PTO_Data (with enrichment from roster/archive)\n        await syncPtoAnalysis();\n        \n        // Get the row count from PTO_Analysis\n        const result = await Excel.run(async (context) => {\n            const analysisSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Analysis\");\n            analysisSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (analysisSheet.isNullObject) {\n                throw new Error(\"PTO_Analysis sheet was not created. Please check that PTO_Data has data.\");\n            }\n            \n            const analysisRange = analysisSheet.getUsedRangeOrNullObject();\n            analysisRange.load(\"values\");\n            await context.sync();\n            \n            const values = analysisRange.isNullObject ? [] : analysisRange.values || [];\n            const dataRows = values.length > 1 ? values.length - 1 : 0;\n            \n            if (dataRows === 0) {\n                throw new Error(\"No employee data found. Please import PTO data in Step 1 first.\");\n            }\n            \n            return { employeeCount: dataRows };\n        });\n        \n        // Update state with success\n        analysisState.cleanDataReady = true;\n        analysisState.employeeCount = result.employeeCount;\n        analysisState.lastRun = new Date().toISOString();\n        analysisState.lastError = null;\n        \n        setState({ stepStatuses: { 4: \"complete\" } });\n    } catch (error) {\n        console.error(error);\n        analysisState.lastError = error?.message || \"An unexpected error occurred while running the analysis.\";\n        analysisState.lastRun = null;\n    } finally {\n        analysisState.loading = false;\n        renderApp();\n    }\n}\n\n/**\n * Check PTO_Analysis status when entering Step 4\n */\nasync function checkAnalysisPrerequisites() {\n    if (!hasExcel()) {\n        analysisState.cleanDataReady = false;\n        analysisState.employeeCount = 0;\n        return;\n    }\n    \n    try {\n        const result = await Excel.run(async (context) => {\n            const analysisSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Analysis\");\n            analysisSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (analysisSheet.isNullObject) {\n                return { ready: false, count: 0 };\n            }\n            \n            const analysisRange = analysisSheet.getUsedRangeOrNullObject();\n            analysisRange.load(\"values\");\n            await context.sync();\n            \n            const values = analysisRange.isNullObject ? [] : analysisRange.values || [];\n            const dataRows = values.length > 1 ? values.length - 1 : 0;\n            \n            return { ready: dataRows > 0, count: dataRows };\n        });\n        \n        analysisState.cleanDataReady = result.ready;\n        analysisState.employeeCount = result.count;\n    } catch (error) {\n        console.error(\"Error checking analysis prerequisites:\", error);\n        analysisState.cleanDataReady = false;\n        analysisState.employeeCount = 0;\n    }\n}\n\nasync function runJournalSummary() {\n    if (!hasExcel()) {\n        window.alert(\"Excel is not available. Open this module inside Excel to run journal checks.\");\n        return;\n    }\n    journalState.loading = true;\n    journalState.lastError = null;\n    updateSaveButtonState(document.getElementById(\"je-save-btn\"), false);\n    renderApp();\n    try {\n        const totals = await Excel.run(async (context) => {\n            // Read JE Draft\n            const jeSheet = context.workbook.worksheets.getItem(\"PTO_JE_Draft\");\n            const jeRange = jeSheet.getUsedRangeOrNullObject();\n            jeRange.load(\"values\");\n            \n            // Read PTO_Analysis for comparison\n            const analysisSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Analysis\");\n            analysisSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            const jeValues = jeRange.isNullObject ? [] : jeRange.values || [];\n            if (!jeValues.length) {\n                throw new Error(\"PTO_JE_Draft is empty. Generate the JE first.\");\n            }\n            \n            // Parse JE headers\n            const jeHeaders = (jeValues[0] || []).map((h) => normalizeName(h));\n            const debitIdx = findColumnIndex(jeHeaders, [\"debit\"]);\n            const creditIdx = findColumnIndex(jeHeaders, [\"credit\"]);\n            const lineAmountIdx = findColumnIndex(jeHeaders, [\"lineamount\", \"line amount\"]);\n            const acctNumIdx = findColumnIndex(jeHeaders, [\"account number\", \"accountnumber\"]);\n            \n            if (debitIdx === -1 || creditIdx === -1) {\n                throw new Error(\"Could not find Debit and Credit columns in PTO_JE_Draft.\");\n            }\n            \n            let debitTotal = 0;\n            let creditTotal = 0;\n            let lineAmountSum = 0;\n            let jeChangeTotal = 0; // Sum of expense line amounts (not liability offset)\n            \n            jeValues.slice(1).forEach((row) => {\n                const debit = Number(row[debitIdx]) || 0;\n                const credit = Number(row[creditIdx]) || 0;\n                const lineAmount = lineAmountIdx !== -1 ? Number(row[lineAmountIdx]) || 0 : 0;\n                const acctNum = acctNumIdx !== -1 ? String(row[acctNumIdx] || \"\").trim() : \"\";\n                \n                debitTotal += debit;\n                creditTotal += credit;\n                lineAmountSum += lineAmount;\n                \n                // Sum expense lines only (not the liability offset 21540)\n                if (acctNum && acctNum !== \"21540\") {\n                    jeChangeTotal += lineAmount;\n                }\n            });\n            \n            // Get PTO_Analysis total change\n            let analysisChangeTotal = 0;\n            if (!analysisSheet.isNullObject) {\n                const analysisRange = analysisSheet.getUsedRangeOrNullObject();\n                analysisRange.load(\"values\");\n                await context.sync();\n                \n                const analysisValues = analysisRange.isNullObject ? [] : analysisRange.values || [];\n                if (analysisValues.length > 1) {\n                    const analysisHeaders = (analysisValues[0] || []).map(h => normalizeName(h));\n                    const changeIdx = findColumnIndex(analysisHeaders, [\"change\"]);\n                    \n                    if (changeIdx !== -1) {\n                        analysisValues.slice(1).forEach(row => {\n                            analysisChangeTotal += Number(row[changeIdx]) || 0;\n                        });\n                    }\n                }\n            }\n            \n            // Build validation issues array\n            const difference = debitTotal - creditTotal;\n            const issues = [];\n            \n            // Check 1: Debits = Credits\n            if (Math.abs(difference) >= 0.01) {\n                issues.push({\n                    check: \"Debits = Credits\",\n                    passed: false,\n                    detail: difference > 0 \n                        ? `Debits exceed credits by $${Math.abs(difference).toLocaleString(undefined, {minimumFractionDigits: 2})}`\n                        : `Credits exceed debits by $${Math.abs(difference).toLocaleString(undefined, {minimumFractionDigits: 2})}`\n                });\n            } else {\n                issues.push({ check: \"Debits = Credits\", passed: true, detail: \"\" });\n            }\n            \n            // Check 2: Line Amounts Sum to Zero\n            if (Math.abs(lineAmountSum) >= 0.01) {\n                issues.push({\n                    check: \"Line Amounts Sum to Zero\",\n                    passed: false,\n                    detail: `Line amounts sum to $${lineAmountSum.toLocaleString(undefined, {minimumFractionDigits: 2})} (should be $0.00)`\n                });\n            } else {\n                issues.push({ check: \"Line Amounts Sum to Zero\", passed: true, detail: \"\" });\n            }\n            \n            // Check 3: JE Matches Analysis Total\n            const changeDiff = Math.abs(jeChangeTotal - analysisChangeTotal);\n            if (changeDiff >= 0.01) {\n                issues.push({\n                    check: \"JE Matches Analysis Total\",\n                    passed: false,\n                    detail: `JE expense total ($${jeChangeTotal.toLocaleString(undefined, {minimumFractionDigits: 2})}) differs from PTO_Analysis Change total ($${analysisChangeTotal.toLocaleString(undefined, {minimumFractionDigits: 2})}) by $${changeDiff.toLocaleString(undefined, {minimumFractionDigits: 2})}`\n                });\n            } else {\n                issues.push({ check: \"JE Matches Analysis Total\", passed: true, detail: \"\" });\n            }\n            \n            return { \n                debitTotal, \n                creditTotal, \n                difference,\n                lineAmountSum,\n                jeChangeTotal,\n                analysisChangeTotal,\n                issues,\n                validationRun: true\n            };\n        });\n        Object.assign(journalState, totals, { lastError: null });\n    } catch (error) {\n        console.warn(\"PTO JE summary:\", error);\n        journalState.lastError = error?.message || \"Unable to calculate journal totals.\";\n        journalState.debitTotal = null;\n        journalState.creditTotal = null;\n        journalState.difference = null;\n        journalState.lineAmountSum = null;\n        journalState.jeChangeTotal = null;\n        journalState.analysisChangeTotal = null;\n        journalState.issues = [];\n        journalState.validationRun = false;\n    } finally {\n        journalState.loading = false;\n        renderApp();\n    }\n}\n\n/**\n * Department to Expense Account mapping for PTO accrual entries\n */\nconst DEPARTMENT_EXPENSE_ACCOUNTS = {\n    \"general & administrative\": \"64110\",\n    \"general and administrative\": \"64110\",\n    \"g&a\": \"64110\",\n    \"research & development\": \"62110\",\n    \"research and development\": \"62110\",\n    \"r&d\": \"62110\",\n    \"marketing\": \"61610\",\n    \"cogs onboarding\": \"53110\",\n    \"cogs prof. services\": \"56110\",\n    \"cogs professional services\": \"56110\",\n    \"sales & marketing\": \"61110\",\n    \"sales and marketing\": \"61110\",\n    \"cogs support\": \"52110\",\n    \"client success\": \"61811\"\n};\n\nconst LIABILITY_OFFSET_ACCOUNT = \"21540\";\n\n/**\n * Create PTO Journal Entry Draft\n * Groups Change amounts by Department and creates proper debit/credit entries\n */\nasync function createJournalDraft() {\n    if (!hasExcel()) {\n        window.alert(\"Excel is not available. Open this module inside Excel to create the journal entry.\");\n        return;\n    }\n    \n    toggleLoader(true, \"Creating PTO Journal Entry...\");\n    \n    try {\n        await Excel.run(async (context) => {\n            // 1. Read config values\n            const configTable = context.workbook.tables.getItem(CONFIG_TABLES[0]);\n            const configRange = configTable.getDataBodyRange();\n            configRange.load(\"values\");\n            \n            // 2. Read PTO_Analysis\n            const analysisSheet = context.workbook.worksheets.getItem(\"PTO_Analysis\");\n            const analysisRange = analysisSheet.getUsedRangeOrNullObject();\n            analysisRange.load(\"values\");\n            \n            // 3. Read Chart of Accounts for account name lookups\n            const coaSheet = context.workbook.worksheets.getItemOrNullObject(\"SS_Chart_of_Accounts\");\n            coaSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            let coaData = [];\n            if (!coaSheet.isNullObject) {\n                const coaRange = coaSheet.getUsedRangeOrNullObject();\n                coaRange.load(\"values\");\n                await context.sync();\n                coaData = coaRange.isNullObject ? [] : coaRange.values || [];\n            }\n            \n            const configValues = configRange.values || [];\n            const analysisValues = analysisRange.isNullObject ? [] : analysisRange.values || [];\n            \n            if (!analysisValues.length) {\n                throw new Error(\"PTO_Analysis is empty. Run the analysis first.\");\n            }\n            \n            // Parse config values - SS_PF_Config structure:\n            // Column 0 = Category (e.g., \"Tab Structure\", \"PTO\")\n            // Column 1 = Field name (e.g., \"PTO_Journal_Entry_ID\")\n            // Column 2 = Value (the actual value we need)\n            // Column 3 = Value2 (used for tab structure)\n            const configMap = {};\n            configValues.forEach(row => {\n                const field = String(row[1] || \"\").trim(); // Column 1 = Field name\n                const value = row[2]; // Column 2 = Value\n                if (field) {\n                    configMap[field] = value;\n                }\n            });\n            \n            // Log config lookup results (useful for troubleshooting)\n            if (!configMap[PTO_CONFIG_FIELDS.journalEntryId] || !configMap[PTO_CONFIG_FIELDS.payrollDate]) {\n                console.warn(\"[JE Draft] Missing config values - RefNumber:\", configMap[PTO_CONFIG_FIELDS.journalEntryId], \"TxnDate:\", configMap[PTO_CONFIG_FIELDS.payrollDate]);\n            }\n            \n            const refNumber = configMap[PTO_CONFIG_FIELDS.journalEntryId] || \"\";\n            const rawTxnDate = configMap[PTO_CONFIG_FIELDS.payrollDate] || \"\";\n            const accountingPeriod = configMap[PTO_CONFIG_FIELDS.accountingPeriod] || \"\";\n            \n            // Format TxnDate as MM/DD/YYYY\n            // Handle Excel serial numbers, ISO strings, or already formatted dates\n            let txnDate = \"\";\n            if (rawTxnDate) {\n                try {\n                    let d;\n                    // Check if it's an Excel serial number (typically 5 digits like 45626)\n                    if (typeof rawTxnDate === \"number\" || /^\\d{4,5}$/.test(String(rawTxnDate).trim())) {\n                        // Excel serial date: days since Jan 1, 1900 (with leap year bug adjustment)\n                        const serialNum = Number(rawTxnDate);\n                        // Excel incorrectly treats 1900 as leap year, so subtract 1 for dates after Feb 28, 1900\n                        const excelEpoch = new Date(1899, 11, 30); // Dec 30, 1899\n                        d = new Date(excelEpoch.getTime() + serialNum * 24 * 60 * 60 * 1000);\n                    } else {\n                        d = new Date(rawTxnDate);\n                    }\n                    \n                    if (!isNaN(d.getTime()) && d.getFullYear() > 1970) {\n                        const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n                        const dd = String(d.getDate()).padStart(2, \"0\");\n                        const yyyy = d.getFullYear();\n                        txnDate = `${mm}/${dd}/${yyyy}`;\n                    } else {\n                        console.warn(\"[JE Draft] Date parsing resulted in invalid date:\", rawTxnDate, \"->\", d);\n                        txnDate = String(rawTxnDate); // Fall back to raw value\n                    }\n                } catch (e) {\n                    console.warn(\"[JE Draft] Could not parse TxnDate:\", rawTxnDate, e);\n                    txnDate = String(rawTxnDate); // Fall back to raw value\n                }\n            }\n            \n            const lineDescBase = accountingPeriod ? `${accountingPeriod} PTO Accrual` : \"PTO Accrual\";\n            \n            // Build Chart of Accounts lookup map\n            const coaMap = {};\n            if (coaData.length > 1) {\n                const coaHeaders = (coaData[0] || []).map(h => normalizeName(h));\n                const acctNumIdx = findColumnIndex(coaHeaders, [\"account number\", \"accountnumber\", \"account\", \"acct\"]);\n                const acctNameIdx = findColumnIndex(coaHeaders, [\"account name\", \"accountname\", \"name\", \"description\"]);\n                \n                if (acctNumIdx !== -1 && acctNameIdx !== -1) {\n                    coaData.slice(1).forEach(row => {\n                        const num = String(row[acctNumIdx] || \"\").trim();\n                        const name = String(row[acctNameIdx] || \"\").trim();\n                        if (num) coaMap[num] = name;\n                    });\n                }\n            }\n            \n            // Parse PTO_Analysis headers and find columns\n            const headers = (analysisValues[0] || []).map(h => normalizeName(h));\n            const deptIdx = findColumnIndex(headers, [\"department\"]);\n            const changeIdx = findColumnIndex(headers, [\"change\"]);\n            \n            if (deptIdx === -1 || changeIdx === -1) {\n                throw new Error(\"Could not find Department or Change columns in PTO_Analysis.\");\n            }\n            \n            // Group Change amounts by Department\n            const deptTotals = {};\n            analysisValues.slice(1).forEach(row => {\n                const dept = String(row[deptIdx] || \"\").trim();\n                const change = Number(row[changeIdx]) || 0;\n                \n                if (dept && change !== 0) {\n                    if (!deptTotals[dept]) {\n                        deptTotals[dept] = 0;\n                    }\n                    deptTotals[dept] += change;\n                }\n            });\n            \n            // Build JE rows\n            const jeHeaders = [\"RefNumber\", \"TxnDate\", \"Account Number\", \"Account Name\", \"LineAmount\", \"Debit\", \"Credit\", \"LineDesc\", \"Department\"];\n            const jeRows = [jeHeaders];\n            \n            let totalDebits = 0;\n            let totalCredits = 0;\n            \n            // Create expense lines by department\n            Object.entries(deptTotals).forEach(([dept, change]) => {\n                if (Math.abs(change) < 0.01) return; // Skip zero changes\n                \n                // Look up expense account for this department\n                const deptKey = dept.toLowerCase().trim();\n                const expenseAcct = DEPARTMENT_EXPENSE_ACCOUNTS[deptKey] || \"\";\n                const expenseAcctName = coaMap[expenseAcct] || \"\";\n                \n                // Determine debit/credit\n                // Positive change = liability increased = expense (debit)\n                // Negative change = liability decreased = expense reversal (credit)\n                const debit = change > 0 ? Math.abs(change) : 0;\n                const credit = change < 0 ? Math.abs(change) : 0;\n                \n                totalDebits += debit;\n                totalCredits += credit;\n                \n                jeRows.push([\n                    refNumber,\n                    txnDate,\n                    expenseAcct,\n                    expenseAcctName,\n                    change, // Line amount (positive or negative)\n                    debit,\n                    credit,\n                    lineDescBase,\n                    dept\n                ]);\n            });\n            \n            // Add liability offset entry (account 21540)\n            // Net offset = credits - debits (opposite of expense entries)\n            const netChange = totalDebits - totalCredits;\n            if (Math.abs(netChange) >= 0.01) {\n                const liabilityDebit = netChange < 0 ? Math.abs(netChange) : 0;\n                const liabilityCredit = netChange > 0 ? Math.abs(netChange) : 0;\n                const liabilityAcctName = coaMap[LIABILITY_OFFSET_ACCOUNT] || \"Accrued PTO\";\n                \n                jeRows.push([\n                    refNumber,\n                    txnDate,\n                    LIABILITY_OFFSET_ACCOUNT,\n                    liabilityAcctName,\n                    -netChange, // Opposite of net expense\n                    liabilityDebit,\n                    liabilityCredit,\n                    lineDescBase,\n                    \"\" // No department for liability\n                ]);\n            }\n            \n            // Write to PTO_JE_Draft sheet\n            let jeSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_JE_Draft\");\n            jeSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (jeSheet.isNullObject) {\n                jeSheet = context.workbook.worksheets.add(\"PTO_JE_Draft\");\n            } else {\n                // Clear existing content\n                const usedRange = jeSheet.getUsedRangeOrNullObject();\n                usedRange.load(\"isNullObject\");\n                await context.sync();\n                if (!usedRange.isNullObject) {\n                    usedRange.clear();\n                }\n            }\n            \n            // Write all rows\n            if (jeRows.length > 0) {\n                const writeRange = jeSheet.getRangeByIndexes(0, 0, jeRows.length, jeHeaders.length);\n                writeRange.values = jeRows;\n                \n                // Format headers\n                const headerRange = jeSheet.getRangeByIndexes(0, 0, 1, jeHeaders.length);\n                formatSheetHeaders(headerRange);\n                \n                // Format currency columns (E: LineAmount, F: Debit, G: Credit)\n                const dataRowCount = jeRows.length - 1;\n                if (dataRowCount > 0) {\n                    formatCurrencyColumn(jeSheet, 4, dataRowCount, true);  // E: LineAmount (with negative)\n                    formatCurrencyColumn(jeSheet, 5, dataRowCount);        // F: Debit\n                    formatCurrencyColumn(jeSheet, 6, dataRowCount);        // G: Credit\n                }\n                \n                // Auto-fit columns\n                writeRange.format.autofitColumns();\n            }\n            \n            await context.sync();\n            \n            // Activate the sheet and select A1\n            jeSheet.activate();\n            jeSheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n        \n        // Run journal summary to update totals\n        await runJournalSummary();\n        \n    } catch (error) {\n        console.error(\"Create JE Draft error:\", error);\n        window.alert(`Unable to create Journal Entry: ${error.message}`);\n    } finally {\n        toggleLoader(false);\n    }\n}\n\nasync function exportJournalDraft() {\n    if (!hasExcel()) {\n        window.alert(\"Excel is not available. Open this module inside Excel to export.\");\n        return;\n    }\n    toggleLoader(true, \"Preparing JE CSV...\");\n    try {\n        const { rows } = await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(\"PTO_JE_Draft\");\n            const range = sheet.getUsedRangeOrNullObject();\n            range.load(\"values\");\n            await context.sync();\n            const values = range.isNullObject ? [] : range.values || [];\n            if (!values.length) {\n                throw new Error(\"PTO_JE_Draft is empty.\");\n            }\n            return { rows: values };\n        });\n        const csv = buildCsv(rows);\n        downloadCsv(`pto-je-draft-${todayIso()}.csv`, csv);\n    } catch (error) {\n        console.error(\"PTO JE export:\", error);\n        window.alert(\"Unable to export the JE draft. Confirm the sheet has data.\");\n    } finally {\n        toggleLoader(false);\n    }\n}\n\nasync function archiveAndReset() {\n    if (!appState.workbookReady || !hasExcel()) {\n        return;\n    }\n    toggleLoader(true, \"Archiving PTO outputs...\");\n    try {\n        await Excel.run(async (context) => {\n            // capture clean rows before any clears\n            const analysisRowsBefore = await getAnalysisRows(context);\n\n            // Add archive log entry\n            const archiveTable = context.workbook.tables.getItemOrNullObject(\"PTOArchiveLog\");\n            archiveTable.load(\"isNullObject\");\n            await context.sync();\n            if (!archiveTable.isNullObject) {\n                archiveTable.rows.add(null, [[new Date().toISOString(), \"Archived PTO run\", \"Completed via module\"]]);\n            }\n\n            // Export all PTO-related sheets defined in SS_PF_Config\n            await exportPtoSheets(context);\n\n            // Snapshot PTO_Analysis into PTO_Archive_Summary (row 2+)\n            await copyAnalysisToArchiveSummary(context, analysisRowsBefore);\n\n            // Clear data rows (row 2+) from target sheets\n            const sheetsToClear = [\"PTO_JE_Draft\", \"PTO_Analysis\", \"PTO_Data\"];\n            for (const name of sheetsToClear) {\n                await clearSheetBelowHeader(context, name);\n            }\n\n            // Clear non-permanent config values\n            await clearNonPermanentConfig(context);\n\n            await context.sync();\n        });\n\n        setState({\n            stepStatuses: {\n                1: \"pending\",\n                2: \"pending\",\n                3: \"pending\",\n                4: \"pending\",\n                5: \"pending\",\n                6: \"complete\"\n            }\n        });\n    } catch (error) {\n        console.error(error);\n    } finally {\n        toggleLoader(false);\n    }\n}\n\nasync function openSheet(sheetName) {\n    if (!sheetName || !hasExcel()) {\n        return;\n    }\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(sheetName);\n            sheet.activate();\n            // Select cell A1 so user always starts at a consistent location\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n    } catch (error) {\n        console.error(error);\n    }\n}\n\n/**\n * Clear PTO_Data sheet to start fresh\n */\nasync function clearPtoData() {\n    if (!hasExcel()) return;\n    \n    const confirmed = window.confirm(\"This will clear all data in PTO_Data. Are you sure?\");\n    if (!confirmed) return;\n    \n    toggleLoader(true);\n    try {\n        await Excel.run(async (context) => {\n            const sheet = context.workbook.worksheets.getItem(\"PTO_Data\");\n            const usedRange = sheet.getUsedRangeOrNullObject();\n            usedRange.load(\"rowCount\");\n            await context.sync();\n            \n            if (!usedRange.isNullObject && usedRange.rowCount > 1) {\n                // Keep header row, clear everything else\n                const dataRange = sheet.getRangeByIndexes(1, 0, usedRange.rowCount - 1, 20);\n                dataRange.clear(Excel.ClearApplyTo.contents);\n                await context.sync();\n            }\n            \n            sheet.activate();\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n        window.alert(\"PTO_Data cleared successfully. You can now paste new data.\");\n    } catch (error) {\n        console.error(\"Clear PTO_Data error:\", error);\n        window.alert(`Failed to clear PTO_Data: ${error.message}`);\n    } finally {\n        toggleLoader(false);\n    }\n}\n\n/**\n * Open a reference data sheet (creates if doesn't exist)\n */\nasync function openReferenceSheet(sheetName) {\n    if (!sheetName || !hasExcel()) {\n        return;\n    }\n    \n    const defaultHeaders = {\n        \"SS_Employee_Roster\": [\"Employee\", \"Department\", \"Pay_Rate\", \"Status\", \"Hire_Date\"],\n        \"SS_Chart_of_Accounts\": [\"Account_Number\", \"Account_Name\", \"Type\", \"Category\"]\n    };\n    \n    try {\n        await Excel.run(async (context) => {\n            let sheet = context.workbook.worksheets.getItemOrNullObject(sheetName);\n            sheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (sheet.isNullObject) {\n                // Create the sheet with default headers\n                sheet = context.workbook.worksheets.add(sheetName);\n                const headers = defaultHeaders[sheetName] || [\"Column1\", \"Column2\"];\n                const headerRange = sheet.getRange(`A1:${String.fromCharCode(64 + headers.length)}1`);\n                headerRange.values = [headers];\n                headerRange.format.font.bold = true;\n                headerRange.format.fill.color = \"#f0f0f0\";\n                headerRange.format.autofitColumns();\n                await context.sync();\n            }\n            \n            sheet.activate();\n            sheet.getRange(\"A1\").select();\n            await context.sync();\n        });\n    } catch (error) {\n        console.error(\"Error opening reference sheet:\", error);\n    }\n}\n\n/**\n * Unhide system sheets (SS_* prefix) for configuration access\n */\nasync function unhideSystemSheets() {\n    if (!hasExcel()) {\n        console.log(\"Excel not available\");\n        return;\n    }\n    \n    try {\n        await Excel.run(async (context) => {\n            const worksheets = context.workbook.worksheets;\n            worksheets.load(\"items/name,visibility\");\n            await context.sync();\n            \n            let unhiddenCount = 0;\n            worksheets.items.forEach((sheet) => {\n                if (sheet.name.toUpperCase().startsWith(\"SS_\")) {\n                    sheet.visibility = Excel.SheetVisibility.visible;\n                    console.log(`[Config] Made visible: ${sheet.name}`);\n                    unhiddenCount++;\n                }\n            });\n            \n            await context.sync();\n            \n            // Activate SS_PF_Config if it exists\n            const configSheet = context.workbook.worksheets.getItemOrNullObject(\"SS_PF_Config\");\n            configSheet.load(\"isNullObject\");\n            await context.sync();\n            \n            if (!configSheet.isNullObject) {\n                configSheet.activate();\n                configSheet.getRange(\"A1\").select();\n                await context.sync();\n            }\n            \n            console.log(`[Config] ${unhiddenCount} system sheets now visible`);\n        });\n    } catch (error) {\n        console.error(\"[Config] Error unhiding system sheets:\", error);\n    }\n}\n\nasync function writeDatasetToSheet(context, sheetName, columns, rows) {\n    const sheet = context.workbook.worksheets.getItem(sheetName);\n    const usedRange = sheet.getUsedRangeOrNullObject();\n    usedRange.load(\"address\");\n    await context.sync();\n    if (!usedRange.isNullObject) {\n        usedRange.clear();\n    }\n    const data = [\n        columns.map((col) => col.header),\n        ...rows.map((row) => columns.map((col) => row[col.key]))\n    ];\n    const range = sheet.getRangeByIndexes(0, 0, data.length, data[0]?.length || 1);\n    range.values = data;\n    range.format.autofitColumns();\n    await context.sync();\n}\n\nasync function clearSheetBelowHeader(context, sheetName) {\n    const sheet = context.workbook.worksheets.getItem(sheetName);\n    const usedRange = sheet.getUsedRangeOrNullObject();\n    usedRange.load(\"rowCount\");\n    await context.sync();\n    if (usedRange.isNullObject || usedRange.rowCount <= 1) return;\n    const dataRange = sheet.getRangeByIndexes(1, 0, usedRange.rowCount - 1, usedRange.columnCount);\n    dataRange.clear();\n}\n\nasync function getAnalysisRows(context) {\n    const sheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Analysis\");\n    sheet.load(\"isNullObject\");\n    await context.sync();\n    if (sheet.isNullObject) return [];\n    const range = sheet.getUsedRangeOrNullObject();\n    range.load(\"values\");\n    await context.sync();\n    const values = range.isNullObject ? [] : range.values || [];\n    if (values.length <= 1) return [];\n    return values.slice(1);\n}\n\nasync function writeRowsStartingAt(context, sheetName, rows) {\n    if (!rows.length) return;\n    const sheet = context.workbook.worksheets.getItem(sheetName);\n    const range = sheet.getRangeByIndexes(1, 0, rows.length, rows[0].length);\n    range.values = rows;\n    range.format.autofitColumns();\n}\n\nasync function clearNonPermanentConfig(context) {\n    const table = context.workbook.tables.getItemOrNullObject(CONFIG_TABLES[0]);\n    await context.sync();\n    if (table.isNullObject) return;\n    const body = table.getDataBodyRange();\n    const header = table.getHeaderRowRange();\n    body.load(\"values\");\n    header.load(\"values\");\n    await context.sync();\n    const headers = header.values[0] || [];\n    const normalizedHeaders = headers.map((h) => normalizeName(h));\n    const idx = {\n        field: normalizedHeaders.findIndex((h) => h === \"field\" || h === \"field name\" || h === \"setting\"),\n        permanent: normalizedHeaders.findIndex((h) => h === \"permanent\" || h === \"persist\"),\n        value: normalizedHeaders.findIndex((h) => h === \"value\" || h === \"setting value\")\n    };\n    if (idx.field === -1 || idx.value === -1 || idx.permanent === -1) return;\n    (body.values || []).forEach((row, rowIndex) => {\n        const permanent = String(row[idx.permanent] ?? \"\").trim().toLowerCase();\n        const shouldClear = permanent !== \"y\" && permanent !== \"yes\" && permanent !== \"true\" && permanent !== \"t\" && permanent !== \"1\";\n        if (shouldClear) {\n            body.getCell(rowIndex, idx.value).values = [[\"\"]];\n        }\n    });\n}\n\nasync function exportPtoSheets(context) {\n    const sheetNames = await getPtoSheetNames(context);\n    if (!sheetNames.length) return;\n    const chunks = [];\n    for (const name of sheetNames) {\n        try {\n            const sheet = context.workbook.worksheets.getItemOrNullObject(name);\n            sheet.load(\"isNullObject\");\n            await context.sync();\n            if (sheet.isNullObject) continue;\n            const range = sheet.getUsedRangeOrNullObject();\n            range.load(\"values\");\n            await context.sync();\n            const values = range.isNullObject ? [] : range.values || [];\n            const csv = values\n                .map((row) => row.map((cell) => `\"${String(cell ?? \"\").replace(/\"/g, '\"\"')}\"`).join(\",\"))\n                .join(\"\\n\");\n            chunks.push(`# Sheet: ${name}\\n${csv}`);\n        } catch (error) {\n            console.warn(\"PTO: unable to export sheet\", name, error);\n        }\n    }\n    if (!chunks.length) return;\n    const fileName = `${new Date().toISOString().slice(0, 10)} - Tai Software PTO Accrual.xlsx`;\n    // rudimentary multi-tab export: CSV sections inside a .xlsx extension to break links\n    const blob = new Blob([chunks.join(\"\\n\\n\")], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = fileName;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n}\n\nasync function getPtoSheetNames(context) {\n    const configSheet = context.workbook.worksheets.getItemOrNullObject(\"SS_PF_Config\");\n    configSheet.load(\"isNullObject\");\n    await context.sync();\n    if (configSheet.isNullObject) return [];\n    const usedRange = configSheet.getUsedRangeOrNullObject();\n    usedRange.load(\"values\");\n    await context.sync();\n    const values = usedRange.isNullObject ? [] : usedRange.values || [];\n    if (!values.length) return [];\n    const headers = (values[0] || []).map((h) => normalizeName(h));\n    const idx = {\n        category: headers.findIndex((h) => h === \"category\"),\n        module: headers.findIndex((h) => h === \"module\"),\n        field: headers.findIndex((h) => h === \"field\"),\n        value: headers.findIndex((h) => h === \"value\")\n    };\n    if (idx.category === -1 || idx.field === -1) return [];\n    const targetModule = normalizeName(MODULE_NAME);\n    const names = values\n        .slice(1)\n        .filter((row) => {\n            const category = normalizeName(row[idx.category]);\n            const module = idx.module >= 0 ? normalizeName(row[idx.module]) : \"\";\n            const moduleValue = idx.value >= 0 ? normalizeName(row[idx.value]) : \"\";\n            return category === \"tab-structure\" && (module === targetModule || moduleValue === \"pto-accrual\");\n        })\n        .map((row) => String(row[idx.field] ?? \"\").trim())\n        .filter(Boolean);\n    return Array.from(new Set(names));\n}\n\n/**\n * Copy PTO_Analysis to PTO_Archive_Summary.\n * Only retains the MOST RECENT period - older data is replaced.\n * e.g., When archiving 11/30, this overwrites any existing 10/31 data.\n */\nasync function copyAnalysisToArchiveSummary(context, analysisRows = null) {\n    const analysisSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Analysis\");\n    const archiveSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Archive_Summary\");\n    analysisSheet.load(\"isNullObject\");\n    archiveSheet.load(\"isNullObject\");\n    await context.sync();\n    if (analysisSheet.isNullObject || archiveSheet.isNullObject) return;\n    \n    // Get analysis data (use passed rows or fetch fresh)\n    let values = analysisRows;\n    if (!values || !values.length) {\n        const analysisRange = analysisSheet.getUsedRangeOrNullObject();\n        analysisRange.load(\"values\");\n        await context.sync();\n        values = analysisRange.isNullObject ? [] : analysisRange.values || [];\n    }\n    if (!values.length) return;\n    \n    // Clear existing archive data (only retain most recent period)\n    const existingRange = archiveSheet.getUsedRangeOrNullObject();\n    existingRange.load(\"isNullObject\");\n    await context.sync();\n    if (!existingRange.isNullObject) {\n        existingRange.clear();\n    }\n    \n    // Write current period's analysis as the new archive\n    const archiveRange = archiveSheet.getRangeByIndexes(0, 0, values.length, values[0].length);\n    archiveRange.values = values;\n    archiveRange.format.autofitColumns();\n    \n    // Reset selection to A1\n    archiveSheet.getRange(\"A1\").select();\n    await context.sync();\n}\n\nfunction getConfigValue(fieldName) {\n    const key = String(fieldName ?? \"\").trim();\n    return configState.values?.[key] ?? \"\";\n}\n\n/**\n * Get reviewer name with fallback chain:\n * 1. Step-specific reviewer (from step config fields)\n * 2. Module default (PTO_Reviewer_Name in SS_PF_Config)\n * 3. Shared default (Default_Reviewer in SS_PF_Config)\n */\nfunction getReviewerWithFallback(stepReviewer) {\n    // Step-specific\n    if (stepReviewer) return stepReviewer;\n    \n    // Module default\n    const moduleDefault = getConfigValue(PTO_CONFIG_FIELDS.reviewerName);\n    if (moduleDefault) return moduleDefault;\n    \n    // Shared default (from cached SS_PF_Config) - check new + legacy names\n    if (window.PrairieForge?._sharedConfigCache) {\n        const sharedDefault = window.PrairieForge._sharedConfigCache.get(\"SS_Default_Reviewer\") \n            || window.PrairieForge._sharedConfigCache.get(\"Default_Reviewer\");\n        if (sharedDefault) return sharedDefault;\n    }\n    \n    return \"\";\n}\n\nfunction scheduleConfigWrite(fieldName, value, options = {}) {\n    const key = String(fieldName ?? \"\").trim();\n    if (!key) return;\n    configState.values[key] = value ?? \"\";\n    const delay = options.debounceMs ?? 0;\n    if (!delay) {\n        const existing = pendingConfigWrites.get(key);\n        if (existing) clearTimeout(existing);\n        pendingConfigWrites.delete(key);\n        void saveConfigValue(key, value ?? \"\", CONFIG_TABLES);\n        return;\n    }\n    if (pendingConfigWrites.has(key)) {\n        clearTimeout(pendingConfigWrites.get(key));\n    }\n    const timer = setTimeout(() => {\n        pendingConfigWrites.delete(key);\n        void saveConfigValue(key, value ?? \"\", CONFIG_TABLES);\n    }, delay);\n    pendingConfigWrites.set(key, timer);\n}\n\nfunction normalizeName(value) {\n    return String(value ?? \"\").trim().toLowerCase();\n}\n\nfunction columnLetterFromIndex(index) {\n    let dividend = index + 1;\n    let columnName = \"\";\n    while (dividend > 0) {\n        const modulo = (dividend - 1) % 26;\n        columnName = String.fromCharCode(65 + modulo) + columnName;\n        dividend = Math.floor((dividend - modulo) / 26);\n    }\n    return columnName;\n}\n\nfunction toggleLoader(show, message = \"Working...\") {\n    // Suppress loader overlay for smoother transitions between views.\n    const overlay = document.getElementById(LOADER_ID);\n    if (overlay) overlay.style.display = \"none\";\n}\n\nfunction bootstrapModule() {\n    init();\n}\n\nif (typeof Office !== \"undefined\" && Office.onReady) {\n    Office.onReady(() => bootstrapModule()).catch(() => bootstrapModule());\n} else {\n    bootstrapModule();\n}\n\nfunction getStepConfig(stepId) {\n    return configState.steps[stepId] || { notes: \"\", reviewer: \"\", signOffDate: \"\" };\n}\n\nfunction getFieldNames(stepId) {\n    return STEP_CONFIG_FIELDS[stepId] || {};\n}\n\nfunction getStepType(stepId) {\n    if (stepId === 0) return \"config\";\n    if (stepId === 1) return \"import\";\n    if (stepId === 2) return \"headcount\";\n    if (stepId === 3) return \"validate\";\n    if (stepId === 4) return \"review\";\n    if (stepId === 5) return \"journal\";\n    if (stepId === 6) return \"archive\";\n    return \"\";\n}\n\nasync function saveStepField(stepId, key, value) {\n    const current = configState.steps[stepId] || { notes: \"\", reviewer: \"\", signOffDate: \"\" };\n    current[key] = value;\n    configState.steps[stepId] = current;\n    const fieldNames = getFieldNames(stepId);\n    const targetField =\n        key === \"notes\" ? fieldNames.note : key === \"reviewer\" ? fieldNames.reviewer : fieldNames.signOff;\n    if (!targetField) return;\n    if (!hasExcelRuntime()) return;\n    try {\n        await saveConfigValue(targetField, value, CONFIG_TABLES);\n    } catch (error) {\n        console.warn(\"PTO: unable to save field\", targetField, error);\n    }\n}\n\nasync function toggleNotePermanent(stepId, isPermanent) {\n    configState.permanents[stepId] = isPermanent;\n    const fieldNames = getFieldNames(stepId);\n    if (!fieldNames?.note) return;\n    if (!hasExcelRuntime()) return;\n    try {\n        await Excel.run(async (context) => {\n            const table = context.workbook.tables.getItemOrNullObject(CONFIG_TABLES[0]);\n            await context.sync();\n            if (table.isNullObject) return;\n            const body = table.getDataBodyRange();\n            const header = table.getHeaderRowRange();\n            body.load(\"values\");\n            header.load(\"values\");\n            await context.sync();\n            const headers = header.values[0] || [];\n            const normalizedHeaders = headers.map((h) => String(h || \"\").trim().toLowerCase());\n            const idx = {\n                field: normalizedHeaders.findIndex((h) => h === \"field\" || h === \"field name\" || h === \"setting\"),\n                permanent: normalizedHeaders.findIndex((h) => h === \"permanent\" || h === \"persist\"),\n                value: normalizedHeaders.findIndex((h) => h === \"value\" || h === \"setting value\"),\n                type: normalizedHeaders.findIndex((h) => h === \"type\" || h === \"category\"),\n                title: normalizedHeaders.findIndex((h) => h === \"title\" || h === \"display name\")\n            };\n            if (idx.field === -1) return;\n            const rows = body.values || [];\n            const targetIndex = rows.findIndex(\n                (row) => String(row[idx.field] || \"\").trim() === fieldNames.note\n            );\n            if (targetIndex >= 0) {\n                if (idx.permanent >= 0) {\n                    body.getCell(targetIndex, idx.permanent).values = [[isPermanent ? \"Y\" : \"N\"]];\n                }\n            } else {\n                // create row with permanent flag if missing\n                const newRow = new Array(headers.length).fill(\"\");\n                if (idx.type >= 0) newRow[idx.type] = \"Other\";\n                if (idx.title >= 0) newRow[idx.title] = \"\";\n                newRow[idx.field] = fieldNames.note;\n                if (idx.permanent >= 0) newRow[idx.permanent] = isPermanent ? \"Y\" : \"N\";\n                if (idx.value >= 0) newRow[idx.value] = configState.steps[stepId]?.notes || \"\";\n                table.rows.add(null, [newRow]);\n            }\n            await context.sync();\n        });\n    } catch (error) {\n        console.warn(\"PTO: unable to update permanent flag\", error);\n    }\n}\n\nasync function saveCompletionFlag(stepId, isComplete) {\n    const fieldName = STEP_COMPLETE_FIELDS[stepId];\n    if (!fieldName) return;\n    configState.completes[stepId] = isComplete ? \"Y\" : \"\";\n    if (!hasExcelRuntime()) return;\n    try {\n        await saveConfigValue(fieldName, isComplete ? \"Y\" : \"\", CONFIG_TABLES);\n    } catch (error) {\n        console.warn(\"PTO: unable to save completion flag\", fieldName, error);\n    }\n}\n\nfunction updateActionToggleState(button, isActive) {\n    if (!button) return;\n    button.classList.toggle(\"is-active\", isActive);\n    button.setAttribute(\"aria-pressed\", String(isActive));\n}\n\n/**\n * Get current step completion status for sequential validation\n * @returns {Object} Map of step IDs to boolean completion status\n */\nfunction getStepCompletionStatus() {\n    const status = {};\n    Object.keys(STEP_CONFIG_FIELDS).forEach(stepIdStr => {\n        const id = parseInt(stepIdStr, 10);\n        // A step is complete if it has a sign-off date OR is explicitly marked complete\n        const hasSignOff = Boolean(configState.steps[id]?.signOffDate);\n        const isMarkedComplete = Boolean(configState.completes[id]);\n        status[id] = hasSignOff || isMarkedComplete;\n    });\n    return status;\n}\n\nfunction bindSignoffToggle(stepId, { buttonId, inputId, canActivate = null, onComplete = null }) {\n    const button = document.getElementById(buttonId);\n    if (!button) return;\n    const input = document.getElementById(inputId);\n    const initial =\n        Boolean(configState.steps[stepId]?.signOffDate) || Boolean(configState.completes[stepId]);\n    updateActionToggleState(button, initial);\n    button.addEventListener(\"click\", () => {\n        // Check sequential completion (only when trying to activate, not deactivate)\n        const isCurrentlyActive = button.classList.contains(\"is-active\");\n        if (!isCurrentlyActive && stepId > 0) {\n            const completionStatus = getStepCompletionStatus();\n            const { canComplete, message } = canCompleteStep(stepId, completionStatus);\n            if (!canComplete) {\n                showBlockedToast(message);\n                return;\n            }\n        }\n        \n        if (typeof canActivate === \"function\" && !canActivate()) return;\n        const next = !button.classList.contains(\"is-active\");\n        updateActionToggleState(button, next);\n        if (input) {\n            input.value = next ? todayIso() : \"\";\n            saveStepField(stepId, \"signOffDate\", input.value);\n        }\n        saveCompletionFlag(stepId, next);\n        if (next && typeof onComplete === \"function\") {\n            onComplete();\n        }\n    });\n}\n\nfunction escapeHtml(value) {\n    return String(value ?? \"\")\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\");\n}\n\nfunction escapeAttr(value) {\n    return String(value ?? \"\")\n        .replace(/&/g, \"&amp;\")\n        .replace(/\"/g, \"&quot;\")\n        .replace(/'/g, \"&#39;\");\n}\n\nfunction parseBooleanFlag(value) {\n    const normalized = String(value ?? \"\").trim().toLowerCase();\n    return normalized === \"true\" || normalized === \"y\" || normalized === \"yes\" || normalized === \"1\";\n}\n\nfunction parseBooleanStrict(value) {\n    const normalized = String(value ?? \"\").trim().toLowerCase();\n    return normalized === \"true\" || normalized === \"y\" || normalized === \"yes\" || normalized === \"1\";\n}\n\nfunction parseDateInput(value) {\n    if (!value) return null;\n    const match = /^(\\d{4})-(\\d{2})-(\\d{2})$/.exec(String(value));\n    if (!match) return null;\n    const year = Number(match[1]);\n    const month = Number(match[2]);\n    const day = Number(match[3]);\n    if (!year || !month || !day) return null;\n    return { year, month, day };\n}\n\nfunction formatDateInput(value) {\n    if (!value) return \"\";\n    const parts = parseDateInput(value);\n    if (!parts) return \"\";\n    const { year, month, day } = parts;\n    return `${year}-${String(month).padStart(2, \"0\")}-${String(day).padStart(2, \"0\")}`;\n}\n\nfunction formatDateFromDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, \"0\");\n    const day = String(date.getDate()).padStart(2, \"0\");\n    return `${year}-${month}-${day}`;\n}\n\nfunction deriveAccountingPeriod(payrollDate) {\n    const parts = parseDateInput(payrollDate);\n    if (!parts) return \"\";\n    const monthNames = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n    return `${monthNames[parts.month - 1]} ${parts.year}`;\n}\n\nfunction deriveJournalId(payrollDate) {\n    const parts = parseDateInput(payrollDate);\n    if (!parts) return \"\";\n    return `PTO-AUTO-${parts.year}-${String(parts.month).padStart(2, \"0\")}-${String(parts.day).padStart(2, \"0\")}`;\n}\n\nfunction todayIso() {\n    const now = new Date();\n    const y = now.getFullYear();\n    const m = String(now.getMonth() + 1).padStart(2, \"0\");\n    const d = String(now.getDate()).padStart(2, \"0\");\n    return `${y}-${m}-${d}`;\n}\n\nfunction parsePermanentFlag(value) {\n    const normalized = String(value ?? \"\").trim().toLowerCase();\n    return normalized === \"y\" || normalized === \"yes\" || normalized === \"true\" || normalized === \"t\" || normalized === \"1\";\n}\n\nfunction coerceTimestamp(value) {\n    if (value instanceof Date) return value.getTime();\n    if (typeof value === \"number\") {\n        const date = convertExcelSerialDate(value);\n        return date ? date.getTime() : null;\n    }\n    const parsed = new Date(value);\n    return Number.isNaN(parsed.getTime()) ? null : parsed.getTime();\n}\n\nfunction convertExcelSerialDate(serial) {\n    if (!Number.isFinite(serial)) return null;\n    const excelEpoch = new Date(Date.UTC(1899, 11, 30));\n    return new Date(excelEpoch.getTime() + serial * 24 * 60 * 60 * 1000);\n}\n\nfunction persistConfigBasics() {\n    const getVal = (id) => document.getElementById(id)?.value?.trim() || \"\";\n    const fields = [\n        { id: \"config-payroll-date\", field: PTO_CONFIG_FIELDS.payrollDate },\n        { id: \"config-accounting-period\", field: PTO_CONFIG_FIELDS.accountingPeriod },\n        { id: \"config-journal-id\", field: PTO_CONFIG_FIELDS.journalEntryId },\n        { id: \"config-company-name\", field: PTO_CONFIG_FIELDS.companyName },\n        { id: \"config-payroll-provider\", field: PTO_CONFIG_FIELDS.payrollProvider },\n        { id: \"config-accounting-link\", field: PTO_CONFIG_FIELDS.accountingSoftware },\n        { id: \"config-user-name\", field: PTO_CONFIG_FIELDS.reviewerName }\n    ];\n    fields.forEach(({ id, field }) => {\n        const value = getVal(id);\n        if (!field) return;\n        scheduleConfigWrite(field, value);\n    });\n}\n\nfunction findColumnIndex(headers, keywords = []) {\n    const normalizedKeywords = keywords.map((k) => normalizeName(k));\n    return headers.findIndex((header) =>\n        normalizedKeywords.some((keyword) => header.includes(keyword))\n    );\n}\n\nfunction renderHeadcountStep(detail) {\n    const stepFields = getStepConfig(2);\n    const stepNotes = stepFields?.notes || \"\";\n    const stepNotesPermanent = Boolean(configState.permanents[2]);\n    const stepReviewer = getReviewerWithFallback(stepFields?.reviewer);\n    const stepSignOff = stepFields?.signOffDate || \"\";\n    const stepComplete = Boolean(parseBooleanStrict(configState.completes[2]) || stepSignOff);\n    const roster = headcountState.roster || {};\n    const hasRun = headcountState.hasAnalyzed;\n    const rosterDiff = headcountState.roster?.difference ?? 0;\n    const requiresNotes = !headcountState.skipAnalysis && Math.abs(rosterDiff) > 0;\n    const rosterCount = roster.rosterCount ?? 0;\n    const payrollCount = roster.payrollCount ?? 0;\n    const diffValue = roster.difference ?? payrollCount - rosterCount;\n    const mismatchList = Array.isArray(roster.mismatches) ? roster.mismatches.filter(Boolean) : [];\n    \n    // Status banner\n    let statusBanner = \"\";\n    if (headcountState.loading) {\n        statusBanner = window.PrairieForge?.renderStatusBanner?.({\n            type: \"info\",\n            message: \"Analyzing headcount\u2026\",\n            escapeHtml\n        }) || \"\";\n    } else if (headcountState.lastError) {\n        statusBanner = window.PrairieForge?.renderStatusBanner?.({\n            type: \"error\",\n            message: headcountState.lastError,\n            escapeHtml\n        }) || \"\";\n    }\n    \n    // Build check rows (circle + pill format)\n    const renderCheckRow = (label, desc, value, isMatch) => {\n        const pending = !hasRun;\n        let circleHtml;\n        \n        if (pending) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pending\"></span>`;\n        } else if (isMatch) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pass\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><polyline points=\"20 6 9 17 4 12\"/></svg>\n            </span>`;\n        } else {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--fail\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n            </span>`;\n        }\n        \n        const valueDisplay = hasRun ? ` = ${value}` : \"\";\n        \n        return `\n            <div class=\"pf-je-check-row\">\n                ${circleHtml}\n                <span class=\"pf-je-check-desc-pill\">${escapeHtml(label)}${valueDisplay}</span>\n            </div>\n        `;\n    };\n    \n    const checkRowsHtml = `\n        ${renderCheckRow(\"SS_Employee_Roster count\", \"Active employees in roster\", rosterCount, true)}\n        ${renderCheckRow(\"PTO_Data count\", \"Unique employees in PTO data\", payrollCount, true)}\n        ${renderCheckRow(\"Difference\", \"Should be zero\", diffValue, diffValue === 0)}\n    `;\n    \n    // Mismatch section\n    const mismatchSection =\n        mismatchList.length && !headcountState.skipAnalysis && hasRun\n            ? window.PrairieForge.renderMismatchTiles({\n                  mismatches: mismatchList,\n                  label: \"Employees Driving the Difference\",\n                  sourceLabel: \"Roster\",\n                  targetLabel: \"PTO Data\",\n                  escapeHtml: escapeHtml\n              })\n            : \"\";\n    \n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n            <div class=\"pf-skip-action\">\n                <button type=\"button\" class=\"pf-skip-btn ${headcountState.skipAnalysis ? \"is-active\" : \"\"}\" id=\"headcount-skip-btn\">\n                    ${X_CIRCLE_SVG}\n                    <span>Skip Analysis</span>\n                </button>\n            </div>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Run Headcount Check</h3>\n                    <p class=\"pf-config-subtext\">Compare employee roster against PTO data to identify discrepancies.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(`<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"headcount-run-btn\" title=\"Run headcount analysis\">${CALCULATOR_ICON_SVG}</button>`, \"Run\")}\n                    ${renderLabeledButton(`<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"headcount-refresh-btn\" title=\"Refresh headcount analysis\">${REFRESH_ICON_SVG}</button>`, \"Refresh\")}\n                </div>\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Headcount Comparison</h3>\n                    <p class=\"pf-config-subtext\">Verify roster and payroll data align before proceeding.</p>\n                </div>\n                ${statusBanner}\n                <div class=\"pf-je-checks-container\">\n                    ${checkRowsHtml}\n                </div>\n                ${mismatchSection}\n            </article>\n            ${renderInlineNotes({\n                textareaId: \"step-notes-input\",\n                value: stepNotes,\n                permanentId: \"step-notes-lock-2\",\n                isPermanent: stepNotesPermanent,\n                hintId: requiresNotes ? \"headcount-notes-hint\" : \"\",\n                saveButtonId: \"step-notes-save-2\"\n            })}\n            ${renderSignoff({\n                reviewerInputId: \"step-reviewer-name\",\n                reviewerValue: stepReviewer,\n                signoffInputId: \"step-signoff-date\",\n                signoffValue: stepSignOff,\n                isComplete: stepComplete,\n                saveButtonId: \"headcount-signoff-save\",\n                completeButtonId: \"headcount-signoff-toggle\"\n            })}\n        </section>\n    `;\n}\n\n/**\n * Render unified Apple-inspired Data Readiness card\n * Combines completeness check pills + missing pay rate resolution\n */\nfunction renderDataReadinessCard() {\n    const check = analysisState.completenessCheck || {};\n    const missing = analysisState.missingPayRates || [];\n    \n    // Completeness check fields with descriptions\n    const fields = [\n        { key: \"accrualRate\", label: \"Accrual Rate\", desc: \"\u2211 PTO_Data = \u2211 PTO_Analysis\" },\n        { key: \"carryOver\", label: \"Carry Over\", desc: \"\u2211 PTO_Data = \u2211 PTO_Analysis\" },\n        { key: \"ytdAccrued\", label: \"YTD Accrued\", desc: \"\u2211 PTO_Data = \u2211 PTO_Analysis\" },\n        { key: \"ytdUsed\", label: \"YTD Used\", desc: \"\u2211 PTO_Data = \u2211 PTO_Analysis\" },\n        { key: \"balance\", label: \"Balance\", desc: \"\u2211 PTO_Data = \u2211 PTO_Analysis\" }\n    ];\n    \n    // Calculate overall status\n    const allChecked = fields.every(f => check[f.key] !== null && check[f.key] !== undefined);\n    const allPassed = allChecked && fields.every(f => check[f.key]?.match);\n    const hasMissingRates = missing.length > 0;\n    \n    // Build check rows (circle + pill format like JE tab)\n    const renderCheckRow = (field) => {\n        const result = check[field.key];\n        const pending = result === null || result === undefined;\n        let circleHtml;\n        \n        if (pending) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pending\"></span>`;\n        } else if (result.match) {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pass\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><polyline points=\"20 6 9 17 4 12\"/></svg>\n            </span>`;\n        } else {\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--fail\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n            </span>`;\n        }\n        \n        return `\n            <div class=\"pf-je-check-row\">\n                ${circleHtml}\n                <span class=\"pf-je-check-desc-pill\">${escapeHtml(field.label)}: ${escapeHtml(field.desc)}</span>\n            </div>\n        `;\n    };\n    \n    const checkRowsHtml = fields.map(f => renderCheckRow(f)).join(\"\");\n    \n    // Missing pay rate section\n    let missingSection = \"\";\n    if (hasMissingRates) {\n        const employee = missing[0];\n        const remainingCount = missing.length - 1;\n        \n        missingSection = `\n            <div class=\"pf-readiness-divider\"></div>\n            <div class=\"pf-readiness-issue\">\n                <div class=\"pf-readiness-issue-header\">\n                    <span class=\"pf-readiness-issue-badge\">Action Required</span>\n                    <span class=\"pf-readiness-issue-title\">Missing Pay Rate</span>\n                </div>\n                <p class=\"pf-readiness-issue-desc\">\n                    Enter hourly rate for <strong>${escapeHtml(employee.name)}</strong> to calculate liability\n                </p>\n                <div class=\"pf-readiness-input-row\">\n                    <div class=\"pf-readiness-input-field\">\n                        <span class=\"pf-readiness-input-prefix\">$</span>\n                        <input type=\"number\" \n                               id=\"payrate-input\" \n                               class=\"pf-readiness-input\" \n                               placeholder=\"0.00\" \n                               step=\"0.01\"\n                               min=\"0\"\n                               data-employee=\"${escapeAttr(employee.name)}\"\n                               data-row=\"${employee.rowIndex}\">\n                    </div>\n                    <button type=\"button\" class=\"pf-readiness-btn pf-readiness-btn--secondary\" id=\"payrate-ignore-btn\">\n                        Skip\n                    </button>\n                    <button type=\"button\" class=\"pf-readiness-btn pf-readiness-btn--primary\" id=\"payrate-save-btn\">\n                        Save\n                    </button>\n                </div>\n                ${remainingCount > 0 ? `<p class=\"pf-readiness-remaining\">${remainingCount} more employee${remainingCount > 1 ? \"s\" : \"\"} need pay rates</p>` : \"\"}\n            </div>\n        `;\n    }\n    \n    return `\n        <article class=\"pf-step-card pf-step-detail pf-config-card\" id=\"data-readiness-card\">\n            <div class=\"pf-config-head\">\n                <h3>Data Completeness</h3>\n                <p class=\"pf-config-subtext\">Quick check that all your data transferred correctly.</p>\n            </div>\n            <div class=\"pf-je-checks-container\">\n                ${checkRowsHtml}\n            </div>\n            ${missingSection}\n        </article>\n    `;\n}\n\nfunction renderDataQualityStep(detail) {\n    const stepFields = getStepConfig(3);\n    const notesPermanent = Boolean(configState.permanents[3]);\n    const stepReviewer = getReviewerWithFallback(stepFields?.reviewer);\n    const stepSignOff = stepFields?.signOffDate || \"\";\n    const stepComplete = Boolean(parseBooleanStrict(configState.completes[3]) || stepSignOff);\n    \n    // Build quality check results display\n    const hasRun = dataQualityState.hasRun;\n    const { balanceIssues, zeroBalances, accrualOutliers, totalEmployees } = dataQualityState;\n    \n    // Status banner\n    let statusBanner = \"\";\n    if (dataQualityState.loading) {\n        statusBanner = window.PrairieForge?.renderStatusBanner?.({\n            type: \"info\",\n            message: \"Analyzing data quality...\",\n            escapeHtml\n        }) || \"\";\n    } else if (hasRun) {\n        const criticalCount = balanceIssues.length;\n        const warningCount = accrualOutliers.length + zeroBalances.length;\n        \n        if (criticalCount > 0) {\n            statusBanner = window.PrairieForge?.renderStatusBanner?.({\n                type: \"error\",\n                title: `${criticalCount} Balance Issue${criticalCount > 1 ? \"s\" : \"\"} Found`,\n                message: \"Review the issues below. Fix in PTO_Data and re-run, or acknowledge to continue.\",\n                escapeHtml\n            }) || \"\";\n        } else if (warningCount > 0) {\n            statusBanner = window.PrairieForge?.renderStatusBanner?.({\n                type: \"warning\",\n                title: \"No Critical Issues\",\n                message: `${warningCount} informational item${warningCount > 1 ? \"s\" : \"\"} to review (see below).`,\n                escapeHtml\n            }) || \"\";\n        } else {\n            statusBanner = window.PrairieForge?.renderStatusBanner?.({\n                type: \"success\",\n                title: \"Data Quality Passed\",\n                message: `${totalEmployees} employee${totalEmployees !== 1 ? \"s\" : \"\"} checked \u2014 no anomalies found.`,\n                escapeHtml\n            }) || \"\";\n        }\n    }\n    \n    // Build issue cards\n    const issueCards = [];\n    \n    if (hasRun && balanceIssues.length > 0) {\n        issueCards.push(`\n            <div class=\"pf-quality-issue pf-quality-issue--critical\">\n                <div class=\"pf-quality-issue-header\">\n                    <span class=\"pf-quality-issue-icon\">\u26A0\uFE0F</span>\n                    <span class=\"pf-quality-issue-title\">Balance Issues (${balanceIssues.length})</span>\n                </div>\n                <ul class=\"pf-quality-issue-list\">\n                    ${balanceIssues.slice(0, 5).map(e => \n                        `<li><strong>${escapeHtml(e.name)}</strong>: ${escapeHtml(e.issue)}</li>`\n                    ).join(\"\")}\n                    ${balanceIssues.length > 5 ? `<li class=\"pf-quality-more\">+${balanceIssues.length - 5} more</li>` : \"\"}\n                </ul>\n            </div>\n        `);\n    }\n    \n    if (hasRun && accrualOutliers.length > 0) {\n        issueCards.push(`\n            <div class=\"pf-quality-issue pf-quality-issue--warning\">\n                <div class=\"pf-quality-issue-header\">\n                    <span class=\"pf-quality-issue-icon\">\uD83D\uDCCA</span>\n                    <span class=\"pf-quality-issue-title\">High Accrual Rates (${accrualOutliers.length})</span>\n                </div>\n                <ul class=\"pf-quality-issue-list\">\n                    ${accrualOutliers.slice(0, 5).map(e => \n                        `<li><strong>${escapeHtml(e.name)}</strong>: ${e.accrualRate.toFixed(2)} hrs/period</li>`\n                    ).join(\"\")}\n                    ${accrualOutliers.length > 5 ? `<li class=\"pf-quality-more\">+${accrualOutliers.length - 5} more</li>` : \"\"}\n                </ul>\n            </div>\n        `);\n    }\n    \n    if (hasRun && zeroBalances.length > 0) {\n        issueCards.push(`\n            <div class=\"pf-quality-issue pf-quality-issue--info\">\n                <div class=\"pf-quality-issue-header\">\n                    <span class=\"pf-quality-issue-icon\">\u2139\uFE0F</span>\n                    <span class=\"pf-quality-issue-title\">Zero Balances (${zeroBalances.length})</span>\n                </div>\n                <ul class=\"pf-quality-issue-list\">\n                    ${zeroBalances.slice(0, 5).map(e => \n                        `<li><strong>${escapeHtml(e.name)}</strong></li>`\n                    ).join(\"\")}\n                    ${zeroBalances.length > 5 ? `<li class=\"pf-quality-more\">+${zeroBalances.length - 5} more</li>` : \"\"}\n                </ul>\n            </div>\n        `);\n    }\n    \n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Run Quality Check</h3>\n                    <p class=\"pf-config-subtext\">Scan your imported data for common errors before proceeding.</p>\n                </div>\n                ${statusBanner}\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(`<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"quality-run-btn\" title=\"Run data quality checks\">${CALCULATOR_ICON_SVG}</button>`, \"Run\")}\n                </div>\n            </article>\n            ${issueCards.length > 0 ? `\n                <article class=\"pf-step-card pf-step-detail\">\n                    <div class=\"pf-config-head\">\n                        <h3>Issues Found</h3>\n                        <p class=\"pf-config-subtext\">Fix issues in PTO_Data and re-run, or acknowledge to continue.</p>\n                    </div>\n                    <div class=\"pf-quality-issues-grid\">\n                        ${issueCards.join(\"\")}\n                    </div>\n                    <div class=\"pf-quality-actions-bar\">\n                        ${dataQualityState.acknowledged \n                            ? `<p class=\"pf-quality-actions-hint\"><span class=\"pf-acknowledged-badge\">\u2713 Issues Acknowledged</span></p>` \n                            : \"\"}\n                        <div class=\"pf-signoff-action\">\n                            ${renderLabeledButton(`<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"quality-refresh-btn\" title=\"Re-run quality checks\">${REFRESH_ICON_SVG}</button>`, \"Refresh\")}\n                            ${!dataQualityState.acknowledged ? renderLabeledButton(`<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"quality-acknowledge-btn\" title=\"Acknowledge issues and continue\">${CHECK_ICON_SVG}</button>`, \"Continue\") : \"\"}\n                        </div>\n                    </div>\n                </article>\n            ` : \"\"}\n            ${renderInlineNotes({\n                textareaId: \"step-notes-3\",\n                value: stepFields?.notes || \"\",\n                permanentId: \"step-notes-lock-3\",\n                isPermanent: notesPermanent,\n                hintId: \"\",\n                saveButtonId: \"step-notes-save-3\"\n            })}\n            ${renderSignoff({\n                reviewerInputId: \"step-reviewer-3\",\n                reviewerValue: stepReviewer,\n                signoffInputId: \"step-signoff-3\",\n                signoffValue: stepSignOff,\n                isComplete: stepComplete,\n                saveButtonId: \"step-signoff-save-3\",\n                completeButtonId: \"step-signoff-toggle-3\"\n            })}\n        </section>\n    `;\n}\n\nfunction renderAccrualReviewStep(detail) {\n    const stepFields = getStepConfig(4);\n    const notesPermanent = Boolean(configState.permanents[4]);\n    const stepReviewer = getReviewerWithFallback(stepFields?.reviewer);\n    const stepSignOff = stepFields?.signOffDate || \"\";\n    const stepComplete = Boolean(parseBooleanStrict(configState.completes[4]) || stepSignOff);\n    \n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Run Analysis</h3>\n                    <p class=\"pf-config-subtext\">Calculate liabilities and compare against last period.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"analysis-run-btn\" title=\"Run analysis and checks\">${CALCULATOR_ICON_SVG}</button>`,\n                        \"Run\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"analysis-refresh-btn\" title=\"Refresh data from PTO_Data\">${REFRESH_ICON_SVG}</button>`,\n                        \"Refresh\"\n                    )}\n                </div>\n            </article>\n            ${renderDataReadinessCard()}\n            ${renderInlineNotes({\n                textareaId: \"step-notes-4\",\n                value: stepFields?.notes || \"\",\n                permanentId: \"step-notes-lock-4\",\n                isPermanent: notesPermanent,\n                hintId: \"\",\n                saveButtonId: \"step-notes-save-4\"\n            })}\n            ${renderSignoff({\n                reviewerInputId: \"step-reviewer-4\",\n                reviewerValue: stepReviewer,\n                signoffInputId: \"step-signoff-4\",\n                signoffValue: stepSignOff,\n                isComplete: stepComplete,\n                saveButtonId: \"step-signoff-save-4\",\n                completeButtonId: \"step-signoff-toggle-4\"\n            })}\n        </section>\n    `;\n}\n\nfunction renderJournalStep(detail) {\n    const stepFields = getStepConfig(5);\n    const notesPermanent = Boolean(configState.permanents[5]);\n    const stepReviewer = getReviewerWithFallback(stepFields?.reviewer);\n    const stepSignOff = stepFields?.signOffDate || \"\";\n    const stepComplete = Boolean(parseBooleanStrict(configState.completes[5]) || stepSignOff);\n    const statusNote = journalState.lastError\n        ? `<p class=\"pf-step-note\">${escapeHtml(journalState.lastError)}</p>`\n        : \"\";\n    \n    // Build validation check rows: circle icon on left, description pill on right\n    const hasRun = journalState.validationRun;\n    const issues = journalState.issues || [];\n    \n    // Define check descriptions (what's being calculated)\n    const checkDefinitions = [\n        { key: \"Debits = Credits\", desc: \"\u2211 Debit column = \u2211 Credit column\" },\n        { key: \"Line Amounts Sum to Zero\", desc: \"\u2211 Line Amount = $0.00\" },\n        { key: \"JE Matches Analysis Total\", desc: \"\u2211 Expense line amounts = \u2211 PTO_Analysis Change\" }\n    ];\n    \n    const renderCheckRow = (def) => {\n        const issue = issues.find(i => i.check === def.key);\n        const pending = !hasRun;\n        let circleHtml;\n        \n        if (pending) {\n            // Empty circle - waiting for validation\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pending\"></span>`;\n        } else if (issue?.passed) {\n            // Checkmark in circle\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--pass\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><polyline points=\"20 6 9 17 4 12\"/></svg>\n            </span>`;\n        } else {\n            // X in circle\n            circleHtml = `<span class=\"pf-je-check-circle pf-je-circle--fail\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n            </span>`;\n        }\n        \n        return `\n            <div class=\"pf-je-check-row\">\n                ${circleHtml}\n                <span class=\"pf-je-check-desc-pill\">${escapeHtml(def.desc)}</span>\n            </div>\n        `;\n    };\n    \n    const checkRows = checkDefinitions.map(def => renderCheckRow(def)).join(\"\");\n    \n    // Build issues card if there are failures\n    const failedIssues = issues.filter(i => !i.passed);\n    let issuesCard = \"\";\n    if (hasRun && failedIssues.length > 0) {\n        issuesCard = `\n            <article class=\"pf-step-card pf-step-detail pf-je-issues-card\">\n                <div class=\"pf-config-head\">\n                    <h3>\u26A0\uFE0F Issues Identified</h3>\n                    <p class=\"pf-config-subtext\">The following checks did not pass:</p>\n                </div>\n                <ul class=\"pf-je-issues-list\">\n                    ${failedIssues.map(i => `<li><strong>${escapeHtml(i.check)}:</strong> ${escapeHtml(i.detail)}</li>`).join(\"\")}\n                </ul>\n            </article>\n        `;\n    }\n    \n    return `\n        <section class=\"pf-hero\" id=\"pf-step-hero\">\n            <p class=\"pf-hero-copy\">${escapeHtml(MODULE_NAME)} | Step ${detail.id}</p>\n            <h2 class=\"pf-hero-title\">${escapeHtml(detail.title)}</h2>\n            <p class=\"pf-hero-copy\">${escapeHtml(detail.summary || \"\")}</p>\n        </section>\n        <section class=\"pf-step-guide\">\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Generate Journal Entry</h3>\n                    <p class=\"pf-config-subtext\">Create a balanced JE from your imported PTO data, grouped by department.</p>\n                </div>\n                <div class=\"pf-signoff-action\">\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"je-create-btn\" title=\"Generate journal entry from PTO_Analysis\">${TABLE_ICON_SVG}</button>`,\n                        \"Generate\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"je-run-btn\" title=\"Refresh validation checks\">${REFRESH_ICON_SVG}</button>`,\n                        \"Refresh\"\n                    )}\n                    ${renderLabeledButton(\n                        `<button type=\"button\" class=\"pf-action-toggle pf-clickable\" id=\"je-export-btn\" title=\"Export journal draft as CSV\">${DOWNLOAD_ICON_SVG}</button>`,\n                        \"Export\"\n                    )}\n                </div>\n            </article>\n            <article class=\"pf-step-card pf-step-detail pf-config-card\">\n                <div class=\"pf-config-head\">\n                    <h3>Validation Checks</h3>\n                    <p class=\"pf-config-subtext\">These checks run automatically after generating your JE.</p>\n                </div>\n                ${statusNote}\n                <div class=\"pf-je-checks-container\">\n                    ${checkRows}\n                </div>\n            </article>\n            ${issuesCard}\n            ${renderInlineNotes({\n                textareaId: \"step-notes-5\",\n                value: stepFields?.notes || \"\",\n                permanentId: \"step-notes-lock-5\",\n                isPermanent: notesPermanent,\n                hintId: \"\",\n                saveButtonId: \"step-notes-save-5\"\n            })}\n            ${renderSignoff({\n                reviewerInputId: \"step-reviewer-5\",\n                reviewerValue: stepReviewer,\n                signoffInputId: \"step-signoff-5\",\n                signoffValue: stepSignOff,\n                isComplete: stepComplete,\n                saveButtonId: \"step-signoff-save-5\",\n                completeButtonId: \"step-signoff-toggle-5\"\n            })}\n        </section>\n    `;\n}\n\nfunction headcountHasDifferences() {\n    const rosterDiff = Math.abs(headcountState.roster?.difference ?? 0);\n    return rosterDiff > 0;\n}\n\nfunction isHeadcountNotesRequired() {\n    return !headcountState.skipAnalysis && headcountHasDifferences();\n}\n\nfunction formatMetricValue(value) {\n    if (value === null || value === undefined || value === \"\") return \"---\";\n    const num = Number(value);\n    const formatter = window.PrairieForge?.formatNumber;\n    if (Number.isFinite(num)) {\n        return formatter ? formatter(num) : num.toLocaleString(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n    }\n    return String(value);\n}\n\nfunction formatNumberDisplay(value) {\n    if (value === null || value === undefined || value === \"\") return \"---\";\n    const num = Number(value);\n    const formatter = window.PrairieForge?.formatNumber;\n    if (Number.isFinite(num)) {\n        return formatter ? formatter(num) : num.toLocaleString(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n    }\n    return String(value);\n}\n\nfunction formatSignedValue(value) {\n    if (value === null || value === undefined) return \"---\";\n    if (typeof value !== \"number\" || Number.isNaN(value)) return \"---\";\n    if (value === 0) return \"0\";\n    return value > 0 ? `+${value}` : value.toString();\n}\n\nasync function refreshHeadcountAnalysis() {\n    if (!hasExcelRuntime()) {\n        headcountState.loading = false;\n        headcountState.lastError = \"Excel runtime is unavailable.\";\n        renderApp();\n        return;\n    }\n    headcountState.loading = true;\n    headcountState.lastError = null;\n    // Reset save button since data is being refreshed\n    updateSaveButtonState(document.getElementById(\"headcount-save-btn\"), false);\n    renderApp();\n    try {\n        const results = await Excel.run(async (context) => {\n            // Use SS_Employee_Roster as the single source of truth for employee data\n            const rosterSheet = context.workbook.worksheets.getItem(\"SS_Employee_Roster\");\n            const payrollSheet = context.workbook.worksheets.getItem(\"PTO_Data\");\n            const analysisSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Analysis\");\n            const rosterRange = rosterSheet.getUsedRangeOrNullObject();\n            const payrollRange = payrollSheet.getUsedRangeOrNullObject();\n            rosterRange.load(\"values\");\n            payrollRange.load(\"values\");\n            analysisSheet.load(\"isNullObject\");\n            await context.sync();\n            let analysisRange = null;\n            if (!analysisSheet.isNullObject) {\n                analysisRange = analysisSheet.getUsedRangeOrNullObject();\n                analysisRange.load(\"values\");\n            }\n            await context.sync();\n            const rosterValues = rosterRange.isNullObject ? [] : rosterRange.values || [];\n            const payrollValues = payrollRange.isNullObject ? [] : payrollRange.values || [];\n            const analysisValues = analysisRange && !analysisRange.isNullObject ? analysisRange.values || [] : [];\n            // Prefer PTO_Analysis if it has data, otherwise fall back to PTO_Data\n            const payrollSource = analysisValues.length ? analysisValues : payrollValues;\n            return parseHeadcount(rosterValues, payrollSource);\n        });\n        headcountState.roster = results.roster;\n        headcountState.hasAnalyzed = true;\n        headcountState.lastError = null;\n    } catch (error) {\n        console.warn(\"PTO headcount: unable to analyze data\", error);\n        headcountState.lastError = \"Unable to analyze headcount data. Try re-running the analysis.\";\n    } finally {\n        headcountState.loading = false;\n        renderApp();\n    }\n}\n\n/**\n * Check if a value looks like a summary row (total, subtotal, etc.)\n * @param {string} value - Value to check\n * @returns {boolean} True if it should be excluded\n */\nfunction isSummaryOrEmpty(value) {\n    if (!value) return true;\n    const lower = value.toLowerCase().trim();\n    if (!lower) return true;\n    const summaryPatterns = [\"total\", \"subtotal\", \"sum\", \"count\", \"grand\", \"average\", \"avg\"];\n    return summaryPatterns.some((pattern) => lower.includes(pattern));\n}\n\nfunction parseHeadcount(rosterValues, payrollValues) {\n    const roster = {\n        rosterCount: 0,\n        payrollCount: 0,\n        difference: 0,\n        mismatches: []\n    };\n\n    // Require at least header + 1 data row\n    if ((rosterValues?.length || 0) < 2 || (payrollValues?.length || 0) < 2) {\n        console.warn(\"Headcount: insufficient data rows\", {\n            rosterRows: rosterValues?.length || 0,\n            payrollRows: payrollValues?.length || 0\n        });\n        return { roster };\n    }\n\n    const rosterHeaderInfo = findHeaderRow(rosterValues);\n    const payrollHeaderInfo = findHeaderRow(payrollValues);\n\n    const rosterHeaders = rosterHeaderInfo.headers;\n    const payrollHeaders = payrollHeaderInfo.headers;\n\n    const rosterIdx = {\n        employee: getEmployeeColumnIndex(rosterHeaders),\n        termination: rosterHeaders.findIndex((h) => h.includes(\"termination\"))\n    };\n    const payrollIdx = {\n        employee: getEmployeeColumnIndex(payrollHeaders)\n    };\n\n    // Log column detection for debugging\n    console.log(\"Headcount column detection:\", {\n        rosterEmployeeCol: rosterIdx.employee,\n        rosterTerminationCol: rosterIdx.termination,\n        payrollEmployeeCol: payrollIdx.employee,\n        rosterHeaders: rosterHeaders.slice(0, 5),\n        payrollHeaders: payrollHeaders.slice(0, 5)\n    });\n\n    const rosterSet = new Set();\n    const payrollSet = new Set();\n\n    // Count unique employees from roster (excluding terminated and summary rows)\n    for (let i = rosterHeaderInfo.startIndex; i < rosterValues.length; i += 1) {\n        const row = rosterValues[i];\n        const employee = rosterIdx.employee >= 0 ? normalizeString(row[rosterIdx.employee]) : \"\";\n        if (isSummaryOrEmpty(employee)) continue;\n        // Skip terminated employees\n        const termination = rosterIdx.termination >= 0 ? normalizeString(row[rosterIdx.termination]) : \"\";\n        if (termination) continue;\n        rosterSet.add(employee.toLowerCase());\n    }\n\n    // Count unique employees from payroll (excluding summary rows)\n    for (let i = payrollHeaderInfo.startIndex; i < payrollValues.length; i += 1) {\n        const row = payrollValues[i];\n        const employee = payrollIdx.employee >= 0 ? normalizeString(row[payrollIdx.employee]) : \"\";\n        if (isSummaryOrEmpty(employee)) continue;\n        payrollSet.add(employee.toLowerCase());\n    }\n\n    roster.rosterCount = rosterSet.size;\n    roster.payrollCount = payrollSet.size;\n    roster.difference = roster.payrollCount - roster.rosterCount;\n\n    console.log(\"Headcount results:\", {\n        rosterCount: roster.rosterCount,\n        payrollCount: roster.payrollCount,\n        difference: roster.difference\n    });\n\n    const missingInPayroll = [...rosterSet].filter((name) => !payrollSet.has(name));\n    const missingInRoster = [...payrollSet].filter((name) => !rosterSet.has(name));\n    roster.mismatches = [\n        ...missingInPayroll.map((name) => `In roster, missing in PTO_Data: ${name}`),\n        ...missingInRoster.map((name) => `In PTO_Data, missing in roster: ${name}`)\n    ];\n    return { roster };\n}\n\nfunction findHeaderRow(values) {\n    if (!Array.isArray(values) || !values.length) {\n        return { headers: [], startIndex: 1 };\n    }\n    const headerRowIndex = values.findIndex((row = []) =>\n        row.some((cell) => {\n            const normalized = normalizeString(cell).toLowerCase();\n            return normalized.includes(\"employee\");\n        })\n    );\n    const index = headerRowIndex === -1 ? 0 : headerRowIndex;\n    const headers = (values[index] || []).map((h) => normalizeString(h).toLowerCase());\n    return { headers, startIndex: index + 1 };\n}\n\nfunction getEmployeeColumnIndex(headers = []) {\n    let bestIndex = -1;\n    let bestScore = -1;\n    headers.forEach((header, index) => {\n        const value = header.toLowerCase();\n        if (!value.includes(\"employee\")) return;\n        let score = 1; // baseline: contains \"employee\"\n        if (value.includes(\"name\")) {\n            score = 4; // prefer explicit name column\n        } else if (value.includes(\"id\")) {\n            score = 2; // lower priority than name\n        } else {\n            score = 3; // generic employee column without name/id hints\n        }\n        if (score > bestScore) {\n            bestScore = score;\n            bestIndex = index;\n        }\n    });\n    return bestIndex;\n}\n\nfunction normalizeString(value) {\n    return value == null ? \"\" : String(value).trim();\n}\n\n/**\n * Sync PTO_Analysis from PTO_Data with enrichment from roster, payroll archive, and prior period.\n * This replaces the old PTO_Data_Clean - PTO_Analysis now serves as the single\n * source of enriched employee PTO data.\n * \n * Columns:\n * - Analysis Date, Employee Name, Department, Pay Rate, Accrual Rate, Carry Over, YTD Used, Balance\n * - Liability Amount (current period)\n * - Accrued PTO $ [Prior Period] (from PTO_Archive_Summary, 0 if not found)\n * - Change (current - prior)\n */\nasync function syncPtoAnalysis(contextArg = null) {\n    const runner = async (context) => {\n        const dataSheet = context.workbook.worksheets.getItem(\"PTO_Data\");\n        const analysisSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Analysis\");\n        const rosterSheet = context.workbook.worksheets.getItemOrNullObject(\"SS_Employee_Roster\");\n        const prArchiveSheet = context.workbook.worksheets.getItemOrNullObject(\"PR_Archive_Summary\");\n        const ptoArchiveSheet = context.workbook.worksheets.getItemOrNullObject(\"PTO_Archive_Summary\");\n        const dataRange = dataSheet.getUsedRangeOrNullObject();\n        dataRange.load(\"values\");\n        analysisSheet.load(\"isNullObject\");\n        rosterSheet.load(\"isNullObject\");\n        prArchiveSheet.load(\"isNullObject\");\n        ptoArchiveSheet.load(\"isNullObject\");\n        await context.sync();\n\n        const dataValues = dataRange.isNullObject ? [] : dataRange.values || [];\n        if (!dataValues.length) return;\n        const dataHeaders = (dataValues[0] || []).map((h) => normalizeName(h));\n        const empIdx = dataHeaders.findIndex((h) => h.includes(\"employee\") && h.includes(\"name\"));\n        const targetEmpIdx = empIdx >= 0 ? empIdx : 0;\n        const accrualRateIdx = findColumnIndex(dataHeaders, [\"accrual rate\"]);\n        const carryOverIdx = findColumnIndex(dataHeaders, [\"carry over\", \"carryover\"]);\n        // Be specific - \"ytd\" must be in the column name to avoid matching \"Pay Period Accrued\"\n        const ytdAccruedIdx = dataHeaders.findIndex((h) => h.includes(\"ytd\") && (h.includes(\"accrued\") || h.includes(\"accrual\")));\n        // Be specific - \"ytd\" must be in the column name to avoid matching \"Pay Period Used\"\n        const ytdUsedIdx = dataHeaders.findIndex((h) => h.includes(\"ytd\") && h.includes(\"used\"));\n        const balanceIdx = findColumnIndex(dataHeaders, [\"balance\", \"current balance\", \"pto balance\"]);\n        \n        // Debug logging for column detection\n        console.log(\"[PTO Analysis] PTO_Data headers:\", dataHeaders);\n        console.log(\"[PTO Analysis] Column indices found:\", {\n            employee: targetEmpIdx,\n            accrualRate: accrualRateIdx,\n            carryOver: carryOverIdx,\n            ytdAccrued: ytdAccruedIdx,\n            ytdUsed: ytdUsedIdx,\n            balance: balanceIdx\n        });\n        \n        // Log the actual header names at each index\n        if (ytdUsedIdx >= 0) {\n            console.log(`[PTO Analysis] YTD Used column: \"${dataHeaders[ytdUsedIdx]}\" at index ${ytdUsedIdx}`);\n        } else {\n            console.warn(\"[PTO Analysis] YTD Used column NOT FOUND. Headers:\", dataHeaders);\n        }\n        const names = dataValues\n            .slice(1)\n            .map((row) => normalizeString(row[targetEmpIdx]))\n            .filter((name) => name && !name.toLowerCase().includes(\"total\"));\n        const dataMap = new Map();\n        dataValues.slice(1).forEach((row) => {\n            const name = normalizeName(row[targetEmpIdx]);\n            if (!name || name.includes(\"total\")) return;\n            dataMap.set(name, row);\n        });\n\n        // Build roster map for department lookup from SS_Employee_Roster\n        let rosterMap = new Map();\n        if (!rosterSheet.isNullObject) {\n            const rosterRange = rosterSheet.getUsedRangeOrNullObject();\n            rosterRange.load(\"values\");\n            await context.sync();\n            const rosterValues = rosterRange.isNullObject ? [] : rosterRange.values || [];\n            if (rosterValues.length) {\n                const rosterHeaders = (rosterValues[0] || []).map((h) => normalizeName(h));\n                console.log(\"[PTO Analysis] SS_Employee_Roster headers:\", rosterHeaders);\n                \n                // More flexible column matching - try multiple patterns\n                let rosterNameIdx = rosterHeaders.findIndex((h) => h.includes(\"employee\") && h.includes(\"name\"));\n                if (rosterNameIdx < 0) {\n                    rosterNameIdx = rosterHeaders.findIndex((h) => h === \"employee\" || h === \"name\" || h === \"full name\");\n                }\n                \n                const rosterDeptIdx = rosterHeaders.findIndex((h) => h.includes(\"department\"));\n                \n                console.log(`[PTO Analysis] Roster column indices - Name: ${rosterNameIdx}, Dept: ${rosterDeptIdx}`);\n                \n                if (rosterNameIdx >= 0 && rosterDeptIdx >= 0) {\n                    rosterValues.slice(1).forEach((row) => {\n                        const empName = normalizeName(row[rosterNameIdx]);\n                        const dept = normalizeString(row[rosterDeptIdx]);\n                        if (empName) {\n                            rosterMap.set(empName, dept);\n                        }\n                    });\n                    console.log(`[PTO Analysis] Built roster map with ${rosterMap.size} employees`);\n                } else {\n                    console.warn(\"[PTO Analysis] Could not find Name or Department columns in SS_Employee_Roster\");\n                }\n            }\n        } else {\n            console.warn(\"[PTO Analysis] SS_Employee_Roster sheet not found\");\n        }\n\n        // Build archive map for pay rate lookup (from PR_Archive_Summary)\n        let payRateMap = new Map();\n        if (!prArchiveSheet.isNullObject) {\n            const archiveRange = prArchiveSheet.getUsedRangeOrNullObject();\n            archiveRange.load(\"values\");\n            await context.sync();\n            const archiveValues = archiveRange.isNullObject ? [] : archiveRange.values || [];\n            if (archiveValues.length) {\n                const archiveHeaders = (archiveValues[0] || []).map((h) => normalizeName(h));\n                const idx = {\n                    payrollDate: findColumnIndex(archiveHeaders, [\"payroll date\"]),\n                    employee: findColumnIndex(archiveHeaders, [\"employee\"]),\n                    category: findColumnIndex(archiveHeaders, [\"payroll category\", \"category\"]),\n                    amount: findColumnIndex(archiveHeaders, [\"amount\", \"gross salary\", \"gross_salary\", \"earnings\"])\n                };\n                if (idx.employee >= 0 && idx.category >= 0 && idx.amount >= 0) {\n                    archiveValues.slice(1).forEach((row) => {\n                        const name = normalizeName(row[idx.employee]);\n                        if (!name) return;\n                        const category = normalizeName(row[idx.category]);\n                        if (!category.includes(\"regular\") || !category.includes(\"earn\")) return;\n                        const amount = Number(row[idx.amount]) || 0;\n                        if (!amount) return;\n                        const timestamp = coerceTimestamp(row[idx.payrollDate]);\n                        const existing = payRateMap.get(name);\n                        if (!existing || (timestamp != null && timestamp > existing.timestamp)) {\n                            payRateMap.set(name, { payRate: amount / 80, timestamp });\n                        }\n                    });\n                }\n            }\n        }\n\n        // Build prior period liability map (from PTO_Archive_Summary)\n        let priorLiabilityMap = new Map();\n        if (!ptoArchiveSheet.isNullObject) {\n            const ptoArchiveRange = ptoArchiveSheet.getUsedRangeOrNullObject();\n            ptoArchiveRange.load(\"values\");\n            await context.sync();\n            const ptoArchiveValues = ptoArchiveRange.isNullObject ? [] : ptoArchiveRange.values || [];\n            if (ptoArchiveValues.length > 1) {\n                const ptoArchiveHeaders = (ptoArchiveValues[0] || []).map((h) => normalizeName(h));\n                const priorNameIdx = ptoArchiveHeaders.findIndex((h) => h.includes(\"employee\") && h.includes(\"name\"));\n                const priorLiabilityIdx = findColumnIndex(ptoArchiveHeaders, [\"liability amount\", \"liability\", \"accrued pto\"]);\n                if (priorNameIdx >= 0 && priorLiabilityIdx >= 0) {\n                    ptoArchiveValues.slice(1).forEach((row) => {\n                        const name = normalizeName(row[priorNameIdx]);\n                        if (!name) return;\n                        const liability = Number(row[priorLiabilityIdx]) || 0;\n                        priorLiabilityMap.set(name, liability);\n                    });\n                }\n            }\n        }\n\n        const analysisDate = getConfigValue(PTO_CONFIG_FIELDS.payrollDate) || \"\";\n        \n        // Track data quality issues\n        const missingPayRates = [];\n        const missingDepartments = [];\n        \n        const rows = names.map((name, idx) => {\n            const normalized = normalizeName(name);\n            const department = rosterMap.get(normalized) || \"\";\n            const payRate = payRateMap.get(normalized)?.payRate ?? \"\";\n            const dataRow = dataMap.get(normalized);\n            const accrualRate = dataRow && accrualRateIdx >= 0 ? dataRow[accrualRateIdx] ?? \"\" : \"\";\n            const carryOver = dataRow && carryOverIdx >= 0 ? dataRow[carryOverIdx] ?? \"\" : \"\";\n            const ytdAccrued = dataRow && ytdAccruedIdx >= 0 ? dataRow[ytdAccruedIdx] ?? \"\" : \"\";\n            const ytdUsed = dataRow && ytdUsedIdx >= 0 ? dataRow[ytdUsedIdx] ?? \"\" : \"\";\n            \n            // Debug logging for specific employees with issues\n            if (normalized.includes(\"avalos\") || normalized.includes(\"sarah\")) {\n                console.log(`[PTO Debug] ${name}:`, {\n                    ytdUsedIdx,\n                    rawValue: dataRow ? dataRow[ytdUsedIdx] : \"no dataRow\",\n                    ytdUsed,\n                    fullRow: dataRow\n                });\n            }\n            const balance = dataRow && balanceIdx >= 0 ? Number(dataRow[balanceIdx]) || 0 : 0;\n            \n            // Track missing data (row index is +2 because of header and 0-based)\n            const rowIndex = idx + 2;\n            if (!payRate && typeof payRate !== \"number\") {\n                missingPayRates.push({ name, rowIndex });\n            }\n            if (!department) {\n                missingDepartments.push({ name, rowIndex });\n            }\n            \n            // Calculate current liability amount: Balance (hours) \u00D7 Pay Rate ($/hr)\n            const liabilityAmount = (typeof payRate === \"number\" && balance) ? balance * payRate : 0;\n            \n            // Get prior period liability (0 if employee not found in archive)\n            const priorLiability = priorLiabilityMap.get(normalized) ?? 0;\n            \n            // Calculate change (current - prior)\n            const change = (typeof liabilityAmount === \"number\" ? liabilityAmount : 0) - priorLiability;\n            \n            return [analysisDate, name, department, payRate, accrualRate, carryOver, ytdAccrued, ytdUsed, balance, liabilityAmount, priorLiability, change];\n        });\n        \n        // Update state with data quality info\n        analysisState.missingPayRates = missingPayRates.filter(e => !analysisState.ignoredMissingPayRates.has(e.name));\n        analysisState.missingDepartments = missingDepartments;\n        \n        console.log(`[PTO Analysis] Data quality: ${missingPayRates.length} missing pay rates, ${missingDepartments.length} missing departments`);\n        const output = [\n            [\"Analysis Date\", \"Employee Name\", \"Department\", \"Pay Rate\", \"Accrual Rate\", \"Carry Over\", \"YTD Accrued\", \"YTD Used\", \"Balance\", \"Liability Amount\", \"Accrued PTO $ [Prior Period]\", \"Change\"],\n            ...rows\n        ];\n\n        // Write to PTO_Analysis (create if doesn't exist)\n        const targetSheet = analysisSheet.isNullObject ? context.workbook.worksheets.add(\"PTO_Analysis\") : analysisSheet;\n        const used = targetSheet.getUsedRangeOrNullObject();\n        used.load(\"address\");\n        await context.sync();\n        if (!used.isNullObject) {\n            used.clear();\n        }\n        \n        const columnCount = output[0].length;\n        const rowCount = output.length;\n        const dataRowCount = rows.length;\n        const range = targetSheet.getRangeByIndexes(0, 0, rowCount, columnCount);\n        range.values = output;\n        \n        // Format header row using shared utility (black bg, white bold text)\n        const headerRange = targetSheet.getRangeByIndexes(0, 0, 1, columnCount);\n        formatSheetHeaders(headerRange);\n        \n        // Apply column formatting using shared utilities\n        // Column indices (0-based):\n        // A=0: Analysis Date, B=1: Employee Name, C=2: Department\n        // D=3: Pay Rate, E=4: Accrual Rate, F=5: Carry Over, G=6: YTD Accrued, H=7: YTD Used\n        // I=8: Balance, J=9: Liability Amount, K=10: Accrued PTO $ [Prior Period], L=11: Change\n        \n        if (dataRowCount > 0) {\n            formatDateColumn(targetSheet, 0, dataRowCount);           // A: Analysis Date\n            formatCurrencyColumn(targetSheet, 3, dataRowCount);       // D: Pay Rate\n            formatNumberColumn(targetSheet, 4, dataRowCount);         // E: Accrual Rate\n            formatNumberColumn(targetSheet, 5, dataRowCount);         // F: Carry Over\n            formatNumberColumn(targetSheet, 6, dataRowCount);         // G: YTD Accrued\n            formatNumberColumn(targetSheet, 7, dataRowCount);         // H: YTD Used\n            formatNumberColumn(targetSheet, 8, dataRowCount);         // I: Balance\n            formatCurrencyColumn(targetSheet, 9, dataRowCount);       // J: Liability Amount\n            formatCurrencyColumn(targetSheet, 10, dataRowCount);      // K: Accrued PTO $ [Prior Period]\n            formatCurrencyColumn(targetSheet, 11, dataRowCount, true); // L: Change (with negative parens)\n        }\n        \n        range.format.autofitColumns();\n        \n        // Reset selection to A1 so tab switching doesn't land on a random cell\n        targetSheet.getRange(\"A1\").select();\n        await context.sync();\n    };\n\n    if (!hasExcelRuntime()) return;\n    if (contextArg) {\n        await runner(contextArg);\n    } else {\n        await Excel.run(runner);\n    }\n}\n\nfunction buildCsv(rows = []) {\n    return rows\n        .map((row) =>\n            (row || [])\n                .map((cell) => {\n                    if (cell == null) return \"\";\n                    const str = String(cell);\n                    if (/[\",\\n]/.test(str)) return `\"${str.replace(/\"/g, '\"\"')}\"`;\n                    return str;\n                })\n                .join(\",\")\n        )\n        .join(\"\\n\");\n}\n\nfunction downloadCsv(filename, content) {\n    const blob = new Blob([content], { type: \"text/csv;charset=utf-8;\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n}\n\nfunction updateHeadcountSignoffState() {\n    const button = document.getElementById(\"headcount-signoff-toggle\");\n    if (!button) return;\n    const notesRequired = isHeadcountNotesRequired();\n    const notesInput = document.getElementById(\"step-notes-input\");\n    const notesValue = notesInput?.value.trim() || \"\";\n    button.disabled = notesRequired && !notesValue;\n    const hint = document.getElementById(\"headcount-notes-hint\");\n    if (hint) {\n        hint.textContent = notesRequired\n            ? \"Please document outstanding differences before signing off.\"\n            : \"\";\n    }\n}\n\nfunction enforceHeadcountSkipNote() {\n    const textarea = document.getElementById(\"step-notes-input\");\n    if (!textarea) return;\n    const current = textarea.value || \"\";\n    const remainder = current.startsWith(HEADCOUNT_SKIP_NOTE)\n        ? current.slice(HEADCOUNT_SKIP_NOTE.length).replace(/^\\s+/, \"\")\n        : current.replace(new RegExp(`^${HEADCOUNT_SKIP_NOTE}\\\\s*`, \"i\"), \"\").trimStart();\n    const next = HEADCOUNT_SKIP_NOTE + (remainder ? `\\n${remainder}` : \"\");\n    if (textarea.value !== next) {\n        textarea.value = next;\n    }\n    saveStepField(2, \"notes\", textarea.value);\n}\n\nfunction bindHeadcountNotesGuard() {\n    const textarea = document.getElementById(\"step-notes-input\");\n    if (!textarea) return;\n    textarea.addEventListener(\"input\", () => {\n        if (!headcountState.skipAnalysis) return;\n        const value = textarea.value || \"\";\n        if (!value.startsWith(HEADCOUNT_SKIP_NOTE)) {\n            const remainder = value.replace(HEADCOUNT_SKIP_NOTE, \"\").trimStart();\n            textarea.value = HEADCOUNT_SKIP_NOTE + (remainder ? `\\n${remainder}` : \"\");\n        }\n        saveStepField(2, \"notes\", textarea.value);\n    });\n}\n\nfunction handleHeadcountSignoff() {\n    const notesRequired = isHeadcountNotesRequired();\n    const notesValue = document.getElementById(\"step-notes-input\")?.value.trim() || \"\";\n    if (notesRequired && !notesValue) {\n        window.alert(\"Please enter a brief explanation of the outstanding differences before completing this step.\");\n        return;\n    }\n}\n"],
  "mappings": "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",
  "names": ["hasExcelRuntime", "SHARED_CONFIG_TABLE", "getConfigTable", "context", "tableCandidates", "_a", "tables", "match", "t", "getColumnIndices", "headers", "normalizedHeaders", "h", "loadConfigFromTable", "hasExcelRuntime", "table", "body", "headerRange", "cols", "values", "row", "field", "error", "saveConfigValue", "fieldName", "value", "targetIndex", "newRow", "CONFIG_SHEET_NAME", "PREFIX_CATEGORY", "SYSTEM_MODULE", "DEFAULT_PREFIX_CONFIG", "getPrefixConfig", "hasExcelRuntime", "DEFAULT_PREFIX_CONFIG", "context", "_a", "_b", "configSheet", "CONFIG_SHEET_NAME", "usedRange", "values", "headerMap", "buildHeaderMap", "categoryIdx", "fieldIdx", "valueIdx", "prefixConfig", "foundPrefixRows", "i", "row", "normalizeToken", "PREFIX_CATEGORY", "prefix", "moduleKey", "error", "applyModuleTabVisibility", "normalizedModuleKey", "worksheets", "modulePrefixes", "module", "activePrefixes", "systemPrefixes", "SYSTEM_MODULE", "otherPrefixes", "prefixes", "toShow", "toHide", "sheet", "sheetName", "upperName", "matchesActive", "p", "matchesOther", "matchesSystem", "s", "e", "showAllSheets", "hasExcelRuntime", "context", "worksheets", "unhiddenCount", "sheet", "error", "unhideSystemSheets", "prefixConfig", "getPrefixConfig", "systemPrefixes", "prefix", "module", "SYSTEM_MODULE", "upperName", "p", "buildHeaderMap", "headers", "map", "header", "index", "normalized", "normalizeToken", "value", "showAllSheets", "unhideSystemSheets", "applyModuleTabVisibility", "BRANDING", "ADA_IMAGE_URL", "BRANDING", "activateHomepageSheet", "sheetName", "title", "subtitle", "context", "sheet", "targetSheet", "setupHomepageContent", "error", "usedRange", "data", "dataRange", "backgroundRange", "titleCell", "subtitleCell", "HOMEPAGE_CONFIG", "getHomepageConfig", "moduleKey", "renderAdaFab", "removeAdaFab", "fab", "showAdaModal", "existingFab", "existingModal", "overlay", "closeBtn", "hideAdaModal", "e", "handleEscape", "HOME_ICON_SVG", "MODULES_ICON_SVG", "MENU_ICON_SVG", "TABLE_ICON_SVG", "USERS_ICON_SVG", "BOOK_ICON_SVG", "STEP_ICON_MAP", "getStepIconSvg", "type", "LOCK_OPEN_SVG", "LOCK_CLOSED_SVG", "CHECK_ICON_SVG", "CALCULATOR_ICON_SVG", "HAMMER_ICON_SVG", "LINK_ICON_SVG", "DOWNLOAD_ICON_SVG", "X_CIRCLE_SVG", "ARROW_LEFT_SVG", "SAVE_ICON_SVG", "ARROW_RIGHT_SVG", "CHECK_CIRCLE_SVG", "ALERT_CIRCLE_SVG", "ALERT_TRIANGLE_SVG", "INFO_CIRCLE_SVG", "CIRCLE_CHECK_BIG_SVG", "CIRCLE_X_SVG", "ARROW_UP_FROM_LINE_SVG", "ARROW_DOWN_TO_LINE_SVG", "REFRESH_ICON_SVG", "TRASH_ICON_SVG", "escapeHtml", "str", "renderLabeledButton", "buttonHtml", "label", "renderInlineNotes", "textareaId", "value", "permanentId", "isPermanent", "hintId", "saveButtonId", "isSaved", "placeholder", "lockIcon", "LOCK_CLOSED_SVG", "LOCK_OPEN_SVG", "saveButton", "SAVE_ICON_SVG", "lockButton", "renderSignoff", "reviewerInputId", "reviewerValue", "signoffInputId", "signoffValue", "isComplete", "completeButtonId", "subtext", "completeButton", "CHECK_ICON_SVG", "updateLockButtonVisual", "button", "isLocked", "LOCK_CLOSED_SVG", "LOCK_OPEN_SVG", "updateSaveButtonState", "button", "isSaved", "initSaveTracking", "container", "saveButtons", "cleanupFns", "saveButton", "inputId", "input", "handleChange", "fn", "canCompleteStep", "stepId", "completionStatus", "i", "showBlockedToast", "message", "existing", "toast", "HEADER_STYLE", "NUMBER_FORMATS", "formatSheetHeaders", "headerRange", "formatCurrencyColumn", "sheet", "colIndex", "dataRowCount", "showNegativeInParens", "colRange", "NUMBER_FORMATS", "formatNumberColumn", "formatDateColumn", "format", "MODULE_VERSION", "MODULE_KEY", "MODULE_NAME", "HERO_COPY", "SELECTOR_URL", "LOADER_ID", "CONFIG_TABLES", "PTO_CONFIG_FIELDS", "HEADCOUNT_SKIP_NOTE", "STEP_CONFIG_FIELDS", "STEP_COMPLETE_FIELDS", "WORKFLOW_STEPS", "stepStatuses", "WORKFLOW_STEPS", "acc", "step", "appState", "configState", "rootEl", "loadingEl", "pendingScrollIndex", "pendingConfigWrites", "headcountState", "journalState", "dataQualityState", "analysisState", "init", "_a", "ensureTabVisibility", "loadStepConfig", "homepageConfig", "getHomepageConfig", "MODULE_KEY", "activateHomepageSheet", "renderApp", "error", "applyModuleTabVisibility", "hasExcelRuntime", "moduleValues", "loadConfigFromTable", "CONFIG_TABLES", "sharedValues", "value", "key", "values", "fieldMappings", "PTO_CONFIG_FIELDS", "sharedField", "ptoField", "loadPermanentFlags", "STEP_CONFIG_FIELDS", "stepId", "fields", "_b", "_c", "STEP_COMPLETE_FIELDS", "field", "permanents", "fieldToStep", "context", "table", "body", "header", "normalizedHeaders", "h", "idx", "row", "fieldName", "flag", "parsePermanentFlag", "prevDisabled", "nextDisabled", "isStepView", "content", "renderConfigView", "renderStepView", "renderHero", "renderWorkflow", "ARROW_LEFT_SVG", "HOME_ICON_SVG", "MODULES_ICON_SVG", "ARROW_RIGHT_SVG", "MENU_ICON_SVG", "USERS_ICON_SVG", "BOOK_ICON_SVG", "MODULE_VERSION", "isHomeView", "infoFabElement", "infoConfig", "getStepInfoConfig", "bindInteractions", "scrollFocusedIntoView", "renderAdaFab", "removeAdaFab", "HERO_COPY", "index", "renderStepCard", "status", "isActive", "icon", "getStepIconSvg", "getStepType", "renderArchiveStep", "detail", "completionItems", "isStepComplete", "allComplete", "item", "statusList", "CHECK_ICON_SVG", "escapeHtml", "MODULE_NAME", "payrollDate", "formatDateInput", "getConfigValue", "accountingPeriod", "journalEntryId", "accountingLink", "payrollLink", "companyName", "userName", "stepFields", "getStepConfig", "notesPermanent", "parseBooleanFlag", "stepReviewer", "getReviewerWithFallback", "stepSignOff", "renderInlineNotes", "renderSignoff", "renderImportStep", "stepComplete", "parseBooleanStrict", "providerLink", "renderLabeledButton", "LINK_ICON_SVG", "TABLE_ICON_SVG", "TRASH_ICON_SVG", "renderHeadcountStep", "renderDataQualityStep", "renderAccrualReviewStep", "renderJournalStep", "_d", "_e", "_f", "_g", "setState", "SELECTOR_URL", "moveFocus", "quickToggle", "quickDropdown", "e", "openReferenceSheet", "unhideSystemSheets", "card", "focusStep", "bindConfigView", "bindStepView", "_h", "_i", "_j", "_k", "_l", "_m", "_n", "_o", "_p", "_q", "notesInput", "reviewerInput", "signoffInput", "backBtn", "lockBtn", "notesSaveBtn", "notes", "saveStepField", "updateSaveButtonState", "signoffSaveBtn", "reviewer", "initSaveTracking", "signoffButtonId", "signoffInputId", "bindSignoffToggle", "isHeadcountNotesRequired", "handleHeadcountSignoff", "nextLocked", "updateLockButtonVisual", "toggleNotePermanent", "openSheet", "clearPtoData", "skipBtn", "enforceHeadcountSkipNote", "updateHeadcountSignoffState", "refreshHeadcountAnalysis", "bindHeadcountNotesGuard", "runDataQualityCheck", "acknowledgeQualityIssues", "runFullAnalysis", "handlePayRateSave", "handlePayRateIgnore", "createJournalDraft", "runJournalSummary", "exportJournalDraft", "payrollInput", "event", "scheduleConfigWrite", "derivedPeriod", "deriveAccountingPeriod", "periodInput", "derivedJe", "deriveJournalId", "jeInput", "journalInput", "lockButton", "today", "todayIso", "saveCompletionFlag", "reviewerValue", "signoffValue", "persistConfigBasics", "resolvedStepId", "syncPtoAnalysis", "delta", "next", "target", "setState", "partial", "appState", "renderApp", "hasExcel", "handlePayRateSave", "input", "payRate", "employeeName", "rowIndex", "toggleLoader", "context", "sheet", "payRateCell", "balanceCell", "liabilityAmount", "liabilityCell", "priorCell", "priorLiability", "change", "changeCell", "analysisState", "e", "focusStep", "error", "handlePayRateIgnore", "runDataQualityCheck", "hasExcel", "dataQualityState", "updateSaveButtonState", "_a", "dataRange", "dataValues", "headers", "normalizeName", "nameIdx", "balanceIdx", "findColumnIndex", "accrualRateIdx", "carryOverIdx", "ytdAccruedIdx", "ytdUsedIdx", "balanceIssues", "zeroBalances", "accrualOutliers", "dataRows", "row", "idx", "name", "balance", "accrualRate", "carryOver", "ytdAccrued", "ytdUsed", "maxUsable", "r", "c", "hasBlockingIssues", "setState", "renderApp", "acknowledgeQualityIssues", "runCompletenessCheck", "dataSheet", "analysisSheet", "analysisRange", "analysisValues", "sumColumn", "rows", "columnAliases", "label", "h", "sum", "fields", "results", "field", "ptoDataSum", "analysisSum", "match", "runFullAnalysis", "syncPtoAnalysis", "runJournalSummary", "hasExcel", "journalState", "updateSaveButtonState", "renderApp", "totals", "context", "jeRange", "analysisSheet", "jeValues", "jeHeaders", "h", "normalizeName", "debitIdx", "findColumnIndex", "creditIdx", "lineAmountIdx", "acctNumIdx", "debitTotal", "creditTotal", "lineAmountSum", "jeChangeTotal", "row", "debit", "credit", "lineAmount", "acctNum", "analysisChangeTotal", "analysisRange", "analysisValues", "analysisHeaders", "changeIdx", "difference", "issues", "changeDiff", "error", "DEPARTMENT_EXPENSE_ACCOUNTS", "LIABILITY_OFFSET_ACCOUNT", "createJournalDraft", "toggleLoader", "configRange", "CONFIG_TABLES", "coaSheet", "coaData", "coaRange", "configValues", "configMap", "field", "value", "PTO_CONFIG_FIELDS", "refNumber", "rawTxnDate", "accountingPeriod", "txnDate", "d", "serialNum", "excelEpoch", "mm", "dd", "yyyy", "e", "lineDescBase", "coaMap", "coaHeaders", "acctNameIdx", "num", "name", "headers", "deptIdx", "deptTotals", "dept", "change", "jeRows", "totalDebits", "totalCredits", "deptKey", "expenseAcct", "expenseAcctName", "netChange", "liabilityDebit", "liabilityCredit", "liabilityAcctName", "jeSheet", "usedRange", "writeRange", "headerRange", "formatSheetHeaders", "dataRowCount", "formatCurrencyColumn", "exportJournalDraft", "rows", "range", "values", "csv", "buildCsv", "downloadCsv", "todayIso", "openSheet", "sheetName", "hasExcel", "context", "sheet", "error", "clearPtoData", "toggleLoader", "usedRange", "openReferenceSheet", "defaultHeaders", "headers", "headerRange", "unhideSystemSheets", "worksheets", "unhiddenCount", "configSheet", "getConfigValue", "fieldName", "_a", "_b", "key", "configState", "getReviewerWithFallback", "stepReviewer", "moduleDefault", "PTO_CONFIG_FIELDS", "sharedDefault", "scheduleConfigWrite", "value", "options", "delay", "existing", "pendingConfigWrites", "saveConfigValue", "CONFIG_TABLES", "timer", "normalizeName", "toggleLoader", "show", "message", "overlay", "LOADER_ID", "bootstrapModule", "init", "getStepConfig", "stepId", "configState", "getFieldNames", "STEP_CONFIG_FIELDS", "getStepType", "saveStepField", "key", "value", "current", "fieldNames", "targetField", "hasExcelRuntime", "saveConfigValue", "CONFIG_TABLES", "error", "toggleNotePermanent", "isPermanent", "context", "_a", "table", "body", "header", "headers", "normalizedHeaders", "h", "idx", "targetIndex", "row", "newRow", "saveCompletionFlag", "isComplete", "fieldName", "STEP_COMPLETE_FIELDS", "updateActionToggleState", "button", "isActive", "getStepCompletionStatus", "status", "stepIdStr", "id", "hasSignOff", "isMarkedComplete", "bindSignoffToggle", "buttonId", "inputId", "canActivate", "onComplete", "input", "initial", "completionStatus", "canComplete", "canCompleteStep", "showBlockedToast", "next", "todayIso", "escapeHtml", "escapeAttr", "parseBooleanFlag", "normalized", "parseBooleanStrict", "parseDateInput", "match", "year", "month", "day", "formatDateInput", "parts", "deriveAccountingPeriod", "payrollDate", "parts", "parseDateInput", "deriveJournalId", "todayIso", "now", "y", "m", "d", "parsePermanentFlag", "value", "normalized", "coerceTimestamp", "date", "convertExcelSerialDate", "parsed", "serial", "excelEpoch", "persistConfigBasics", "getVal", "id", "_a", "_b", "PTO_CONFIG_FIELDS", "field", "scheduleConfigWrite", "findColumnIndex", "headers", "keywords", "normalizedKeywords", "k", "normalizeName", "header", "keyword", "renderHeadcountStep", "detail", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "stepFields", "getStepConfig", "stepNotes", "stepNotesPermanent", "configState", "stepReviewer", "getReviewerWithFallback", "stepSignOff", "stepComplete", "parseBooleanStrict", "roster", "headcountState", "hasRun", "rosterDiff", "requiresNotes", "rosterCount", "payrollCount", "diffValue", "mismatchList", "statusBanner", "escapeHtml", "renderCheckRow", "label", "desc", "isMatch", "pending", "circleHtml", "valueDisplay", "checkRowsHtml", "mismatchSection", "MODULE_NAME", "X_CIRCLE_SVG", "renderLabeledButton", "CALCULATOR_ICON_SVG", "REFRESH_ICON_SVG", "renderInlineNotes", "renderSignoff", "renderDataReadinessCard", "check", "analysisState", "missing", "fields", "allPassed", "f", "hasMissingRates", "result", "missingSection", "employee", "remainingCount", "escapeAttr", "renderDataQualityStep", "notesPermanent", "dataQualityState", "balanceIssues", "zeroBalances", "accrualOutliers", "totalEmployees", "criticalCount", "warningCount", "issueCards", "e", "CHECK_ICON_SVG", "renderAccrualReviewStep", "renderJournalStep", "statusNote", "journalState", "issues", "checkDefinitions", "def", "issue", "i", "checkRows", "failedIssues", "issuesCard", "TABLE_ICON_SVG", "DOWNLOAD_ICON_SVG", "headcountHasDifferences", "isHeadcountNotesRequired", "refreshHeadcountAnalysis", "hasExcelRuntime", "headcountState", "renderApp", "updateSaveButtonState", "results", "context", "rosterSheet", "payrollSheet", "analysisSheet", "rosterRange", "payrollRange", "analysisRange", "rosterValues", "payrollValues", "analysisValues", "payrollSource", "parseHeadcount", "error", "isSummaryOrEmpty", "value", "lower", "pattern", "roster", "rosterHeaderInfo", "findHeaderRow", "payrollHeaderInfo", "rosterHeaders", "payrollHeaders", "rosterIdx", "getEmployeeColumnIndex", "h", "payrollIdx", "rosterSet", "payrollSet", "i", "row", "employee", "normalizeString", "missingInPayroll", "name", "missingInRoster", "values", "headerRowIndex", "cell", "index", "headers", "bestIndex", "bestScore", "header", "score", "syncPtoAnalysis", "contextArg", "runner", "dataSheet", "prArchiveSheet", "ptoArchiveSheet", "dataRange", "dataValues", "dataHeaders", "normalizeName", "empIdx", "targetEmpIdx", "accrualRateIdx", "findColumnIndex", "carryOverIdx", "ytdAccruedIdx", "ytdUsedIdx", "balanceIdx", "names", "dataMap", "rosterMap", "rosterNameIdx", "rosterDeptIdx", "empName", "dept", "payRateMap", "archiveRange", "archiveValues", "archiveHeaders", "idx", "category", "amount", "timestamp", "coerceTimestamp", "existing", "priorLiabilityMap", "ptoArchiveRange", "ptoArchiveValues", "ptoArchiveHeaders", "priorNameIdx", "priorLiabilityIdx", "liability", "analysisDate", "getConfigValue", "PTO_CONFIG_FIELDS", "missingPayRates", "missingDepartments", "rows", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "normalized", "department", "payRate", "dataRow", "accrualRate", "carryOver", "ytdAccrued", "ytdUsed", "balance", "rowIndex", "liabilityAmount", "priorLiability", "change", "analysisState", "e", "output", "targetSheet", "used", "columnCount", "rowCount", "dataRowCount", "range", "headerRange", "formatSheetHeaders", "formatDateColumn", "formatCurrencyColumn", "formatNumberColumn", "buildCsv", "str", "downloadCsv", "filename", "content", "blob", "url", "link", "updateHeadcountSignoffState", "button", "notesRequired", "isHeadcountNotesRequired", "notesInput", "notesValue", "hint", "enforceHeadcountSkipNote", "textarea", "current", "remainder", "HEADCOUNT_SKIP_NOTE", "next", "saveStepField", "bindHeadcountNotesGuard", "handleHeadcountSignoff"]
}
